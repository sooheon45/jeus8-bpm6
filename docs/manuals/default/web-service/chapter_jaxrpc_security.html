<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제27장 JAX-RPC 웹 서비스의 보안</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="JEUS Web Service 안내서"/><link rel="up" href="pt02.html" title="Part II. JAX-RPC 웹 서비스의 지원"/><link rel="prev" href="chapter_jaxrpc_datatype.html" title="제26장 JAX-RPC 웹 서비스 데이터 타입"/><link rel="next" href="glossary.html" title="용어해설"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제27장 JAX-RPC 웹 서비스의 보안</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_jaxrpc_datatype.html">이전</a> </td><td class="navbar-title" width="60%" align="center">Part II. JAX-RPC 웹 서비스의 지원</td><td width="20%" align="right"> <a accesskey="n" href="glossary.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_jaxrpc_security"></a>제27장 JAX-RPC 웹 서비스의 보안</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_overview_webservice_security">27.1. 개요</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_jeus_webservice_security_ssl">27.2. 전송 수준 보안</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_jeus_webservice_message_security">27.3. 메시지 수준 보안</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_apply_jeus_webservice_security">27.3.1. 웹 서비스 보안 적용</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_architecture_jeus_webservice_security">27.3.2. 웹 서비스 보안 아키텍처</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_configure_jeus_webservice_security">27.3.3. JEUS 웹 서비스 보안 설정</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_generate_password_callback_class">27.3.4. 패스워드 Callback 클래스 생성</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_example_jeus_webservice_server_security">27.3.5. JEUS 웹 서비스 서버 보안 적용 예제</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_example_jeus_webservice_client_security">27.3.6. JEUS 웹 서비스 클라이언트 보안 적용 예제</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_writing_jeus_webservice_client_through_api">27.3.7. 보안 API를 이용한 JEUS 웹 서비스 클라이언트의 작성</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_configure_jeus_webservice_domain">27.4. 접근 제어 설정</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_configure_java_class_webservice_domain">27.4.1. Java 클래스 웹 서비스 접근 제어 설정</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_configure_ejb_webservice_domain">27.4.2. EJB 웹 서비스의 접근 제어 설정</a></span></dt><dt><span class="section"><a href="chapter_jaxrpc_security.html#sect_call_webservice_with_domain">27.4.3. 접근 제어가 설정된 웹 서비스 호출</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 JEUS에서 JAX-RPC 웹 서비스에 보안을 적용하기 위한 방법을 설명한다.</p>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sect_overview_webservice_security"></a>27.1. 개요</h2></div></div></div>
    

    <p>전통적으로 웹 서비스에 보안을 적용하기 위해서는 다음과 같은 2가지 방식이 존재한다.</p><div class="itemizedlist"><ul type="disc"><li>
          <p>전송 수준 보안(Transport-level Security)<a id="d4e7537" class="indexterm"></a><a id="d4e7539" class="indexterm"></a></p>

          <p>SSL을 이용하여 클라이언트와 웹 서비스 사이의 연결의 보안을 보장한다.</p>

          <p>전송 수준 보안을 적용하려면 클라이언트와 JEUS 서버 간의 연결을 SSL을 이용하여 안전하게 할 수 있다.
          그러나 이러한 방식은 연결 자체만을 안전하게 하며 클라이언트와 JEUS 서버 사이에 라우터나 메시지 큐와 같은
          매개체(Intermediary)가 있다면 매개체는 SOAP 메시지를 암호화되지 않은 읽히기 쉬운 텍스트 문서 형태로 가질
          수 있다. 또 전송 수준 보안은 전체적인 메시지를 다루므로 메시지 일부에의 보안 적용이 불가능하다.</p>
        </li><li>
          <p>메시지 수준 보안<a id="d4e7546" class="indexterm"></a><a id="d4e7548" class="indexterm"></a></p>

          <p>SOAP 메시지를 전자 서명이나 암호화한다.</p>

          <p>메시지 수준 보안은 SSL의 보안상의 장점을 포함하면서 부가적인 유연성을 제공한다. 메시지 수준 보안은 메시지
          전달 과정에서 하나 이상의 매개체가 존재하더라도 보안이 유지되는 End-to-End 보안이며, 연결 자체의 보안 유지된다는
          SOAP 메시지 자체의 서명과 암호화를 의미한다. 또한 부분적인 서명과 암호화가 가능하다는 장점이 있다.</p>
        </li></ul></div>

    <p/>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sect_jeus_webservice_security_ssl"></a>27.2. 전송 수준 보안</h2></div></div></div>
    

    <p><a id="d4e7557" class="indexterm"></a>웹 서비스의 전송 수준 보안은 웹 서비스 클라이언트 응용 프로그램과 웹 서비스 간의 연결을 SSL을 이용하여
    안전하게 하는 것을 의미한다.</p>

    <p>전체적인 절차는 다음과 같다.</p>

    <div class="orderedlist"><ol type="1"><li>
          <p>JEUS 서버의 SSL 설정한다.</p>

          <p>웹 서비스 개발 부분은 추가 작업이 필요하지 않다. JEUS 서버에서의 SSL 설정에 대한 자세한 내용은
          <a xmlns="" href="../web-engine/index.html" class="olink">"JEUS Web Engine
          안내서"</a>를 참고한다.</p>
        </li><li>
          <p>다음의 과정으로 클라이언트 응용 프로그램의 SSL을 설정한다.</p>

          <div class="orderedlist"><ol type="a"><li>
                <p>인증서를 가져온다(Internet Explorer 등을 통해 인증서를 로컬 디렉터리에
                저장한다).</p>
              </li><li>
                <p>가져온 인증서를 Keystore에 저장한다.</p>
              </li><li>
                <p>wsdl2java를 이용하여 WSDL로부터 Stub을 생성하거나 클라이언트에서 웹 서비스를 호출하기
                위해 클라이언트를 실행하려고 할 때 시스템 프로퍼티 값을 다음과 같이 설정한다.</p>

                <pre class="programlisting">–Djavax.net.ssl.trustStore=keystore_name</pre>

                <pre class="programlisting">–Djavax.net.ssl.trustStorePassword=keystore_password</pre>
              </li><li>
                <p>Ant가 아닌 wsdl2java 콘솔 툴을 사용한다면 다음과 같은 환경변수 설정이
                필요하다.</p>

                <pre class="programlisting">set WSDL2JAVA_OPTS=-Djavax.net.ssl.trustStore=keystore_name 
      -Djavax.net.ssl.trustStorePassword=keystore_password</pre>
              </li></ol></div>
        </li></ol></div>

    <p/>

    <p/>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sect_jeus_webservice_message_security"></a>27.3. 메시지 수준 보안</h2></div></div></div>
    

    <p><a id="d4e7586" class="indexterm"></a>메시지 수준의 보안은 웹 서비스와 웹 서비스를 호출하는 클라이언트 간의 SOAP 메시지가 서명이나 암호화되는
    것을 의미한다.</p>

    <p>JEUS 웹 서비스는 다음과 같은 OASIS 웹 서비스 보안 표준 1.0을 지원한다.</p><div class="itemizedlist"><ul type="disc"><li>
          <p>OASIS Stardard 1.0</p>

          <div class="itemizedlist"><ul type="circle"><li>
                <p>SOAP Message Security V1.0</p>
              </li><li>
                <p>Username Token Profile V1.0</p>
              </li><li>
                <p>X.509 Token Profile V1.0</p>
              </li></ul></div>
        </li></ul></div>

    <p>위와 같은 표준들은 인증, 권한 부여, 데이터 무결성 및 기밀성 보장에 관한 요구 조건을 명시하며 각종 기업
    애플리케이션들에 존재하는 보안 쟁점들을 해결할 수 있게 한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_apply_jeus_webservice_security"></a>27.3.1. 웹 서비스 보안 적용</h3></div></div></div>
      

      <p>JEUS 웹 서비스에서는 다음과 같이 적용이 가능하다.</p><div class="itemizedlist"><ul type="disc"><li>
            <p>클라이언트는 X.509 인증서를 사용하여 SOAP 메시지의 암호화와 서명을 하여 보안이 적용된 웹 서비스를
            호출할 수 있고, 웹 서비스는 다시 X.509 인증서를 이용하여 SOAP 메시지를 암호화와 서명을 하여 응답으로 내보낼
            수 있다.</p>

            <p>SOAP 메시지는 메시지 안에 모든 보안 관련 정보들을 포함하고 있으므로, 클라이언트와 웹 서비스 사이의
            매개체들은 SOAP 메시지에서 필요한 부분만 골라서 처리하게 할 수 있다.</p>
          </li><li>
            <p>기본적으로 JEUS 웹 서비스는 암호화하는 부분을 별도로 지정하지 않을 경우 SOAP 메시지의 Body
            부분을 암호화하지만 어떤 부분이든지 암호화할 수 있다. 서명도 마찬가지이며, 이 2가지는 서로 혼용될 수
            있다.</p>
          </li></ul></div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_architecture_jeus_webservice_security"></a>27.3.2. 웹 서비스 보안 아키텍처</h3></div></div></div>
      

      <p>다음은 JEUS 웹 서비스 보안 아키텍처를 나타내는 그림이다.</p>

      <p/>

      <div class="figure"><a id="d4e7614"></a><p class="title"><b>[그림 27.1] JEUS 웹 서비스 보안 아키텍처</b></p><div class="figure-contents">
        

        <div xmlns="" class="mediaobject" align="left"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="545"><tr><td align="left"><img src="resources/figure_image041_archi.png" align="top" width="545" alt="JEUS 웹 서비스 보안 아키텍처"/></td></tr></table></div>
      </div></div><br class="figure-break"/>

      <p>Server Keystore 설정은 jeus-webservices-dd.xml에 설정되고, Client Keystore
      설정은 jeus-web-dd.xml에 설정된다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e7624"></a>JEUS Java EE 웹 서비스 클라이언트와 웹 서비스 간의 보안 메시지의
      송수신</h4>

      <p>웹 서비스에 보안을 적용하는 경우 jeus-webservices-dd.xml에 &lt;security&gt;를 설정하고
      Keystore를 생성해야 한다. 그리고 Keystore에 접근하기 위한 암호나 사용자명 토큰(UsernameToken)에 사용할
      암호를 설정하기 위해서 Callback 클래스를 하나 생성해야 한다. 이 애플리케이션을 JEUS 서버에 재배치함으로써 보안 설정이
      적용된다.</p>

      <p>Java EE 클라이언트는 jeus-web-dd.xml에 &lt;security&gt;를 설정해야 하며, 클라이언트의
      키를 저장할 Keystore를 생성해야 한다. 사용자명 토큰(UsernameToken)에 사용할 암호와 Keystore의 개인
      키를 가져오기 위한 암호를 설정하기 위해서 Callback 클래스를 하나 생성해야 한다.</p>

      <p>Java EE 클라이언트 애플리케이션이 실행되면 웹 서비스 클라이언트 런타임은 jeus-web-dd.xml에서
      &lt;security&gt;의 설정된 값에 따라 보안 로직을 동작시켜 클라이언트 Keystore에서 개인 키를 꺼내어 서명을
      하거나 서버의 공개 키를 가지고 메시지를 암호화하여 JEUS 서버의 웹 서비스 서버 런타임으로 메시지를 보낸다.</p>

      <p>서버 런타임은 jeus-webservices-dd.xml에서 &lt;security&gt;에 설정된 값을 바탕으로 보안
      로직을 실행시킨다.</p>

      <div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
          <p>메시지가 서명이 되어 있을 경우 메시지에 포함된 서명에 사용된 키에 대한 정보를 바탕으로 클라이언트의 공개 키를
          서버의 Keystore에서 인출하여 서명을 검증한다.</p>
        </li><li style="list-style-type: circle">
          <p>메시지가 암호화되어 있을 경우 메시지에 포함된 암호화에 사용된 키 정보를 바탕으로 서버의 Keystore에서
          서버의 개인 키를 인출하여 암호를 해독한다.</p>
        </li></ul></div>

      <p>서버에서 웹 서비스 호출이 끝나고 응답을 돌려 보내는 경우 보안을 적용할 때는 위의 과정과 유사하게
      진행된다.</p>

      <div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
          <p>웹 서비스는 jeus-webservices-dd.xml에 &lt;security&gt;에 설정된 값을 바탕으로
          Keystore에서 서버의 개인 키나 클라이언트의 공개 키를 꺼내어서 응답 메시지의 일부 또는 전체를 서명하거나
          암호화한다.</p>
        </li><li style="list-style-type: circle">
          <p>클라이언트 런타임은 jeus-web-dd.xml의 &lt;security&gt;에 설정된 값을 바탕으로
          클라이언트 Keystore에서 서버의 공개 키나 클라이언트의 개인 키를 꺼내어 이를 사용하여 응답 메시지를 검증하고
          해독한다.</p>
        </li></ul></div>

      <p/>

      <p/>

      <div class="literallayout"><p/></div><h4><a id="d4e7644"></a>JEUS와 타 벤더 간 보안 메시지의 상호
      호환 및 운영성</h4>

      <p>웹 서비스의 보안은 메시지 수준의 보안을 적용하고 사용하게 되어 있다. 보안이 적용된 SOAP 메시지 내부에는 보안에
      관련된 모든 정보가 포함되어 있으며 이러한 정보들이 OASIS의 웹 서비스 보안 표준을 만족하게 될 경우, 여러 벤더 간의 상호
      운영성이 보장된다.</p>

      <p>JEUS는 OASIS의 보안 표준의 최신 버전인 웹 서비스 보안 표준 1.0을 준수하고 있으며, 따라서 이 표준을
      준수하는 벤더 간의 메시지 송수신 및 처리를 할 수 있다.</p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_configure_jeus_webservice_security"></a>27.3.3. JEUS 웹 서비스 보안 설정</h3></div></div></div>
      

      <p>JEUS 웹 서비스와 클라이언트에서 보안 메시지를 송수신하기 위해서는 JEUS 웹 서비스는
      jeus-webservices-dd.xml에 &lt;security&gt;를 추가 설정하고, 클라이언트는
      jeus-web-dd.xml에 &lt;security&gt;를 추가 설정해야 한다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e7654"></a>서버 설정 </h4>

      <p>jeus-webservices-dd.xml에 추가되는 &lt;security&gt;는 웹 서비스의 포트 하나당 하나의
      설정이 요구된다. 보다 자세한 설명은 "JEUS XML Reference"의 "23.
      jeus-webservices-dd.xml"을 참고한다.</p>

      <p>다음은 서버 설정에 대한 예이다. </p><div class="example"><a id="d4e7657"></a><p class="title"><b>[예 27.1] &lt;&lt;jeus-webservices-dd.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-webservices-dd&gt;
    &lt;service&gt;
        &lt;webservice-description-name/&gt;
        &lt;port&gt;
            &lt;port-component-name/&gt;
            &lt;security&gt;
                &lt;request-receiver/&gt; 
                &lt;response-sender/&gt;
            &lt;/security&gt;
        &lt;/port&gt;
    &lt;/service&gt;
&lt;/jeus-webservices-dd&gt;</pre>
        </div></div><p><br class="example-break"/>&lt;security&gt;의 하위 element인 &lt;request-receiver&gt;에 서버가
      클라이언트로부터 받는 메시지의 보안 처리를 위해 필요한 정보를 설정해야 한다. &lt;response-sender&gt;에는
      서버가 클라이언트로 보내는 메시지의 보안 처리를 위해 필요한 정보를 설정해야 한다.</p>

      <p/>

      <p/>

      <p/>

      <p/>

      <div class="literallayout"><p/></div>

      

      <h4><a id="d4e7666"></a>클라이언트 설정</h4>

      <p>jeus-web-dd.xml에 추가되는 &lt;security&gt;는 각각의 &lt;port-info&gt;마다
      하나의 설정이 필요하다. 보다 자세한 설명은 "JEUS XML Reference"의 "19. jeus-web-dd.xml"을
      참고한다. <a id="d4e7668" class="indexterm"></a></p>

      <p>다음은 클라이언트 설정을 구현한 예이다. </p><div class="example"><a id="d4e7671"></a><p class="title"><b>[예 27.2] &lt;&lt;jeus-web-dd.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-web-dd&gt;
    &lt;service-ref&gt;
        &lt;service-client&gt;
            &lt;service-ref-name/&gt;
            &lt;port-info&gt;
                &lt;wsdl-port/&gt;
                &lt;security&gt;
                    &lt;request-sender/&gt;
                    &lt;response-receiver/&gt;
                &lt;/security&gt;
            &lt;/port-info&gt;
            . . .
        &lt;/service-client&gt;
        &lt;service-client&gt;
            . . .
        &lt;/service-client&gt;
        . . .
    &lt;/service-ref&gt;
&lt;/jeus-webservices-client-dd&gt;</pre>
        </div></div><p><br class="example-break"/>&lt;security&gt;의 하위 element인 &lt;request-sender&gt;에는
      클라이언트가 서버로 보내는 메시지의 보안 처리를 위해 필요한 정보를 설정해야 한다.
      &lt;response-receiver&gt;에는 클라이언트가 서버로부터 받는 메시지의 보안 처리를 위해 필요한 정보를 설정해야
      한다.</p>

      <p/>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_generate_password_callback_class"></a>27.3.4. 패스워드 Callback 클래스 생성</h3></div></div></div>
      

      <p>JEUS 웹 서비스에 보안을 적용하기 위해서는 패스워드 Callback 클래스의 생성이 필요하다. 이는
      Keystore에 저장된 개인 키의 암호를 설정하거나 사용자명 토큰에 사용될 암호를 설정하는 등의 작업 때문에 필요하다.
      Callback 클래스는 javax.security.auth.callback.CallbackHandler를 구현한 클래스여야
      한다.</p>

      <p>다음은 패스워드 Callback 클래스를 구현한 예이다.</p>

      <div class="example"><a id="d4e7681"></a><p class="title"><b>[예 27.3] &lt;&lt; PWCallback.java &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">package jeustest.webservices.wssec.doall;

import com.tmax.ws.security.WSPasswordCallback;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import java.io.IOException;

public class PWCallback implements CallbackHandler {
    public void handle(Callback[] callbacks)
        throws IOException, UnsupportedCallbackException {
        for (int i = 0; i &lt; callbacks.length; i++) {
            if (callbacks[i] instanceof WSPasswordCallback) {
                WSPasswordCallback pc = (WSPasswordCallback) callbacks[i];
                checkPassword(pc);
            } else {
                throw new UnsupportedCallbackException(
                    callbacks[i], "Unrecognized Callback");
            }
        }
    }

    public void checkPassword(WSPasswordCallback pc) {
        String userId = pc.getIdentifier();
        if (pc.getUsage() == <span class="bold"><strong>WSPasswordCallback.USERNAME_TOKEN</strong></span>) {
            if (userId.equals("16c73ab6-b892-458f-abf5-2f875f74882e")) {
                pc.setPassword("security2");
            }
            if (userId.equals("key_tmax1")) {
                pc.setPassword("keypass_tmax1");
            }
        } else if (pc.getUsage() == <span class="bold"><strong>WSPasswordCallback.DECRYPT</strong></span>) {
            if (userId.equals("16c73ab6-b892-458f-abf5-2f875f74882e")) {
                pc.setPassword("security");
            }
            if (userId.equals("key_tmax1")) {
                pc.setPassword("keypass_tmax1");
            } 
        } else if(pc.getUsage() == <span class="bold"><strong>WSPasswordCallback.SIGNATURE</strong></span>) {
            if (userId.equals("16c73ab6-b892-458f-abf5-2f875f74882e")) {
                pc.setPassword("security");
            }
            if (userId.equals("key_tmax1")) {
                pc.setPassword("keypass_tmax1");
            }
        }
    }
}</pre>
        </div></div><p><br class="example-break"/>WSPasswordCallback.getUsage()는 인자로 넘겨 받는 Callback 파라미터가 어떤
      경우에 사용되기 위한 것인지에 대한 값을 리턴한다. 사용자명 토큰의 암호를 설정하려면 USERNAME_TOKEN이라는 값을 가지고
      있고, 암호화된 메시지를 해독하기 위해 사용할 개인 키에 대한 암호를 설정하려면 DECRYPT 값을 리턴한다. 그 외에도 서명을
      하기 위해 필요한 개인 키를 Keystore에서 가져오기 위한 암호를 설정하거나 세션 키를 설정하려 할 경우에도 이러한 구현이
      필요하다.</p>

      <p>이렇게 생성된 Callback 클래스는 jeus-webservices-dd.xml이나 jeus-web-dd.xml의
      &lt;password-callback-class&gt;에 클래스 이름을 설정함으로써 보안에 적용이 가능하다.</p>

      <p/>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_example_jeus_webservice_server_security"></a>27.3.5. JEUS 웹 서비스 서버 보안 적용 예제</h3></div></div></div>
      

      <p>스트링을 주고받는 웹 서비스를 보안을 적용은 다음의 과정으로 구현되어야 한다.</p>

      <p/>

      <div class="orderedlist"><ol type="1"><li>
          <p>SOAP 메시지를 암호화하고 서명하는 데 필요한 Keystore 생성한다.</p>
        </li><li>
          <p>Java 클래스 작성한다.</p>
        </li><li>
          <p>웹 서비 스 DD를 작성한다.</p>
        </li><li>
          <p>패키징과 배치를 한다.</p>
        </li></ol></div>

      <p/>

      <p/>

      <p>본 절에서는 각 과정에 대해서 설명한다.</p>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_jeus_web_service_server_security_keystoregen_example"></a>27.3.5.1. Keystore 생성</h4></div></div></div>
        

        <p>SOAP 메시지를 암호화하고 서명하는 데 필요한 키의 생성이 필요하며 Java에서 제공하는 Keytool을 이용하여
        간단하게 구현할 수 있다. keytool 외에도 여러 가지 방법이 있지만, 여기에서는 keytool을 이용하도록 한다. 좀 더
        상세한 설명은 keytool의 도움말을 참고한다.</p>

        <p>샘플이 존재하는 폴더에서 keygen을 수행하면 다음과 같은 작업을 수행한다.</p>

        <div class="orderedlist"><ol type="1"><li>
            <p>server-keystore.jks라는 Keystore 파일을 생성하고 Keystore의 암호는
            keystore_password로 한다. Keystore에는 JEUS_SERVER라는 별칭을 가진 개인 키를 RSA
            알고리즘으로 생성하며 개인 키의 암호는 key_password이다. 이때 JEUS_SERVER라는 개인 키의 공개 키도
            쌍으로 생성된다.</p>

            <pre class="screen">$ keytool -genkey -alias JEUS_SERVER -keyalg rsa -keypass
key_password -keystore server-keystore.jks -storepass
keystore_password</pre>
          </li><li>
            <p>client-keystore.jks라는 Keystore 파일을 생성하고 Keystore의 암호는
            keystore_password로 한다. Keystore에는 JEUS_CLIENT라는 별칭을 가진 개인 키를 RSA
            알고리즘으로 생성하며 개인 키의 암호는 key_password이다. 이때 JEUS_CLIENT라는 개인 키의 공개 키도
            쌍으로 생성된다.</p>

            <pre class="screen">$ keytool -genkey -alias JEUS_CLIENT -keyalg rsa -keypass
key_password -keystore client-keystore.jks -storepass
keystore_password</pre>
          </li><li>
            <p>서버의 Keystore로 사용할 server-keystore.jks라는 Keystore에서
            JEUS_SERVER의 공개 키를 꺼낸다.</p>

            <pre class="screen">$ keytool -export -alias JEUS_SERVER -storepass keystore_password
-keystore server-keystore.jks -file jeus_server.cert</pre>
          </li><li>
            <p>클라이언트 Keystore인 client-keystore.jks에 JEUS_SERVER라는 별칭으로
            저장한다.</p>

            <pre class="screen">$ keytool -import -file jeus_server.cert -keystore
client-keystore.jks -storepass keystore_password -alias JEUS_SERVER</pre>
          </li><li>
            <p>클라이언트 Keystore로 사용할 client-keystore.jks라는 Keystore에서
            JEUS_CLIENT의 공개 키를 꺼낸다.</p>

            <pre class="screen">$ keytool -export -alias JEUS_CLIENT -storepass keystore_password
-keystore client-keystore.jks -file jeus_client.cert</pre>
          </li><li>
            <p>서버 Keystore인 server-keystore.jks에 JEUS_CLIENT라는 별칭으로
            저장한다.</p>

            <pre class="screen">$ keytool -import -file jeus_client.cert -keystore
server-keystore.jks -storepass keystore_password -alias JEUS_CLIENT</pre>
          </li></ol></div>

        <p/>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_java_class_example_for_jeus_webservice_server_security"></a>27.3.5.2. Java 클래스 작성</h4></div></div></div>
        

        <p>기본적인 웹 서비스 구현은 보안이 적용되지 않았을 경우와 차이점이 없다.</p><div class="example"><a id="d4e7740"></a><p class="title"><b>[예 27.4] &lt;&lt; Ping.java &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">package ping;

public interface Ping extends java.rmi.Remote {
    public String ping(String arg) throws
        java.rmi.RemoteException;
}</pre>
          </div></div><p><br class="example-break"/></p><div class="example"><a id="d4e7743"></a><p class="title"><b>[예 27.5] &lt;&lt; PingImpl.java &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">package ping;

public class PingImpl implements Ping {
    public String ping(String arg) throws
        java.rmi.RemoteException {
        return arg;
    }
}</pre>
          </div></div><p><br class="example-break"/></p>

        <p>여기에 추가적으로 개인 키를 꺼내오거나 사용자명 토큰의 암호를 설정하기 위한 Callback 클래스를 생성해야
        한다.</p><div class="example"><a id="d4e7747"></a><p class="title"><b>[예 27.6] &lt;&lt; PingPWCallback.java &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">package ping;

import com.tmax.ws.security.WSPasswordCallback;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import java.io.IOException;

public class PingPWCallback implements CallbackHandler {
    public void handle(Callback[] callbacks) throws
        IOException, UnsupportedCallbackException {
        for ( int i = 0 ; i&lt;callbacks.length; i++) {
            if(callbacks[i] instanceof WSPasswordCallback) {
                WSPasswordCallback pc = (WSPasswordCallback) callbacks[i];

                if(pc.getUsage()== WSPasswordCallback.USERNAME_TOKEN) {
                    pc.setPassword("<span class="bold"><strong>usertoken_password</strong></span>");
                }

                if(pc.getUsage()== WSPasswordCallback.DECRYPT){
                    pc.setPassword("<span class="bold"><strong>key_password</strong></span>");
                }

                if(pc.getUsage()== WSPasswordCallback.SIGNATURE) {
                    pc.setPassword("<span class="bold"><strong>key_password</strong></span>");
                }
            }
        }
    }
}</pre>
          </div></div><p><br class="example-break"/></p>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_writing_jeus_websevices_dd_for_jeus_webservice_security"></a>27.3.5.3. DD 파일 작성</h4></div></div></div>
        

        <p>Keystore를 생성하고 Java 클래스 작성이 완료되면 웹 서비스 DD를 작성해야 한다. 다른 부분은 일반적인
        웹 서비스 DD 작성과 동일하며, JEUS 특정 설정을 담당하는 jeus-webservices-dd.xml에서만 추가 작업을
        한다.</p>

        <p>다음은 서버에서 클라이언트의 메시지를 처리하는 부분의 설정이다. 파일 전체의 내용은 샘플을 참고한다.</p><div class="example"><a id="d4e7759"></a><p class="title"><b>[예 27.7] &lt;&lt; jeus-webservices-dd.xml &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">. . .
&lt;security&gt;
    &lt;request-receiver&gt;
        &lt;action-list&gt;
            UsernameToken Signature Encrypt
        &lt;/action-list&gt;
        &lt;password-callback-class&gt;
            ping.PingPWCallback
        &lt;/password-callback-class&gt;
        &lt;decryption&gt;
            &lt;keystore&gt;
                &lt;key-type&gt;jks&lt;/key-type&gt;
                &lt;keystore-password&gt;
                    keystore_password
                &lt;/keystore-password&gt;
                &lt;keystore-filename&gt;
                    server-keystore.jks
                &lt;/keystore-filename&gt;
            &lt;/keystore&gt;
        &lt;/decryption&gt;
        &lt;signature-verification&gt;
            &lt;keystore&gt;
                &lt;key-type&gt;jks&lt;/key-type&gt;
                &lt;keystore-password&gt;
                    keystore_password
                &lt;/keystore-password&gt;
                &lt;keystore-filename&gt;
                    server-keystore.jks
                &lt;/keystore-filename&gt;
            &lt;/keystore&gt;
        &lt;/signature-verification&gt;
    &lt;/request-receiver&gt;
    . . .
&lt;/security&gt;
. . .</pre>
          </div></div><p><br class="example-break"/></p>

        <p/>

        <p/>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_packaging_for_jeus_webservice_security"></a>27.3.5.4. 패키징과 배치</h4></div></div></div>
        

        <p>웹 서비스 보안 모듈의 패키징과 배치 방식은 기존의 웹 서비스 모듈의 방식과 크게 다르지 않다. 추가적으로
        Keystore(server-keystore.jks)를 컨텍스트의 클래스 경로 안에 위치시켜야 하는 점이 다르다. 또는
        jeus-webservices-dd.xml의 &lt;keystore-filename&gt;에 절대 경로를 포함한
        Keystore 파일 이름을 적어주는 방법도 있다.</p>

        <p>샘플 홈인 pingSecurityService 디렉터리에서 다음과 같이 입력하면 패키징 작업과 패키징된 모듈에 대해
        JEUS 서버 배치 작업이 완료된다.</p>

        <pre class="screen">$ ant</pre>

        <p/>

        <p>이제 보안이 적용된 웹 서비스를 시작할 수 있다.</p>

        <p/>
      </div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_example_jeus_webservice_client_security"></a>27.3.6. JEUS 웹 서비스 클라이언트 보안 적용 예제</h3></div></div></div>
      

      <p>JEUS의 웹 서비스 Java EE 클라이언트의 경우도 서버의 설정과 유사하게 일반적인 웹 서비스 클라이언트 생성
      작업에 Callback 클래스와 설정 파일 작업, Keystore 패키징 작업이 추가적으로 더해진다.</p>

      <p/>

      <p>JEUS 웹 서비스 클라이언트 보안 적용은 다음의 과정으로 구현되어야 한다.</p>

      <p/>

      <div class="orderedlist"><ol type="1"><li>
          <p>SOAP 메시지를 암호화하고 서명하는 데 필요한 Keystore 생성한다.</p>
        </li><li>
          <p>Java 클래스 작성한다.</p>
        </li><li>
          <p>웹 서비 스 DD를 작성한다.</p>
        </li><li>
          <p>패키징과 배치를 한다.</p>
        </li></ol></div>

      <p/>

      <p/>

      <p>본 절에서는 각 과정에 대해서 설명한다.</p>

      <div class="literallayout"><p/></div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_example_generate_keystore_for_jeus_webservice_client_security"></a>27.3.6.1. Keystore 생성</h4></div></div></div>
        

        <p>Keystore는 <a href="chapter_jaxrpc_security.html#sect_jeus_web_service_server_security_keystoregen_example" title="27.3.5.1. Keystore 생성">“27.3.5.1. Keystore 생성”</a>에서
        생성한 Keystore 중 client-keystore.jks를 사용한다.</p>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_writing_java_class_for_jeus_webservice_client"></a>27.3.6.2. Java 클래스 작성</h4></div></div></div>
        

        <p>다음은 클라이언트인 pingClient.jsp 파일의 일부이다. 웹 서비스의 보안 적용은 웹 서비스의 포트 단위로
        적용되므로 반드시 호출할 포트의 이름을 명시해야 한다.</p><div class="example"><a id="d4e7803"></a><p class="title"><b>[예 27.8] &lt;&lt; pingClient.jsp &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">. . . 
InitialContext jndiContext = new InitialContext();

Service service = (Service)jndiContext.lookup(
"java:comp/env/service/PingSecurityService");

QName <span class="bold"><strong>portName</strong></span> = new QName(<span class="bold"><strong>"urn:PingSecurityService","PingPort"</strong></span>);
java.rmi.Remote port = service.getPort(<span class="bold"><strong>portName</strong></span>, Ping.class);

Ping pingPort = (Ping)port;
ret = pingPort.ping(msgToSend);
. . .</pre>
          </div></div><p><br class="example-break"/>클라이언트도 서버 설정과 마찬가지로 Callback 클래스를 생성한다. 여기서 사용하는 Callback
        클래스는 서버 설정할 때 생성했던 Callback 클래스를 재사용하도록 한다.</p>

        <p/>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_writing_jeus_web_dd_for_jeus_webservice_security"></a>27.3.6.3. DD 파일 작성</h4></div></div></div>
        

        <p>다른 설정 파일은 일반적인 웹 서비스 클라이언트 DD 파일 작성과 동일하며, JEUS 특성 설정을 담당하는
        jeus-web-dd.xml에서만 추가 작업을 한다.</p>

        <p>다음은 클라이언트에서 서버로 전송할 메시지를 처리하는 부분의 설정이다. 파일 전체의 내용은 샘플을
        참고한다.</p><div class="example"><a id="d4e7815"></a><p class="title"><b>[예 27.9] &lt;&lt; jeus-web-dd.xml &gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">. . .
&lt;security&gt;
    &lt;request-sender&gt;
        &lt;action-list&gt;
            UsernameToken Signature Encrypt
        &lt;/action-list&gt;
        &lt;password-callback-class&gt;
            ping.PingPWCallback
        &lt;/password-callback-class&gt;
        &lt;user&gt;JEUS_CLIENT&lt;/user&gt;
        &lt;signature-infos&gt;
            &lt;signature-info&gt;
                &lt;keyIdentifier&gt;DirectReference&lt;/keyIdentifier&gt;
                &lt;keystore&gt;
                    &lt;key-type&gt;jks&lt;/key-type&gt;
                    &lt;keystore-password&gt;
                        keystore_password
                    &lt;/keystore-password&gt;
                    &lt;keystore-filename&gt;
                        client-keystore.jks
                    &lt;/keystore-filename&gt;
                &lt;/keystore&gt;
            &lt;/signature-info&gt;
        &lt;/signature-infos&gt;
        &lt;encryption-infos&gt;
            &lt;encryption-info&gt;
                &lt;encryptionUser&gt;JEUS_SERVER&lt;/encryptionUser&gt;
                &lt;keyIdentifier&gt;DirectReference&lt;/keyIdentifier&gt;
                &lt;keystore&gt;
                    &lt;key-type&gt;jks&lt;/key-type&gt;
                    &lt;keystore-password&gt;
                        keystore_password
                    &lt;/keystore-password&gt;
                    &lt;keystore-filename&gt;
                        client-keystore.jks
                    &lt;/keystore-filename&gt;
                &lt;/keystore&gt;
            &lt;/encryption-info&gt;
        &lt;/encryption-infos&gt;
    &lt;/request-sender&gt;
    . . .
&lt;/security&gt;
. . .</pre>
          </div></div><p><br class="example-break"/></p>

        <p/>

        <p/>

        <div class="literallayout"><p/></div>

        
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="sect_packaging_example_for_jeus_webservice_client_security"></a>27.3.6.4. 패키징과 배치</h4></div></div></div>
        

        <p>웹 서비스 Java EE 클라이언트 보안 모듈의 패키징과 배치 방식은 기존의 웹 서비스 Java EE 클라이언트
        모듈의 방식과 크게 다르지 않다. 추가적으로 Keystore(client-keystore.jks)를 컨텍스트의 클래스 경로
        안에 위치시켜야 하는 점이 다르다. 또는 jeus-web-dd.xml에 &lt;keystore-filename&gt;에 절대
        경로를 포함한 Keystore 파일 이름을 적어주는 방법도 있다.</p>

        <p>샘플 홈인 pingSecurityServiceJavaeeClient 디렉터리에서 다음과 같이 입력하면 패키징 작업과
        JEUS 서버 배치 작업이 완료된다.</p>

        <pre class="screen">$ ant</pre>

        <p/>

        <p>패키징하여 배치까지 완료되면 보안이 적용된 웹 서비스 클라이언트를 시작할 수 있다.</p>

        <p/>

        <p/>
      </div>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_writing_jeus_webservice_client_through_api"></a>27.3.7. 보안 API를 이용한 JEUS 웹 서비스 클라이언트의 작성</h3></div></div></div>
      

      <p>JEUS 웹 서비스는 Java EE 환경과 Java SE 환경에서 모두 적용이 가능한 웹 서비스 클라이언트 보안
      API를 제공하여 보다 쉽게 웹 서비스 클라이언트 작성을 가능하게 한다.</p>

      <p>다음은 API를 이용한 웹 서비스 보안 클라이언트이다.</p><div class="example"><a id="d4e7835"></a><p class="title"><b>[예 27.10] &lt;&lt; pingClient.jsp &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;%@ page language="java" %&gt;
&lt;%@ page import="javax.naming.*" %&gt;
&lt;%@ page import="javax.rmi.*" %&gt;
&lt;%@ page import="java.rmi.RemoteException" %&gt;
&lt;%@ page import="java.util.*" %&gt;

&lt;%@ page import="javax.naming.InitialContext" %&gt;
&lt;%@ page import="javax.xml.rpc.Service" %&gt;
&lt;%@ page import="javax.xml.namespace.QName" %&gt;

&lt;%@ page import="jeus.webservices.wssecurity.SecurityConfiguration"%&gt;
&lt;%@ page import="jeus.webservices.wssecurity.Keystore" %&gt;

&lt;%@ page import="ping.*" %&gt;
&lt;%@ page errorPage="/error.html" %&gt;

&lt;%! String msgToSend = "msg_sent_by_jspClient";
    String ret=null;
    String exceptionString="";
%&gt;

&lt;%
    try {

<span class="bold"><strong>(1)     Keystore keystore = new Keystore ("JKS", "keystore_password", 
                           "client-keystore.jks");
        Keystore truststore = new Keystore ("JKS","keystore_password", 
                           "client-keystore.jks");

        InitialContext jndiContext = new InitialContext();
            
        Service service = 
          (Service)jndiContext.lookup("java:comp/env/service/PingSecurityService");
        QName portName = new QName("urn:PingSecurityService", "PingPort");

(2)     SecurityConfiguration sconfig = 
            new SecurityConfiguration(service, portName);
(3)     sconfig.setUsername("JEUS_CLIENT");
(4)     sconfig.setRequestPasswordCallbackClass("ping.PingPWCallback");
            
(5)     sconfig.addUTRequest(true, true);
(6)     sconfig.addSignRequest(null, "DirectReference", keystore);
(7)     sconfig.addEncryptRequest(null, "DirectReference", 
            truststore, "JEUS_SERVER", null);

(4)     sconfig.setResponsePasswordCallbackClass("ping.PingPWCallback");
        sconfig.addUTResponse();
        sconfig.addSignResponse(truststore);
        sconfig.addDecryptResponse(keystore);</strong></span>

        java.rmi.Remote port = service.getPort(portName, Ping.class);
        Ping pingPort = (Ping)port;
            
        ((javax.xml.rpc.Stub)pingPort)._setProperty(
            javax.xml.rpc.Stub.ENDPOINT_ADDRESS_PROPERTY,
            "http://localhost:8088/PingSecurity" + "/PingSecurityService");
            
        System.out.println("Send : " + msgToSend);
        ret = pingPort.ping(msgToSend);
        System.out.println("You received : " + ret);
    } catch (Exception e) {
        exceptionString = e.toString();
        e.printStackTrace();
    }
%&gt;
&lt;%= "Result is " + ret + "......" 
%&gt;
&lt;%= exceptionString
%&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p/>

      <p>위의 예제 중 굵은 글자로 표시된 부분이 웹 서비스 보안 설정에 관한 부분이다.</p>

      <p>보안 설정을 위해 jeus.webservices.wssecurity.SecurityConfiguration 객체를
      생성하고, 보안 요청 메시지를 작성하기 위해서는 기본적으로 사용자 이름과 패스워드 Callback 클래스를 지정해야 한다.
      Callback 클래스 생성에 관해서는 <a href="chapter_jaxrpc_security.html#sect_generate_password_callback_class" title="27.3.4. 패스워드 Callback 클래스 생성">“27.3.4. 패스워드 Callback 클래스 생성”</a>을 참고한다.</p>

      <p>그 외에 사용자 이름 토큰이나 서명, 암호화에 관한 설정을 추가할 때 각각의 API를 이용하여 추가할 수 있다. 이때
      Keystore에 대한 설정이 필요할 경우에는 jeus.webservices.wssecurity.Keystore 클래스를 생성하여
      설정이 가능하다.</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span><strong class="guibutton">(1) Keystore 객체 생성</strong></span></p>

          <p><a id="d4e7849" class="indexterm"></a>웹 서비스 보안 API를 적용하기 위해서는 서명 작업이나 암호화 작업의 진행을 위해
          Keystore 객체의 생성이 필요하다.</p>

          <pre class="programlisting">public Keystore(String keyType, String keystorePassword, String keystoreFilename)</pre>

          <div class="informaltable">
            <table border="1"><colgroup><col width="130" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">keystoreFilename<a id="d4e7863" class="indexterm"></a></td><td>Keystore의 파일 이름을 입력한다.</td></tr><tr><td align="left">keystorePassword<a id="d4e7869" class="indexterm"></a></td><td>Keystore 파일의 암호를 입력한다.</td></tr><tr><td align="left">keyType<a id="d4e7875" class="indexterm"></a></td><td>Keystore가 저장하고 있는 키의 타입을 입력한다. 지원되는 키의 타입은 'JKS'나
                  'PKCS12' 둘 중에 하나이다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p><span><strong class="guibutton">(2) SecurityConfiguration 객체 생성</strong></span></p>

          <p>웹 서비스 보안 API를 적용하기 위해 가장 먼저 생성해야 하는 객체이다.<a id="d4e7883" class="indexterm"></a></p>

          <pre class="programlisting">public SecurityConfiguration(javax.xml.rpc.Service service,QName portName) 
          throws ConfigurationException</pre>

          <div class="informaltable">
            <table border="1"><colgroup><col width="130" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">service<a id="d4e7897" class="indexterm"></a></td><td>Java EE 클라이언트에서 작성할 경우에는 JNDI를 통해 얻어오는 Service 객체를
                  넣어주고, Java SE 클라이언트에서 작성할 경우에는 Service_Impl() 객체를 통해 생성한 객체를
                  인자로 넣어준다.</td></tr><tr><td align="left">portName<a id="d4e7903" class="indexterm"></a></td><td>WSDL에 공개된 포트의 QName을 넣어준다.</td></tr></tbody></table>
          </div>
        </li><li>
          <p><span><strong class="guibutton">(3) 사용자 이름 설정</strong></span></p>

          <p>웹 서비스 보안 요청 메시지를 작성하기 위해서는 사용자명 토큰에 들어갈 이름이나 서명에 사용될 개인 키의 이름이
          필요하며 이를 이 함수를 통해 설정할 수 있다.</p>

          <pre class="programlisting">public void setUsername(String username)</pre>
        </li><li>
          <p><span><strong class="guibutton">(4) Callback 클래스 이름 설정</strong></span></p>

          <p>웹 서비스 보안 요청이나 응답 메시지를 주고받는 과정 중 사용자명 토큰에 사용되는 암호 설정이나, 개인 키에
          대한 암호 설정을 할 경우 패스워드 Callback 클래스들을 생성해야 하며, 생성된 Callback 클래스의 이름을 이
          함수들을 사용하여 지정한다.</p>

          <pre class="programlisting">public void setRequestPasswordCallbackClass(String classname)
public void setResponsePasswordCallbackClass(String classname)</pre>
        </li><li>
          <p><span><strong class="guibutton">(5) UsernameToken 처리 </strong></span></p>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 UsernameToken element를 추가할 경우
          사용한다.</p>

          <pre class="programlisting">public void addUTRequest(boolean addNonceCreated, boolean passwordDigest)</pre>

          <p>패스워드는 평문이나 다이제스트 형태로 생성될 수 있으며, 평문으로 생성할 경우에는 Nonce와 Created
          항목을 추가할 것인지를 선택할 수 있다.</p>

          <p/>

          <p>다음 함수는 웹 서비스 보안 응답 메시지에 UsernameToken element가 있기를 기대하는 경우에
          사용한다.</p>

          <pre class="programlisting">public void addUTResonse()</pre>
        </li><li>
          <p><span><strong class="guibutton">(6) 서명 처리 </strong></span></p>

          <p/>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 특정 부분에 서명할 때 사용한다.</p>

          <pre class="programlisting">public void addSignRequest(QName signPart, String keyIdentifier, 
                       Keystore keystore)
       throws SecurityConfigurationException</pre>

          <div class="informaltable">
              <table border="1"><colgroup><col width="130" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">signPart</td><td>null로 설정하면 기본적으로 SOAP 메시지의 body 부분을 기본적으로
                    서명한다.</td></tr><tr><td align="left">keyIdentifier</td><td><p>다음 중 하나를 입력한다. </p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                          <p>IssuerSerial</p>
                        </li><li style="list-style-type: circle">
                          <p>DirectReference</p>
                        </li><li style="list-style-type: circle">
                          <p>SKIKeyIdentifier</p>
                        </li><li style="list-style-type: circle">
                          <p>X509KeyIdentifier</p>
                        </li></ul></div></td></tr><tr><td align="left">keystore</td><td>서명에 필요한 개인 키를 저장하고 있는 Keystore 객체를 입력한다.</td></tr></tbody></table>
            </div>
        </li><li>
          <p><span><strong class="guibutton">(7) 암호화 처리</strong></span></p>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 특정 부분을 암호화할 때 사용한다.</p>

          <pre class="programlisting">public void addEncryptRequest(QName encPart, String keyIdentifier,
    Keystore keystore, String encryptUser, String algorithm)
    throws SecurityConfigurationException</pre>

          <div class="informaltable">
              <table border="1"><colgroup><col width="130" align="left"/><col/></colgroup><thead><tr><th align="left">파라미터</th><th>설명</th></tr></thead><tbody><tr><td align="left">encPart</td><td><p>암호화하는 SOAP 메시지의 부분으로 QName 형태로 입력한다.
                    </p><p>만약 null로 설정될 경우 기본적으로 SOAP 메시지의 body 부분을
                    기본적으로 암호화한다.</p></td></tr><tr><td align="left">keyIdentifier</td><td><p>다음 중 하나를 입력한다. </p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                          <p>IssuerSerial</p>
                        </li><li style="list-style-type: circle">
                          <p>DirectReference</p>
                        </li><li style="list-style-type: circle">
                          <p>SKIKeyIdentifier</p>
                        </li><li style="list-style-type: circle">
                          <p>X509KeyIdentifier</p>
                        </li><li style="list-style-type: circle">
                          <p>EmbeddedKeyName</p>
                        </li></ul></div></td></tr><tr><td align="left">keystore</td><td>암호화에 필요한 공개 키를 저장하고 있는 Keystore 객체를 입력한다.</td></tr><tr><td align="left">encryptUser</td><td>암호화에 사용할 공개 키의 별칭을 입력한다.</td></tr><tr><td align="left">algorithm</td><td><p>암호화에 사용될 알고리즘으로 다음 중에 하나를 입력한다.
                    </p><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                          <p>AES_128</p>
                        </li><li style="list-style-type: circle">
                          <p>AES_256</p>
                        </li><li style="list-style-type: circle">
                          <p>TRIPLE_DES</p>
                        </li><li style="list-style-type: circle">
                          <p>AES_192</p>
                        </li></ul></div></td></tr></tbody></table>
            </div>

          <div class="literallayout"><p/></div>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 특정 부분을 암호화하고자 할 때 사용하며, 특히 특정 Callback
          클래스에 Byte의 배열로 키를 설정하여 그 키를 이름으로 불러내려 할 때, 이 함수를 사용한다.</p>

          <pre class="programlisting">public void addEncryptRequest(QName encPart,
    String keyIdentifier, String embeddedKeyCallbackClass,
    String keyName, String encryptUser, String algorithm)</pre>

          <div class="literallayout"><p/></div>

          <p>다음 함수는 웹 서비스 보안 응답 메시지에 암호화 된 부분이 있기를 기대할 때 사용한다. keystore
          파라미터에는 암호화를 풀기 위한 개인 키를 가지고 있는 Keystore 객체를 입력한다.</p><pre class="programlisting">public void addDecryptResponse(Keystore keystore)</pre>
        </li></ul></div>

      <p/>

      <div class="literallayout"><p/></div>

      <p><span><strong class="guibutton">[참고]</strong></span></p>

      <p>다음은 본 예제에는 적용되지 않았으나 추가로 사용할 수 있는 기능에 대한 설명이다.</p>

      <div class="itemizedlist"><ul type="disc"><li>
          <p><span><strong class="guibutton">TimeStamp 처리 </strong></span></p>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 TimeStamp element를 추가할 경우
          사용한다.</p><pre class="programlisting">public void addTimeStampRequest()</pre>

          <p/>

          <p>다음 함수는 웹 서비스 보안 요청 메시지에 유효 기간을 별도로 설정할 경우 사용한다. 초(second)단위이며,
          별도로 설정하지 않았을 경우 기본 설정값은 300초이다.</p><pre class="programlisting">public void addTimeStampRequest(int timeToLive)</pre>

          <p/>

          <p>다음 함수는 웹 서비스 보안 응답 메시지에 TimeStamp element가 있기를 기대하는 경우
          사용한다.</p><pre class="programlisting">public void addTimeStampResponse()</pre>

          <p/>

          <p>다음 함수는 웹 서비스 보안 응답 메시지의 TimeStamp element에 설정된 유효 기간이 인자로 입력한
          시간 이내여야 한다.</p><pre class="programlisting">public void addTimeStampResponse(int timeToLive)</pre>
        </li></ul></div>

      <p/>

      <p/>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sect_configure_jeus_webservice_domain"></a>27.4. 접근 제어 설정</h2></div></div></div>
    

    <p>JEUS 웹 서비스는 접근이 허용된 사용자만이 웹 서비스를 호출할 수 있도록 접근 제어 설정을 할 수 있으며, 웹 서비스
    Back-end에 따라 각각 설정법이 다르다. 본 절에서는 웹 서비스 접근 제어 설정법과 접근 제어 설정이 된 웹 서비스를 호출하는
    방법에 대해 설명한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_configure_java_class_webservice_domain"></a>27.4.1. Java 클래스 웹 서비스 접근 제어 설정</h3></div></div></div>
      

      <p>특정한 URL로의 접근을 제한함으로써 웹 서비스로의 접근을 제한할 수 있으며, 이를 위해서는 web.xml과
      jeus-web-dd.xml 같은 웹 응용 프로그램의 DD에 보안 정보를 추가해야 한다. 또한 보안 도메인의 설정도
      필요하다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e8059"></a>보안 도메인 설정</h4>

      <p>접근 제어 설정을 하기 위해서는 먼저 사용자 등록이 필요하다.</p>

      <p>다음 경로의 accounts.xml에 사용자를 등록한다.</p>

      <pre class="programlisting">JEUS_HOME/config/{NODE_NAME}/security/{SECURITY_DOMAIN_NAME}/accounts.xml</pre>

      <p>다음은 사용자 등록의 예로 사용자의 이름은 'jeus'이고, 암호는 'jeus'이며, 암호는 base64 인코딩하여
      등록한다.</p><div class="example"><a id="d4e8065"></a><p class="title"><b>[예 27.11] &lt;&lt; accounts.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;accounts xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;users&gt;
        &lt;user&gt;
            &lt;name&gt;jeus&lt;/name&gt;
            &lt;password&gt;{SHA}McbQlyhI3yiOG1HGTg8DQVWkyhg=&lt;/password&gt;
        &lt;/user&gt;
    &lt;/users&gt;
&lt;/accounts&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p/>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e8072"></a>DD 파일 작성</h4>

      <p>jeus-web-dd.xml에 다음과 같이 &lt;role-mapping&gt;을 추가한다.</p><div class="example"><a id="d4e8074"></a><p class="title"><b>[예 27.12] &lt;&lt; jeus-web-dd.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-web-dd xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;docbase&gt;BA_DocLitEchoService&lt;/docbase&gt;
    &lt;role-mapping&gt;
        &lt;role-permission&gt;
            &lt;principal&gt;<span class="bold"><strong>jeus</strong></span>&lt;/principal&gt;
            &lt;role&gt;<span class="bold"><strong>Administrator</strong></span>&lt;/role&gt;
        &lt;/role-permission&gt;
    &lt;/role-mapping&gt;
&lt;/jeus-web-dd&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p>그리고 web.xml에 다음과 같이 보안 관련 설정을 추가한다.</p><div class="example"><a id="d4e8080"></a><p class="title"><b>[예 27.13] &lt;&lt; web.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;web-app…&gt;
    . . .
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;MySecureBit&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;<span class="bold"><strong>/BA_DocLitEchoService</strong></span>&lt;/url-pattern&gt;
            &lt;http-method&gt;POST&lt;/http-method&gt;
            &lt;http-method&gt;GET&lt;/http-method&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;<span class="bold"><strong>Administrator</strong></span>&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
        &lt;user-data-constraint&gt;
            &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;   
    
    &lt;login-config&gt;
        &lt;auth-method&gt;<span class="bold"><strong>BASIC</strong></span>&lt;/auth-method&gt;
        &lt;realm-name&gt;default&lt;/realm-name&gt;
    &lt;/login-config&gt;    
&lt;/web-app&gt;</pre>
        </div></div><p><br class="example-break"/>위와 같이 설정하면 URL이 /BA_DocLitEchoService인 모든 요청에 대해 사용자가
      'jeus'이며 암호가 'jeus'일 경우에만 접근이 허용된다.</p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_configure_ejb_webservice_domain"></a>27.4.2. EJB 웹 서비스의 접근 제어 설정</h3></div></div></div>
      

      <p>EJB 웹 서비스의 접근 제어 또한 Java 클래스 웹 서비스의 접근 제어와 마찬가지로 특정한 URL로의 접근을
      제한함으로써 웹 서비스로의 접근을 제한할 수 있다. 이를 위해서는 ejb-jar.xml과 jeus-ejb-dd.xml 같은 EJB
      DD와 jeus-webservices-dd.xml과 같은 웹 서비스 DD에 보안 정보를 추가해야 한다. 또한 보안 도메인의 설정이
      필요하다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e8093"></a>보안 도메인 설정</h4>

      <p>접근 제어 설정을 하기 위해서는 먼저 사용자의 등록이 필요하다.</p>

      <p>다음 경로의 accounts.xml에 사용자를 등록한다.</p>

      <pre class="programlisting">JEUS_HOME/config/{NODE_NAME}/security/{SECURITY_DOMAIN_NAME}/accounts.xml</pre>

      <p>다음은 사용자 등록의 예로 사용자의 이름은 'jeus'이고, 암호는 'jeus'이며, 암호는 base64 인코딩하여
      등록한다.</p>

      <div class="example"><a id="d4e8100"></a><p class="title"><b>[예 27.14] &lt;&lt; accounts.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;accounts xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;users&gt;
        &lt;user&gt;
            &lt;name&gt;jeus&lt;/name&gt;
            &lt;password&gt;{SHA}McbQlyhI3yiOG1HGTg8DQVWkyhg=&lt;/password&gt;
        &lt;/user&gt;
    &lt;/users&gt;
&lt;/accounts&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p/>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="d4e8107"></a>DD 파일 작성</h4>

      <p>jeus-ejb-dd.xml에 다음과 같이 &lt;role-permission&gt;을 추가한다.</p><div class="example"><a id="d4e8109"></a><p class="title"><b>[예 27.15] &lt;&lt; jeus-ejb-dd.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-ejb-dd xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;module-info&gt;        
        &lt;role-permission&gt;
            &lt;principal&gt;<span class="bold"><strong>jeus</strong></span>&lt;/principal&gt;
            &lt;role&gt;<span class="bold"><strong>Administrator</strong></span>&lt;/role&gt;
        &lt;/role-permission&gt;
    &lt;/module-info&gt;
    &lt;beanlist&gt;
        …
    &lt;/beanlist&gt;
&lt;/jeus-ejb-dd&gt;</pre>
        </div></div><p><br class="example-break"/>그리고 ejb-jar.xml에 다음과 같이 보안 관련 설정을 추가한다.</p><div class="example"><a id="d4e8114"></a><p class="title"><b>[예 27.16] &lt;&lt; ejb-jar.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ejb-jar …&gt;
    &lt;display-name&gt;AddressEjb&lt;/display-name&gt;
    &lt;enterprise-beans&gt;
        …
    &lt;/enterprise-beans&gt;
    &lt;assembly-descriptor&gt;
        &lt;security-role&gt;
            &lt;role-name&gt;<span class="bold"><strong>Administrator</strong></span>&lt;/role-name&gt;
        &lt;/security-role&gt;
        &lt;method-permission&gt;
            &lt;role-name&gt;<span class="bold"><strong>Administrator</strong></span>&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;<span class="bold"><strong>AddressEJB</strong></span>&lt;/ejb-name&gt;
                &lt;method-intf&gt;<span class="bold"><strong>ServiceEndpoint</strong></span>&lt;/method-intf&gt;
                &lt;method-name&gt;<span class="bold"><strong>listAll</strong></span>&lt;/method-name&gt;                
            &lt;/method&gt;
        &lt;/method-permission&gt;
    &lt;/assembly-descriptor&gt;
&lt;/ejb-jar&gt;</pre>
        </div></div><p><br class="example-break"/>추가적으로 다음과 같은 설정을 웹 서비스 DD에 할 수 있으며, 별도로 하지 않을 경우에는 기본적으로 설정된
      값으로 수행된다. SSL을 사용하여 주고받는 데이터의 무결성을 보장하려면
      &lt;ejb-transport-guarantee&gt;를 'INTEGRAL' 값을 설정하고, 데이터의 기밀성과 무결성을 모두
      보장하려면 'CONFIDENTIAL'로 설정해야 한다. 물론 이 경우에는 HTTPS로 통신을 주고받도록 별도의 HTTP 리스너의
      설정이 필요하다. </p><div class="example"><a id="d4e8122"></a><p class="title"><b>[예 27.17] &lt;&lt; jeus-webservices-dd.xml &gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-webservices-dd xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;ejb-context-path&gt;webservice&lt;/ejb-context-path&gt;
<span class="bold"><strong>    &lt;ejb-login-config&gt;
        &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
        &lt;realm-name&gt;default&lt;/realm-name&gt;
    &lt;/ejb-login-config&gt;</strong></span>
    &lt;service&gt;
        &lt;webservice-description-name&gt;…&lt;/webservice-description-name&gt;
        &lt;port&gt;
            &lt;port-component-name&gt;…&lt;/port-component-name&gt;
            &lt;ejb-endpoint-url&gt;… &lt;/ejb-endpoint-url&gt;
<span class="bold"><strong>            &lt;ejb-transport-guarantee&gt;
                CONFIDENTIAL
            &lt;/ejb-transport-guarantee&gt;</strong></span>
        &lt;/port&gt;
    &lt;/service&gt;
&lt;/jeus-webservices-dd&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p/>

      <p/>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_call_webservice_with_domain"></a>27.4.3. 접근 제어가 설정된 웹 서비스 호출</h3></div></div></div>
      

      <p>접근 제어(Basic Authentication)가 설정된 웹 서비스의 호출을 하기 위해서는 WSDL에 접근하여 그
      내용을 바탕으로 Stub을 생성하고, Stub을 이용하여 웹 서비스를 호출해야 하는데, 이 경우에 사용자 이름과 암호를 요구할
      경우 설정해 주는 작업이 필요하다.</p>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="sect_generating_stub_from_wsdl"></a>WSDL로부터 Stub
      생성</h4>

      <p>콘솔 툴을 이용할 경우 다음과 같이 설정한다.</p>

      <pre class="programlisting">wsdl2java -gen:client <span class="bold"><strong>-username jeus</strong></span> <span class="bold"><strong>-password jeus</strong></span> 
http://localhost:8088/BA_DocLitEchoService/BA_DocLitEchoService?wsdl</pre>

      <p/>

      <div class="literallayout"><p/></div>

      <h4><a id="sect_writing_client_for_webservice_with_domain"></a>접근
      제어가 설정된 웹 서비스의 클라이언트 작성</h4>

      <p>JAX-RPC 웹 서비스 클라이언트가 스스로 인증하기 위해서는 다음과 같은 2가지의 설정이 클라이언트 프로그램 내에
      삽입되어야 한다.</p><div class="itemizedlist"><ul type="disc"><li>
            <p>javax.xml.rpc.Stub.USERNAME_PROPERTY<a id="d4e8148" class="indexterm"></a></p>
          </li><li>
            <p>javax.xml.rpc.Stub.PASSWORD_PROPERTY<a id="d4e8152" class="indexterm"></a></p>
          </li></ul></div>

      <p>다음 예는 실제로 프로그램 내에 어떻게 위 설정들이 삽입될 수 있는지를 보여준다.</p><pre class="programlisting">Echo port = // … 서비스 Endpoint 인터페이스의 획득
<span class="bold"><strong>((javax.xml.rpc.Stub) port)._setProperty(javax.xml.rpc.Stub.USERNAME_PROPERTY, 
      "jeus");
((javax.xml.rpc.Stub) port)._setProperty(javax.xml.rpc.Stub.PASSWORD_PROPERTY, 
      "jeus");</strong></span>
String s = port.echoString("JEUS");</pre>

      <p/>

      <p/>

      <p/>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_jaxrpc_datatype.html">이전</a> </td><td width="20%" align="center"><a accesskey="u" href="pt02.html">위로</a></td><td width="40%" align="right"> <a accesskey="n" href="glossary.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제26장 JAX-RPC 웹 서비스 데이터 타입 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 용어해설</td></tr></table></div><div xmlns="" align="center"/></body></html>
