<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta xmlns="" http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>제4장 EJB의 공통 특성</title><link rel="stylesheet" href="../stylesheet.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="JEUS EJB 안내서"/><link rel="up" href="index.html" title="JEUS EJB 안내서"/><link rel="prev" href="chapter_ejb_module.html" title="제3장 EJB 모듈"/><link rel="next" href="chapter_ejb_iiop.html" title="제5장 EJB 상호 운용성 및 RMI/IIOP"/></head><body><div xmlns="" class="navheader"><table width="100%" summary="Navigation header"><tr><td class="navbar-title" colspan="3" align="center">제4장 EJB의 공통 특성</td></tr><tr><td width="20%" align="left"><a accesskey="p" href="chapter_ejb_module.html">이전</a> </td><td class="navbar-title" width="60%" align="center"> </td><td width="20%" align="right"> <a accesskey="n" href="chapter_ejb_iiop.html">다음</a></td></tr></table><hr/></div><div class="chapter" lang="ko"><div class="titlepage"><div><div><h2 class="title"><a id="chapter_common_characters_of_ejb"></a>제4장 EJB의 공통 특성</h2></div></div></div><div class="toc"><p><b>내용 목차</b></p><dl><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e1972">4.1. 개요</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2288">4.2. EJB 설정</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2300">4.2.1. 기본 환경설정</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2404">4.2.2. Thread Ticket 설정</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2433">4.2.3. External Reference 설정과 매핑</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#sect_http_invoke_ejb_module_config">4.2.4. HTTP Invoke 환경설정</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2624">4.2.5. JEUS RMI 설정</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#ejb_security">4.2.6. EJB 보안 설정</a></span></dt></dl></dd><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2779">4.3. EJB 모니터링</a></span></dt><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2799">4.4. EJB 튜닝</a></span></dt><dd><dl><dt><span class="section"><a href="chapter_common_characters_of_ejb.html#d4e2818">4.4.1. Thread Ticket Pool 설정 튜닝</a></span></dt></dl></dd></dl></div>
  

  <p>본 장에서는 JEUS에서의 EJB 공통 특성에 대해 설명한다.</p>

  <p>EJB 표준에 언급된 내용은 설명하지 않고, JEUS에서 EJB를 사용하기 위해 필요한 추가적인 정보들만 제공한다. 또한
  EJB deploy에 대해 언급하지 않으므로 <a href="chapter_ejb_module.html" title="제3장 EJB 모듈">“제3장 EJB 모듈”</a>의 내용을 먼저
  참고한다.</p>

  <p/>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d4e1972"></a>4.1. 개요</h2></div></div></div>
    

    <p>본 절에서는 EJB의 종류와 각 종류별 DD 설정에 대해서 설명한다.</p>

    <p/>

    <h3><a id="d4e1977"></a>EJB 종류</h3>

    <p>JEUS는 EJB 스펙에 따라 다음의 EJB들을 지원한다.</p>

    <div class="itemizedlist"><ul type="disc"><li>
        <p>Stateless Session Bean : <a href="chapter_session_ejb.html" title="제7장 Session Bean">“제7장 Session Bean”</a></p>
      </li><li>
        <p>Stateful Session Bean : <a href="chapter_session_ejb.html" title="제7장 Session Bean">“제7장 Session Bean”</a></p>
      </li><li>
        <p>BMP Entity Bean : <a href="chapter_entity_bean.html" title="제8장 Entity Bean">“제8장 Entity Bean”</a></p>
      </li><li>
        <p>CMP 1.1 &amp; CMP 2.x Entity Bean : <a href="chapter_entity_bean.html" title="제8장 Entity Bean">“제8장 Entity Bean”</a></p>
      </li><li>
        <p>Message-Driven Bean : <a href="chapter_mdb.html" title="제9장 Message Driven Bean(MDB)">“제9장 Message Driven Bean(MDB)”</a></p>
      </li></ul></div>

    <p>본 장에서는 모든 Bean들에 적용되는 공통적인 특징과 설정에 대해서 설명한다. 각 EJB에 대한 추가적인 상세 정보는
    위에 나열된 해당 장을 참고한다.</p>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
      <p>Entity Bean은 EJB 3.0부터는 JPA로 대체되었으므로 이에 대해서는 <a xmlns="" href="../jpa/index.html" class="olink">"JEUS JPA 안내서"</a>를 참고한다. 따라서
      Entity Bean의 사용을 권장하지 않지만 하위 호환성을 위해 계속 지원하고 있다.</p>
    </div>

    <p/>

    <p/>

    <p/>

    <h3><a id="d4e2003"></a>EJB 종류별 DD 설정</h3>

    <p>JEUS EJB DD(Deployment Descriptors)는 jeus-ejb-dd.xml로 명명된 XML 파일이며,
    EJB JAR 파일의 META-INF 하위에 존재한다. JEUS EJB DD에 대한 간단한 내용은 <a href="chapter_ejb_module.html" title="제3장 EJB 모듈">“제3장 EJB 모듈”</a>을 참고한다.</p>

    <div class="literallayout"><p/></div>

    <p>다음은 JEUS EJB DD로 설정 가능한 기능들과 컴포넌트들의 간략한 정보를 나타낸다("@" 표시는
    Annotation으로도 설정 가능한 개체이다). 표의 왼쪽에 나열된 항목들은 실제 설정 가능한 JEUS EJB DD의 XML
    태그들이다. 표의 나머지 6개 열은 EJB 종류에 따른 설정 사항들을 나타낸다. </p>

    <div class="informaltable"><a id="table_config_elements_for_eachtype"></a>
        <table border="1"><colgroup><col width="200"/><col width="80"/><col width="60"/><col width="60"/><col width="60"/><col width="60"/><col width="60"/></colgroup><thead><tr><th>설정 가능한 개체</th><th>Stateless</th><th>Stateful</th><th>BMP</th><th>CMP1.1</th><th>CMP2.0</th><th>MDB</th></tr></thead><tbody><tr><td>1. EJB name @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>2. Export name @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>3. Local export name @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>4. Export port</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>5. Export IIOP switch</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>6. use-access-control</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>7. Run-as Identify</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>8. Security CSI Interop.</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>9. Env. Refs @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>10. EJB refs @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>11. Resource Refs @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>12. Resource env. Refs @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>13. Thread ticket pool settings</td><td>√</td><td>√`</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>14. Clustering settings @</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>15. HTTP Invoke</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>16. JEUS RMI</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>17. Pooling Bean Switch</td><td> </td><td>√</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td>18. Object management</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>19. Persistence Optimize</td><td> </td><td> </td><td>√</td><td>√</td><td>√</td><td> </td></tr><tr><td>20. CM persistence opt.</td><td> </td><td> </td><td> </td><td>√</td><td>√</td><td> </td></tr><tr><td>21. Schema info</td><td> </td><td> </td><td> </td><td>√</td><td>√</td><td> </td></tr><tr><td>22. Relationship map</td><td> </td><td> </td><td> </td><td> </td><td>√</td><td> </td></tr><tr bgcolor="#EEEEEE"><td>23. Connect. fact. name</td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr bgcolor="#EEEEEE"><td>24. MDB resource adaptor</td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr bgcolor="#EEEEEE"><td>25. Destination @</td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr bgcolor="#EEEEEE"><td>26. JNDI SPI settings</td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr bgcolor="#EEEEEE"><td>27. Max messages<a id="d4e2239" class="indexterm"></a></td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr bgcolor="#EEEEEE"><td>28. Activation Config @</td><td> </td><td> </td><td> </td><td> </td><td> </td><td>√</td></tr><tr><td>29. Durable Timer Service</td><td>√</td><td> </td><td>√</td><td>√</td><td>√</td><td>√</td></tr></tbody></table>
      </div>

    <p/>

    <p>위의 표는 다음과 같이 나누어 진다.</p><div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
          <p>항목 1부터 16까지는 6개의 EJB 종류 모두에 공통으로 적용되는 사항이다(MDB의 2~5과 14~16은
          제외). 이 모든 항목들에 대해서 본 장에서 설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 7(Run-as Identify)과 8(security interoperability),
          14(clustering)은 모든 EJB 종류에 공통이지만, 각각 <a href="chapter_common_characters_of_ejb.html#ejb_security" title="4.2.6. EJB 보안 설정">“4.2.6. EJB 보안 설정”</a>, <a href="chapter_ejb_iiop.html" title="제5장 EJB 상호 운용성 및 RMI/IIOP">“제5장 EJB 상호 운용성 및 RMI/IIOP”</a>,
          <a href="chapter_ejb_clustering.html" title="제6장 EJB 클러스터링">“제6장 EJB 클러스터링”</a>에서 별도로 설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 17은 Stateful Session Bean에 대해서만 적용되며, <a href="chapter_session_ejb.html" title="제7장 Session Bean">“제7장 Session Bean”</a>에서 자세히 설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 18(object management)은 6개의 EJB 종류 모두에 공통으로 적용되는 사항이나 Bean의
          종류에 따라 조금씩 다르므로 기본적인 것은 <a href="chapter_session_ejb.html" title="제7장 Session Bean">“제7장 Session Bean”</a>에서
          설명하고 각 장에서 차이점을 설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 19부터 22까지는 Entity Bean에만 적용된다. 이들은 <a href="chapter_entity_bean.html" title="제8장 Entity Bean">“제8장 Entity Bean”</a>에서 설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 23부터 28까지는 MDB에만 적용된다. 이들은 <a href="chapter_mdb.html" title="제9장 Message Driven Bean(MDB)">“제9장 Message Driven Bean(MDB)”</a>에서
          설명한다.</p>
        </li><li style="list-style-type: circle">
          <p>항목 29는 EJB 스펙에서 제공하는 타이머 서비스를 사용할 수 있는 Bean(Stateful Session
          Bean을 제외한 모든 Bean)에 사용할 수 있다. 이는 <a href="chapter_ejb_timer_service.html" title="제10장 EJB Timer Service">“제10장 EJB Timer Service”</a>에서 설명한다.</p>
        </li></ul></div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d4e2288"></a>4.2. EJB 설정</h2></div></div></div>
    

    <p>모든 EJB 설정들은 JEUS EJB DD 파일인 jeus-ejb-dd.xml 파일 내에 설정된다. 상위 XML 태그는
    Bean의 종류에 관계없이 &lt;jeus-bean&gt;을 사용한다.</p>

    <p>다음 절에서는 위의 5종류의 EJB XML 부모 태그들에 적용될 수 있는 설정들을 설명한다. &lt;beanlist&gt;
    밖에 있는 다른 태그들은 <a href="chapter_ejb_module.html" title="제3장 EJB 모듈">“제3장 EJB 모듈”</a>에서 이미 설명하였다. 특정 XML 부모
    태그(Bean 종류)에 대한 설명은 이 문서의 후반부에 나오는 해당 장들을 참고한다.</p>

    <p/>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
        <p>클러스터링 환경설정은 <a href="chapter_ejb_clustering.html" title="제6장 EJB 클러스터링">“제6장 EJB 클러스터링”</a>을
        참고한다.</p>
      </div>

    <p/>

    <p/>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2300"></a>4.2.1. 기본 환경설정</h3></div></div></div>
      

      <p>다음은 주로 사용되는 JEUS 전용 설정들이며 jeus-ejb-dd.xml에 선언되어 있다. 이 파일에 대해서는
      <a href="chapter_ejb_module.html" title="제3장 EJB 모듈">“제3장 EJB 모듈”</a>을 참고한다. </p><div class="itemizedlist"><ul type="disc"><li>
            <p><span class="bold"><strong>&lt;ejb-name&gt;</strong></span></p>

            <div class="itemizedlist"><ul type="circle"><li>
                <p>표준 ejb-jar.xml에서 &lt;ejb-name&gt; 또는 구현 클래스의 @Stateless,
                @Stateful, @MessageDriven의 "name" 값과 동일한 이름이다.</p>
              </li></ul></div>
          </li><li>
            <p><span class="bold"><strong>&lt;export-name&gt;</strong></span></p><div class="itemizedlist"><ul type="circle"><li>
                  <p>글로벌 JNDI에 등록될 시스템 내부에서 유일한 이름을 가져야 한다.</p>
                </li><li>
                  <p>DD 파일에 이 element가 없는 경우 Annotation @Stateless나
                  @Stateful의 mappedName attribute 값이 적용되거나, ejb-jar.xml의
                  &lt;mapped-name&gt;값이 적용된다.</p>

                  <p>이 모든 설정이 없는 경우는 기본값으로 Remote Business Interface name이
                  사용된다. 단, Remote Business Interface가 하나만 존재하고 Remote Home
                  Interface가 존재하지 하는 경우나 Remote Business Interface가 존재하지 않고
                  Remote Home Interface가 존재하는 경우에만 기본값이 적용되고 아닌 경우에는 JNDI
                  name을 결정할 수 없어 deploy가 실패한다.</p>
                </li><li>
                  <p>순위는 다음과 같다.</p>

                  <div class="orderedlist"><ol type="1"><li>
                      <p>jeus-ejb-dd.xml의 &lt;export-name&gt;</p>
                    </li><li>
                      <p>ejb-jar의 &lt;mapped-name&gt;</p>
                    </li><li>
                      <p>@EJB의 mappedName</p>
                    </li></ol></div>
                </li></ul></div>
          </li><li>
            <p><span class="bold"><strong>&lt;local-export-name&gt;</strong></span></p><div class="itemizedlist"><ul type="circle"><li>
                  <p>JNDI에 등록될 시스템 내부의 유일한 이름을 가져야 한다.</p>
                </li><li>
                  <p>DD 파일에 이 element가 없는 경우 Annotation @EJB mappedName
                  attribute 값에 적용된다. 만약 Remote Business Interface가 존재하는 경우에는 이
                  값에 '_Local'이 붙는다.</p>

                  <p>둘 다 없는 경우는 기본값으로 Local Business Interface name이 사용된다.
                  단, Local Business Interface가 하나만 존재하고 Local Home Interface가
                  존재하지 않는 경우나 Local Business Interface가 존재하지 않고 Local Home
                  Interface가 존재하는 경우에만 기본값이 적용되고 아닌 경우에는 JNDI name을 찾을 수 없어
                  Exception이 발생한다.</p>
                </li><li>
                  <p>순위는 다음과 같다.</p>

                  <div class="orderedlist"><ol type="1"><li>
                      <p>jeus-ejb-dd.xml의 &lt;local-export-name&gt;</p>
                    </li><li>
                      <p>Remote Business Interface가 존재하면 ejb-jar.xml의
                      &lt;mapped-name&gt;+ _Local</p>

                      <p>Remote Business Interface가 존재하지 않으면 ejb-jar.xml의
                      &lt;mapped-name&gt;</p>
                    </li><li>
                      <p>Remote Business Interface가 존재하면 @EJB의 mappedName +
                      _Local</p>

                      <p>Remote Business Interface가 존재하지 않으면 @EJB의
                      mappedName</p>
                    </li></ol></div>
                </li></ul></div>
          </li><li>
            <p><span class="bold"><strong>&lt;export-port&gt;</strong></span></p><div class="itemizedlist"><ul type="circle"><li>
                  <p>RMI 서비스 포트를 명시적으로 설정할 필요가 있을 때에 이 설정을 사용한다.</p>
                </li></ul></div><div class="itemizedlist"><ul type="circle"><li>
                  <p>방화벽을 사용하고 있어서 특정 포트로만 시스템 접근을 허용할 경우에 유용하다. 이 태그의 설정은
                  방화벽 설정의 “allowed”로 설정된 포트와 동일한 것이어야 한다. 값을 지정하지 않는 경우는 시스템
                  프로퍼티에 따라 일괄적으로 포트가 적용되는데 정리하면 다음과 같다.</p>

                  <div class="informaltable">
                      <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">항목</th><th>설명</th></tr></thead><tbody><tr><td align="left">jeus.ejb.exportPort</td><td>jeus-ejb-dd에 특정 EJB에 대한 &lt;export-port&gt;가
                            지정되어 있지 않는 나머지 EJB의 export port를 결정한다.</td></tr><tr><td align="left">jeus.rmi.usebaseport</td><td><div class="itemizedlist"><ul type="circle" compact="compact"><li style="list-style-type: circle">
                                  <p>true: Managed Server base port를 사용한다.</p>
                                </li><li style="list-style-type: circle">
                                  <p>false: Managed Server base port + 7을
                                  사용한다.</p>
                                </li></ul></div></td></tr></tbody></table>
                    </div>
                </li></ul></div>
          </li><li>
            <p><span class="bold"><strong>&lt;export-iiop&gt;</strong></span></p><div class="itemizedlist"><ul type="circle"><li>
                  <p>활성화되어 있을 경우에 Bean의 인터페이스가 IIOP Stub과 Skeleton으로서 COS
                  Naming Server에 export될 수 있도록 한다. 이는 IIOP로 접근 가능한 모든 클라이언트가
                  Bean에 접근 가능하도록 한다.</p>
                </li></ul></div>
          </li><li>
            <p><span class="bold"><strong>&lt;use-access-control&gt;</strong></span></p><div class="itemizedlist"><ul type="circle"><li>
                  <p>Boolean 설정은 Bean 메소드들을 수행할 때 Java EE의 principal에 따라
                  메소드의 수행이 Java SE Security Manager의 감시를 받도록 할 것인지를 결정한다. 자세한
                  내용은 <a xmlns="" href="../security/index.html" class="olink">"JEUS
                  Security 안내서"</a>와 JACC specification을 참고한다. (기본값:
                  false)</p>
                </li></ul></div>
          </li></ul></div>

      <div class="literallayout"><p/></div>

      <p>다음은 위의 설정들이 Stateful Session Bean class와 DD에 적용된 예로 대응되는
      Annotation과 DD의 element는 굵게 표시했다.</p>

      <div class="example"><a id="d4e2394"></a><p class="title"><b>[예 4.1] Stateful Session Bean class와 DD :
          &lt;&lt;CounterEJB.java&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">package ejb.basic.statefulSession;

<span class="bold"><strong>@Stateful(name="counter", mappedName="counterEJB")</strong></span>
public class CounterEJB implements Counter, CounterLocal
{
   private int count = 0;

   public void increase()
   {
      count++;
   }
 ...
}</pre>
        </div></div><p><br class="example-break"/></p>

      <div class="example"><a id="d4e2399"></a><p class="title"><b>[예 4.2] Stateful Session Bean class와 DD :
          &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-ejb-dd&gt;
    . . .
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
 <span class="bold"><strong>           &lt;ejb-name&gt;counter&lt;/ejb-name&gt;
            &lt;export-name&gt;counterEJB&lt;/export-name&gt;
            &lt;local-export-name&gt;counterEJB_Local&lt;/local-export-name&gt;</strong></span>
            &lt;export-port&gt;7654&lt;/export-port&gt;
            &lt;export-iiop/&gt;
            . . .
        &lt;/jeus-bean&gt;
        . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2404"></a>4.2.2. Thread Ticket 설정</h3></div></div></div>
      

      <p>다음은 EJB Thread Ticket Pool(이하 TTP)의 개념을 나타낸 그림이다.<a id="d4e2407" class="indexterm"></a></p>

      <p>기본적인 동작은 클라이언트로부터 요청을 받으면 새로운 RMI 스레드를 클라이언트 요청에 부여하는 것이다. 이때 부여된
      RMI 스레드의 수가 설정된 최댓값보다 많은 경우에는 해당 요청에 스레드를 부여하지 않고 대기한다. </p><div class="figure"><a id="figure_thread_ticket_pool"></a><p class="title"><b>[그림 4.1] TTP 상태 전이도</b></p><div class="figure-contents">
          

          <div xmlns="" class="mediaobject" align="left"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="616"><tr><td align="left"><img src="resources/figure_16_thread_ticket_pool.png" align="top" width="616" alt="TTP 상태 전이도"/></td></tr></table></div>
        </div></div><p><br class="figure-break"/>위 그림에서 볼 수 있듯이 TTP는 Thread Ticket(이하 TT)을 가지고 있다. 한 개의 TT는
      하나의 클라이언트 스레드가 EJB 엔진에 접근할 수 있도록 허가한다. 클라이언트의 요청이 도착하면, 하나의 TT가 TTP에서
      얻어지고 클라이언트에게 부여된다. 이는 각 클라이언트 스레드는 실제 EJB Instance에게 요청을 전달할 한 개의 EJB
      Object에게 할당된다는 것을 의미한다. 그러므로 EJB Object는 EJB 엔진 내에 존재하는 하나의 Object라고 볼 수
      있고 EJB 클라이언트와 실제 EJB Instance와의 연결을 관리한다.</p>

      <p>TTP에 있는 TT의 숫자보다 많은 클라이언트의 요청이 오는 경우 새로운 요청은 TT가 Free되어 Pool로 반환될
      때까지 기다려야 한다. 클라이언트의 요청이 TT를 기다린지 10분이 초과할 경우 시간 초과로 RemoteException을
      던진다.</p>

      <p>EJB 처리가 끝나거나(Stateless Session Bean) Connection 타임아웃이 발생하여 클라이언트가
      연결을 잃을 경우에 TTP로 TT가 반환된다. 그리고 TTP는 원격 호출이 가능한 EJB 컴포넌트마다 하나씩 가지고 있다. 이
      외에도 Connection Pool과 Bean Pool이 있다. MDB에서는 TTP가 아닌 Bean Pool을 설정한다.
      </p><div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
          <p>Connection Pool과 Bean Pool에 대한 자세한 내용은 <a href="chapter_session_ejb.html" title="제7장 Session Bean">“제7장 Session Bean”</a>과 <a href="chapter_entity_bean.html" title="제8장 Entity Bean">“제8장 Entity Bean”</a>을 참고한다. MDB에서 Bean Pool 사용에 대한 자세한
          내용은 <a href="chapter_mdb.html" title="제9장 Message Driven Bean(MDB)">“제9장 Message Driven Bean(MDB)”</a>을 참고한다.</p>
        </div>

      <div class="literallayout"><p/></div>

      <p>EJB의 TT은 Bean의 최상위 XML 태그의
      <span><strong class="guibutton">&lt;thread-max&gt;</strong></span>에서 설정한다. 이 값은 각 EJB를 수행하는 스레드의
      최대 허용 개수, 즉 최대 TT의 수를 의미한다. 기본은 100이다. 대기하고 있는 클라이언트의 요청 수가 이 값보다 클 경우에는
      새로운 요청들은 먼저 진행 중인 작업이 끝나고, Pool로 TT가 반환될 때까지 대기한다. 대기한지 10분이 지날 경우 시간
      초과로 RemoteException을 던진다.</p>

      <p/>

      <p>다음은 BMP Bean에 위의 설정을 적용한 예이다.</p><div class="example"><a id="d4e2428"></a><p class="title"><b>[예 4.3] BMP Bean 설정 : &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-ejb-dd&gt;
    . . .
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
            . . .
            <span class="bold"><strong>&lt;thread-max&gt;</strong></span>200<span class="bold"><strong>&lt;/thread-max&gt;</strong></span>
            . . .
        &lt;/jeus-bean&gt;
        . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
        </div></div><p><br class="example-break"/></p>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2433"></a>4.2.3. External Reference 설정과 매핑</h3></div></div></div>
      

      <p>Bean이 사용하는 External Reference는 Annotation을 통해 설정하거나 또는
      ejb-jar.xml에서 사용한 reference 이름과 매핑된 jeus-ejb-dd.xml의 JNDI export name을
      사용하여 설정할 수 있다. 선언된 모든 External Reference들은 JNDI export name과 매핑되어야
      한다.</p>

      <p>Annotation이나 ejb-jar.xml에 선언된 External Reference는 각 Reference에
      해당하는 jeus-ejb-dd.xml의 태그에 실제 시스템 JNDI export name으로 매핑되어야 한다.</p>

      <div class="literallayout"><p/></div>

      <p>다음은 ejb-jar.xml과 JEUS EJB DD 파일의 참조 태그에 대한 설명이다.</p>

      <div class="informaltable"><a id="table_relationship_with_ejbjar_jeusejbdd"></a>
          <table border="1"><colgroup><col width="160"/><col width="180"/><col/></colgroup><thead><tr><th>태그</th><th>EJB DD XML 태그</th><th>설명</th></tr></thead><tbody><tr><td>&lt;env-entry&gt;<a id="d4e2453" class="indexterm"></a></td><td>&lt;env&gt;<a id="d4e2457" class="indexterm"></a></td><td>EJB 환경설정을 정의하거나 무시한다.</td></tr><tr><td>&lt;ejb-ref&gt;<a id="d4e2463" class="indexterm"></a></td><td>&lt;ejb-ref&gt;<a id="d4e2467" class="indexterm"></a></td><td>EJB reference를 실제 export name으로 binding한다.</td></tr><tr><td>&lt;resource-ref&gt;<a id="d4e2473" class="indexterm"></a></td><td>&lt;res-ref&gt;<a id="d4e2477" class="indexterm"></a></td><td>External resource manage reference를 실제 export name에
                binding한다.</td></tr><tr><td>&lt;resource-env-ref&gt;<a id="d4e2483" class="indexterm"></a></td><td>&lt;res-env-ref&gt;<a id="d4e2487" class="indexterm"></a></td><td>관리되고 있는 object reference를 실제 export name에
                binding한다.</td></tr><tr><td>&lt;message-destination-ref&gt;<a id="d4e2493" class="indexterm"></a></td><td>&lt;message-destination-ref&gt;<a id="d4e2497" class="indexterm"></a></td><td>message destination의 reference를 실제 export name에
                binding한다.</td></tr><tr><td>&lt;service-ref&gt;<a id="d4e2503" class="indexterm"></a></td><td>&lt;service-ref&gt;<a id="d4e2507" class="indexterm"></a></td><td>Webservice endpoint의 reference를 실제 export name에
                binding한다.</td></tr></tbody></table>
        </div>

      <div class="literallayout"><p/></div>

      <p>모든 &lt;env&gt; 태그는 다음의 하위 태그를 설정해야 한다.</p>

      <div class="informaltable">
          <table border="1"><colgroup><col width="160"/><col/></colgroup><thead><tr><th>태그</th><th>설명</th></tr></thead><tbody><tr><td>&lt;name&gt;<a id="d4e2525" class="indexterm"></a></td><td>env의 이름으로 ejb-jar.xml에 정의된 &lt;env-entry-name&gt; 태그의
                값과 같은 값을 사용한다.</td></tr><tr><td>&lt;type&gt;<a id="d4e2531" class="indexterm"></a></td><td>값의 자료형에 해당하는 완전한 Java 클래스 이름으로 기본 자료형은 wrapper 클래스를
                사용한다.</td></tr><tr><td>&lt;value&gt;<a id="d4e2537" class="indexterm"></a></td><td>env의 실제 값을 선언한다.</td></tr></tbody></table>
        </div>

      <div class="literallayout"><p/></div>

      <p>다른 태그들(&lt;ejb-ref&gt;, &lt;res-ref&gt;, &lt;res-env-ref&gt;)은 여러
      개의 &lt;jndi-info&gt; 태그를 가진다. 이 태그들은 또 JNDI export name에 reference를 매핑하기
      위해서 다음과 같은 하위 태그를 설정해야 한다.</p>

      <div class="informaltable">
          <table border="1"><colgroup><col width="160"/><col/></colgroup><thead><tr><th>태그</th><th>설명</th></tr></thead><tbody><tr><td>&lt;ref-name&gt;<a id="d4e2555" class="indexterm"></a></td><td>EJB 소스 코드와 ejb-jar.xml에서 정의된 참조 이름으로 ejb-jar.xml에서
                &lt;ejb-ref&gt;와 동격의 태그는 &lt;ejb-ref&gt;이다.
                &lt;resource-ref&gt;와 동격은 &lt;res-ref&gt;이고,
                &lt;resource-env-ref&gt;와 동격은 &lt;res-env-ref&gt;이다.</td></tr><tr><td>&lt;export-name&gt;<a id="d4e2560" class="indexterm"></a></td><td>JNDI에 export될 때 사용되는 이름이다.</td></tr></tbody></table>
        </div>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
          <p>&lt;ref-name&gt;과 &lt;export-name&gt; 태그는 반드시 ejb-jar.xml에 설정된
          이름과 같은 값이어야 한다.</p>
        </div>

      <p/>

      <div class="literallayout"><p/></div>

      <p>다음은 External Reference를 JNDI로 매핑하는 방법으로, Annotation과 XML의
      예이다.</p>

      <div class="example"><a id="d4e2571"></a><p class="title"><b>[예 4.4] External Reference를 JNDI로 매핑 :
          &lt;&lt;CounterEJB.java&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">@Stateful

@EJB(name="AccountEJB", beanInterface=ejb.Account.class, mapppedName="ACCEJB")
@Resource(name="jdbc/DBDS", type=javax.sql.DataSource.class, mappedName="ACCOUNTDB")
public class CounterEJB implements Counter{
    @Resource(name="minAmount")
    private int minAccount = 100;

 . . .
}</pre>
        </div></div><p><br class="example-break"/></p>

      <div class="example"><a id="d4e2575"></a><p class="title"><b>[예 4.5] External Reference를 JNDI로 매핑 :
          &lt;&lt;ejb-jar.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;ejb-jar.xml&gt;
    . . .
    &lt;enterprise-beans&gt;
        &lt;session&gt;
            . . .
            &lt;env-entry&gt;
                &lt;env-entry-name&gt;minAmount&lt;/env-entry-name&gt;
                &lt;env-entry-type&gt;java.lang.Integer&lt;/env-entry-type&gt;
            &lt;/env-entry&gt;
            &lt;ejb-ref&gt;
                &lt;ejb-ref-name&gt;AccountEJB&lt;/ejb-ref-name&gt;    
                &lt;ejb-ref-type&gt;Session&lt;ejb-ref-type&gt;
                &lt;remote&gt;ejb.Account&lt;/remote&gt;
            &lt;/ejb-ref&gt;
            &lt;resource-ref&gt;
                &lt;res-ref-name&gt;jdbc/DBDS&lt;/res-ref-name&gt;
                &lt;res-ref-type&gt;javax.sql.DataSource&lt;/res-ref-type&gt;
            &lt;/resource-ref&gt;
            . . .
        &lt;/session&gt;
    &lt;/enterprise-beans&gt;
    . . .
&lt;/ejb-jar.xml&gt;</pre>
        </div></div><p><br class="example-break"/></p>

      <div class="example"><a id="d4e2579"></a><p class="title"><b>[예 4.6] External Reference를 JNDI로 매핑 :
          &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
          

          

          <pre class="programlisting">&lt;jeus-ejb-dd&gt;
    . . .
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
            . . .
            &lt;env&gt;
                &lt;name&gt;minAmount&lt;/name&gt;
                &lt;type&gt;java.lang.Integer&lt;/type&gt;
                &lt;value&gt;100&lt;/value&gt;
            &lt;/env&gt;
            &lt;ejb-ref&gt;
                &lt;jndi-info&gt;
                    &lt;ref-name&gt;AccountEJB&lt;/ref-name&gt;
                    &lt;export-name&gt;ACCEJB&lt;/export-name&gt;
                &lt;/jndi-info&gt;
            &lt;/ejb-ref&gt;
            &lt;res-ref&gt;
                &lt;jndi-info&gt;
                    &lt;ref-name&gt;jdbc/DBDS&lt;/ref-name&gt;
                    &lt;export-name&gt;ACCOUNTDB&lt;/export-name&gt;
                &lt;/jndi-info&gt;
            &lt;/res-ref&gt;
            . . .
        &lt;/jeus-bean&gt;
        . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>

          <p/>
        </div></div><p><br class="example-break"/></p>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="sect_http_invoke_ejb_module_config"></a>4.2.4. HTTP Invoke 환경설정</h3></div></div></div>
      

      <p>EJB 모듈 중 특정 EJB에 HTTP invocation을 설정하고 사용하기 위해서는 jeus-ejb-dd.xml의
      &lt;jeus-bean&gt; 하위에 &lt;invoke-http&gt;를 설정해야 한다. EJB 엔진에서 HTTP
      invocation이 필요하면 domain.xml의 ejb-engine에 &lt;invoke-http&gt;를 추가한다(<a href="chapter_ejb_engine.html" title="제2장 EJB 엔진">“제2장 EJB 엔진”</a>에서 언급). 이 설정은 모든 모듈에 적용되는데, 각 모듈의 DD 파일에
      &lt;invoke-http&gt;가 있다면 파일의 설정을 사용한다.</p>

      <div class="literallayout"><p/></div>

      <p>다음은 jeus-ejb-dd.xml의 HTTP invoke 환경설정 예제이다.</p>

      <div class="example"><a id="d4e2590"></a><p class="title"><b>[예 4.7] HTTP Invoke 환경설정 : &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
        

        

        <pre class="programlisting">&lt;jeus-ejb-dd&gt;
    . . .
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
            . . .
            <span class="bold"><strong>&lt;invoke-http&gt;</strong></span>
                &lt;url&gt;
                    /mycontext/RMIServletHandler
                &lt;/url&gt;
                &lt;http-port&gt;
                    80
                &lt;/http-port&gt;
            <span class="bold"><strong>&lt;/invoke-http&gt;</strong></span>
            . . .
        &lt;/jeus-bean&gt;
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
      </div></div><br class="example-break"/>

      <p>&lt;invoke-http&gt; 설정에는 2개의 하위 태그가 존재한다.</p>

      <div class="informaltable">
        <table border="1"><colgroup><col width="120" align="left"/><col/></colgroup><thead><tr><th align="left">태그</th><th>설명</th></tr></thead><tbody><tr><td align="left">&lt;url&gt;<a id="d4e2606" class="indexterm"></a></td><td><p>반드시 HTTP-RMI Stub으로부터 호출되는 RMI 핸들러
              서블릿(jeus.rmi.http.ServletHandler)의 URI를 입력한다. 이 URI에서는 프로토콜, IP,
              포트를 제외한 서블릿 요청 경로만을 입력한다.</p><p>프로토콜은 "HTTP"로 IP는 RMI 런타임과
              동일한 주소로 간주된다. 즉, HTTP-RMI 요청을 받은 웹 서버와 웹 엔진이 RMI 런타임과 같은 머신에 있어야
              된다. 그러면 RMI 런타임의 주소는 RMI Stub에게 알려지게 된다. 웹 서버의 포트는 반드시 다음
              &lt;http-port&gt;에 설정해야 한다.</p></td></tr><tr><td align="left">&lt;http-port&gt;<a id="d4e2614" class="indexterm"></a></td><td>HTTP-RMI 요청을 받을 포트 번호를 설정한다. 웹 서버 및 웹 엔진에는 반드시 RMI 핸들러
              서블릿이 deploy되어 실행되고 있어야 한다.</td></tr></tbody></table>
      </div>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
          <p>HTTP invoke가 정상적으로 작동하기 위해선 RMI 핸들러 서블릿이 deploy되어 있어야 한다. RMI
          핸들러 서블릿을 구현한 클래스는 jeus.rmi.http.ServletHandler이다.
          jeus.rmi.http.ServletHandler는 context 내에 &lt;invoke-http&gt;에 설정된
          URL과 동일하게 deploy되어야 한다. deploy에 대한 자세한 내용은 <a xmlns="" href="../web-engine/index.html" class="olink">"JEUS Web Engine
          안내서"</a>를 참고한다.</p>
        </div>

      <p/>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2624"></a>4.2.5. JEUS RMI 설정</h3></div></div></div>
      

      <p>JEUS에서는 성능을 향상시킨 JEUS RMI 통신을 제공한다. 이 RMI는 Non-blocking IO로도 RMI
      통신을 할 수 있기 때문에 클라이언트 수가 많은 경우에 유용하다. JEUS RMI를 사용하기 위해서는 클라이언트용 라이브러리인
      JEUS_HOME\lib\client\jclient.jar를 클래스 패스에 설정하는 것 외에 특별히 다른 작업은 필요하지
      않다.</p>

      <p>JEUS RMI의 사용 여부는 jeus-ejb-dd.xml에 Bean별로 설정할 수 있으며, JEUS 전체에 시스템
      프로퍼티(-Djeus.ejb.rmi.jeus=true)로 적용할 수도 있다. 이때 DD의 설정이 우선한다.</p>

      <p>JEUS RMI를 Blocking IO와 Non-blocking IO로 사용할지 여부와 채널과 소켓의 사용 여부 등
      통신 레이어의 상세한 것은 시스템 프로퍼티로 모두 설정 가능하다. 이에 대한 설명은 <a xmlns="" href="../reference-book/index.html" class="olink">"JEUS Reference
      Book"</a>을 참고한다.</p>

      <p/>
    </div>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="ejb_security"></a>4.2.6. EJB 보안 설정</h3></div></div></div>
      

      <p><a id="d4e2634" class="indexterm"></a></p>

      <p>본 절에서는 JEUS에서 EJB를 위한 보안 설정 방법에 대해 설명한다. 여기에서 사용된 보안은 인증과 권한 부여를
      의미한다.</p>

      <p>JEUS EJB의 보안 설정과 관련된 항목은 다음과 같다.</p><div class="itemizedlist"><ul type="disc"><li>
            <p>EJB 모듈의 역할 할당(Role Assignment)</p>
          </li><li>
            <p>EJB Run-as Identify 설정</p>
          </li></ul></div>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
        <p>EJB 설정에서 사용하는 실제 JEUS 사용자 목록은 accounts.xml에 정의되어 있다. 이에 대한 설정은
        <a xmlns="" href="../security/index.html" class="olink">"JEUS Security
        안내서"</a>를 참고한다.</p>
      </div>

      <div class="literallayout"><p/></div>

      <p/>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="d4e2649"></a>4.2.6.1. 보안 설정</h4></div></div></div>
        

        <p>다음은 상황별 보안 설정하는 방법에 대한 설명이다.</p>

        <p/>

        <div class="literallayout"><p/></div>

        

        <h5><a id="d4e2655"></a>역할 할당(Role Assignment) 설정</h5>

        <p>EJB 모듈의 역할 할당 설정은 표준 ejb-jar.xml 파일에 개발자가 정의한 역할과 실제 JEUS 보안
        도메인의 principal와 group name을 매핑하는 것이다. 이는 jeus-ejb-dd.xml 파일의
        <span><strong class="guibutton">&lt;module-info&gt;</strong></span>의
        <span><strong class="guibutton">&lt;role-permission&gt;</strong></span> 태그에서 설정한다.<a id="d4e2659" class="indexterm"></a></p>

        <p>다음은 역할 할당을 설정한 XML의 예이다.</p>

        <p/>

        <div class="example"><a id="d4e2665"></a><p class="title"><b>[예 4.8] 역할 할당(Role Assignment) 설정 :
            &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">&lt;jeus-ejb-dd&gt;
 <span class="bold"><strong>   &lt;module-info&gt;
        <span class="bold"><strong>&lt;role-permission&gt;</strong></span>
            &lt;role&gt;manager&lt;/role&gt;
            &lt;principal&gt;peter&lt;/principal&gt;
        <span class="bold"><strong>&lt;/role-permission&gt;</strong></span>
    &lt;/module-info&gt;</strong></span>
    &lt;beanlist&gt;
       . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
          </div></div><p><br class="example-break"/></p>

        <p>다음은 설정 하위 필수 태그에 대한 설명이다.</p>

        <div class="informaltable">
            <table border="1"><colgroup><col width="100" align="left"/><col/></colgroup><thead><tr><th align="left">태그</th><th>설명</th></tr></thead><tbody><tr><td align="left">&lt;role&gt;<a id="d4e2683" class="indexterm"></a></td><td>EJB에 설정된(Annotation이나 ejb-jar.xml을 통해) 논리적인 role
                  name을 지정한다.</td></tr><tr><td align="left">&lt;principal&gt;<a id="d4e2689" class="indexterm"></a></td><td><p>accounts.xml에서 정의된 실제 user name을 지정한다.
                  </p><p>role name-user name 쌍이 개발자가 정의한 role과 JEUS
                  principal 간의 매핑을 정의한다. 하나의 역할 이름에 여러 개의 사용자 이름을 설정할 수
                  있다.</p></td></tr></tbody></table>
          </div>

        <div class="literallayout"><p/></div>

        <h5><a id="d4e2698"></a>Run-as Identify 설정<a id="d4e2699" class="indexterm"></a></h5>

        <p>Run-as Identify 설정은 ejb-jar.xml의 &lt;run-as&gt;에서 개발자가 정의한 역할
        이름과 JEUS 보안 도메인 설정에서 지정한 실제 principal의 매핑을 제공한다(예: accounts.xml
        파일에서).</p>

        <p/>

        <p>이 principal은 일반적으로 간단한 사용자 이름을 사용한다. 이는 jeus-ejb-dd.xml에서 Bean
        설정 수준과 같은 <span><strong class="guibutton">&lt;run-as-identity&gt;</strong></span> 태그에서
        설정한다.<a id="d4e2705" class="indexterm"></a></p>

        <p>다음은 Run-as Identify를 설정한 XML 예이다.</p>

        <div class="example"><a id="d4e2710"></a><p class="title"><b>[예 4.9] Run-as Identify 설정 :
            &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">&lt;jeus-ejb-dd&gt;
    . . .
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
            . . .
<span class="bold"><strong>            &lt;run-as-identity&gt;
                &lt;principal-name&gt;peter&lt;/principal-name&gt;
            &lt;/run-as-identity&gt;</strong></span>
            . . .
        &lt;/jeus-bean&gt;
        . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
          </div></div><p><br class="example-break"/></p>

        <div class="informaltable">
            <table border="1"><colgroup><col width="150" align="left"/><col/></colgroup><thead><tr><th align="left">태그</th><th>설명</th></tr></thead><tbody><tr><td align="left">&lt;principal-name&gt;<a id="d4e2725" class="indexterm"></a></td><td>ejb-jar.xml 파일의 &lt;run-as&gt; 태그에서 주어진 role에 매핑할
                  user name으로 accounts.xml에 설정되어 있어야 한다.<a id="d4e2729" class="indexterm"></a></td></tr></tbody></table>
          </div>

        <p/>

        <div class="literallayout"><p/></div>
      </div>

      <div class="section" lang="ko"><div class="titlepage"><div><div><h4 class="title"><a id="d4e2734"></a>4.2.6.2. 보안 설정의 예</h4></div></div></div>
        

        <p>다음은 role-permisstion의 role과 run-as의 role이 실제 JEUS 사용자에서 매핑되는
        예이다.</p>

        <p>Java 클래스와 XML 내용의 일부분들은 3개의 설정 파일들(ejb-jar.xml, jeus-ejb-dd.xml,
        accounts.xml)에서 가져온 것이다. 이 파일들에서 서로 동일해야 하는 부분들은 굵은 글자로 강조하였다.</p>

        <div class="example"><a id="d4e2739"></a><p class="title"><b>[예 4.10] 보안 설정 : &lt;&lt;CustomerBean.java&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">@Stateless(name="CustomerEJB")
@RolesAllowed("<span class="bold"><strong>CUSTOMER</strong></span>")
public class CustomerBean implementes Customer {
    ...
}</pre>
          </div></div><p><br class="example-break"/></p>

        <p/>

        <div class="example"><a id="d4e2745"></a><p class="title"><b>[예 4.11] 보안 설정 : &lt;&lt;EmployeeServiceBean.java&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">@Stateful(name="EmployeeService")
@RunAs("<span class="bold"><strong>ADMIN</strong></span>")
public class EmployeeServiceBean implements EmployService{
    ...
}</pre>
          </div></div><p><br class="example-break"/></p>

        <p/>

        <div class="example"><a id="d4e2751"></a><p class="title"><b>[예 4.12] 보안 설정 : &lt;&lt;ejb-jar.xml&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;ejb-jar version="3.2" xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
              http://xmlns.jcp.org/xml/ns/javaee/ejb-jar_3_2.xsd"&gt;
    &lt;enterprise-beans&gt;
        &lt;session&gt;
            &lt;ejb-name&gt;CustomerEJB&lt;/ejb-name&gt;
            . . .
<span class="bold"><strong>            &lt;security-role-ref&gt;
                &lt;role-name&gt;CUSTOMER&lt;/role-name&gt;
            &lt;/security-role-ref&gt;</strong></span>
            &lt;security-identity&gt;
                &lt;use-caller-identity /&gt;
            &lt;/security-identity&gt;
        &lt;/session&gt;
        &lt;session&gt;
            &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
            . . .
            &lt;security-identity&gt;
<span class="bold"><strong>                &lt;run-as&gt;
                    &lt;role-name&gt;ADMIN&lt;/role-name&gt;
                &lt;/run-as&gt;</strong></span>
            &lt;/security-identity&gt;
        &lt;/session&gt;
        . . .
    &lt;/enterprise-beans&gt;
    &lt;assembly-descriptor&gt;
<span class="bold"><strong>       &lt;security-role&gt;
           &lt;role-name&gt;CUSTOMER&lt;/role-name&gt;
       &lt;/security-role&gt;
       &lt;method-permission&gt;
           &lt;role-name&gt;CUSTOMER&lt;/role-name&gt;
           &lt;method&gt;
               &lt;ejb-name&gt;CustomerEJB&lt;/ejb-name&gt;
               &lt;method-name&gt;*&lt;/method-name&gt;
               &lt;method-params /&gt;
           &lt;/method&gt;
       &lt;/method-permission&gt;</strong></span>
        . . .
    &lt;/assembly-descriptor&gt;
    . . .
&lt;/ejb-jar&gt;</pre>
          </div></div><p><br class="example-break"/>위의 예에서는 2개의 Session Bean을 선언하였다.</p>

        <div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle">
            <p>첫 번째 Session Bean("CustomerEJB")은 "CUSTOMER" 역할에 연결되는 보안 역할을
            가지고 있다.</p>
          </li><li style="list-style-type: circle">
            <p>두 번째 Session Bean("EmployeeService")은 "ADMIN"이라는
            &lt;run-as&gt; 역할을 선언하고 있다. "CUSTOMER"와 "ADMIN" 역할은 EJB deploy할 때
            실제 시스템 principal들과 매핑되어야 한다.</p>
          </li></ul></div>

        <p/>

        <div class="literallayout"><p/></div>

        <p>다음의 XML DD 파일은 "CUSTOMER"와 "ADMIN" 역할이 실제 시스템 principal 이름들(각각
        "customer"와 "peter")에 어떻게 매핑되는지 보여주는 예이다.</p><div class="example"><a id="d4e2766"></a><p class="title"><b>[예 4.13] 보안 설정 : &lt;&lt;jeus-ejb-dd.xml&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jeus-ejb-dd xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;module-info&gt;
        . . .
<span class="bold"><strong>        &lt;role-permission&gt;
            &lt;principal&gt;customer&lt;/principal&gt;
            &lt;role&gt;CUSTOMER&lt;/role&gt;
        &lt;/role-permission&gt;</strong></span>
    &lt;/module-info&gt;
    &lt;beanlist&gt;
        &lt;jeus-bean&gt;
            &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
<span class="bold"><strong>            &lt;run-as-identity&gt;
                &lt;principal-name&gt;peter&lt;/principal-name&gt;
            &lt;/run-as-identity&gt;</strong></span>
        &lt;/jeus-bean&gt;
        . . .
    &lt;/beanlist&gt;
    . . .
&lt;/jeus-ejb-dd&gt;</pre>
          </div></div><p><br class="example-break"/></p>

        <div class="literallayout"><p/></div>

        <p>다음은 이 사용자들이 accounts.xml에 어떻게 설정되는지를 확인할 수 있는 예이다.</p><div class="example"><a id="d4e2774"></a><p class="title"><b>[예 4.14] 보안 설정 : &lt;&lt;accounts.xml&gt;&gt;</b></p><div class="example-contents">
            

            

            <pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;accounts xmlns="http://www.tmaxsoft.com/xml/ns/jeus"&gt;
    &lt;users&gt;
        &lt;user&gt;
            &lt;name&gt;<span class="bold"><strong>customer</strong></span>&lt;/ name&gt;
            &lt;password&gt;{SHA}blSUPYpdjb8QDcq+ozfbIEZx5oY=&lt;/name&gt;
            &lt;group&gt;test&lt;/group&gt;
        &lt;/user&gt;
       &lt;user&gt;
            &lt;name&gt;<span class="bold"><strong>peter</strong></span>&lt;/ name&gt;
            &lt;password&gt;{SHA}McbQlyhI3yiOG1HGTg8DQVWkyhg=&lt;/name&gt;
            &lt;group&gt;test&lt;/group&gt;
        &lt;/user&gt;
    &lt;/users&gt;
&lt;/accounts&gt;</pre>
          </div></div><p><br class="example-break"/>위의 예에서 "customer"와 "peter"라는 사용자들의 정의를 확인할 수 있다. 이 사용자들은
        jeus-ejb-dd.xml 파일을 통하여 ejb-jar.xml 파일의 "CUSTOMER"와 "ADMIN" 역할과 연관되어
        있다.</p>
      </div>
    </div>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d4e2779"></a>4.3. EJB 모니터링</h2></div></div></div>
    

    <p>JEUS에서는 EJB 모듈에 포함된 개별 EJB를 제어하는 방법은 제공하지 않는다. 그러나 콘솔 툴을 사용한 Bean별
    모니터링은 가능하다.</p>

    <div class="literallayout"><p/></div>

    <p/>

    <p>콘솔 툴에서는 <span><strong class="guibutton">application-info</strong></span> 명령을 사용하여 Bean의 이름,
    Export Name 및 상태 등 개별 EJB의 정보를 조회할 수 있다. 다음의 예제에서는 countermod라는 EJB가
    deploy되어 있다고 가정한다.</p>

    <p>다음과 같이 명령을 실행하면 EJB 모듈 내의 각 Bean들의 이름과 Export Name을 확인할 수 있다.</p>

    <pre class="screen">[DAS]domain1.adminServer&gt;<span><strong class="guibutton">application-info -server server1 -id countermod -detail</strong></span>
General information about the EJB module [countermod].
==============================================================
+-------------+----------------------------------------------+
| Module Name |              Unique Module Name              |
+-------------+----------------------------------------------+
| countermod  | countermod                                   |
+-------------+----------------------------------------------+
==============================================================

Beans
================================================================================

+-----------+-------------------------+-------------------+--------------------+
| Bean Name |           Type          | Local Export Name | Remote Export Name |
+-----------+-------------------------+-------------------+--------------------+
| Count     | StatelessSessionBean    |                   | Count              |
+-----------+-------------------------+-------------------+--------------------+

================================================================================</pre>

    <p>다음과 같이 명령을 실행하면 지정한 EJB 모듈에 등록되어 있는 개별 Bean의 상태를 확인할 수 있다.</p>

    <pre class="screen">[DAS]domain1.adminServer&gt;<span><strong class="guibutton">application-info -server server1 -id countermod -bean Count</strong></span>
Module name : countermod
Bean name : Count
================================================================================

+---------------+-----------+-------------------+--------------+---------------+
|      Name     |  (Count)  | WaterMark(High:Low| Bound(Upper:L| Time(Max:Min:T|
|               |           |       :Cur)       |    ower)     |     otal)     |
+---------------+-----------+-------------------+--------------+---------------+
| create        | times(0)  |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| comitted      | transactio|                   |              |               |
|               |n(0)       |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| total-remote-t|           |thread(100:100:100)|              |               |
|hread          |           |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| timed-rb      | transactio|                   |              |               |
|               |n(0)       |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| remove        | times(0)  |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| active-bean   |           | bean(0:0:0)       |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| request       | request(0)|                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| total-bean    |           | bean(0:0:0)       |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| rolledback    | transactio|                   |              |               |
|               |n(0)       |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| active-thread |           | thread(0:0:0)     |              |               |
+---------------+-----------+-------------------+--------------+---------------+
| MethodReadyCou|           | bean(0:0:0)       |              |               |
|nt             |           |                   |              |               |
+---------------+-----------+-------------------+--------------+---------------+

================================================================================</pre>

    <p/>

    <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
        <p>application-info 명령에 대한 자세한 내용은 <a xmlns="" href="../reference-book/ch04.html#cmd_application-info" class="olink">“<span xmlns="http://www.w3.org/1999/xhtml" xmlns:xlink="http://www.w3.org/1999/xlink" class="olinkdocname">JEUS Reference Book</span>”의 “4.2.6.3. application-info”</a>를
        참고한다.</p>
      </div>

    <p/>
  </div>

  <div class="section" lang="ko"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d4e2799"></a>4.4. EJB 튜닝</h2></div></div></div>
    

    <p><a id="d4e2802" class="indexterm"></a></p>

    <p>모든 EJB 종류에 공통으로 EJB 운영 성능을 향상(또는 시스템 리소스의 낭비를 방지하기 위해)하기 위해 적용할 수 있는
    몇 가지 설정은 다음과 같다. </p><div class="itemizedlist"><ul type="disc"><li>
          <p>TTP의 최댓값을 적절히 수정한다.</p>
        </li><li>
          <p>여러 개의 EJB 엔진에 Bean들을 클러스터링해서 설정한다. <a href="chapter_ejb_clustering.html" title="제6장 EJB 클러스터링">“제6장 EJB 클러스터링”</a>을 참고한다.</p>
        </li><li>
          <p>적절한 JDBC Connection Pool을 설정한다. 설정에 대한 자세한 내용은 "<a xmlns="" href="../server/index.html" class="olink">JEUS Server 안내서"</a>를
          참고한다.</p>
        </li><li>
          <p>EJB 2.x인 경우 EJB 모듈 Deploy 시간을 절약하기 위해 deploy 명령에 -fast 옵션과
          appcompiler를 사용한다. 자세한 내용은 <a href="chapter_ejb_module.html" title="제3장 EJB 모듈">“제3장 EJB 모듈”</a>을
          참고한다.</p>
        </li></ul></div>

    <p>위의 기본적인 최적화 옵션뿐만 아니라 Bean의 종류에 따라 수십 개의 튜닝 팁이 존재한다. 그러므로, 각 EJB 종류에
    따른 튜닝과 최적화하는 방법은 해당하는 각 장을 참고한다.</p>

    <div class="section" lang="ko"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2818"></a>4.4.1. Thread Ticket Pool 설정 튜닝</h3></div></div></div>
      

      <p>EJB가 최상의 성능을 내기 위해서는 다음의 원칙을 적용해서 TTP가 올바르게 설정되어야 한다.</p>

      <p/>

      <div class="itemizedlist"><ul type="disc"><li>
          <p>max pool 크기를 크게 설정할수록 더 많은 TT들이 생성될 수 있고, 따라서 더 많은 클라이언트 요청을
          수행할 수 있다. 그러나 크게 설정한 max pool 크기는 많은 클라이언트들이 EJB 엔진에 접속한 경우에 많은 메모리
          자원을 소모하게 된다.</p>
        </li></ul></div>

      <div class="itemizedlist"><ul type="disc"><li>
          <p>특정한 시간대에 Bean의 서비스 사용을 요청하는 클라이언트가 급격히 증가할 경우에는 max pool 크기에서
          min pool 크기를 뺀 값을 증가시켜 새로운 TT들이 "batch"로 생성될 수 있도록 설정한다.</p>
        </li></ul></div>

      <p/>

      <p>TTP의 설정은 특정한 EJB에 대하여 접근 가능한 양을 조절할 수 있는 밸브의 역할을 한다.</p>

      <div class="note" style="margin-left: 0in; margin-right: 0in;"><h3 class="title">참고</h3>
          <p>max pool 크기는 TTP에서 가장 중요한 파라미터이다. 그러므로 성능 개선을 위해서는 이 값을 가장 먼저
          조절하고 튜닝해야 한다. 이 값은 &lt;thread-max&gt;에 설정한다.</p>
        </div>
    </div>
  </div>
</div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chapter_ejb_module.html">이전</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="chapter_ejb_iiop.html">다음</a></td></tr><tr><td width="40%" align="left" valign="top">제3장 EJB 모듈 </td><td width="20%" align="center"><a accesskey="h" href="index.html">처음으로</a></td><td width="40%" align="right" valign="top"> 제5장 EJB 상호 운용성 및 RMI/IIOP</td></tr></table></div><div xmlns="" align="center"/></body></html>
