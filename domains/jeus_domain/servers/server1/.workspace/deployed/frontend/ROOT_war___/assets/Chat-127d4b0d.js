import{_ as F,o as i,c as d,a as r,bi as J,r as A,e as m,w as a,b as n,aS as O,K as M,V as _,F as b,i as w,h as u,X as ne,d as k,bj as G,m as S,a_ as U,g as ee,t as f,f as W,P as N,Q as C,A as z,bb as K,v as X,aw as Z,ao as q,cc as ae,E as L,D as R,bk as oe,a7 as le,cU as re,k as D,bl as de,R as E,S as ce,H as ue,cK as he,O as Y,U as V,a0 as me,W as ge,be as fe,bf as ye}from"./index-7b37f28a.js";import{P as te,_ as j}from"./chat-icon-2658168f.js";import{V as H}from"./VSheet-beabeb52.js";import{a as pe,_ as _e,V as ve}from"./DynamicForm-9e8c830e.js";import{V as xe}from"./VDatePicker-b7697b5c.js";const ke={props:{audioResponse:String,isLoading:Boolean,offStream:Boolean,stopAudioStreamStatus:Boolean,chatRoomId:String},data(){return{audio:null,sourceBuffer:null,abortController:null,audioContext:null,analyser:null,dataArray:null,audioQueue:[],isPlaying:!1}},mounted(){this.setupAudioStream()},watch:{stopAudioStreamStatus(e){e&&this.stopStream()},audioResponse(e){if(e==""||e==null)return;let t=e.replace(/[\n\r]/g,"");this.playResponseData(t)},offStream(e){e===!0&&this.streamOff()}},methods:{setupAudioStream(){this.audio=this.$refs.audioPlay,this.audio.autoplay=!0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);const e=this.$refs.audioPlay;this.audioContext.createMediaElementSource(e).connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.updateAudioBars()},stopStream(){this.abortController&&this.abortController.abort(),this.audio&&(this.audio.pause(),this.audio.currentTime=0),this.sourceBuffer&&this.sourceBuffer.updating&&this.sourceBuffer.abort(),this.audioQueue=[],this.isPlaying=!1,this.$emit("audio:stop")},async playResponseData(e){var t=this;t.abortController=new AbortController;const s=t.abortController.signal;var p={query:e,chat_room_id:t.chatRoomId};const c=localStorage.getItem("accessToken");fetch("/execution/audio-stream",{method:"POST",headers:{"Content-Type":"text/plain",Authorization:`Bearer ${c}`},body:JSON.stringify(p),signal:s}).then(l=>{const y=l.body.getReader(),g=()=>{y.read().then(async({done:x,value:T})=>{if(!x){try{const P=await t.audioContext.decodeAudioData(T.buffer);t.audioQueue.push(P),t.playNextInQueue()}catch(P){console.error("Error decoding audio data",P)}t.$emit("update:isLoading",!1),t.$emit("audio:start"),t.updateAudioBars(),g()}}).catch(x=>{console.error("Error fetching audio stream",x),t.$emit("update:isLoading",!1)})};g()}).catch(l=>{l.name==="AbortError"?console.log("Fetch aborted"):console.error("Fetch error:",l)})},playNextInQueue(){if(this.isPlaying||this.audioQueue.length===0)return;const e=this.audioQueue.shift(),t=this.audioContext.createBufferSource();t.buffer=e,t.connect(this.analyser),this.analyser.connect(this.audioContext.destination),t.onended=()=>{this.isPlaying=!1,this.playNextInQueue()},t.start(),this.isPlaying=!0},updateAudioBars(){this.analyser&&(this.audioContext.state==="suspended"&&this.audioContext.resume(),this.analyser.getByteFrequencyData(this.dataArray),console.log("dataArray",Array.from(this.dataArray)),this.$emit("update:audioBars",Array.from(this.dataArray)),requestAnimationFrame(this.updateAudioBars))}}},be={ref:"audioPlay"};function we(e,t,s,p,c,l){return i(),d("div",null,[r("audio",be,null,512)])}const Ce=F(ke,[["render",we],["__scopeId","data-v-43cd560a"]]);const Me={components:{Icon:J,AudioStream:Ce},props:{recordingMode:Boolean,audioResponse:String,chatRoomId:String},data(){return{audioContext:null,analyser:null,microphone:null,dataArray:null,volume:0,threshold:15,isRecording:!1,stream:null,isLoading:!1,isAudioPlaying:!1,stopAudioStreamStatus:!1,sendRecordingStatus:!1,audioBars:[]}},methods:{updateAudioBars(e){this.audioBars=e},AudioPlayingBarHeight(e){if(this.audioBars.length===0)return 30;const t=30,s=60+e*30,p=this.audioBars[e]||0,c=Math.min(p/255,1);return t+(s-t)*c},stopAudioStream(){this.stopAudioStreamStatus=!0,this.sendRecordingStatus=!1},async getMicrophoneInput(){if(!navigator.mediaDevices){alert("브라우저가 마이크 입력을 지원하지 않습니다.");return}this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.microphone.connect(this.analyser),this.analyser.fftSize=256,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.updateVolume()},updateVolume(){if(!this.isRecording)return;this.analyser.getByteFrequencyData(this.dataArray);let e=0;for(let t=0;t<this.dataArray.length;t++)e+=this.dataArray[t];this.volume=e/this.dataArray.length,requestAnimationFrame(this.updateVolume)},boxHeight(e){return this.volume<this.threshold?20:20+(this.volume-this.threshold)/(100-this.threshold)*(e*10)},async toggleRecording(){this.isRecording?this.isRecording=!1:(this.isRecording=!0,await this.getMicrophoneInput()),this.$emit("start")},sendRecording(){this.isRecording=!1,this.stopAudioStreamStatus=!1,this.sendRecordingStatus=!0,this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.$emit("stop"),this.updateLoadingStatus(!0)},updateLoadingStatus(e){this.isLoading=e},closeRecording(){this.$emit("close"),this.EventBus.emit("instances-updated")},startAudio(){this.isAudioPlaying=!0},stopAudio(){this.isAudioPlaying=!1,this.isRecording=!1,this.isLoading=!1,this.stopAudioStreamStatus=!1,this.sendRecordingStatus=!1}},computed:{circleSize(){return this.volume<this.threshold?250:250+(this.volume-this.threshold)/(100-this.threshold)*20},containerStyle(){return{backgroundColor:pe.value,height:"100vh"}}}},Ie=k("mdi-close"),Se={key:0,class:"loading-circle"},Ae={key:1,class:"audio-bar-box"},Re={class:"controls"},Ve={key:3,class:"bars"};function Le(e,t,s,p,c,l){const y=A("AudioStream"),g=A("Icons");return i(),m(ne,{modelValue:s.recordingMode,"onUpdate:modelValue":t[3]||(t[3]=x=>s.recordingMode=x),fullscreen:""},{default:a(()=>[r("div",{class:"container",style:M(l.containerStyle)},[n(_,{class:"record-close-btn",icon:"",density:"comfortable",onClick:l.closeRecording,style:M(e.$globalState.state.isRightZoomed?"top:10px; z-index: 9999;":"")},{default:a(()=>[n(O,null,{default:a(()=>[Ie]),_:1})]),_:1},8,["onClick","style"]),c.isLoading?(i(),d("div",Se,[(i(),d(b,null,w(5,x=>r("div",{class:"child-circle",key:x})),64))])):c.isAudioPlaying?(i(),d("div",Ae,[(i(),d(b,null,w(4,x=>r("div",{key:x,class:"audio-bar",style:M({height:l.AudioPlayingBarHeight(x)+"px"})},null,4)),64))])):(i(),d("div",{key:2,class:"circle",style:M({width:l.circleSize+"px",height:l.circleSize+"px"})},null,4)),n(y,{"onUpdate:isLoading":l.updateLoadingStatus,"onAudio:start":l.startAudio,"onAudio:stop":l.stopAudio,"onUpdate:audioBars":l.updateAudioBars,audioResponse:s.audioResponse,isLoading:c.isLoading,stopAudioStreamStatus:c.stopAudioStreamStatus,chatRoomId:s.chatRoomId},null,8,["onUpdate:isLoading","onAudio:start","onAudio:stop","onUpdate:audioBars","audioResponse","isLoading","stopAudioStreamStatus","chatRoomId"]),r("div",Re,[!c.isRecording&&!c.isAudioPlaying&&!c.isLoading?(i(),m(_,{key:0,onClick:t[0]||(t[0]=x=>l.toggleRecording()),icon:"",density:"comfortable"},{default:a(()=>[n(g,{icon:"sharp-mic"})]),_:1})):c.sendRecordingStatus?(i(),m(_,{key:2,onClick:t[2]||(t[2]=x=>l.stopAudioStream()),icon:"",density:"comfortable"},{default:a(()=>[n(g,{icon:"stop"})]),_:1})):(i(),m(_,{key:1,onClick:t[1]||(t[1]=x=>l.sendRecording()),icon:"",density:"comfortable"},{default:a(()=>[n(g,{icon:"stop"})]),_:1})),!c.isAudioPlaying&&!c.isLoading?(i(),d("div",Ve,[(i(),d(b,null,w(4,x=>r("div",{key:x,class:"bar",style:M({height:l.boxHeight(x)+"px"})},null,4)),64))])):u("",!0)])],4)]),_:1},8,["modelValue"])}const Ue=F(Me,[["render",Le],["__scopeId","data-v-975c99dc"]]);const Te={name:"RetrievalBox",props:{message:String},components:{Icon:J},data:function(){return{retrievalJS:null,foldedbtn:!0,loading:!1,queryData:null,retrievalData:null}},watch:{message:function(e,t){e&&(this.queryData=e)}},computed:{queryResponse(){return this.queryData&&this.queryData.response?this.queryData.response:""},querySources(){if(!this.queryData||!this.queryData.metadata)return{};const e={};return Object.values(this.queryData.metadata).filter(s=>{if(!e[s.file_path])return e[s.file_path]=!0,!0})}},created(){},methods:{}},Pe={key:0},ze=k(" AI Retrieval "),Be={key:1},De={style:{display:"flex","justify-content":"center","align-items":"flex-start",height:"20px"}},Ne=k("mdi-chevron-down"),Oe={class:"chips-container",style:{"margin-top":"5px"}};function We(e,t,s,p,c,l){const y=A("Icons");return i(),m(W,{flat:""},{default:a(()=>[e.foldedbtn?(i(),d("div",Pe,[n(_,{block:"",onClick:t[0]||(t[0]=g=>e.foldedbtn=!1),style:{background:"lightgrey","font-size":"large"}},{default:a(()=>[n(y,{icon:"ai-edit-spark",style:{"margin-right":"5px"}}),ze]),_:1}),e.loading?(i(),m(G,{key:0,color:"deep-purple-accent-4",indeterminate:"",rounded:"",height:"6"})):u("",!0)])):(i(),d("div",Be,[n(W,null,{default:a(()=>[n(S,{style:{padding:"10px"}},{default:a(()=>[r("div",De,[n(_,{onClick:t[1]||(t[1]=g=>e.foldedbtn=!0),block:"",style:{"align-items":"start",height:"fit-content"}},{default:a(()=>[n(O,null,{default:a(()=>[Ne]),_:1})]),_:1})]),n(U,{"hide-details":"",modelValue:l.queryResponse,"onUpdate:modelValue":t[2]||(t[2]=g=>l.queryResponse=g),"auto-grow":"",readonly:"",variant:"solo-filled"},null,8,["modelValue"]),e.loading?(i(),m(G,{key:0,color:"deep-purple-accent-4",indeterminate:"",rounded:"",height:"6"})):u("",!0),r("div",Oe,[(i(!0),d(b,null,w(l.querySources,(g,x)=>(i(),m(ee,{key:x,variant:"outlined",size:"x-small","text-color":"primary",style:{"margin-bottom":"1px"}},{default:a(()=>[n(O,{start:"",icon:"mdi-label","x-small":""}),k(" "+f(g.file_name),1)]),_:2},1024))),128))])]),_:1})]),_:1})]))]),_:1})}const He=F(Te,[["render",We],["__scopeId","data-v-0a443872"]]),Fe={components:{},props:{},data(){return{isAtBottom:!0}},watch:{filteredMessages(){this.isAtBottom?this.scrollToBottom():this.showNewMessage()}},computed:{},methods:{scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer.$el;e.scrollTop=e.scrollHeight},300)},handleScroll(){const e=this.$refs.scrollContainer.$el;clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{const s=Math.round(e.scrollTop+e.clientHeight)+1>=e.scrollHeight;this.isAtBottom=s},200)}}};function je(e,t,s,p,c,l){return null}const qe=F(Fe,[["render",je]]);const Ee={components:{Icon:J},props:{agentInfo:Object,message:Object,totalSize:Number,currentIndex:Number},mixins:[te],data(){return{}},mounted(){this.animateBorder()},methods:{isFileLink(e){return!!(e.includes("/FileDown")||e.includes("/readDownloadFile")||e.includes(".pdf"))},generatePreviewImage(e){const t=new URL(e),s=t.hostname;return s.includes("youtube.com")?`https://img.youtube.com/vi/${t.searchParams.get("v")}/0.jpg`:s.includes("github.com")?"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png":null}}},Ge={style:{"background-color":"rgba( 255, 255, 255, 1 )"}},Je={key:0,style:{"margin-bottom":"2%"}},Qe={key:0,src:j,alt:"pro",width:"50"},Ze=["src"],Ke={style:{"font-weight":"bold","align-self":"self-end","margin-left":"5px"}},Xe={key:0},Ye={style:{margin:"15px"}},$e=["src"],et={class:"ml-3"},tt={style:{"font-weight":"bold"}},st=["innerHTML"],it={key:1},nt=["innerHTML"],at={key:2},ot={key:0},lt=["innerHTML"],rt={key:1},dt={key:0,style:{"marin-top":"20px"}},ct={key:0,style:{"align-items":"center"}},ut={style:{"font-weight":"bold"}},ht=["href"],mt={key:1,style:{display:"flex","align-items":"center","justify-content":"space-between"}},gt={style:{"margin-top":"20px"}},ft={style:{"font-weight":"bold"}},yt={style:{"margin-top":"auto","font-size":"x-small"}},pt=["href"],_t=["href"],vt=["src"],xt={key:3},kt={key:0,class:"d-flex align-items-center justify-content-center"},bt={class:"text-center"},wt=["src"],Ct={style:{"font-size":"small"}},Mt=r("div",{style:{"font-size":"large",margin:"0 10px","align-self":"center"}},">>",-1),It={class:"text-center"},St=["src"],At={style:{"font-size":"small"}},Rt=["innerHTML"],Vt={key:4},Lt=["innerHTML"],Ut={key:1},Tt=r("img",{src:j,alt:"pro",width:"50"},null,-1),Pt=k(" system ");function zt(e,t,s,p,c,l){const y=A("Icons");return i(),d("div",Ge,[s.message?(i(),d("div",Je,[n(C,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:a(()=>[n(N,{size:"40"},{default:a(()=>[s.message.role=="system"?(i(),d("img",Qe)):(i(),d("img",{key:1,src:s.message.profile,alt:"pro",width:"50"},null,8,Ze))]),_:1}),r("div",Ke,f(s.message.role),1)]),_:1}),r("div",{class:z(["progress-border",{animate:e.borderCompletedAnimated}])},[s.totalSize==s.currentIndex+1?(i(),d(b,{key:0},w(5,g=>r("div",{class:z(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:g},null,2)),64)):u("",!0),n(H,{class:"bg-lightsecondary rounded-md px-3 py-2"},{default:a(()=>[s.message.content.type=="agents"?(i(),d("div",Xe,[r("div",Ye,'요청 주신 "'+f(s.agentInfo.draftPrompt)+'"작업을 위해서 팀 구성을 아래와 같이 하였습니다..',1),(i(!0),d(b,null,w(s.message.content.data,g=>(i(),d("div",{key:g.name,class:"d-flex align-items-start mb-3",style:{"margin-left":"5%"}},[n(N,{size:"40"},{default:a(()=>[r("img",{src:g.profile,alt:"profile",width:"50"},null,8,$e)]),_:2},1024),r("div",et,[r("div",tt,f(g.role),1),r("div",{innerHTML:g.explanation},null,8,st)])]))),128))])):s.message.content.type=="search"?(i(),d("div",it,[r("div",{innerHTML:s.message.content.data},null,8,nt)])):s.message.content.type=="searchOutput"?(i(),d("div",at,[typeof s.message.content.data=="string"?(i(),d("div",ot,[r("div",{innerHTML:s.message.content.data,class:"mt-2"},null,8,lt)])):(i(),d("div",rt,[(i(!0),d(b,null,w(s.message.content.data,g=>(i(),d("div",null,[g.link?(i(),d("div",dt,[l.isFileLink(g.link)?(i(),d("div",ct,[r("div",ut,[k(f(g.title)+" ",1),r("a",{href:g.link,target:"_blank",style:{"margin-right":"10px"}},[n(y,{icon:"file-type-pdf2",size:35})],8,ht)]),r("div",null,f(g.snippet),1)])):(i(),d("div",mt,[r("div",gt,[r("div",ft,f(g.title),1),r("div",null,f(g.snippet),1),r("div",yt,[r("a",{href:g.link,target:"_blank",style:{color:"#0000EE","text-decoration":"underline"}},f(g.link),9,pt)])]),r("a",{href:g.link,target:"_blank",style:{"margin-right":"10px"}},[l.generatePreviewImage(g.link)?(i(),d("img",{key:0,src:l.generatePreviewImage(g.link),alt:"preview",style:{width:"100px",height:"100px"}},null,8,vt)):u("",!0)],8,_t)]))])):u("",!0)]))),256))]))])):s.message.content.type=="delegate"?(i(),d("div",xt,[s.message.role!=s.message.content.delegate?(i(),d("div",kt,[r("div",bt,[n(N,{size:"40"},{default:a(()=>[r("img",{src:s.message.profile,alt:"profile",width:"50"},null,8,wt)]),_:1}),r("div",Ct,f(s.message.role),1)]),Mt,r("div",It,[n(N,{size:"40"},{default:a(()=>[r("img",{src:s.message.content.delegateProfile,alt:"profile",width:"50"},null,8,St)]),_:1}),r("div",At,f(s.message.content.delegate),1)])])):u("",!0),r("div",{innerHTML:s.message.content.data,class:"mt-2"},null,8,Rt)])):s.message.content.type=="system"?(i(),d("div",Vt,[r("div",{innerHTML:s.message.content.data},null,8,Lt)])):u("",!0)]),_:1}),u("",!0)],2)])):u("",!0),s.totalSize==s.currentIndex+1&&s.agentInfo.isRunning?(i(),d("div",Ut,[n(C,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important","align-items":"center"}},{default:a(()=>[n(N,{size:"40",style:{"margin-right":"5px"}},{default:a(()=>[Tt]),_:1}),Pt]),_:1}),r("div",{class:z(["progress-border",{animate:e.borderCompletedAnimated}])},[r("template",null,[(i(),d(b,null,w(5,g=>r("div",{class:z(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:g},null,2)),64))]),n(H,{class:"bg-lightsecondary rounded-md px-3 py-2",style:{height:"100px"}}),n(G,{class:"my-progress-linear",indeterminate:""})],2)])):u("",!0)])}const Bt=F(Ee,[["render",zt]]);const Dt={components:{Icon:J,RetrievalBox:He,AgentsChat:Bt,Record:Ue,DynamicForm:_e},mixins:[te,qe],props:{prompt:String,name:String,messages:Array,userInfo:Object,chatInfo:Object,disableChat:Boolean,isChanged:Boolean,type:String,agentInfo:Object,userList:Array,currentChatRoom:Object,lock:Boolean,generatedWorkList:Array,ProcessGPTActive:Boolean,isAgentMode:Boolean,chatRoomId:String,isMobile:Boolean},data(){return{workIcons:{ScheduleQuery:"calendar-line-duotone",ScheduleRegistration:"calendar-line-duotone",TodoListRegistration:"overview",StartProcessInstance:"ibm-process-mining",CreateProcessDefinition:"device-imac-cog"},recordingMode:!1,defaultWorkIcon:j,displayGeneratedWorkList:!1,showGeneratedWorkList:!1,mediaRecorder:null,audioChunks:[],isRecording:!1,isMicRecording:!1,micRecorder:null,micAudioChunks:[],isMicRecorderLoading:!1,isReply:!1,newMessage:"",hoverIndex:-1,editIndex:-1,editText:null,replyIndex:-1,replyUser:null,isViewJSON:[],isviewJSONStatus:!1,attachedImg:null,showNewMessageNoti:!1,lastMessage:{name:"",content:""},showNewMessageNotiTimer:null,showUserList:!1,mentionStartIndex:null,mentionedUsers:[],file:null,isRender:!1,chatHeight:"height:calc(100vh - 300px)",checked:!0,isOpenedChatMenu:!1,isViewWork:null}},mounted(){var e=this;document.addEventListener("click",t=>{t.target.matches(".request-file-link")&&(t.preventDefault(),e.$emit("requestFile",t.target.getAttribute("data-filename")))}),window.location.pathname&&window.location.pathname.includes("/definitions/")?this.isMobile?this.chatHeight="height:calc(100vh - 450px)":this.chatHeight="height:calc(100vh - 337px)":window.location.pathname&&window.location.pathname.includes("/instancelist")&&(this.isMobile?this.chatHeight="height:calc(100vh - 450px)":this.chatHeight="height:calc(100vh - 350px)"),this.EventBus.on("scroll_update",()=>{this.$refs&&this.$refs.scrollContainer&&setTimeout(()=>{this.$refs.scrollContainer.update()},1e3)})},watch:{prompt(e,t){e!==t&&(this.newMessage=e,this.beforeSend())}},computed:{isSystemMentioned(){return this.mentionedUsers.some(e=>e.id==="system_id")||this.newMessage.startsWith(">")||this.newMessage.startsWith("!")},filteredUserList(){if(!this.showUserList||this.mentionStartIndex===null||!this.userList)return[];let e=this.userList.filter(s=>this.currentChatRoom.participants.some(p=>p.id===s.id));e.push({email:"system@uengine.org",id:"system_id",profile:"src/assets/images/chat/chat-icon.png",username:"System"}),e.reverse();const t=this.newMessage.substring(this.mentionStartIndex+1).toLowerCase();return e.filter(s=>s.username.toLowerCase().includes(t)&&!this.mentionedUsers.some(p=>p.id===s.id))},filteredAlert(){const e={subtitle:"",detail:""};return this.chatInfo&&(e.detail=this.$t(this.chatInfo.text)),e},filteredMessages(){var e=[];const t=localStorage.getItem("email");return this.messages&&this.messages.length>0&&this.messages.forEach(s=>{let p=JSON.parse(JSON.stringify(s));(p.content||p.jsonContent||p.image)&&e.push(p)}),e.length>0&&e[e.length-1].email==t&&this.setRenderTime(),e},isLoading:{get(){var e=!1;return this.messages&&this.messages.length>0&&this.messages.forEach(t=>{t.isLoading&&(e=t.isLoading)}),e},set(e){e||(this.animateBorder(),this.$emit("stopMessage"))}},disableBtn(){return this.disableChat?!0:!(this.newMessage!==""||this.attachedImg!==null)}},methods:{clickedWorkOrder(){this.$emit("clickedWorkOrder")},startWorkOrder(){this.$emit("startWorkOrder"),this.isOpenedChatMenu=!1},openChatMenu(){this.isOpenedChatMenu=!this.isOpenedChatMenu},reGenerateAgentAI(){this.$emit("reGenerateAgentAI")},getOtherUserMessageColor(e){return e.role==="user"?{backgroundColor:"#fff9c4"}:{backgroundColor:"#eeeeee"}},getUserMessageStyle(e){return e.role==="user"?{display:"flex",justifyContent:"flex-start"}:{}},recordingModeChange(){this.recordingMode=!this.recordingMode},shouldDisplayGeneratedWorkList(e,t,s,p){var c=0,l=0;const y=localStorage.getItem("email");for(let g=0;g<t.length;g++)t[g].email&&t[g].email==y&&(l=c,c=g);return this.isRender||(c=l),e=="chats"&&c==p&&this.ProcessGPTActive},setRenderTime(){this.isRender=!1,setTimeout(()=>{this.isRender=!0},3e3)},getWorkIcon(e){return this.workIcons[e]||this.defaultWorkIcon},toggleProcessGPTActive(){this.$emit("toggleProcessGPTActive")},linkify(e){var t,s,p,c;return s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(s,'<a href="$1" target="_blank">$1</a>'),p=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(p,'$1<a href="http://$2" target="_blank">$2</a>'),c=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(c,'<a href="mailto:$1">$1</a>'),t},async startRecording(){if(this.isRecording=!0,!navigator.mediaDevices){alert("getUserMedia를 지원하지 않는 브라우저입니다.");return}const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{this.audioChunks.push(t.data)},this.mediaRecorder.start()},stopRecording(){this.isRecording=!1,this.mediaRecorder&&this.mediaRecorder.state==="recording"&&(this.mediaRecorder.stop(),this.mediaRecorder.onstop=async()=>{const e=new Blob(this.audioChunks,{type:"audio/wav"});this.uploadAudio(e)})},async startVoiceRecording(){if(this.isMicRecording=!0,!navigator.mediaDevices){alert("getUserMedia를 지원하지 않는 브라우저입니다.");return}const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.micRecorder=new MediaRecorder(e),this.micAudioChunks=[],this.micRecorder.ondataavailable=t=>{this.micAudioChunks.push(t.data)},this.micRecorder.start()},stopVoiceRecording(){this.isMicRecording=!1,this.micRecorder&&this.micRecorder.state==="recording"&&(this.micRecorder.stop(),this.micRecorder.onstop=async()=>{const e=new Blob(this.micAudioChunks,{type:"audio/wav"});await this.uploadAudio(e)})},async uploadAudio(e){this.isMicRecorderLoading=!0;const t=new FormData;t.append("audio",e);try{const p=(await K.post("/execution/upload",t)).data;this.newMessage=p.transcript}catch(s){console.error("Error:",s)}finally{this.isMicRecorderLoading=!1}},async submitFile(){var e=this;e.$try({action:async()=>{if(!e.file)return;const t=new FormData;t.append("file",this.file[0]);const s=await K.post("/memento/uploadfile/",t,{headers:{"Content-Type":"multipart/form-data"}});console.log(s.data),this.file=null},successMsg:"파일 업로드가 완료되었습니다."})},openVerMangerDialog(){this.$emit("openVerMangerDialog",!0)},handleTextareaInput(e){const t=e.target.value,s=t.lastIndexOf("@");s!==-1?(this.showUserList=!0,this.mentionStartIndex=s):this.showUserList=!1,this.mentionedUsers=this.mentionedUsers.filter(p=>{const c=new RegExp(`@${p.username}`,"g");return t.match(c)}),t.startsWith(">")||t.startsWith("!")},selectUser(e){const t=this.newMessage.substring(0,this.mentionStartIndex);this.newMessage=`${t}@${e.username} `,this.showUserList=!1,this.mentionedUsers.some(s=>s.id===e.id)||this.mentionedUsers.push(e)},clickToScroll(){this.isAtBottom=!0,this.scrollToBottom(),this.showNewMessageNoti=!1,this.lastMessage={name:"",content:""}},showNewMessage(){this.messages.length>0&&this.userInfo.email!=this.messages[this.messages.length-1].email&&(this.lastMessage={name:this.messages[this.messages.length-1].name,content:this.messages[this.messages.length-1].content&&this.messages[this.messages.length-1].content.length>130?this.messages[this.messages.length-1].content.substring(0,130)+"...":this.messages[this.messages.length-1].content},this.showNewMessageNoti=!0,this.showNewMessageNotiTimer&&clearTimeout(this.showNewMessageNotiTimer),this.showNewMessageNotiTimer=setTimeout(()=>{this.showNewMessageNoti=!1},5e3))},getProfile(e){if(!this.userList)return"";const t=this.userList.find(s=>s.email===e);return t?t.profile:""},shouldDisplayUserInfo(){return(e,t)=>{if(!e.disableMsg){if(t===0)return!0;const s=this.filteredMessages[t-1];if(e.email!==s.email||new Date(e.timeStamp)-new Date(s.timeStamp)>6e4)return!0}return!1}},requestDraftAgent(){this.$emit("requestDraftAgent",this.newMessage)},setMessageForUser(e){if(e)if(e.includes('"messageForUser":')){let s=X(e).messageForUser||e;return this.linkify(s)}else return this.linkify(e)},setTableName(e){return X(e).content||e},viewProcess(){this.$emit("viewProcess")},formatTime(e){var t=new Date(e),s=t.toString(),p=s.split(" ")[4].substring(0,5);return p},startProcess(e,t){this.$emit("startProcess",e),this.ProcessGPTActive&&this.$emit("deleteWorkList",t)},cancelProcess(e){this.$emit("cancelProcess",e)},deleteAllWorkList(){this.$emit("deleteAllWorkList")},deleteWorkList(e){this.$emit("deleteWorkList",e)},getMoreChat(){this.$emit("getMoreChat")},cancelReply(){this.isReply=!1,this.replyUser=null,this.$emit("beforeReply",!1)},beforeReply(e){this.$emit("beforeReply",e),this.isReply=!0,this.replyUser=e},beforeSend(e){if(!(e&&e.shiftKey))if(this.isAgentMode)this.requestDraftAgent(),setTimeout(()=>{this.newMessage=""},100);else{this.isLoading&&(this.isLoading=!1,this.$emit("stopMessage"));var t=this.newMessage.replace(/(?:\r\n|\r|\n)/g,"");(t.length>0||this.attachedImg!=null)&&this.send()}},send(){this.editIndex>=0?(this.$emit("sendEditedMessage",this.editIndex+1),this.editIndex=-1):this.$emit("sendMessage",{image:this.attachedImg,text:this.newMessage,mentionedUsers:this.mentionedUsers}),this.isReply&&(this.isReply=!1),this.attachedImg=null;var e=document.querySelector("#imagePreview");e.innerHTML="",this.isAtBottom=!0,setTimeout(()=>{this.newMessage="",this.mentionedUsers=[],this.showUserList=!1},100)},cancel(){this.messages[this.editIndex].content=this.editText,this.editIndex=-1},editMessage(e){e&&e>=0?this.editIndex=e:this.editIndex=-1,this.editIndex=e,this.editText=this.messages[this.editIndex].content},viewWork(e){this.isViewWork?this.isViewWork=null:this.isViewWork=e,this.$nextTick(()=>{this.$refs.scrollContainer.update()})},viewJSON(e){this.isviewJSONStatus=!this.isviewJSONStatus,this.isViewJSON.includes(e)?this.isViewJSON=this.isViewJSON.filter(t=>t!=e):this.isViewJSON.push(e),this.$nextTick(()=>{this.$refs.scrollContainer.update()})},uploadImage(){this.$refs.uploader.value="",this.attachedImg=null,this.$refs.uploader.click()},changeImage(e){const t=this,s=e.target.files[0],p=new FileReader;p.onload=c=>{const l=document.createElement("img");l.src=c.target.result,l.onload=()=>{const y=document.createElement("canvas"),g=200,x=g/l.width;y.width=g,y.height=l.height*x;const T=y.getContext("2d");T.drawImage(l,0,0,y.width,y.height);const P=T.canvas.toDataURL(l,"image/jpeg",.2);var Q=`<img src=${P} width='100%' />`;$("#imagePreview").append(Q),t.attachedImg=P}},s&&p.readAsDataURL(s)},capture(){this.$refs.captureImg.value="",this.attachedImg=null,this.$refs.captureImg.click()}}},Nt={class:"customHeight",style:{"background-color":"rgba( 255, 255, 255, 1 )"}},Ot={class:"chat-info-title",style:{position:"sticky",top:"0px","z-index":"1","background-color":"white"}},Wt={class:"align-right gap-3 pa-4 justify-space-between"},Ht={key:0,class:"d-flex gap-2 align-center"},Ft={class:"text-h5 mb-n1"},jt={key:1,class:"d-flex gap-2 align-center"},qt=["src"],Et={class:"text-h5 mb-n1"},Gt={class:"textPrimary"},Jt={style:{"white-space":"pre-line","font-size":"14px"}},Qt=k("try again"),Zt={key:1},Kt={key:0},Xt={key:0,class:"text-medium-emphasis text-subtitle-2 mr-2"},Yt=["src"],$t={key:0,class:"bg-lightprimary",style:{"border-radius":"10px"}},es=["onMouseover"],ts={key:0,class:"text-body-1"},ss={key:1,class:"text-body-1"},is=["innerHTML"],ns={key:4,class:"text-body-1"},as=r("img",{src:j,style:{height:"30px"}},null,-1),os=[as],ls={key:0,class:"flex-grow-1 d-flex align-items-center"},rs={class:"w-100"},ds=["src"],cs={key:1,style:{"padding-top":"2px"}},us={style:{"margin-left":"5px","margin-top":"0px"}},hs={key:0,class:"mt-2 w-100"},ms={key:0,src:j,height:"48",width:"48"},gs={key:0,style:{"font-size":"12px","padding-top":"20px"}},fs={key:1},ys={key:2,class:"w-100 pb-5"},ps=["src"],_s={key:0,class:"text-body-1"},vs={key:1,class:"text-body-1"},xs={key:3,class:"text-body-1"},ks={key:4,class:"text-body-1"},bs={key:0},ws=["innerHTML"],Cs=k("Memento"),Ms={class:"chips-container",style:{"margin-top":"5px"}},Is={key:7,class:"text-body-1"},Ss={key:0},As=r("h3",null,"Title:",-1),Rs=r("h3",null,"Specific:",-1),Vs=r("h3",null,"Measurable:",-1),Ls=r("h3",null,"Attainable:",-1),Us=r("h3",null,"Relevant:",-1),Ts=r("h3",null,"Time-bound:",-1),Ps=k("Descriptions"),zs=k("CheckList"),Bs={key:0,class:"d-flex justify-center",style:{"margin-bottom":"10px"}},Ds=k("업무 지시하기"),Ns={key:0,class:"chat-menu-background"},Os={key:0,class:"text-body-1",style:{"margin-left":"10px"}},Ws={key:0},Hs={key:1},Fs=k("mdi-close"),js=r("div",{id:"imagePreview",style:{"max-width":"200px"}},null,-1),qs=k("mdi-plus"),Es=k("mdi-close"),Gs={style:{height:"-webkit-fill-available",margin:"5px 5px 0px 0px"}},Js={key:0,class:"user-list",style:{position:"absolute",bottom:"16%",left:"0","background-color":"white","z-index":"100"}},Qs=["onClick"],Zs=["src"],Ks={style:{"font-size":"0.8em",color:"#666"}};function Xs(e,t,s,p,c,l){const y=A("Icons"),g=A("AgentsChat"),x=A("SendIcon"),T=A("icons"),P=A("DynamicForm"),Q=A("perfect-scrollbar"),se=A("Record");return i(),d("div",Nt,[r("div",null,[r("div",null,[r("div",null,[Z(e.$slots,"custom-title",{},()=>[r("div",Ot,[r("div",Wt,[s.name&&s.name!==""?(i(),d("div",Ht,[r("div",null,[r("h5",Ft,f(s.name),1)])])):s.chatInfo?(i(),d("div",jt,[s.chatInfo.img?(i(),m(N,{key:0},{default:a(()=>[r("img",{src:s.chatInfo.img,width:"50"},null,8,qt)]),_:1})):u("",!0),r("div",null,[r("h5",Et,f(e.$t(s.chatInfo.title)),1),r("small",Gt,f(l.filteredAlert.subtitle),1)])])):u("",!0),Z(e.$slots,"custom-tools")]),s.name&&s.name!==""||s.chatInfo||s.type=="form"?(i(),m(D,{key:0,style:{margin:"0px"}})):u("",!0)])]),n(Q,{class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:a(()=>[r("div",{class:"d-flex w-100 chat-view-box",style:M(e.$globalState.state.isRightZoomed?"height:100vh;":c.chatHeight)},[n(q,null,{default:a(()=>[l.filteredAlert.detail?(i(),m(ae,{key:0,color:"#2196F3",variant:"outlined"},{title:a(()=>[n(y,{style:{"padding-left":"-5px"},icon:"info-line",size:32,color:"#2196F3"})]),default:a(()=>[r("small",Jt,f(l.filteredAlert.detail),1),l.filteredAlert.detail=="Agent 기능을 사용해 제안서 초안을 작성하십시오."?(i(),m(_,{key:0,onClick:t[0]||(t[0]=o=>l.reGenerateAgentAI()),color:"primary",style:{"margin-left":"10px"}},{default:a(()=>[Qt]),_:1})):u("",!0)]),_:1})):u("",!0),(i(!0),d(b,null,w(l.filteredMessages,(o,v)=>(i(),d("div",{key:v,class:"px-1 py-1"},[o&&o._template==="agent"?(i(),m(g,{key:0,message:o,agentInfo:s.agentInfo,totalSize:l.filteredMessages.length,currentIndex:v},null,8,["message","agentInfo","totalSize","currentIndex"])):(i(),d("div",Zt,[r("div",null,[o.email==s.userInfo.email&&o.role!="system"?(i(),d("div",Kt,[n(C,{class:"ma-0 pa-0"},{default:a(()=>[n(E),o.timeStamp?(i(),d("small",Xt,f(l.formatTime(o.timeStamp)),1)):u("",!0),o.image?(i(),m(H,{key:1,class:"mb-1"},{default:a(()=>[r("img",{src:o.image,class:"rounded-md",alt:"pro",width:"250"},null,8,Yt)]),_:2},1024)):u("",!0)]),_:2},1024),c.editIndex===v?(i(),d("div",$t,[n(U,{modelValue:s.messages[v].content,"onUpdate:modelValue":h=>s.messages[v].content=h,variant:"solo","hide-details":"","bg-color":"lightprimary",class:"shadow-none",density:"compact","auto-grow":"",rows:"1",autofocus:""},null,8,["modelValue","onUpdate:modelValue"]),n(C,{class:"pa-0 ma-0 mr-2 pb-2"},{default:a(()=>[n(E),n(_,{onClick:l.send,class:"text-medium-emphasis",icon:"",variant:"text",size:"x-small",style:{"background-color":"white !important","margin-right":"5px"}},{default:a(()=>[n(x,{size:"20"})]),_:1},8,["onClick"]),n(_,{onClick:l.cancel,class:"text-medium-emphasis",icon:"",variant:"text",size:"x-small",style:{"background-color":"white !important"}},{default:a(()=>[n(y,{icon:"backspace-bold",size:20})]),_:1},8,["onClick"])]),_:1})])):(i(),d("div",{key:1,class:"d-flex justify-end",onMouseover:h=>c.hoverIndex=v,onMouseleave:t[2]||(t[2]=h=>c.hoverIndex=-1)},[n(H,{class:"bg-lightprimary rounded-md px-3 py-2 mb-1"},{default:a(()=>[o.replyUserName?(i(),d("pre",ts,f(o.replyUserName),1)):u("",!0),o.replyContent?(i(),d("pre",ss,f(o.replyContent),1)):u("",!0),o.replyContent?(i(),m(D,{key:2})):u("",!0),o.content?(i(),d("pre",{key:3,class:"text-body-1",innerHTML:l.linkify(o.content)},null,8,is)):u("",!0),o.jsonContent?(i(),d("pre",ns,f(o.jsonContent),1)):u("",!0),n(C,{class:"ma-0 pa-0"},{default:a(()=>[n(E),c.hoverIndex===v&&!s.disableChat?(i(),m(_,{key:0,onClick:h=>l.editMessage(v),icon:"",variant:"text",size:"x-small",class:"float-left edit-btn",style:{"background-color":"white"}},{default:a(()=>[n(T,{icon:"pencil",size:20})]),_:2},1032,["onClick"])):u("",!0),l.shouldDisplayGeneratedWorkList(s.type,l.filteredMessages,s.generatedWorkList,v)?(i(),d("div",{key:c.isRender},[(i(),d("div",{onClick:t[1]||(t[1]=h=>c.showGeneratedWorkList=!c.showGeneratedWorkList),class:z(["find-message",s.generatedWorkList.length>0?"find-message-on":"find-message-off"]),key:s.generatedWorkList},os,2))])):u("",!0)]),_:2},1024)]),_:2},1024)],40,es)),c.showGeneratedWorkList&&l.shouldDisplayGeneratedWorkList(s.type,l.filteredMessages,s.generatedWorkList,v)&&s.generatedWorkList.length>0?(i(),m(W,{key:2,class:"mt-3"},{default:a(()=>[n(_,{onClick:t[3]||(t[3]=h=>l.deleteAllWorkList()),size:"small",icon:"",density:"comfortable",style:{position:"absolute",right:"5px",top:"5px","z-index":"1"}},{default:a(()=>[n(y,{icon:"trash"})]),_:1}),n(ce,null,{default:a(()=>[r("div",null,[(i(!0),d(b,null,w(s.generatedWorkList,(h,I)=>(i(),m(ue,{key:I,class:"d-flex align-items-center"},{default:a(()=>[h.messageForUser?(i(),d("div",ls,[r("div",rs,[n(C,{class:"ma-0 pa-3"},{default:a(()=>[c.workIcons[h.work]?(i(),d("div",cs,[n(y,{icon:l.getWorkIcon(h.work)},null,8,["icon"])])):(i(),d("img",{key:0,src:c.defaultWorkIcon,alt:"Default Icon",style:{width:"20px",height:"20px"}},null,8,ds)),r("div",us,f(h.messageForUser),1),r("div",null,[e.isViewMode?u("",!0):(i(),m(L,{key:0,text:e.$t("chat.viewDetails")},{activator:a(({props:B})=>[n(_,R(B,{onClick:ie=>h.expanded=!h.expanded,class:"ml-2",size:"small",icon:"",variant:"text",density:"comfortable"}),{default:a(()=>[n(T,{icon:h.expanded?"arrow-up-2":"arrow-down-2"},null,8,["icon"])]),_:2},1040,["onClick"])]),_:2},1032,["text"])),e.isViewMode?u("",!0):(i(),m(L,{key:1,text:e.$t("chat.executeProcess")},{activator:a(({props:B})=>[n(_,R(B,{onClick:ie=>l.startProcess(h,I),class:"ml-2",size:"small",icon:"",variant:"text",density:"comfortable"}),{default:a(()=>[n(y,{icon:"play",color:"rgb(var(--v-theme-primary))"},null,8,["color"])]),_:2},1040,["onClick"])]),_:2},1032,["text"]))])]),_:2},1024),n(he,null,{default:a(()=>[h.expanded?(i(),d("div",hs,[r("pre",null,f(h),1)])):u("",!0)]),_:2},1024),h.work=="CreateProcessDefinition"?(i(),m(Y,{key:0,width:300,"aspect-ratio":"16/9",cover:"",src:"https://github.com/jhyg/project-shop-test/assets/65217813/1b551056-0428-41b6-9b90-76dd7942affc"})):u("",!0)])])):u("",!0),I<s.generatedWorkList.length-1?(i(),m(D,{key:1})):u("",!0)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)):u("",!0)])):!o.disableMsg||o.isLoading?(i(),d("div",{key:1,style:M(l.shouldDisplayUserInfo(o,v)?"":"margin-top: -20px;")},[l.shouldDisplayUserInfo(o,v)?(i(),m(C,{key:0,class:"ma-0 pa-0"},{default:a(()=>[n(C,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:a(()=>[n(N,{style:{"margin-right":"10px"}},{default:a(()=>[o.role=="system"?(i(),d("img",ms)):(i(),m(Y,{key:1,src:l.getProfile(o.email),alt:o.name,height:"48",width:"48"},null,8,["src","alt"]))]),_:2},1024),o.timeStamp?(i(),d("div",gs,f(o.role=="system"?"System,":o.name+",")+" "+f(l.formatTime(o.timeStamp)),1)):u("",!0)]),_:2},1024)]),_:2},1024)):u("",!0),o.contentType&&o.contentType=="html"?(i(),d("div",fs,[n(P,{ref_for:!0,ref:"dynamicForm",formHTML:o.htmlContent,modelValue:o.jsonContent,"onUpdate:modelValue":h=>o.jsonContent=h},null,8,["formHTML","modelValue","onUpdate:modelValue"])])):(i(),d("div",ys,[o.image?(i(),m(H,{key:0,class:"mb-1"},{default:a(()=>[r("img",{src:o.image,class:"rounded-md",alt:"pro",width:"250"},null,8,ps)]),_:2},1024)):u("",!0),r("div",{class:z(["progress-border",{animate:e.borderCompletedAnimated}]),style:M(l.getUserMessageStyle(o))},[o.role=="system"&&l.filteredMessages.length-1==v?(i(),d(b,{key:0},w(5,h=>r("div",{class:z(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:h},null,2)),64)):u("",!0),o.content?(i(),m(H,{key:1,class:"rounded-md px-3 py-2",style:M(l.getOtherUserMessageColor(o)),onMouseover:h=>c.replyIndex=v,onMouseleave:t[7]||(t[7]=h=>c.replyIndex=-1)},{default:a(()=>[o.replyUserName?(i(),d("pre",_s,f(o.replyUserName),1)):u("",!0),o.replyContent?(i(),d("pre",vs,f(o.replyContent),1)):u("",!0),o.replyContent?(i(),m(D,{key:2})):u("",!0),o.disableMsg?(i(),d("pre",xs,f("..."),1)):(i(),d("pre",ks,f(l.setMessageForUser(o.content)),1)),n(C,{class:"pa-0 ma-0"},{default:a(()=>[n(E),s.isMobile||c.replyIndex===v?(i(),d("div",bs,[s.type!="AssistantChats"&&o.specific?(i(),m(_,{key:0,onClick:h=>l.viewWork(v),variant:"text",size:"x-small",icon:"",style:{"background-color":"white","margin-right":"5px"}},{default:a(()=>[n(y,{icon:"document",size:20})]),_:2},1032,["onClick"])):u("",!0),n(_,{onClick:h=>l.beforeReply(o),variant:"text",size:"x-small",icon:"",style:{"background-color":"white","margin-right":"5px"}},{default:a(()=>[n(y,{icon:"reply",size:20})]),_:2},1032,["onClick"]),n(_,{onClick:h=>l.viewJSON(v),variant:"text",size:"x-small",icon:"",style:{"background-color":"white"}},{default:a(()=>[o.jsonContent&&c.isviewJSONStatus?(i(),m(y,{key:0,icon:"arrow-up-2",size:20})):(i(),m(y,{key:1,icon:"arrow-down-2",size:20}))]),_:2},1032,["onClick"])])):u("",!0)]),_:2},1024),o.tableData?(i(),m(C,{key:5,class:"my-5"},{default:a(()=>[n(q,{cols:"12"},{default:a(()=>[n(W,{outlined:""},{default:a(()=>[n(V,null,{default:a(()=>[k(f(l.setTableName(o.content)),1)]),_:2},1024),n(S,null,{default:a(()=>[r("div",{innerHTML:o.tableData,class:"table-responsive"},null,8,ws)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):u("",!0),o.memento?(i(),m(C,{key:6,class:"my-5"},{default:a(()=>[n(q,{cols:"12"},{default:a(()=>[n(W,{outlined:""},{default:a(()=>[n(V,null,{default:a(()=>[Cs]),_:1}),n(S,null,{default:a(()=>[n(U,{"hide-details":"",modelValue:o.memento.response,"onUpdate:modelValue":h=>o.memento.response=h,"auto-grow":"",readonly:"",variant:"solo-filled"},null,8,["modelValue","onUpdate:modelValue"]),r("div",Ms,[(i(!0),d(b,null,w(o.memento.sources,(h,I)=>(i(),m(ee,{key:I,variant:"outlined",size:"x-small","text-color":"primary",style:{"margin-bottom":"1px"}},{default:a(()=>[n(O,{start:"",icon:"mdi-label","x-small":""}),k(" "+f(h.file_name),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):u("",!0),c.isViewJSON.includes(v)?(i(),d("pre",Is,f(o.jsonContent)+`
                                                            `,1)):u("",!0),s.type=="AssistantChats"&&s.isMobile&&v===l.filteredMessages.length-1||c.isViewWork==v?(i(),m(W,{key:8},{default:a(()=>[o.specific?(i(),d("div",Ss,[n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[As]),_:1}),n(S,null,{default:a(()=>[n(U,{readonly:"",rows:"1",modelValue:o.title,"onUpdate:modelValue":h=>o.title=h,"auto-grow":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[Rs]),_:1}),n(S,null,{default:a(()=>[n(U,{readonly:"",rows:"1",modelValue:o.specific,"onUpdate:modelValue":h=>o.specific=h,"auto-grow":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[Vs]),_:1}),n(S,null,{default:a(()=>[n(U,{readonly:"",rows:"1",modelValue:o.measurable,"onUpdate:modelValue":h=>o.measurable=h,"auto-grow":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[Ls]),_:1}),n(S,null,{default:a(()=>[n(U,{readonly:"",rows:"1",modelValue:o.attainable,"onUpdate:modelValue":h=>o.attainable=h,"auto-grow":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[Us]),_:1}),n(S,null,{default:a(()=>[n(U,{readonly:"",rows:"1",modelValue:o.relevant,"onUpdate:modelValue":h=>o.relevant=h,"auto-grow":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(V,{style:{"margin-bottom":"-10px"}},{default:a(()=>[Ts]),_:1}),n(S,null,{default:a(()=>[n(q,{style:{"max-width":"100%"},cols:"12",sm:"6",md:"4"},{default:a(()=>[n(me,{modelValue:e.timeBoundMenu,"onUpdate:modelValue":t[5]||(t[5]=h=>e.timeBoundMenu=h),"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:a(({on:h,attrs:I})=>[n(ge,R({modelValue:o.time_bound,"onUpdate:modelValue":B=>o.time_bound=B,"prepend-icon":"mdi-calendar",readonly:""},I,fe(h)),null,16,["modelValue","onUpdate:modelValue"])]),default:a(()=>[n(xe,{modelValue:o.time_bound,"onUpdate:modelValue":h=>o.time_bound=h,onInput:t[4]||(t[4]=h=>e.timeBoundMenu=!1)},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1024),n(V,null,{default:a(()=>[Ps]),_:1}),n(S,null,{default:a(()=>[(i(!0),d(b,null,w(o.descriptions,(h,I)=>(i(),d("div",{key:I},[r("h3",null,f(h.word),1),r("p",null,f(h.description),1)]))),128))]),_:2},1024),n(V,null,{default:a(()=>[zs]),_:1}),n(S,null,{default:a(()=>[(i(!0),d(b,null,w(o.checkPoints,(h,I)=>(i(),m(ye,{key:I,label:h,readonly:"",modelValue:c.checked,"onUpdate:modelValue":t[6]||(t[6]=B=>c.checked=B)},null,8,["label","modelValue"]))),128))]),_:2},1024),s.type=="AssistantChats"&&s.isMobile?(i(),d("div",Bs,[n(_,{onClick:l.clickedWorkOrder,color:"primary"},{default:a(()=>[Ds]),_:1},8,["onClick"])])):u("",!0)])):u("",!0)]),_:2},1024)):u("",!0)]),_:2},1032,["style","onMouseover"])):u("",!0),o.role=="system"&&l.filteredMessages.length-1==v&&l.isLoading?(i(),m(G,{key:2,indeterminate:"",class:"my-progress-linear"})):u("",!0)],6)]))],4)):u("",!0)])])),s.type=="instances"&&s.agentInfo.isRunning&&l.filteredMessages.length==0?(i(),m(g,{key:2,class:"px-5 py-1",agentInfo:s.agentInfo,totalSize:l.filteredMessages.length,currentIndex:-1},null,8,["agentInfo","totalSize"])):u("",!0)]))),128)),Z(e.$slots,"custom-chat")]),_:3})],4)]),_:3},8,["onScroll"]),r("div",{style:M(s.type=="consulting"?"position:relative; z-index: 9999;":"position:relative;")},[n(C,{class:"pa-0 ma-0",style:{position:"absolute",bottom:"0px",left:"0px"}},{default:a(()=>[c.isOpenedChatMenu?(i(),d("div",Ns,[n(L,{text:e.$t("chat.headset")},{activator:a(({props:o})=>[n(_,R({onClick:t[8]||(t[8]=v=>l.recordingModeChange()),class:"text-medium-emphasis",icon:"",variant:"text"},o,{style:{width:"30px",height:"30px"}}),{default:a(()=>[n(y,{icon:"round-headset",size:20})]),_:2},1040)]),_:1},8,["text"]),s.type!="AssistantChats"?(i(),m(L,{key:0,text:e.$t("chat.document")},{activator:a(({props:o})=>[n(_,R({icon:"",variant:"text",class:"text-medium-emphasis",onClick:l.startWorkOrder},o,{style:{width:"30px",height:"30px","margin-left":"5px"},disabled:s.disableChat}),{default:a(()=>[n(y,{icon:"document",size:20})]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"])):u("",!0),n(L,{text:e.$t("chat.camera")},{activator:a(({props:o})=>[n(_,R({icon:"",variant:"text",class:"text-medium-emphasis",onClick:l.capture},o,{style:{width:"30px",height:"30px","margin-left":"5px"},disabled:s.disableChat}),{default:a(()=>[n(y,{icon:"camera",size:20})]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"]),n(L,{text:e.$t("chat.addImage")},{activator:a(({props:o})=>[n(_,R({icon:"",variant:"text",class:"text-medium-emphasis",onClick:l.uploadImage},o,{style:{width:"30px",height:"30px","margin-left":"5px"},disabled:s.disableChat}),{default:a(()=>[n(y,{icon:"add-media-image",size:20})]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"]),n(L,{text:"Draft Agent"},{activator:a(({props:o})=>[(s.type=="instances"||s.type=="chats")&&!s.agentInfo.isRunning?(i(),m(_,R({key:0,disabled:!(c.newMessage||s.agentInfo.draftPrompt),icon:"",variant:"text",class:"text-medium-emphasis",onClick:l.requestDraftAgent},o,{style:{width:"30px",height:"30px",margin:"1px 0px 0px 5px"}}),{default:a(()=>[n(y,{icon:"document-sparkle",size:20})]),_:2},1040,["disabled","onClick"])):u("",!0),(s.type=="instances"||s.type=="chats")&&s.agentInfo.isRunning?(i(),m(_,{key:1,icon:"",variant:"text",class:"text-medium-emphasis",style:{width:"30px",height:"30px"}},{default:a(()=>[n(oe,{size:20,indeterminate:"",color:"primary"})]),_:1})):u("",!0)]),_:1}),(s.type=="instances"||s.type=="chats"||s.type=="consulting")&&!s.agentInfo.isRunning?(i(),m(re,{key:1,ref:"uploadForm",onSubmit:le(l.submitFile,["prevent"]),style:{height:"30px"},class:"chat-selected-file"},{default:a(()=>[n(C,{class:"ma-0 pa-0",style:M(c.file&&c.file.length>0?"margin:-13px 0px 0px 7px !important;":"")},{default:a(()=>[n(L,{text:e.$t("chat.fileUpLoad")},{activator:a(({props:o})=>[c.file&&c.file.length>0?(i(),m(_,R({key:0,type:"submit"},o,{icon:"",variant:"text",class:"text-medium-emphasis",style:{width:"30px",height:"30px",margin:"12.5px 0px 0px 0px"}}),{default:a(()=>[n(y,{icon:"upload"})]),_:2},1040)):u("",!0)]),_:1},8,["text"]),n(ve,{class:z(["chat-file-up-load",{"chat-file-up-load-display":c.file&&c.file.length>0}]),style:M(c.file&&c.file.length>0?"":"padding:5px 0px 0px 8px !important; width:30px !important; height:30px !important;"),modelValue:c.file,"onUpdate:modelValue":t[9]||(t[9]=o=>c.file=o),label:"Choose a file","prepend-icon":"mdi-paperclip",outlined:"",disabled:s.disableChat},null,8,["class","style","modelValue","disabled"]),s.type=="chats"?(i(),m(L,{key:0,text:s.ProcessGPTActive?e.$t("chat.isDisableProcessGPT"):e.$t("chat.isEnableProcessGPT")},{activator:a(({props:o})=>[n(_,R({icon:"",variant:"text",class:"text-medium-emphasis",onClick:l.toggleProcessGPTActive},o,{style:{width:"30px",height:"30px","margin-left":"12px"},disabled:s.disableChat}),{default:a(()=>[r("img",{style:M([s.ProcessGPTActive?"opacity:1":"opacity:0.5",{height:"24px"}]),src:j},null,4)]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"])):u("",!0)]),_:1},8,["style"])]),_:1},8,["onSubmit"])):u("",!0)])):u("",!0)]),_:1})],4)]),n(D)]),n(D),c.isReply?(i(),d("div",Os,[n(C,{class:"ma-0 pa-0"},{default:a(()=>[c.replyUser.role=="system"?(i(),d("div",Ws,f(e.$t("chat.systemReply")),1)):(i(),d("div",Hs,f(e.$t("chat.userReply",{name:c.replyUser.name})),1)),n(O,{onClick:t[10]||(t[10]=o=>l.cancelReply()),style:{"margin-top":"3px"}},{default:a(()=>[Fs]),_:1})]),_:1}),r("p",null,f(c.replyUser.content),1),n(D)])):u("",!0),r("input",{type:"file",accept:"image/*",capture:"camera",ref:"captureImg",class:"d-none",onChange:t[11]||(t[11]=(...o)=>l.changeImage&&l.changeImage(...o))},null,544),r("input",{type:"file",accept:"image/*",ref:"uploader",class:"d-none",onChange:t[12]||(t[12]=(...o)=>l.changeImage&&l.changeImage(...o))},null,544),js,r("form",{style:M(s.type=="consulting"?"position:relative; z-index: 9999;":""),class:"d-flex align-center pa-0"},[n(U,{variant:"solo","hide-details":"",modelValue:c.newMessage,"onUpdate:modelValue":t[17]||(t[17]=o=>c.newMessage=o),color:"primary",class:"shadow-none message-input-box cp-chat",density:"compact",placeholder:e.$t("chat.inputMessage"),"auto-grow":"",rows:"1",onKeypress:de(l.beforeSend,["enter"]),disabled:s.disableChat,style:{"font-size":"20px !important",height:"77px"},onInput:l.handleTextareaInput},{"prepend-inner":a(()=>[n(_,{onClick:t[13]||(t[13]=o=>l.openChatMenu()),density:"comfortable",icon:"",variant:"text"},{default:a(()=>[c.isOpenedChatMenu?(i(),m(O,{key:1},{default:a(()=>[Es]),_:1})):(i(),m(O,{key:0},{default:a(()=>[qs]),_:1}))]),_:1}),!c.isMicRecording&&!c.isMicRecorderLoading?(i(),m(_,{key:0,onClick:t[14]||(t[14]=o=>l.startVoiceRecording()),density:"comfortable",icon:"",variant:"text"},{default:a(()=>[n(y,{icon:"sharp-mic"})]),_:1})):c.isMicRecorderLoading?u("",!0):(i(),m(_,{key:1,onClick:t[15]||(t[15]=o=>l.stopVoiceRecording()),density:"comfortable",icon:"",variant:"text"},{default:a(()=>[n(y,{icon:"stop",size:"20"})]),_:1})),c.isMicRecorderLoading?(i(),m(y,{key:2,icon:"bubble-loading"})):u("",!0)]),"append-inner":a(()=>[r("div",Gs,[l.isLoading?(i(),m(_,{key:1,icon:"",variant:"text",onClick:t[16]||(t[16]=o=>l.isLoading=!l.isLoading),style:{width:"30px",height:"30px"}},{default:a(()=>[n(y,{icon:"outline-stop-circle",size:20})]),_:1})):(i(),m(_,{key:0,class:"cp-send",icon:"",variant:"text",type:"submit",onClick:l.beforeSend,style:{width:"30px",height:"30px"},disabled:l.disableBtn},{default:a(()=>[n(T,{icon:"send-outline",size:20})]),_:1},8,["onClick","disabled"]))])]),_:1},8,["modelValue","placeholder","onKeypress","disabled","onInput"]),c.showUserList?(i(),d("div",Js,[(i(!0),d(b,null,w(l.filteredUserList,o=>(i(),d("div",{key:o.id,onClick:v=>l.selectUser(o),class:"user-item",style:{display:"flex","align-items":"center",padding:"10px",cursor:"pointer"}},[r("img",{src:o.profile,alt:"profile",style:{width:"30px",height:"30px","border-radius":"50%","margin-right":"10px"}},null,8,Zs),r("div",null,[r("div",null,f(o.username),1),r("div",Ks,f(o.email),1)])],8,Qs))),128))])):u("",!0)],4)]),n(se,{onClose:t[18]||(t[18]=o=>l.recordingModeChange()),onStart:t[19]||(t[19]=o=>l.startRecording()),onStop:t[20]||(t[20]=o=>l.stopRecording()),audioResponse:c.newMessage,chatRoomId:s.chatRoomId,recordingMode:c.recordingMode},null,8,["audioResponse","chatRoomId","recordingMode"])])}const ii=F(Dt,[["render",Xs]]);export{ii as C,Ue as R};
