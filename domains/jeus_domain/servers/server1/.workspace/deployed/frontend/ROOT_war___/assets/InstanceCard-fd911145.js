import{B,_ as P,r as I,o as i,e as u,w as d,b as m,c as y,i as T,ao as G,F as b,Q as R,V as S,E as H,h as w,f as N,d as $,a as v,q as W,a2 as L,a1 as z,a6 as F,t as C,g as A,j,k as U,l as K,m as q,n as Q,p as J}from"./index-7b37f28a.js";import{I as X}from"./InstanceProgress-0125616f.js";import{T as Y,a as Z,f as V}from"./TodoTaskColumn-5d1918c7.js";import{W as tt,P as et}from"./WorkItem-328dcf85.js";import"./ProcessDefinition-8367c465.js";import"./index-5e2cd834.js";import"./hooks.module-5c2ff6dd.js";import"./AppBaseCard.vue_vue_type_style_index_0_lang-764d25b8.js";import"./OrganizationChart-bfb9b6f3.js";import"./DynamicForm-9e8c830e.js";import"./customizer-3521e2ce.js";import"./DefaultForm-027b9cf9.js";import"./Chat-127d4b0d.js";import"./chat-icon-2658168f.js";import"./VSheet-beabeb52.js";import"./VDatePicker-b7697b5c.js";import"./index-8f33dbb8.js";const M=B.createBackend(),at={components:{TodoTaskColumn:Y,TodoDialog:Z},props:{instance:Object},data:()=>({todolist:[{id:"TODO",title:"todoList.todo",cardbg:"background",tasks:[]},{id:"IN_PROGRESS",title:"todoList.inProgress",cardbg:"lightsecondary",tasks:[]},{id:"PENDING",title:"todoList.pending",cardbg:"lightinfo",tasks:[]},{id:"DONE",title:"todoList.done",cardbg:"lightsuccess",tasks:[]}],loading:!1,offset:10,currentPage:0,dialog:!1,defId:""}),created(){this.init(),this.mode==="ProcessGPT"&&(this.defId=this.id.split(".")[0])},computed:{mode(){return window.$mode},id(){return this.mode=="ProcessGPT"?atob(this.$route.params.instId):this.$route.params.instId}},watch:{$route:{deep:!0,handler(t,e){t.params.instId&&t.params.instId!==e.params.instId&&(this.todolist.forEach(a=>{a.tasks=[]}),this.loadToDo(),this.loadCompletedWorkList())}}},methods:{async init(){this.todolist.forEach(t=>{t.tasks=[]}),await this.loadToDo(),await this.loadCompletedWorkList()},executeTask(t){var e=this;e.$router.push(`/todolist/${t.taskId}`)},loadToDo(){var t=this;t.$try({context:t,action:async()=>{let e=await M.getWorkList({instId:t.id});e||(e=[]),e.forEach(a=>{a.instId==t.id&&(a.status=="TODO"||a.status=="NEW"||a.status=="DRAFT"?t.todolist.find(s=>s.id=="TODO").tasks.push(a):a.status=="IN_PROGRESS"?t.todolist.find(s=>s.id=="IN_PROGRESS").tasks.push(a):a.status=="PENDING"&&t.todolist.find(s=>s.id=="PENDING").tasks.push(a))})}})},loadCompletedWorkList(){var t=this;t.$try({context:t,action:async()=>{let e=await M.getCompletedList({page:t.currentPage,size:t.offset,instId:t.id});e||(e=[]),e.forEach(function(a){a.instId==t.id&&(a.status=="DONE"||a.status=="COMPLETED")&&t.todolist.find(s=>s.id=="DONE").tasks.push(a)})}})},handleScrollBottom(){var t=this;t.$try({context:t,action:async()=>{t.loading=!0,t.currentPage++,await t.loadCompletedWorkList(),t.loading=!1}})},updateStatus(t,e){let a;this.todolist.forEach(s=>{let f=s.tasks.find(n=>n.taskId===t);f&&(a=f,s.tasks=s.tasks.filter(n=>n.taskId!==t))}),a&&this.todolist.find(s=>s.id===e).tasks.push(a),this.EventBus.emit("instances-updated")},openDialog(){this.dialog=!0},closeDialog(){this.dialog=!1}}},st=$("할 일 등록");function nt(t,e,a,s,f,n){const g=I("TodoTaskColumn"),r=I("PlusIcon"),_=I("TodoDialog");return i(),u(N,{elevation:"10"},{default:d(()=>[m(R,{class:"ma-0 pa-0",style:{height:"calc(100vh - 270px)",overflow:"auto"}},{default:d(()=>[(i(!0),y(b,null,T(t.todolist,o=>(i(),u(G,{key:o.id,cols:"12",lg:"3",md:"3",sm:"6"},{default:d(()=>[m(g,{column:o,loading:t.loading,isNotAll:!0,onExecuteTask:n.executeTask,onScrollBottom:n.handleScrollBottom,onUpdateStatus:n.updateStatus},null,8,["column","loading","onExecuteTask","onScrollBottom","onUpdateStatus"])]),_:2},1024))),128))]),_:1}),n.mode==="ProcessGPT"?(i(),u(S,{key:0,icon:"",color:"primary",size:"40",elevation:"10",class:"todo-add-btn",onClick:n.openDialog},{default:d(()=>[m(H,{activator:"parent",location:"right"},{default:d(()=>[st]),_:1}),m(r,{size:"24","stroke-width":"2"})]),_:1},8,["onClick"])):w("",!0),t.dialog?(i(),u(_,{key:1,isOpen:t.dialog,todolist:t.todolist,instId:n.id,defId:t.defId,onClose:n.closeDialog},null,8,["isOpen","todolist","instId","defId","onClose"])):w("",!0)]),_:1})}const ot=P(at,[["render",nt]]),it=B.createBackend(),rt={components:{"work-history-uEngine":tt,"work-history-ProcessGPT":et},props:{instance:Object},data:()=>({workListByInstId:null,updatedKey:0}),created(){this.init()},computed:{mode(){return window.$mode},id(){return atob(this.$route.params.instId)},messages(){return this.workListByInstId?this.workListByInstId.map(t=>({profile:"https://avatars0.githubusercontent.com/u/9064066?v=4&s=460",roleName:t.task.roleName,_item:t,content:t.title,description:t.description,timeStamp:t.startDate})):[]},isComplete(){return this.instance.status=="COMPLETED"}},methods:{init(){var t=this;t.$try({context:t,action:async()=>{t.instance&&(t.workListByInstId=await it.getWorkListByInstId(t.instance.instanceId),t.mode=="ProcessGPT"?t.currentActivities=t.instance.current_activity_ids:t.currentActivities=t.workListByInstId.map(e=>e.tracingTag),t.updatedKey++)}})},delay(t){return new Promise(e=>setTimeout(e,t))},navigateToWorkItemByTaskId(t){var e=this;e.$router.push(`/todolist/${t._item.taskId}`),this.$nextTick(()=>{e.delay(500).then(()=>{e.init(),e.updatedKey++})})}}},dt={class:"d-flex w-100"};function lt(t,e,a,s,f,n){const g=I("perfect-scrollbar");return i(),y("div",null,[n.messages.length>0?(i(),u(g,{key:0,class:"h-100",ref:"scrollContainer",onScroll:t.handleScroll},{default:d(()=>[v("div",dt,[(i(),u(W("work-history-"+n.mode),{messages:n.messages,isComplete:n.isComplete,onClickMessage:n.navigateToWorkItemByTaskId},null,8,["messages","isComplete","onClickMessage"]))])]),_:1},8,["onScroll"])):w("",!0)])}const ct=P(rt,[["render",lt]]);const ut={props:{instance:Object},setup(t){const e=L([]),a=B.createBackend(),s=L(""),f=L(""),n=()=>{const o="0123456789ABCDEF";let l="#";for(let c=0;c<6;c++)l+=o[Math.floor(Math.random()*16)];return l},g=o=>{const l=parseInt(o.slice(1,3),16),c=parseInt(o.slice(3,5),16),D=parseInt(o.slice(5,7),16);return(.299*l+.587*c+.114*D)/255>.5?"black":"white"},r=async()=>{if(t.instance&&t.instance.instanceId){var o=await a.getWorkListByInstId(t.instance.instanceId);if(o&&o.length>0){o=o.filter(p=>p.startDate&&p.dueDate);let l=new Date(o[0].startDate),c=new Date(o[0].dueDate||o[0].startDate);o.sort((p,h)=>new Date(p.startDate)-new Date(h.startDate)),e.value=o.map(p=>{const h=new Date(p.startDate),k=new Date(p.dueDate);h<l&&(l=h),k>c&&(c=k);const O=n(),x=g(O);return{startDate:h,endDate:k,ganttBarConfig:{id:p.taskId,label:p.title,hasHandles:!0,style:{background:O,borderRadius:"20px",color:x,minWidth:"50px",cursor:"pointer"}}}});const D=15*24*60*60*1e3;l=new Date(l.getTime()-D),c=new Date(c.getTime()+D),s.value=V(l,"yyyy-MM-dd HH:mm"),f.value=V(c,"yyyy-MM-dd HH:mm")}}},_=async o=>{const{bar:l}=o,{id:c}=l.ganttBarConfig,{startDate:D,endDate:p}=l,h=e.value.find(k=>k.ganttBarConfig.id===c);if(h){h.startDate=new Date(D),h.endDate=new Date(p);try{const k={id:c,title:h.ganttBarConfig.label,startDate:h.startDate,dueDate:h.endDate};await a.putWorklist(c,k)}catch(k){console.error("Failed to update work item dates:",k)}}};return z(r),F(()=>t.instance.instanceId,async(o,l)=>{o!==l&&await r()},{deep:!0}),{workItems:e,chartStartDate:s,chartEndDate:f,onDragEnd:_}}},pt={class:"overflow-y-auto",style:{height:"100%"}};function ht(t,e,a,s,f,n){const g=I("g-gantt-row"),r=I("g-gantt-chart");return i(),y("div",pt,[m(r,{"chart-start":s.chartStartDate,"chart-end":s.chartEndDate,precision:"month","bar-start":"startDate","bar-end":"endDate","push-on-overlap":"","color-scheme":"sky",onDragendBar:s.onDragEnd},{default:d(()=>[(i(!0),y(b,null,T(s.workItems,(_,o)=>(i(),u(g,{key:o,bars:[_]},null,8,["bars"]))),128))]),_:1},8,["chart-start","chart-end","onDragendBar"])])}const mt=P(ut,[["render",ht]]),E=B.createBackend(),ft={components:{InstanceProgress:X,InstanceTodo:ot,InstanceWorkHistory:ct,InstanceGantt:mt},data:()=>({instance:null,eventList:[],tab:"progress",tabItems:[{value:"progress",label:"InstanceCard.progress",component:"InstanceProgress"},{value:"todo",label:"InstanceCard.workItem",component:"InstanceTodo"},{value:"workhistory",label:"InstanceCard.workHistory",component:"InstanceWorkHistory"},{value:"gantt",label:"InstanceCard.ganttChart",component:"InstanceGantt"}]}),watch:{$route:{deep:!0,async handler(t,e){t.params.instId&&t.params.instId!==e.params.instId&&await this.init()}},async tab(t,e){if(t!==e){const a=this.$refs[t];a&&a.length>0&&a[0].init&&await a[0].init()}}},created(){this.init()},computed:{id(){return $mode=="ProcessGPT"?atob(this.$route.params.instId):this.$route.params.instId},isCompleted(){return this.instance.status=="COMPLETED"},deletable(){if(this.instance){const t=localStorage.getItem("email");if(this.instance.current_user_ids&&this.instance.current_user_ids.length>0&&this.instance.current_user_ids.includes(t))return!0}return!1}},methods:{init(){var t=this;t.$try({context:t,action:async()=>{t.id&&(t.instance=await E.getInstance(t.id),t.instance&&(t.eventList=await E.getEventList(t.instance.instanceId)))}})},delay(t){return new Promise(e=>setTimeout(e,t))},fireMessage(t){E.fireMessage(this.instance.instanceId,t)},deleteInstance(){var t=this;t.$try({context:t,action:async()=>{t.id&&(await E.deleteInstance(t.id),t.EventBus.emit("instances-updated"),t.$router.push("/todolist"))},successMsg:this.$t("successMsg.instanceDelete")})}}},gt={class:"d-flex"},kt={class:"px-3 py-3 pb-2 pl-4 align-center"},yt={class:"d-flex"},It={class:"text-h5 font-weight-semibold"},_t={key:0,class:"font-weight-medium",style:{color:"gray","font-size":"14px"}},Dt={style:{height:"100%"}};function vt(t,e,a,s,f,n){const g=I("Icons");return t.instance?(i(),u(N,{key:0,elevation:"10",style:{height:"calc(100vh - 155px)"}},{default:d(()=>[v("div",gt,[v("div",kt,[v("div",yt,[v("h5",It,C(t.instance.name),1),t.instance.status?(i(),u(A,{key:0,size:"x-small",variant:"outlined",style:{margin:"2px 0px 0px 5px !important",display:"flex","align-items":"center"}},{default:d(()=>[$(C(t.instance.status),1)]),_:1})):w("",!0),(i(!0),y(b,null,T(t.eventList,r=>(i(),y("div",null,[m(S,{onClick:_=>n.fireMessage(r),color:"primary",rounded:"",style:{"font-size":"12px"},density:"comfortable",class:"ml-3"},{default:d(()=>[$(C(t.$t("InstanceCard.sendEvent",{event:r})),1)]),_:2},1032,["onClick"])]))),256))]),t.instance.instanceId?(i(),y("div",_t," ID: "+C(t.instance.instanceId),1)):w("",!0)]),n.deletable?(i(),u(S,{key:0,onClick:n.deleteInstance,variant:"plain",icon:"",class:"ml-auto"},{default:d(()=>[m(g,{icon:"trash"})]),_:1},8,["onClick"])):w("",!0)]),v("div",Dt,[m(j,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=r=>t.tab=r),"bg-color":"transparent",height:"40",color:"primary"},{default:d(()=>[(i(!0),y(b,null,T(t.tabItems,r=>(i(),u(Q,{key:r.value,value:r.value},{default:d(()=>[$(C(t.$t(r.label)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),m(U),m(q,{style:{height:"calc(100vh - 260px)"},class:"pa-0"},{default:d(()=>[m(K,{style:{height:"100%"},modelValue:t.tab,"onUpdate:modelValue":e[1]||(e[1]=r=>t.tab=r)},{default:d(()=>[(i(!0),y(b,null,T(t.tabItems,r=>(i(),u(J,{style:{height:"100%"},key:r.value,value:r.value},{default:d(()=>[(i(),u(W(r.component),{instance:t.instance,ref_for:!0,ref:r.value},null,8,["instance"]))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1})):(i(),u(N,{key:1}))}const Rt=P(ft,[["render",vt]]);export{Rt as default};
