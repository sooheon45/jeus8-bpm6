import{_ as _t,u as ca,o as L,c as q,c8 as te,B as Nn,r as Te,e as ve,w as I,a as Z,i as Ct,b as k,F as Gt,ao as ht,c9 as hn,Q as vt,A as cp,f as at,ca as If,bM as Af,y as $f,cb as Of,W as Lf,d as st,t as ne,U as Oo,m as ai,V as ft,h as ct,D as Rn,E as kn,R as Bf,bG as Nf,q as jf,X as lp,cc as Hf,K as pp,cd as Vf,ce as Ff,bi as zf,ba as up,j as Gf,n as Ws,aS as Wf,l as Uf,p as Us,z as Xf}from"./index-7b37f28a.js";import{i as Cr,a as X,b as Me,d as la,e as O,I as Kf,f as J,g as yi,h as G,j as Qe,m as Tr,k as S,V as mn,M as pa,Z as ua,l as x,s as gt,n as K,o as da,p as Pe,q as He,r as xe,t as pi,u as De,v as lt,w as Rr,x as se,y as fa,O as dp,z as Ue,A as Dn,C as Dt,D as C,E as kr,F as ue,G as Ie,H as Xt,J as B,K as V,L as g,N as ha,P as ma,Q as Mr,R as Tt,S as Xe,T as va,U as yt,W as ee,X as ui,Y as Rt,_ as vo,$ as Yf,a0 as fp,a1 as hp,a2 as qf,a3 as It,a4 as mp,a5 as Zf,a6 as oe,a7 as ce,a8 as ae,a9 as U,aa as Lo,ab as Pt,ac as Le,ad as Jf,ae as Be,af as ga,ag as Xs,ah as Qf,ai as vp,aj as Bo,ak as Mt,al as ya,am as No,an as eh,ao as gp,ap as Mn,aq as Dr,ar as D,as as yp,at as Ne,au as we,av as be,aw as ie,ax as Y,ay as Ir,az as di,aA as si,aB as In,aC as Ut,aD as Ge,aE as Q,aF as _i,aG as fi,aH as _p,aI as bi,aJ as Tn,aK as pr,aL as cn,aM as Ks,aN as th,aO as nh,aP as ih,aQ as rh,aR as oh,aS as bp,aT as zt,aU as jo,aV as ah,aW as _a,aX as sh,aY as ba,aZ as ch,a_ as lh,a$ as ph,b0 as uh,b1 as Ho,b2 as Ep,b3 as dh,b4 as fh,b5 as Ys,b6 as xp,b7 as An,b8 as hh,b9 as Ar,ba as mh,bb as vh,bc as wp,bd as gh,be as Sp,bf as yh,bg as qs,bh as Pp,B as _h,c as Vo}from"./index-5e2cd834.js";import{y as bh,F as vr,a as Cp,s as Fo,p as go,T as qn,h as zo,D as Tp}from"./hooks.module-5c2ff6dd.js";import{_ as Eh}from"./AppBaseCard.vue_vue_type_style_index_0_lang-764d25b8.js";import{a as Rp,D as xh,F as wh,U as Sh}from"./WorkItem-328dcf85.js";import{O as Ph}from"./OrganizationChart-bfb9b6f3.js";import{U as Ch}from"./DynamicForm-9e8c830e.js";function hi(e,t){for(Cr(t)&&(t=[t]);e=e.parent;)if(X(e,t))return e;return null}function $r(e){var t=["bpmn:Participant","bpmn:Lane"],n=hi(e,t);return n?Me(n):X(e,t)?Me(e):!0}const Th="uengine",Rh="uengine",kh="http://uengine",Mh={tagAlias:"lowerCase"},Dh=[],Ih=[{name:"Properties",superClass:["Element"],properties:[{name:"json",type:"String"},{name:"variables",isMany:!0,type:"Variable"}]},{name:"Variable",superClass:["Element"],properties:[{name:"key",isAttr:!0,type:"String"},{name:"value",type:"String"},{name:"json",type:"String"}]}],Go={name:Th,prefix:Rh,uri:kh,xml:Mh,associations:Dh,types:Ih};function Ei(e){la.call(this,e),this.on("import.parse.complete",function(t){t.error||this._collectIds(t.definitions,t.elementsById)},this),this.on("diagram.destroy",function(){this.get("moddle").ids.clear()},this)}O(Ei,la);Ei.prototype._createModdle=function(e){var t=la.prototype._createModdle.call(this,e);return t.ids=new Kf([32,36,1]),t};Ei.prototype._collectIds=function(e,t){var n=e.$model,i=n.ids,r;i.clear();for(r in t)i.claim(r,t[r])};var Ah=["c","C"],$h=["v","V"],Oh=["y","Y"],kp=["z","Z"];function Lh(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey}function Ke(e){return e.altKey?!1:e.ctrlKey||e.metaKey}function Ee(e,t){return e=J(e)?e:[e],e.indexOf(t.key)!==-1||e.indexOf(t.code)!==-1}function Ea(e){return e.shiftKey}function Bh(e){return Ke(e)&&Ee(Ah,e)}function Nh(e){return Ke(e)&&Ee($h,e)}function jh(e){return Ke(e)&&!Ea(e)&&Ee(kp,e)}function Hh(e){return Ke(e)&&(Ee(Oh,e)||Ee(kp,e)&&Ea(e))}var Or="keyboard.keydown",Vh="keyboard.keyup",Zs="input-handle-modified-keys",Fh=1e3;function Re(e,t){var n=this;this._config=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),t.on("diagram.init",function(){n._fire("init")}),t.on("attach",function(){e&&e.bindTo&&n.bind(e.bindTo)}),t.on("detach",function(){n.unbind()})}Re.$inject=["config.keyboard","eventBus"];Re.prototype._keydownHandler=function(e){this._keyHandler(e,Or)};Re.prototype._keyupHandler=function(e){this._keyHandler(e,Vh)};Re.prototype._keyHandler=function(e,t){var n;if(!this._isEventIgnored(e)){var i={keyEvent:e};n=this._eventBus.fire(t||Or,i),n&&e.preventDefault()}};Re.prototype._isEventIgnored=function(e){return e.defaultPrevented?!0:(zh(e.target)||Gh(e.target)&&Ee([" ","Enter"],e))&&this._isModifiedKeyIgnored(e)};Re.prototype._isModifiedKeyIgnored=function(e){if(!Ke(e))return!0;var t=this._getAllowedModifiers(e.target);return t.indexOf(e.key)===-1};Re.prototype._getAllowedModifiers=function(e){var t=yi(e,"["+Zs+"]",!0);return!t||this._node&&!this._node.contains(t)?[]:t.getAttribute(Zs).split(",")};Re.prototype.bind=function(e){this.unbind(),this._node=e,G.bind(e,"keydown",this._keydownHandler),G.bind(e,"keyup",this._keyupHandler),this._fire("bind")};Re.prototype.getBinding=function(){return this._node};Re.prototype.unbind=function(){var e=this._node;e&&(this._fire("unbind"),G.unbind(e,"keydown",this._keydownHandler),G.unbind(e,"keyup",this._keyupHandler)),this._node=null};Re.prototype._fire=function(e){this._eventBus.fire("keyboard."+e,{node:this._node})};Re.prototype.addListener=function(e,t,n){Qe(e)&&(n=t,t=e,e=Fh),this._eventBus.on(n||Or,e,t)};Re.prototype.removeListener=function(e,t){this._eventBus.off(t||Or,e)};Re.prototype.hasModifier=Lh;Re.prototype.isCmd=Ke;Re.prototype.isShift=Ea;Re.prototype.isKey=Ee;function zh(e){return e&&(Tr(e,"input, textarea")||e.contentEditable==="true")}function Gh(e){return e&&Tr(e,"button, input[type=submit], input[type=button], a[href], [aria-role=button]")}var Wh=500;function jn(e,t){var n=this;e.on("editorActions.init",Wh,function(i){var r=i.editorActions;n.registerBindings(t,r)})}jn.$inject=["eventBus","keyboard"];jn.prototype.registerBindings=function(e,t){function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("undo",function(i){var r=i.keyEvent;if(jh(r))return t.trigger("undo"),!0}),n("redo",function(i){var r=i.keyEvent;if(Hh(r))return t.trigger("redo"),!0}),n("copy",function(i){var r=i.keyEvent;if(Bh(r))return t.trigger("copy"),!0}),n("paste",function(i){var r=i.keyEvent;if(Nh(r))return t.trigger("paste"),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(Ee(["+","Add","="],r)&&Ke(r))return t.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(Ee(["-","Subtract"],r)&&Ke(r))return t.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(i){var r=i.keyEvent;if(Ee("0",r)&&Ke(r))return t.trigger("zoom",{value:1}),!0}),n("removeSelection",function(i){var r=i.keyEvent;if(Ee(["Backspace","Delete","Del"],r))return t.trigger("removeSelection"),!0})};const xa={__init__:["keyboard","keyboardBindings"],keyboard:["type",Re],keyboardBindings:["type",jn]};var Uh={moveSpeed:50,moveSpeedAccelerated:200};function Mp(e,t,n){var i=this;this._config=S({},Uh,e||{}),t.addListener(r);function r(o){var s=o.keyEvent,a=i._config;if(t.isCmd(s)&&t.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],s)){var c=t.isShift(s)?a.moveSpeedAccelerated:a.moveSpeed,l;switch(s.key){case"ArrowLeft":case"Left":l="left";break;case"ArrowUp":case"Up":l="up";break;case"ArrowRight":case"Right":l="right";break;case"ArrowDown":case"Down":l="down";break}return i.moveCanvas({speed:c,direction:l}),!0}}this.moveCanvas=function(o){var s=0,a=0,c=o.speed,l=c/Math.min(Math.sqrt(n.viewbox().scale),1);switch(o.direction){case"left":s=l;break;case"up":a=l;break;case"right":s=-l;break;case"down":a=-l;break}n.scroll({dx:s,dy:a})}}Mp.$inject=["config.keyboardMove","keyboard","canvas"];const Dp={__depends__:[xa],__init__:["keyboardMove"],keyboardMove:["type",Mp]};function mi(e){mn.call(this,e)}O(mi,mn);mi.prototype._navigationModules=[Dp,pa,ua];mi.prototype._modules=[].concat(mn.prototype._modules,mi.prototype._navigationModules);function yo(e){return e&&e[e.length-1]}function Js(e){return e.y}function Qs(e){return e.x}var Xh={left:Qs,center:Qs,right:function(e){return e.x+e.width},top:Js,middle:Js,bottom:function(e){return e.y+e.height}};function Hn(e,t){this._modeling=e,this._rules=t}Hn.$inject=["modeling","rules"];Hn.prototype._getOrientationDetails=function(e){var t=["top","bottom","middle"],n="x",i="width";return t.indexOf(e)!==-1&&(n="y",i="height"),{axis:n,dimension:i}};Hn.prototype._isType=function(e,t){return t.indexOf(e)!==-1};Hn.prototype._alignmentPosition=function(e,t){var n=this._getOrientationDetails(e),i=n.axis,r=n.dimension,o={},s={},a=!1,c,l,p;function u(d,f){return Math.round((d[i]+f[i]+f[r])/2)}if(this._isType(e,["left","top"]))o[e]=t[0][i];else if(this._isType(e,["right","bottom"]))p=yo(t),o[e]=p[i]+p[r];else if(this._isType(e,["center","middle"])){if(x(t,function(d){var f=d[i]+Math.round(d[r]/2);s[f]?s[f].elements.push(d):s[f]={elements:[d],center:f}}),c=gt(s,function(d){return d.elements.length>1&&(a=!0),d.elements.length}),a)return o[e]=yo(c).center,o;l=t[0],t=gt(t,function(d){return d[i]+d[r]}),p=yo(t),o[e]=u(l,p)}return o};Hn.prototype.trigger=function(e,t){var n=this._modeling,i,r=K(e,function(c){return!(c.waypoints||c.host||c.labelTarget)});if(i=this._rules.allowed("elements.align",{elements:r}),J(i)&&(r=i),!(r.length<2||!i)){var o=Xh[t],s=gt(r,o),a=this._alignmentPosition(t,s);n.alignElements(s,a)}};const Kh={__init__:["alignElements"],alignElements:["type",Hn]},Yh=new da;function Vn(e){this._scheduled={},e.on("diagram.destroy",()=>{Object.keys(this._scheduled).forEach(t=>{this.cancel(t)})})}Vn.$inject=["eventBus"];Vn.prototype.schedule=function(e,t=Yh.next()){this.cancel(t);const n=this._schedule(e,t);return this._scheduled[t]=n,n.promise};Vn.prototype._schedule=function(e,t){const{promise:n,resolve:i,reject:r}=qh();return{executionId:requestAnimationFrame(()=>{try{i(e())}catch(s){r(s)}}),promise:n}};Vn.prototype.cancel=function(e){const t=this._scheduled[e];t&&(this._cancel(t),this._scheduled[e]=null)};Vn.prototype._cancel=function(e){cancelAnimationFrame(e.executionId)};function qh(){let e,t;return{promise:new Promise((i,r)=>{e=i,t=r}),resolve:e,reject:t}}const Zh={scheduler:["type",Vn]};var Jh="djs-element-hidden",Wi=".entry",Qh=1e3,ec=8,em=300;function _e(e,t,n,i){this._canvas=e,this._elementRegistry=t,this._eventBus=n,this._scheduler=i,this._current=null,this._init()}_e.$inject=["canvas","elementRegistry","eventBus","scheduler"];_e.prototype._init=function(){var e=this;this._eventBus.on("selection.changed",function(t){var n=t.newSelection,i=n.length?n.length===1?n[0]:n:null;i?e.open(i,!0):e.close()}),this._eventBus.on("elements.changed",function(t){var n=t.elements,i=e._current;if(i){var r=i.target,o=J(r)?r:[r],s=o.filter(function(c){return n.includes(c)});if(s.length){e.close();var a=o.filter(function(c){return e._elementRegistry.get(c.id)});a.length&&e._updateAndOpen(a.length>1?a:a[0])}}}),this._eventBus.on("canvas.viewbox.changed",function(){e._updatePosition()}),this._eventBus.on("element.marker.update",function(t){if(e.isOpen()){var n=t.element,i=e._current,r=J(i.target)?i.target:[i.target];r.includes(n)&&e._updateVisibility()}}),this._container=this._createContainer()};_e.prototype._createContainer=function(){var e=Pe('<div class="djs-context-pad-parent"></div>');return this._canvas.getContainer().appendChild(e),e};_e.prototype.registerProvider=function(e,t){t||(t=e,e=Qh),this._eventBus.on("contextPad.getProviders",e,function(n){n.providers.push(t)})};_e.prototype.getEntries=function(e){var t=this._getProviders(),n=J(e)?"getMultiElementContextPadEntries":"getContextPadEntries",i={};return x(t,function(r){if(Qe(r[n])){var o=r[n](e);Qe(o)?i=o(i):x(o,function(s,a){i[a]=s})}}),i};_e.prototype.trigger=function(e,t,n){var i=this,r,o,s=t.delegateTarget||t.target;if(!s)return t.preventDefault();if(r=He(s,"data-action"),o=t.originalEvent||t,e==="mouseover"){this._timeout=setTimeout(function(){i._mouseout=i.triggerEntry(r,"hover",o,n)},em);return}else if(e==="mouseout"){clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null);return}return this.triggerEntry(r,e,o,n)};_e.prototype.triggerEntry=function(e,t,n,i){if(this.isShown()){var r=this._current.target,o=this._current.entries,s=o[e];if(s){var a=s.action;if(this._eventBus.fire("contextPad.trigger",{entry:s,event:n})!==!1){if(Qe(a)){if(t==="click")return a(n,r,i)}else if(a[t])return a[t](n,r,i);n.preventDefault()}}}};_e.prototype.open=function(e,t){!t&&this.isOpen(e)||(this.close(),this._updateAndOpen(e))};_e.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};_e.prototype._updateAndOpen=function(e){var t=this.getEntries(e),n=this._createHtml(e),i;x(t,function(r,o){var s=r.group||"default",a=Pe(r.html||'<div class="entry" draggable="true"></div>'),c;He(a,"data-action",o),c=xe("[data-group="+pi(s)+"]",n),c||(c=Pe('<div class="group"></div>'),He(c,"data-group",s),n.appendChild(c)),c.appendChild(a),r.className&&tm(a,r.className),r.title&&He(a,"title",r.title),r.imageUrl&&(i=Pe("<img>"),He(i,"src",r.imageUrl),i.style.width="100%",i.style.height="100%",a.appendChild(i))}),De(n).add("open"),this._current={entries:t,html:n,target:e},this._updatePosition(),this._updateVisibility(),this._eventBus.fire("contextPad.open",{current:this._current})};_e.prototype._createHtml=function(e){var t=this,n=Pe('<div class="djs-context-pad"></div>');return lt.bind(n,Wi,"click",function(i){t.trigger("click",i)}),lt.bind(n,Wi,"dragstart",function(i){t.trigger("dragstart",i)}),lt.bind(n,Wi,"mouseover",function(i){t.trigger("mouseover",i)}),lt.bind(n,Wi,"mouseout",function(i){t.trigger("mouseout",i)}),G.bind(n,"mousedown",function(i){i.stopPropagation()}),this._container.appendChild(n),this._eventBus.fire("contextPad.create",{target:e,pad:n}),n};_e.prototype.getPad=function(e){console.warn(new Error("ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888"));let t;return this.isOpen()&&im(this._current.target,e)?t=this._current.html:t=this._createHtml(e),{html:t}};_e.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._container.innerHTML="",this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};_e.prototype.isOpen=function(e){var t=this._current;if(!t)return!1;if(!e)return!0;var n=t.target;return J(e)!==J(n)?!1:J(e)?e.length===n.length&&Rr(e,function(i){return n.includes(i)}):n===e};_e.prototype.isShown=function(){return this.isOpen()&&De(this._current.html).has("open")};_e.prototype.show=function(){this.isOpen()&&(De(this._current.html).add("open"),this._updatePosition(),this._eventBus.fire("contextPad.show",{current:this._current}))};_e.prototype.hide=function(){this.isOpen()&&(De(this._current.html).remove("open"),this._eventBus.fire("contextPad.hide",{current:this._current}))};_e.prototype._getPosition=function(e){if(!J(e)&&se(e)){var t=this._canvas.viewbox(),n=nm(e),i=n.x*t.scale-t.x*t.scale,r=n.y*t.scale-t.y*t.scale;return{left:i+ec*this._canvas.zoom(),top:r}}var o=this._canvas.getContainer(),s=o.getBoundingClientRect(),a=this._getTargetBounds(e);return{left:a.right-s.left+ec*this._canvas.zoom(),top:a.top-s.top}};_e.prototype._updatePosition=function(){const e=()=>{if(this.isOpen()){var t=this._current.html,n=this._getPosition(this._current.target);"x"in n&&"y"in n?(t.style.left=n.x+"px",t.style.top=n.y+"px"):["top","right","bottom","left"].forEach(function(i){i in n&&(t.style[i]=n[i]+"px")})}};this._scheduler.schedule(e,"ContextPad#_updatePosition")};_e.prototype._updateVisibility=function(){const e=()=>{if(this.isOpen()){var t=this,n=this._current.target,i=J(n)?n:[n],r=i.some(function(o){return t._canvas.hasMarker(o,Jh)});r?t.hide():t.show()}};this._scheduler.schedule(e,"ContextPad#_updateVisibility")};_e.prototype._getTargetBounds=function(e){var t=this,n=J(e)?e:[e],i=n.map(function(r){return t._canvas.getGraphics(r)});return i.reduce(function(r,o){const s=o.getBoundingClientRect();return r.top=Math.min(r.top,s.top),r.right=Math.max(r.right,s.right),r.bottom=Math.max(r.bottom,s.bottom),r.left=Math.min(r.left,s.left),r.x=r.left,r.y=r.top,r.width=r.right-r.left,r.height=r.bottom-r.top,r},{top:1/0,right:-1/0,bottom:-1/0,left:1/0})};function tm(e,t){var n=De(e);t=J(t)?t:t.split(/\s+/g),t.forEach(function(i){n.add(i)})}function nm(e){return e.waypoints[e.waypoints.length-1]}function im(e,t){return e=J(e)?e:[e],t=J(t)?t:[t],e.length===t.length&&Rr(e,function(n){return t.includes(n)})}const Ip={__depends__:[fa,Zh,dp],contextPad:["type",_e]};var Ap=function(e,t,n,i){var r;t[0]=0;for(var o=1;o<t.length;o++){var s=t[o++],a=t[o]?(t[0]|=s?1:2,n[t[o++]]):t[++o];s===3?i[0]=a:s===4?i[1]=Object.assign(i[1]||{},a):s===5?(i[1]=i[1]||{})[t[++o]]=a:s===6?i[1][t[++o]]+=a+"":s?(r=e.apply(a,Ap(e,a,n,["",null])),i.push(r),a[0]?t[0]|=2:(t[o-2]=0,t[o]=r)):i.push(a)}return i},tc=new Map;function rm(e){var t=tc.get(this);return t||(t=new Map,tc.set(this,t)),(t=Ap(this,t.get(e)||(t.set(e,t=function(n){for(var i,r,o=1,s="",a="",c=[0],l=function(d){o===1&&(d||(s=s.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?c.push(0,d,s):o===3&&(d||s)?(c.push(3,d,s),o=2):o===2&&s==="..."&&d?c.push(4,d,0):o===2&&s&&!d?c.push(5,0,!0,s):o>=5&&((s||!d&&o===5)&&(c.push(o,0,s,r),o=6),d&&(c.push(o,d,0,r),o=6)),s=""},p=0;p<n.length;p++){p&&(o===1&&l(),l(p));for(var u=0;u<n[p].length;u++)i=n[p][u],o===1?i==="<"?(l(),c=[c],o=3):s+=i:o===4?s==="--"&&i===">"?(o=1,s=""):s=i+s[0]:a?i===a?a="":s+=i:i==='"'||i==="'"?a=i:i===">"?(l(),o=1):o&&(i==="="?(o=5,r=s,s=""):i==="/"&&(o<5||n[p][u+1]===">")?(l(),o===3&&(c=c[0]),o=c,(c=c[0]).push(2,0,o),o=0):i===" "||i==="	"||i===`
`||i==="\r"?(l(),o=2):s+=i),o===3&&s==="!--"&&(o=4,c=c[0])}return l(),c}(e)),t),arguments,[])).length>1?t:t[0]}var me=rm.bind(bh);function $p(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=$p(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function gr(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=$p(e))&&(i&&(i+=" "),i+=t);return i}function om(e){const{headerEntries:t,onSelect:n,selectedEntry:i,setSelectedEntry:r,title:o}=e,s=vr(()=>am(t),[t]);return me`
    <div class="djs-popup-header">
      <h3 class="djs-popup-title" title=${o}>${o}</h3>
      ${s.map(a=>me`
        <ul key=${a.id} class="djs-popup-header-group" data-header-group=${a.id}>

          ${a.entries.map(c=>me`
            <li key=${c.id}>
              <${c.action?"button":"span"}
                class=${sm(c,c===i)}
                onClick=${l=>c.action&&n(l,c)}
                title=${c.title||c.label}
                data-id=${c.id}
                onMouseEnter=${()=>c.action&&r(c)}
                onMouseLeave=${()=>c.action&&r(null)}
                onFocus=${()=>c.action&&r(c)}
                onBlur=${()=>c.action&&r(null)}
              >
                ${c.imageUrl&&me`<img class="djs-popup-entry-icon" src=${c.imageUrl} alt="" />`||c.imageHtml&&me`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:c.imageHtml}} />`}
                ${c.label?me`
                  <span class="djs-popup-label">${c.label}</span>
                `:null}
              </${c.action?"button":"span"}>
            </li>
          `)}
        </ul>
      `)}
    </div>
  `}function am(e){return e.reduce((t,n)=>{const i=n.group||"default",r=t.find(o=>o.id===i);return r?r.entries.push(n):t.push({id:i,entries:[n]}),t},[])}function sm(e,t){return gr("entry",e.className,e.active?"active":"",e.disabled?"disabled":"",t?"selected":"")}function cm(e){const{entry:t,selected:n,onMouseEnter:i,onMouseLeave:r,onAction:o}=e;return me`
    <li
      class=${gr("entry",{selected:n})}
      data-id=${t.id}
      title=${t.title||t.label}
      tabIndex="0"
      onClick=${o}
      onFocus=${i}
      onBlur=${r}
      onMouseEnter=${i}
      onMouseLeave=${r}
      onDragStart=${s=>o(s,t,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${gr("djs-popup-entry-name",t.className)}
        >
          ${t.imageUrl&&me`<img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />`||t.imageHtml&&me`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:t.imageHtml}} />`}

          ${t.label?me`
            <span class="djs-popup-label">
              ${t.label}
            </span>
          `:null}
        </span>
        ${t.description&&me`
          <span
            class="djs-popup-entry-description"
            title=${t.description}
          >
            ${t.description}
          </span>
        `}
      </div>
      ${t.documentationRef&&me`
        <div class="djs-popup-entry-docs">
          <a
            href="${t.documentationRef}"
            onClick=${s=>s.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function lm(e){const{selectedEntry:t,setSelectedEntry:n,entries:i,...r}=e,o=Cp(),s=vr(()=>pm(i),[i]);return Fo(()=>{const a=o.current;if(!a)return;const c=a.querySelector(".selected");c&&um(c)},[t]),me`
    <div class="djs-popup-results" ref=${o}>
      ${s.map(a=>me`
        ${a.name&&me`
          <div key=${a.id} class="entry-header" title=${a.name}>
            ${a.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${a.id}>
          ${a.entries.map(c=>me`
            <${cm}
              key=${c.id}
              entry=${c}
              selected=${c===t}
              onMouseEnter=${()=>n(c)}
              onMouseLeave=${()=>n(null)}
              ...${r}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function pm(e){const t=[],n=o=>t.find(s=>o.id===s.id),i=o=>!!n(o),r=o=>typeof o=="string"?{id:o}:o;return e.forEach(o=>{const s=o.group?r(o.group):{id:"default"};i(s)?n(s).entries.push(o):t.push({...s,entries:[o]})}),t}function um(e){typeof e.scrollIntoViewIfNeeded=="function"?e.scrollIntoViewIfNeeded():e.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function dm(e){const{onClose:t,onSelect:n,className:i,headerEntries:r,position:o,title:s,width:a,scale:c,search:l,emptyPlaceholder:p,entries:u,onOpened:d,onClosed:f}=e,m=vr(()=>Ue(l)?u.length>5:!1,[l,u]),[h,v]=go(""),b=qn((A,H)=>{if(!m)return A;const z=W=>{if(!H)return(W.rank||0)>=0;if(W.searchable===!1)return!1;const Oe=[W.description||"",W.label||"",W.search||""].map(le=>le.toLowerCase());return H.toLowerCase().split(/\s/g).every(le=>Oe.some(xt=>xt.includes(le)))};return A.filter(z)},[m]),[E,y]=go(b(u,h)),[_,w]=go(E[0]),P=qn(A=>{(!_||!A.includes(_))&&w(A[0]),y(A)},[_,y,w]);zo(()=>{P(b(u,h))},[h,u]);const R=qn(A=>{let z=E.indexOf(_)+A;z<0&&(z=E.length-1),z>=E.length&&(z=0),w(E[z])},[E,_,w]),j=qn(A=>{if(A.key==="Enter"&&_)return n(A,_);if(A.key==="ArrowUp")return R(-1),A.preventDefault();if(A.key==="ArrowDown")return R(1),A.preventDefault()},[n,_,R]),F=qn(A=>{Tr(A.target,"input")&&v(()=>A.target.value)},[v]);zo(()=>(d(),()=>{f()}),[]);const T=vr(()=>s||r.length>0,[s,r]);return me`
    <${nc}
      onClose=${t}
      onKeyup=${F}
      onKeydown=${j}
      className=${i}
      position=${o}
      width=${a}
      scale=${c}
    >
      ${T&&me`
        <${om}
          headerEntries=${r}
          onSelect=${n}
          selectedEntry=${_}
          setSelectedEntry=${w}
          title=${s}
        />
      `}
      ${u.length>0&&me`
        <div class="djs-popup-body">

          ${m&&me`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input type="text" aria-label="${s}" />
          </div>
          `}

          <${lm}
            entries=${E}
            selectedEntry=${_}
            setSelectedEntry=${w}
            onAction=${n}
          />
        </div>
      `}
    ${p&&E.length===0&&me`
      <div class="djs-popup-no-results">${Qe(p)?p(h):p}</div>
    `}
    </${nc}>
  `}function nc(e){const{onClose:t,onKeydown:n,onKeyup:i,className:r,children:o,position:s}=e,a=Cp();return Fo(()=>{if(typeof s!="function")return;const c=a.current,l=s(c);c.style.left=`${l.x}px`,c.style.top=`${l.y}px`},[a.current,s]),Fo(()=>{const c=a.current;if(!c)return;(c.querySelector("input")||c).focus()},[]),zo(()=>{const c=p=>{if(p.key==="Escape")return p.preventDefault(),t()},l=p=>{if(!yi(p.target,".djs-popup",!0))return t()};return document.documentElement.addEventListener("keydown",c),document.body.addEventListener("click",l),()=>{document.documentElement.removeEventListener("keydown",c),document.body.removeEventListener("click",l)}},[]),me`
    <div
      class=${gr("djs-popup",r)}
      style=${fm(e)}
      onKeydown=${n}
      onKeyup=${i}
      ref=${a}
      tabIndex="-1"
    >
      ${o}
    </div>
  `}function fm(e){return{transform:`scale(${e.scale})`,width:`${e.width}px`,"transform-origin":"top left"}}var hm="data-id",Op=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],mm=1e3;function de(e,t,n){this._eventBus=t,this._canvas=n,this._current=null;var i=Ue(e&&e.scale)?e.scale:{min:1,max:1};this._config={scale:i},t.on("diagram.destroy",()=>{this.close()}),t.on("element.changed",r=>{const o=this.isOpen()&&this._current.target;r.element===o&&this.refresh()})}de.$inject=["config.popupMenu","eventBus","canvas"];de.prototype._render=function(){const{position:e,providerId:t,entries:n,headerEntries:i,emptyPlaceholder:r,options:o}=this._current,s=Object.entries(n).map(([d,f])=>({id:d,...f})),a=Object.entries(i).map(([d,f])=>({id:d,...f})),c=e&&(d=>this._ensureVisible(d,e)),l=this._updateScale(this._current.container);Tp(me`
      <${dm}
        onClose=${d=>this.close(d)}
        onSelect=${(d,f,m)=>this.trigger(d,f,m)}
        position=${c}
        className=${t}
        entries=${s}
        headerEntries=${a}
        emptyPlaceholder=${r}
        scale=${l}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{...o}}
      />
    `,this._current.container)};de.prototype.open=function(e,t,n,i){if(!e)throw new Error("target is missing");if(!t)throw new Error("providers for <"+t+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:r,headerEntries:o,emptyPlaceholder:s}=this._getContext(e,t);this._current={position:n,providerId:t,target:e,entries:r,headerEntries:o,emptyPlaceholder:s,container:this._createContainer({provider:t}),options:i},this._emit("open"),this._bindAutoClose(),this._render()};de.prototype.refresh=function(){if(!this.isOpen())return;const{target:e,providerId:t}=this._current,{entries:n,headerEntries:i,emptyPlaceholder:r}=this._getContext(e,t);this._current={...this._current,entries:n,headerEntries:i,emptyPlaceholder:r},this._emit("refresh"),this._render()};de.prototype._getContext=function(e,t){const n=this._getProviders(t);if(!n||!n.length)throw new Error("provider for <"+t+"> not found");const i=this._getEntries(e,n),r=this._getHeaderEntries(e,n),o=this._getEmptyPlaceholder(n);return{entries:i,headerEntries:r,emptyPlaceholder:o,empty:!(Object.keys(i).length||Object.keys(r).length)}};de.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._current=null)};de.prototype.reset=function(){const e=this._current.container;Tp(null,e),Dn(e)};de.prototype._emit=function(e,t){this._eventBus.fire(`popupMenu.${e}`,t)};de.prototype._onOpened=function(){this._emit("opened")};de.prototype._onClosed=function(){this._emit("closed")};de.prototype._createContainer=function(e){var t=this._canvas,n=t.getContainer();const i=Pe(`<div class="djs-popup-parent djs-scrollable" data-popup=${e.provider}></div>`);return n.appendChild(i),i};de.prototype._bindAutoClose=function(){this._eventBus.once(Op,this.close,this)};de.prototype._unbindAutoClose=function(){this._eventBus.off(Op,this.close,this)};de.prototype._updateScale=function(){var e=this._canvas.zoom(),t=this._config.scale,n,i,r=e;return t!==!0&&(t===!1?(n=1,i=1):(n=t.min,i=t.max),Ue(n)&&e<n&&(r=n),Ue(i)&&e>i&&(r=i)),r};de.prototype._ensureVisible=function(e,t){var n=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect(),r={},o=t.x,s=t.y;return t.x+i.width>n.width&&(r.x=!0),t.y+i.height>n.height&&(r.y=!0),r.x&&r.y?(o=t.x-i.width,s=t.y-i.height):r.x?(o=t.x-i.width,s=t.y):r.y&&t.y<i.height?(o=t.x,s=10):r.y&&(o=t.x,s=t.y-i.height),t.y<n.top&&(s=t.y+i.height),{x:o,y:s}};de.prototype.isEmpty=function(e,t){if(!e)throw new Error("target is missing");if(!t)throw new Error("provider ID is missing");const n=this._getProviders(t);return!n||!n.length?!0:this._getContext(e,t).empty};de.prototype.registerProvider=function(e,t,n){n||(n=t,t=mm),this._eventBus.on("popupMenu.getProviders."+e,t,function(i){i.providers.push(n)})};de.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"popupMenu.getProviders."+e,providers:[]});return this._eventBus.fire(t),t.providers};de.prototype._getEntries=function(e,t){var n={};return x(t,function(i){if(!i.getPopupMenuEntries){x(i.getEntries(e),function(o){var s=o.id;if(!s)throw new Error("entry ID is missing");n[s]=Dt(o,["id"])});return}var r=i.getPopupMenuEntries(e);Qe(r)?n=r(n):x(r,function(o,s){n[s]=o})}),n};de.prototype._getHeaderEntries=function(e,t){var n={};return x(t,function(i){if(!i.getPopupMenuHeaderEntries){if(!i.getHeaderEntries)return;x(i.getHeaderEntries(e),function(o){var s=o.id;if(!s)throw new Error("entry ID is missing");n[s]=Dt(o,["id"])});return}var r=i.getPopupMenuHeaderEntries(e);Qe(r)?n=r(n):x(r,function(o,s){n[s]=o})}),n};de.prototype._getEmptyPlaceholder=function(e){const t=e.find(n=>Qe(n.getEmptyPlaceholder));return t&&t.getEmptyPlaceholder()};de.prototype.isOpen=function(){return!!this._current};de.prototype.trigger=function(e,t,n="click"){if(e.preventDefault(),!t){let r=yi(e.delegateTarget||e.target,".entry",!0),o=He(r,hm);t={id:o,...this._getEntry(o)}}const i=t.action;if(this._emit("trigger",{entry:t,event:e})!==!1){if(Qe(i)){if(n==="click")return i(e,t)}else if(i[n])return i[n](e,t)}};de.prototype._getEntry=function(e){var t=this._current.entries[e]||this._current.headerEntries[e];if(!t)throw new Error("entry not found");return t};const wa={__init__:["popupMenu"],popupMenu:["type",de]};var vm={align:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 2000">
              <line x1="200" y1="150" x2="200" y2="1850" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
              <rect x="500" y="150" width="1300" height="700" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="500" y="1150" width="700" height="700" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,bottom:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="1650" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="350" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="850" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,center:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="900" y1="150" x2="900" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="250" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="500" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,left:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="100" y1="150" x2="100" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="100" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="100" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,right:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="1650" y1="150" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="350" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="850" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,top:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="150" x2="1650" y2="150" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="150" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="150" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,middle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="900" x2="1650" y2="900" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="250" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="500" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`};const Lp=vm;var gm=900;function Fn(e,t,n,i){e.registerProvider(gm,this),this._contextPad=e,this._popupMenu=t,this._translate=n,this._canvas=i}Fn.$inject=["contextPad","popupMenu","translate","canvas"];Fn.prototype.getMultiElementContextPadEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};Fn.prototype._isAllowed=function(e){return!this._popupMenu.isEmpty(e,"align-elements")};Fn.prototype._getEntries=function(){var e=this;return{"align-elements":{group:"align-elements",title:e._translate("Align elements"),html:`<div class="entry">${Lp.align}</div>`,action:{click:function(t,n){var i=e._getMenuPosition(n);S(i,{cursor:{x:t.x,y:t.y}}),e._popupMenu.open(n,"align-elements",i)}}}}};Fn.prototype._getMenuPosition=function(e){var t=5,n=this._contextPad.getPad(e).html,i=n.getBoundingClientRect(),r={x:i.left,y:i.bottom+t};return r};var ym=["left","center","right","top","middle","bottom"];function xi(e,t,n,i){this._alignElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",this)}xi.$inject=["popupMenu","alignElements","translate","rules"];xi.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};xi.prototype._isAllowed=function(e){return this._rules.allowed("elements.align",{elements:e})};xi.prototype._getEntries=function(e){var t=this._alignElements,n=this._translate,i=this._popupMenu,r={};return x(ym,function(o){r["align-elements-"+o]={group:"align",title:n("Align elements "+o),className:"bjs-align-elements-menu-entry",imageHtml:Lp[o],action:function(){t.trigger(e,o),i.close()}}}),r};function et(e){C.call(this,e),this.init()}et.$inject=["eventBus"];O(et,C);et.prototype.addRule=function(e,t,n){var i=this;typeof e=="string"&&(e=[e]),e.forEach(function(r){i.canExecute(r,t,function(o,s,a){return n(o)},!0)})};et.prototype.init=function(){};function Lr(e){et.call(this,e)}Lr.$inject=["eventBus"];O(Lr,et);Lr.prototype.init=function(){this.addRule("elements.align",function(e){var t=e.elements,n=K(t,function(i){return!(i.waypoints||i.host||i.labelTarget)});return n=kr(n),n.length<2?!1:n})};const _m={__depends__:[Kh,Ip,wa],__init__:["alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements"],alignElementsContextPadProvider:["type",Fn],alignElementsMenuProvider:["type",xi],bpmnAlignElements:["type",Lr]};var bm=10,Bp=50,Em=250;function Sa(e,t,n,i){for(var r;r=xm(e,n,t);)n=i(t,n,r);return n}function Pa(e){return function(t,n,i){var r={x:n.x,y:n.y};return["x","y"].forEach(function(o){var s=e[o];if(s){var a=o==="x"?"width":"height",c=s.margin,l=s.minDistance;c<0?r[o]=Math.min(i[o]+c-t[a]/2,n[o]-l+c):r[o]=Math.max(i[o]+i[a]+c+t[a]/2,n[o]+l+c)}}),r}}function xm(e,t,n){var i={x:t.x-n.width/2,y:t.y-n.height/2,width:n.width,height:n.height},r=Sm(e);return ue(r,function(o){if(o===n)return!1;var s=Ie(o,i,bm);return s==="intersect"})}function wm(e,t){t||(t={});function n(m){return m.source===e?1:-1}var i=t.defaultDistance||Bp,r=t.direction||"e",o=t.filter,s=t.getWeight||n,a=t.maxDistance||Em,c=t.reference||"start";o||(o=Tm);function l(m,h){return r==="n"?c==="start"?B(m).top-B(h).bottom:c==="center"?B(m).top-V(h).y:B(m).top-B(h).top:r==="w"?c==="start"?B(m).left-B(h).right:c==="center"?B(m).left-V(h).x:B(m).left-B(h).left:r==="s"?c==="start"?B(h).top-B(m).bottom:c==="center"?V(h).y-B(m).bottom:B(h).bottom-B(m).bottom:c==="start"?B(h).left-B(m).right:c==="center"?V(h).x-B(m).right:B(h).right-B(m).right}var p=e.incoming.filter(o).map(function(m){var h=s(m),v=h<0?l(m.source,e):l(e,m.source);return{id:m.source.id,distance:v,weight:h}}),u=e.outgoing.filter(o).map(function(m){var h=s(m),v=h>0?l(e,m.target):l(m.target,e);return{id:m.target.id,distance:v,weight:h}}),d=p.concat(u).reduce(function(m,h){return m[h.id+"__weight_"+h.weight]=h,m},{}),f=Xt(d,function(m,h){var v=h.distance,b=h.weight;return v<0||v>a||(m[String(v)]||(m[String(v)]=0),m[String(v)]+=1*b,(!m.distance||m[m.distance]<m[String(v)])&&(m.distance=v)),m},{});return f.distance||i}function Sm(e){var t=_o(e);return e.host&&(t=t.concat(_o(e.host))),e.attachers&&(t=t.concat(e.attachers.reduce(function(n,i){return n.concat(_o(i))},[]))),t}function _o(e){return Cm(e).concat(Pm(e))}function Pm(e){return e.incoming.map(function(t){return t.source})}function Cm(e){return e.outgoing.map(function(t){return t.target})}function Tm(){return!0}var Rm=100;function Np(e,t,n){e.on("autoPlace",Rm,function(i){var r=i.shape,o=i.source;return km(o,r)}),e.on("autoPlace.end",function(i){n.scrollToElement(i.shape)}),this.append=function(i,r,o){e.fire("autoPlace.start",{source:i,shape:r});var s=e.fire("autoPlace",{source:i,shape:r}),a=t.appendShape(i,r,s,i.parent,o);return e.fire("autoPlace.end",{source:i,shape:a}),a}}Np.$inject=["eventBus","modeling","canvas"];function km(e,t,n){n||(n={});var i=n.defaultDistance||Bp,r=V(e),o=B(e);return{x:o.right+i+t.width/2,y:r.y}}function jp(e,t){e.on("autoPlace.end",500,function(n){t.select(n.shape)})}jp.$inject=["eventBus","selection"];const Mm={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",Np],autoPlaceSelectionBehavior:["type",jp]};function Hp(e,t){if(g(t,"bpmn:TextAnnotation"))return Im(e,t);if(X(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"]))return Am(e,t);if(g(t,"bpmn:FlowNode"))return Dm(e,t)}function Dm(e,t){var n=B(e),i=V(e),r=$r(e),o=r?{directionHint:"e",minDistance:80,baseOrientation:"left",boundaryOrientation:"top",start:"top",end:"bottom"}:{directionHint:"s",minDistance:90,baseOrientation:"top",boundaryOrientation:"left",start:"left",end:"right"},s=wm(e,{filter:function(f){return g(f,"bpmn:SequenceFlow")},direction:o.directionHint}),a=30,c=o.minDistance,l=o.baseOrientation;g(e,"bpmn:BoundaryEvent")&&(l=Ie(e,e.host,-25),l.indexOf(o.boundaryOrientation)!==-1&&(a*=-1));var p=r?{x:n.right+s+t.width/2,y:i.y+ic(l,c,o)}:{x:i.x+ic(l,c,o),y:n.bottom+s+t.height/2},u={margin:a,minDistance:c},d=r?{y:u}:{x:u};return Sa(e,t,p,Pa(d))}function ic(e,t,n){return e.includes(n.start)?-1*t:e.includes(n.end)?t:0}function Im(e,t){var n=B(e),i=$r(e),r=i?{x:n.right+t.width/2,y:n.top-50-t.height/2}:{x:n.right+50+t.width/2,y:n.bottom+t.height/2};se(e)&&(r=V(e),i?(r.x+=100,r.y-=50):(r.x+=100,r.y+=50));var o={margin:i?-30:30,minDistance:20},s=i?{y:o}:{x:o};return Sa(e,t,r,Pa(s))}function Am(e,t){var n=B(e),i=$r(e),r=i?{x:n.right-10+t.width/2,y:n.bottom+40+t.width/2}:{x:n.left-40-t.width/2,y:n.bottom-10+t.height/2},o={margin:30,minDistance:30},s=i?{x:o}:{y:o};return Sa(e,t,r,Pa(s))}function Vp(e){e.on("autoPlace",function(t){var n=t.shape,i=t.source;return Hp(i,n)})}Vp.$inject=["eventBus"];const Ca={__depends__:[Mm],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",Vp]};function At(e,t,n,i){C.call(this,e),this._elementRegistry=t,this._modeling=n,this._rules=i;var r=this;this.postExecuted(["shape.create"],function(o){var s=o.context,a=s.hints||{},c=s.shape,l=s.parent||s.newParent;a.autoResize!==!1&&r._expand([c],l)}),this.postExecuted(["elements.move"],function(o){var s=o.context,a=ha(ma(s.closure.topLevel)),c=s.hints,l=c?c.autoResize:!0;if(l!==!1){var p=Mr(a,function(u){return u.parent.id});x(p,function(u,d){J(l)&&(u=u.filter(function(f){return ue(l,Tt({id:f.id}))})),r._expand(u,d)})}}),this.postExecuted(["shape.toggleCollapse"],function(o){var s=o.context,a=s.hints,c=s.shape;a&&a.autoResize===!1||c.collapsed||r._expand(c.children||[],c)}),this.postExecuted(["shape.resize"],function(o){var s=o.context,a=s.hints,c=s.shape,l=c.parent;a&&a.autoResize===!1||l&&r._expand([c],l)})}At.$inject=["eventBus","elementRegistry","modeling","rules"];O(At,C);At.prototype._getOptimalBounds=function(e,t){var n=this.getOffset(t),i=this.getPadding(t),r=B(Xe(e)),o=B(t),s={};return r.top-o.top<i.top&&(s.top=r.top-n.top),r.left-o.left<i.left&&(s.left=r.left-n.left),o.right-r.right<i.right&&(s.right=r.right+n.right),o.bottom-r.bottom<i.bottom&&(s.bottom=r.bottom+n.bottom),va(S({},o,s))};At.prototype._expand=function(e,t){typeof t=="string"&&(t=this._elementRegistry.get(t));var n=this._rules.allowed("element.autoResize",{elements:e,target:t});if(n){var i=this._getOptimalBounds(e,t);if($m(i,t)){var r=Om(yt(t,["x","y","width","height"]),i);this.resize(t,i,{autoResize:r});var o=t.parent;o&&this._expand([t],o)}}};At.prototype.getOffset=function(e){return{top:60,bottom:60,left:100,right:100}};At.prototype.getPadding=function(e){return{top:2,bottom:2,left:15,right:15}};At.prototype.resize=function(e,t,n){this._modeling.resizeShape(e,t,null,n)};function $m(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function Om(e,t){var n="";return e=B(e),t=B(t),e.top>t.top&&(n=n.concat("n")),e.right<t.right&&(n=n.concat("w")),e.bottom<t.bottom&&(n=n.concat("s")),e.left>t.left&&(n=n.concat("e")),n}function Br(e){e.invoke(At,this)}Br.$inject=["injector"];O(Br,At);Br.prototype.resize=function(e,t,n){g(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,n):this._modeling.resizeShape(e,t,null,n)};function wi(e){et.call(this,e);var t=this;this.addRule("element.autoResize",function(n){return t.canResize(n.elements,n.target)})}wi.$inject=["eventBus"];O(wi,et);wi.prototype.canResize=function(e,t){return!1};function Nr(e,t){wi.call(this,e),this._modeling=t}O(Nr,wi);Nr.$inject=["eventBus","modeling"];Nr.prototype.canResize=function(e,t){if(g(t.di,"bpmndi:BPMNPlane")||!g(t,"bpmn:Participant")&&!g(t,"bpmn:Lane")&&!g(t,"bpmn:SubProcess"))return!1;var n=!0;return x(e,function(i){if(g(i,"bpmn:Lane")||ee(i)){n=!1;return}}),n};const Lm={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",Br],bpmnAutoResizeProvider:["type",Nr]};var rc=1500;function Fp(e,t,n){var i=this,r=n.get("dragging",!1);function o(s){if(!s.hover){var a=s.originalEvent,c=i._findTargetGfx(a),l=c&&e.get(c);c&&l&&(s.stopPropagation(),r.hover({element:l,gfx:c}),r.move(a))}}r&&t.on("drag.start",function(s){t.once("drag.move",rc,function(a){o(a)})}),function(){var s,a;t.on("element.hover",function(c){s=c.gfx,a=c.element}),t.on("element.hover",rc,function(c){a&&t.fire("element.out",{element:a,gfx:s})}),t.on("element.out",function(){s=null,a=null})}(),this._findTargetGfx=function(s){var a,c;if(s instanceof MouseEvent)return a=ui(s),c=document.elementFromPoint(a.x,a.y),Bm(c)}}Fp.$inject=["elementRegistry","eventBus","injector"];function Bm(e){return yi(e,"svg, .djs-element",!0)}const Nm={__init__:["hoverFix"],hoverFix:["type",Fp]};var En=Math.round,oc="djs-drag-active";function ln(e){e.preventDefault()}function jm(e){return typeof TouchEvent<"u"&&e instanceof TouchEvent}function Hm(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function zp(e,t,n,i){var r={threshold:5,trapClick:!0},o;function s(y){var _=t.viewbox(),w=t._container.getBoundingClientRect();return{x:_.x+(y.x-w.left)/_.scale,y:_.y+(y.y-w.top)/_.scale}}function a(y,_){_=_||o;var w=e.createEvent(S({},_.payload,_.data,{isTouch:_.isTouch}));return e.fire("drag."+y,w)===!1?!1:e.fire(_.prefix+"."+y,w)}function c(y){var _=y.filter(function(w){return i.get(w.id)});_.length&&n.select(_)}function l(y,_){var w=o.payload,P=o.displacement,R=o.globalStart,j=ui(y),F=Rt(j,R),T=o.localStart,A=s(j),H=Rt(A,T);if(!o.active&&(_||Hm(F)>o.threshold)){if(S(w,{x:En(T.x+P.x),y:En(T.y+P.y),dx:0,dy:0},{originalEvent:y}),a("start")===!1)return v();o.active=!0,o.keepSelection||(w.previousSelection=n.get(),n.select(null)),o.cursor&&hp(o.cursor),t.addMarker(t.getRootElement(),oc)}vo(y),o.active&&(S(w,{x:En(A.x+P.x),y:En(A.y+P.y),dx:En(H.x),dy:En(H.y)},{originalEvent:y}),a("move"))}function p(y){var _,w=!0;o.active&&(y&&(o.payload.originalEvent=y,vo(y)),w=a("end")),w===!1&&a("rejected"),_=b(w!==!0),a("ended",_)}function u(y){Ee("Escape",y)&&(ln(y),v())}function d(y){var _;o.active&&(_=qf(e),setTimeout(_,400),ln(y)),p(y)}function f(y){l(y)}function m(y){var _=o.payload;_.hoverGfx=y.gfx,_.hover=y.element,a("hover")}function h(y){a("out");var _=o.payload;_.hoverGfx=null,_.hover=null}function v(y){var _;if(o){var w=o.active;w&&a("cancel"),_=b(y),w&&a("canceled",_)}}function b(y){var _,w;a("cleanup"),Yf(),o.trapClick?w=d:w=p,G.unbind(document,"mousemove",l),G.unbind(document,"dragstart",ln),G.unbind(document,"selectstart",ln),G.unbind(document,"mousedown",w,!0),G.unbind(document,"mouseup",w,!0),G.unbind(document,"keyup",u),G.unbind(document,"touchstart",f,!0),G.unbind(document,"touchcancel",v,!0),G.unbind(document,"touchmove",l,!0),G.unbind(document,"touchend",p,!0),e.off("element.hover",m),e.off("element.out",h),t.removeMarker(t.getRootElement(),oc);var P=o.payload.previousSelection;return y!==!1&&P&&!n.get().length&&c(P),_=o,o=null,_}function E(y,_,w,P){o&&v(!1),typeof _=="string"&&(P=w,w=_,_=null),P=S({},r,P||{});var R=P.data||{},j,F,T,A,H;P.trapClick?A=d:A=p,y?(j=fp(y)||y,F=ui(y),vo(y),j.type==="dragstart"&&ln(j)):(j=null,F={x:0,y:0}),T=s(F),_||(_=T),H=jm(j),o=S({prefix:w,data:R,payload:{},globalStart:F,displacement:Rt(_,T),localStart:T,isTouch:H},P),P.manual||(H?(G.bind(document,"touchstart",f,!0),G.bind(document,"touchcancel",v,!0),G.bind(document,"touchmove",l,!0),G.bind(document,"touchend",p,!0)):(G.bind(document,"mousemove",l),G.bind(document,"dragstart",ln),G.bind(document,"selectstart",ln),G.bind(document,"mousedown",A,!0),G.bind(document,"mouseup",A,!0)),G.bind(document,"keyup",u),e.on("element.hover",m),e.on("element.out",h)),a("init"),P.autoActivate&&l(y,!0)}e.on("diagram.destroy",v),this.init=E,this.move=l,this.hover=m,this.out=h,this.end=p,this.cancel=v,this.context=function(){return o},this.setOptions=function(y){S(r,y)}}zp.$inject=["eventBus","canvas","selection","elementRegistry"];const $t={__depends__:[Nm,It],dragging:["type",zp]};function zn(e,t,n){this._canvas=n,this._opts=S({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},e);var i=this;t.on("drag.move",function(r){var o=i._toBorderPoint(r);i.startScroll(o)}),t.on(["drag.cleanup"],function(){i.stopScroll()})}zn.$inject=["config.autoScroll","eventBus","canvas"];zn.prototype.startScroll=function(e){var t=this._canvas,n=this._opts,i=this,r=t.getContainer().getBoundingClientRect(),o=[e.x,e.y,r.width-e.x,r.height-e.y];this.stopScroll();for(var s=0,a=0,c=0;c<4;c++)Vm(o[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(c===0?s=n.scrollStep:c==1?a=n.scrollStep:c==2?s=-n.scrollStep:c==3&&(a=-n.scrollStep));(s!==0||a!==0)&&(t.scroll({dx:s,dy:a}),this._scrolling=setTimeout(function(){i.startScroll(e)},n.scrollRepeatTimeout))};function Vm(e,t,n){return t<e&&e<n}zn.prototype.stopScroll=function(){clearTimeout(this._scrolling)};zn.prototype.setOptions=function(e){this._opts=S({},this._opts,e)};zn.prototype._toBorderPoint=function(e){var t=this._canvas._container.getBoundingClientRect(),n=ui(e.originalEvent);return{x:n.x-t.left,y:n.y-t.top}};const Fm={__depends__:[$t],__init__:["autoScroll"],autoScroll:["type",zn]};function Ta(e){this._commandStack=e.get("commandStack",!1)}Ta.$inject=["injector"];Ta.prototype.allowed=function(e,t){var n=!0,i=this._commandStack;return i&&(n=i.canExecute(e,t)),n===void 0?!0:n};const bt={__init__:["rules"],rules:["type",Ta]};var Ui=Math.round,zm=Math.max;function Gm(e,t){var n=e.x,i=e.y;return[["M",n,i],["m",0,-t],["a",t,t,0,1,1,0,2*t],["a",t,t,0,1,1,0,-2*t],["z"]]}function Wm(e){var t=[];return e.forEach(function(n,i){t.push([i===0?"M":"L",n.x,n.y])}),t}var Gp=10;function Um(e,t){var n,i;for(n=0;i=e[n];n++)if(mp(i,t)<=Gp)return{point:e[n],bendpoint:!0,index:n};return null}function Xm(e,t){var n=Zf(Gm(t,Gp),Wm(e)),i=n[0],r=n[n.length-1],o;return i?i!==r?i.segment2!==r.segment2?(o=zm(i.segment2,r.segment2)-1,{point:e[o],bendpoint:!0,index:o}):{point:{x:Ui(i.x+r.x)/2,y:Ui(i.y+r.y)/2},index:i.segment2}:{point:{x:Ui(i.x),y:Ui(i.y)},index:i.segment2}:null}function Wo(e,t){return Um(e,t)||Xm(e,t)}function Wp(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function ac(e){return Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x))}function Km(e,t){return t?{x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y}:e}function Ym(e,t,n){var i=[{n:e[0]-n[0],lambda:t[0]},{n:e[1]-n[1],lambda:t[1]}],r=i[0].n*t[0]+i[1].n*t[1],o=i[0].lambda*t[0]+i[1].lambda*t[1];return-r/o}function Ra(e,t){var n=t[0],i=t[1],r={x:i.x-n.x,y:i.y-n.y},o=Ym([n.x,n.y],[r.x,r.y],[e.x,e.y]);return{x:n.x+o*r.x,y:n.y+o*r.y}}function Up(e,t){var n=Ra(e,t),i={x:n.x-e.x,y:n.y-e.y};return Wp(i)}function yr(e,t){return Wp({x:e.x-t.x,y:e.y-t.y})}var Xp="djs-bendpoint",Kp="djs-segment-dragger";function qm(e,t){var n=ui(t),i=e._container.getBoundingClientRect(),r;r={x:i.left,y:i.top};var o=e.viewbox();return{x:o.x+(n.x-r.x)/o.scale,y:o.y+(n.y-r.y)/o.scale}}function Uo(e,t,n){var i=qm(e,n),r=Wo(t,i);return r}function Xo(e,t){var n=oe("g");ce(n).add(Xp),ae(e,n);var i=oe("circle");U(i,{cx:0,cy:0,r:4}),ce(i).add("djs-visual"),ae(n,i);var r=oe("circle");return U(r,{cx:0,cy:0,r:10}),ce(r).add("djs-hit"),ae(n,r),t&&ce(n).add(t),n}function Zm(e,t,n,i){var r=oe("g");ae(e,r);var o=18,s=6,a=11,c=Qm(t,n,i),l=s+a,p=oe("rect");U(p,{x:-o/2,y:-s/2,width:o,height:s}),ce(p).add("djs-visual"),ae(r,p);var u=oe("rect");return U(u,{x:-c/2,y:-l/2,width:c,height:l}),ce(u).add("djs-hit"),ae(r,u),Jf(r,i==="v"?90:0),r}function Yp(e,t,n){var i=oe("g"),r=Lo(t,n),o=Pt(t,n);return ae(e,i),Zm(i,t,n,o),ce(i).add(Kp),ce(i).add(o==="h"?"horizontal":"vertical"),Le(i,r.x,r.y),i}function Ko(e){return Math.abs(Math.round(e*2/3))}function Jm(e,t){var n=ev(e,t);return Ra(e,n)}function Qm(e,t,n){var i=t.x-e.x,r=t.y-e.y;return Ko(n==="h"?i:r)}function ev(e,t){for(var n=t.waypoints,i=1/0,r,o=0;o<n.length-1;o++){var s=n[o],a=n[o+1],c=Up(e,[s,a]);c<i&&(i=c,r=o)}return[n[r],n[r+1]]}function qp(e,t,n,i,r){function o(y,_,w){var P=y.index,R=y.point,j,F,T,A,H,z;return P<=0||y.bendpoint?!1:(j=_[P-1],F=_[P],T=Lo(j,F),A=Pt(j,F),H=Math.abs(R.x-T.x),z=Math.abs(R.y-T.y),A&&H<=w&&z<=w)}function s(y,_){var w=y.waypoints,P,R,j,F;return _.index<=0||_.bendpoint||(P={start:w[_.index-1],end:w[_.index]},R=Pt(P.start,P.end),!R)?null:(R==="h"?j=P.end.x-P.start.x:j=P.end.y-P.start.y,F=Ko(j)/2,F)}function a(y,_){var w=_.waypoints,P=Uo(t,w,y),R;if(P)return R=s(_,P),o(P,w,R)?r.start(y,_,P.index):i.start(y,_,P.index,!P.bendpoint),!0}function c(y,_,w){G.bind(y,_,function(P){n.triggerMouseEvent(_,P,w),P.stopPropagation()})}function l(y,_){var w=t.getLayer("overlays"),P=xe('.djs-bendpoints[data-element-id="'+pi(y.id)+'"]',w);return!P&&_&&(P=oe("g"),U(P,{"data-element-id":y.id}),ce(P).add("djs-bendpoints"),ae(w,P),c(P,"mousedown",y),c(P,"click",y),c(P,"dblclick",y)),P}function p(y,_){return xe('.djs-segment-dragger[data-segment-idx="'+y+'"]',_)}function u(y,_){_.waypoints.forEach(function(w,P){var R=Xo(y);ae(y,R),Le(R,w.x,w.y)}),Xo(y,"floating")}function d(y,_){for(var w=_.waypoints,P,R,j,F=1;F<w.length;F++)P=w[F-1],R=w[F],Pt(P,R)&&(j=Yp(y,P,R),U(j,{"data-segment-idx":F}),c(j,"mousemove",_))}function f(y){x(Xs("."+Xp,y),function(_){Be(_)})}function m(y){x(Xs("."+Kp,y),function(_){Be(_)})}function h(y){var _=l(y);return _||(_=l(y,!0),u(_,y),d(_,y)),_}function v(y){var _=l(y);_&&(m(_),f(_),d(_,y),u(_,y))}function b(y,_){var w=xe(".floating",y),P=_.point;w&&Le(w,P.x,P.y)}function E(y,_,w){var P=p(_.index,y),R=w[_.index-1],j=w[_.index],F=_.point,T=Lo(R,j),A=Pt(R,j),H,z;P&&(H=tv(P),z={x:F.x-T.x,y:F.y-T.y},A==="v"&&(z={x:z.y,y:z.x}),Le(H,z.x,z.y))}e.on("connection.changed",function(y){v(y.element)}),e.on("connection.remove",function(y){var _=l(y.element);_&&Be(_)}),e.on("element.marker.update",function(y){var _=y.element,w;_.waypoints&&(w=h(_),y.add?ce(w).add(y.marker):ce(w).remove(y.marker))}),e.on("element.mousemove",function(y){var _=y.element,w=_.waypoints,P,R;if(w){if(P=l(_,!0),R=Uo(t,w,y.originalEvent),!R)return;b(P,R),R.bendpoint||E(P,R,w)}}),e.on("element.mousedown",function(y){if(ga(y)){var _=y.originalEvent,w=y.element;if(w.waypoints)return a(_,w)}}),e.on("selection.changed",function(y){var _=y.newSelection,w=_[0];w&&w.waypoints&&h(w)}),e.on("element.hover",function(y){var _=y.element;_.waypoints&&(h(_),n.registerEvent(y.gfx,"mousemove","element.mousemove"))}),e.on("element.out",function(y){n.unregisterEvent(y.gfx,"mousemove","element.mousemove")}),e.on("element.updateId",function(y){var _=y.element,w=y.newId;if(_.waypoints){var P=l(_);P&&U(P,{"data-element-id":w})}}),this.addHandles=h,this.updateHandles=v,this.getBendpointsContainer=l,this.getSegmentDragger=p}qp.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function tv(e){return xe(".djs-visual",e)}var sc=Math.round,pn="reconnectStart",un="reconnectEnd",Zn="updateWaypoints";function ka(e,t,n,i,r,o){this._injector=e,this.start=function(s,a,c,l){var p=n.getGraphics(a),u=a.source,d=a.target,f=a.waypoints,m;!l&&c===0?m=pn:!l&&c===f.length-1?m=un:m=Zn;var h=m===Zn?"connection.updateWaypoints":"connection.reconnect",v=r.allowed(h,{connection:a,source:u,target:d});v===!1&&(v=r.allowed(h,{connection:a,source:d,target:u})),v!==!1&&i.init(s,"bendpoint.move",{data:{connection:a,connectionGfx:p,context:{allowed:v,bendpointIndex:c,connection:a,source:u,target:d,insert:l,type:m}}})},t.on("bendpoint.move.hover",function(s){var a=s.context,c=a.connection,l=c.source,p=c.target,u=s.hover,d=a.type;a.hover=u;var f;if(u){var m=d===Zn?"connection.updateWaypoints":"connection.reconnect";if(f=a.allowed=r.allowed(m,{connection:c,source:d===pn?u:l,target:d===un?u:p}),f){a.source=d===pn?u:l,a.target=d===un?u:p;return}f===!1&&(f=a.allowed=r.allowed(m,{connection:c,source:d===un?u:p,target:d===pn?u:l})),f&&(a.source=d===un?u:p,a.target=d===pn?u:l)}}),t.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(s){var a=s.context,c=a.type;a.hover=null,a.source=null,a.target=null,c!==Zn&&(a.allowed=!1)}),t.on("bendpoint.move.end",function(s){var a=s.context,c=a.allowed,l=a.bendpointIndex,p=a.connection,u=a.insert,d=p.waypoints.slice(),f=a.source,m=a.target,h=a.type,v=a.hints||{},b={x:sc(s.x),y:sc(s.y)};if(!c)return!1;h===Zn?(u?d.splice(l,0,b):d[l]=b,v.bendpointMove={insert:u,bendpointIndex:l},d=this.cropWaypoints(p,d),o.updateWaypoints(p,Qf(d),v)):(h===pn?(v.docking="source",_r(a)&&(v.docking="target",v.newWaypoints=d.reverse())):h===un&&(v.docking="target",_r(a)&&(v.docking="source",v.newWaypoints=d.reverse())),o.reconnect(p,f,m,b,v))},this)}ka.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];ka.prototype.cropWaypoints=function(e,t){var n=this._injector.get("connectionDocking",!1);if(!n)return t;var i=e.waypoints;return e.waypoints=t,e.waypoints=n.getCroppedWaypoints(e),t=e.waypoints,e.waypoints=i,t};function _r(e){var t=e.hover,n=e.source,i=e.target,r=e.type;if(r===pn)return t&&i&&t===i&&n!==i;if(r===un)return t&&n&&t===n&&n!==i}var nv="reconnectStart",iv="reconnectEnd",cc="updateWaypoints",Jn="connect-ok",Xi="connect-not-ok",lc="connect-hover",pc="djs-updating",uc="djs-dragging",dc=1100;function Zp(e,t,n,i){this._injector=t;var r=t.get("connectionPreview",!1);n.on("bendpoint.move.start",function(o){var s=o.context,a=s.bendpointIndex,c=s.connection,l=s.insert,p=c.waypoints,u=p.slice();s.waypoints=p,l&&u.splice(a,0,{x:o.x,y:o.y}),c.waypoints=u;var d=s.draggerGfx=Xo(i.getLayer("overlays"));ce(d).add("djs-dragging"),i.addMarker(c,uc),i.addMarker(c,pc)}),n.on("bendpoint.move.hover",function(o){var s=o.context,a=s.allowed,c=s.hover,l=s.type;if(c){if(i.addMarker(c,lc),l===cc)return;a?(i.removeMarker(c,Xi),i.addMarker(c,Jn)):a===!1&&(i.removeMarker(c,Jn),i.addMarker(c,Xi))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],dc,function(o){var s=o.context,a=s.hover,c=s.target;a&&(i.removeMarker(a,lc),i.removeMarker(a,c?Jn:Xi))}),n.on("bendpoint.move.move",function(o){var s=o.context,a=s.allowed,c=s.bendpointIndex,l=s.draggerGfx,p=s.hover,u=s.type,d=s.connection,f=d.source,m=d.target,h=d.waypoints.slice(),v={x:o.x,y:o.y},b=s.hints||{},E={};r&&(b.connectionStart&&(E.connectionStart=b.connectionStart),b.connectionEnd&&(E.connectionEnd=b.connectionEnd),u===nv?_r(s)?(E.connectionEnd=E.connectionEnd||v,E.source=m,E.target=p||f,h=h.reverse()):(E.connectionStart=E.connectionStart||v,E.source=p||f,E.target=m):u===iv?_r(s)?(E.connectionStart=E.connectionStart||v,E.source=p||m,E.target=f,h=h.reverse()):(E.connectionEnd=E.connectionEnd||v,E.source=f,E.target=p||m):(E.noCropping=!0,E.noLayout=!0,h[c]=v),u===cc&&(h=e.cropWaypoints(d,h)),E.waypoints=h,r.drawPreview(s,a,E)),Le(l,o.x,o.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],dc,function(o){var s=o.context,a=s.connection,c=s.draggerGfx,l=s.hover,p=s.target,u=s.waypoints;a.waypoints=u,Be(c),i.removeMarker(a,pc),i.removeMarker(a,uc),l&&(i.removeMarker(l,Jn),i.removeMarker(l,p?Jn:Xi)),r&&r.cleanUp(s)})}Zp.$inject=["bendpointMove","injector","eventBus","canvas"];var fc="connect-hover",hc="djs-updating";function mc(e,t,n){return Ma(e,t,e[t]+n)}function Ma(e,t,n){return{x:t==="x"?n:e.x,y:t==="y"?n:e.y}}function rv(e,t,n,i){var r=Math.max(t[i],n[i]),o=Math.min(t[i],n[i]),s=20,a=Math.min(Math.max(o+s,e[i]),r-s);return Ma(t,i,a)}function Jp(e){return e==="x"?"y":"x"}function vc(e,t,n){var i,r;return e.original?e.original:(i=V(t),r=Jp(n),Ma(e,r,i[r]))}function Qp(e,t,n,i,r,o){var s=e.get("connectionDocking",!1);this.start=function(u,d,f){var m,h=n.getGraphics(d),v=f-1,b=f,E=d.waypoints,y=E[v],_=E[b],w=Uo(n,E,u),P,R,j;P=Pt(y,_),P&&(R=P==="v"?"x":"y",v===0&&(y=vc(y,d.source,R)),b===E.length-1&&(_=vc(_,d.target,R)),w?j=w.point:j={x:(y.x+_.x)/2,y:(y.y+_.y)/2},m={connection:d,segmentStartIndex:v,segmentEndIndex:b,segmentStart:y,segmentEnd:_,axis:R,dragPosition:j},i.init(u,j,"connectionSegment.move",{cursor:R==="x"?"resize-ew":"resize-ns",data:{connection:d,connectionGfx:h,context:m}}))};function a(u,d){if(!s)return d;var f=u.waypoints,m;return u.waypoints=d,m=s.getCroppedWaypoints(u),u.waypoints=f,m}function c(u){r.update("connection",u.connection,u.connectionGfx)}function l(u,d,f){var m=u.newWaypoints,h=u.segmentStartIndex+d,v=m[h],b=u.segmentEndIndex+d,E=m[b],y=Jp(u.axis),_=rv(f,v,E,y);Le(u.draggerGfx,_.x,_.y)}function p(u,d){var f=0,m=u.filter(function(h,v){return vp(u[v-1],u[v+1],h)?(f=v<=d?f-1:f,!1):!0});return{waypoints:m,segmentOffset:f}}t.on("connectionSegment.move.start",function(u){var d=u.context,f=u.connection,m=n.getLayer("overlays");d.originalWaypoints=f.waypoints.slice(),d.draggerGfx=Yp(m,d.segmentStart,d.segmentEnd),ce(d.draggerGfx).add("djs-dragging"),n.addMarker(f,hc)}),t.on("connectionSegment.move.move",function(u){var d=u.context,f=d.connection,m=d.segmentStartIndex,h=d.segmentEndIndex,v=d.segmentStart,b=d.segmentEnd,E=d.axis,y=d.originalWaypoints.slice(),_=mc(v,E,u["d"+E]),w=mc(b,E,u["d"+E]),P=y.length,R=0;y[m]=_,y[h]=w;var j,F;m<2&&(j=Ie(f.source,_),m===1?j==="intersect"&&(y.shift(),y[0]=_,R--):j!=="intersect"&&(y.unshift(v),R++)),h>P-3&&(F=Ie(f.target,w),h===P-2?F==="intersect"&&(y.pop(),y[y.length-1]=w):F!=="intersect"&&y.push(b)),d.newWaypoints=f.waypoints=a(f,y),l(d,R,u),d.newSegmentStartIndex=m+R,c(u)}),t.on("connectionSegment.move.hover",function(u){u.context.hover=u.hover,n.addMarker(u.hover,fc)}),t.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(u){var d=u.context.hover;d&&n.removeMarker(d,fc)}),t.on("connectionSegment.move.cleanup",function(u){var d=u.context,f=d.connection;d.draggerGfx&&Be(d.draggerGfx),n.removeMarker(f,hc)}),t.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(u){var d=u.context,f=d.connection;f.waypoints=d.originalWaypoints,c(u)}),t.on("connectionSegment.move.end",function(u){var d=u.context,f=d.connection,m=d.newWaypoints,h=d.newSegmentStartIndex;m=m.map(function(w){return{original:w.original,x:Math.round(w.x),y:Math.round(w.y)}});var v=p(m,h),b=v.waypoints,E=a(f,b),y=v.segmentOffset,_={segmentMove:{segmentStartIndex:d.segmentStartIndex,newSegmentStartIndex:h+y}};o.updateWaypoints(f,E,_)})}Qp.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var ov=Math.abs,gc=Math.round;function av(e,t,n){n=n===void 0?10:n;var i,r;for(i=0;i<t.length;i++)if(r=t[i],ov(r-e)<=n)return r}function eu(e){return{x:e.x,y:e.y}}function tu(e){return{x:e.x+e.width,y:e.y+e.height}}function Je(e,t){return!e||isNaN(e.x)||isNaN(e.y)?t:{x:gc(e.x+e.width/2),y:gc(e.y+e.height/2)}}function $n(e,t){var n=e.snapped;return n?typeof t=="string"?n[t]:n.x&&n.y:!1}function ge(e,t,n){if(typeof t!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var i,r=e[t],o=e.snapped=e.snapped||{};return n===!1?o[t]=!1:(o[t]=!0,i=n-r,e[t]+=i,e["d"+t]+=i),r}function nu(e){return e.children||[]}var sv=Math.abs,yc=Math.round,bo=10;function iu(e){function t(o,s){if(J(o)){for(var a=o.length;a--;)if(sv(o[a]-s)<=bo)return o[a]}else{o=+o;var c=s%o;if(c<bo)return s-c;if(c>o-bo)return s-c+o}return s}function n(o,s){if(o.waypoints)return Jm(s,o);if(o.width)return{x:yc(o.width/2+o.x),y:yc(o.height/2+o.y)}}function i(o){var s=o.context,a=s.snapPoints,c=s.connection,l=c.waypoints,p=s.segmentStart,u=s.segmentStartIndex,d=s.segmentEnd,f=s.segmentEndIndex,m=s.axis;if(a)return a;var h=[l[u-1],p,d,l[f+1]];return u<2&&h.unshift(n(c.source,o)),f>l.length-3&&h.unshift(n(c.target,o)),s.snapPoints=a={horizontal:[],vertical:[]},x(h,function(v){v&&(v=v.original||v,m==="y"&&a.horizontal.push(v.y),m==="x"&&a.vertical.push(v.x))}),a}e.on("connectionSegment.move.move",1500,function(o){var s=i(o),a=o.x,c=o.y,l,p;if(s){l=t(s.vertical,a),p=t(s.horizontal,c);var u=a-l,d=c-p;S(o,{dx:o.dx-u,dy:o.dy-d,x:l,y:p}),(u||s.vertical.indexOf(a)!==-1)&&ge(o,"x",l),(d||s.horizontal.indexOf(c)!==-1)&&ge(o,"y",p)}});function r(o){var s=o.snapPoints,a=o.connection.waypoints,c=o.bendpointIndex;if(s)return s;var l=[a[c-1],a[c+1]];return o.snapPoints=s={horizontal:[],vertical:[]},x(l,function(p){p&&(p=p.original||p,s.horizontal.push(p.y),s.vertical.push(p.x))}),s}e.on(["connect.hover","connect.move","connect.end"],1500,function(o){var s=o.context,a=s.hover,c=a&&n(a,o);!se(a)||!c||!c.x||!c.y||(ge(o,"x",c.x),ge(o,"y",c.y))}),e.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(o){var s=o.context,a=r(s),c=s.hover,l=c&&n(c,o),p=o.x,u=o.y,d,f;if(a){d=t(l?a.vertical.concat([l.x]):a.vertical,p),f=t(l?a.horizontal.concat([l.y]):a.horizontal,u);var m=p-d,h=u-f;S(o,{dx:o.dx-m,dy:o.dy-h,x:o.x-m,y:o.y-h}),(m||a.vertical.indexOf(p)!==-1)&&ge(o,"x",d),(h||a.horizontal.indexOf(u)!==-1)&&ge(o,"y",f)}})}iu.$inject=["eventBus"];const cv={__depends__:[$t,bt],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",qp],bendpointMove:["type",ka],bendpointMovePreview:["type",Zp],connectionSegmentMove:["type",Qp],bendpointSnapping:["type",iu]};function ru(e,t,n,i){function r(s,a){return i.allowed("connection.create",{source:s,target:a})}function o(s,a){return r(a,s)}e.on("connect.hover",function(s){var a=s.context,c=a.start,l=s.hover,p;if(a.hover=l,p=a.canExecute=r(c,l),!Bo(p)){if(p!==!1){a.source=c,a.target=l;return}p=a.canExecute=o(c,l),!Bo(p)&&p!==!1&&(a.source=l,a.target=c)}}),e.on(["connect.out","connect.cleanup"],function(s){var a=s.context;a.hover=null,a.source=null,a.target=null,a.canExecute=!1}),e.on("connect.end",function(s){var a=s.context,c=a.canExecute,l=a.connectionStart,p={x:s.x,y:s.y},u=a.source,d=a.target;if(!c)return!1;var f=null,m={connectionStart:Yo(a)?p:l,connectionEnd:Yo(a)?l:p};Mt(c)&&(f=c),a.connection=n.connect(u,d,f,m)}),this.start=function(s,a,c,l){Mt(c)||(l=c,c=V(a)),t.init(s,"connect",{autoActivate:l,data:{shape:a,context:{start:a,connectionStart:c}}})}}ru.$inject=["eventBus","dragging","modeling","rules"];function Yo(e){var t=e.hover,n=e.source,i=e.target;return t&&n&&t===n&&n!==i}var lv=1100,pv=900,_c="connect-ok",bc="connect-not-ok";function ou(e,t,n){var i=e.get("connectionPreview",!1);i&&t.on("connect.move",function(r){var o=r.context,s=o.canExecute,a=o.hover,c=o.source,l=o.start,p=o.startPosition,u=o.target,d=o.connectionStart||p,f=o.connectionEnd||{x:r.x,y:r.y},m=d,h=f;Yo(o)&&(m=f,h=d),i.drawPreview(o,s,{source:c||l,target:u||a,connectionStart:m,connectionEnd:h})}),t.on("connect.hover",pv,function(r){var o=r.context,s=r.hover,a=o.canExecute;a!==null&&n.addMarker(s,a?_c:bc)}),t.on(["connect.out","connect.cleanup"],lv,function(r){var o=r.hover;o&&(n.removeMarker(o,_c),n.removeMarker(o,bc))}),i&&t.on("connect.cleanup",function(r){i.cleanUp(r.context)})}ou.$inject=["injector","eventBus","canvas"];const Da={__depends__:[It,bt,$t],__init__:["connectPreview"],connect:["type",ru],connectPreview:["type",ou]};var uv="djs-dragger";function Ot(e,t,n,i){this._canvas=t,this._graphicsFactory=n,this._elementFactory=i,this._connectionDocking=e.get("connectionDocking",!1),this._layouter=e.get("layouter",!1)}Ot.$inject=["injector","canvas","graphicsFactory","elementFactory"];Ot.prototype.drawPreview=function(e,t,n){n=n||{};var i=e.connectionPreviewGfx,r=e.getConnection,o=n.source,s=n.target,a=n.waypoints,c=n.connectionStart,l=n.connectionEnd,p=n.noLayout,u=n.noCropping,d=n.noNoop,f,m=this;if(i||(i=e.connectionPreviewGfx=this.createConnectionPreviewGfx()),ya(i),r||(r=e.getConnection=dv(function(h,v,b){return m.getConnection(h,v,b)})),t&&(f=r(t,o,s)),!f){!d&&this.drawNoopPreview(i,n);return}f.waypoints=a||[],this._layouter&&!p&&(f.waypoints=this._layouter.layoutConnection(f,{source:o,target:s,connectionStart:c,connectionEnd:l,waypoints:n.waypoints||f.waypoints})),(!f.waypoints||!f.waypoints.length)&&(f.waypoints=[o?V(o):c,s?V(s):l]),this._connectionDocking&&(o||s)&&!u&&(f.waypoints=this._connectionDocking.getCroppedWaypoints(f,o,s)),this._graphicsFactory.drawConnection(i,f,{stroke:"var(--element-dragger-color)"})};Ot.prototype.drawNoopPreview=function(e,t){var n=t.source,i=t.target,r=t.connectionStart||V(n),o=t.connectionEnd||V(i),s=this.cropWaypoints(r,o,n,i),a=this.createNoopConnection(s[0],s[1]);ae(e,a)};Ot.prototype.cropWaypoints=function(e,t,n,i){var r=this._graphicsFactory,o=n&&r.getShapePath(n),s=i&&r.getShapePath(i),a=r.getConnectionPath({waypoints:[e,t]});return e=n&&No(o,a,!0)||e,t=i&&No(s,a,!1)||t,[e,t]};Ot.prototype.cleanUp=function(e){e&&e.connectionPreviewGfx&&Be(e.connectionPreviewGfx)};Ot.prototype.getConnection=function(e){var t=fv(e);return this._elementFactory.createConnection(t)};Ot.prototype.createConnectionPreviewGfx=function(){var e=oe("g");return U(e,{pointerEvents:"none"}),ce(e).add(uv),ae(this._canvas.getActiveLayer(),e),e};Ot.prototype.createNoopConnection=function(e,t){return eh([e,t],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function dv(e){var t={};return function(n){var i=JSON.stringify(n),r=t[i];return r||(r=t[i]=e.apply(null,arguments)),r}}function fv(e){return Mt(e)?e:{}}const hv={__init__:["connectionPreview"],connectionPreview:["type",Ot]},mv=new da("ps");var vv=["marker-start","marker-mid","marker-end"],gv=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Kt(e,t,n,i){this._elementRegistry=e,this._canvas=n,this._styles=i}Kt.$inject=["elementRegistry","eventBus","canvas","styles"];Kt.prototype.cleanUp=function(){console.warn("PreviewSupport#cleanUp is deprecated and will be removed in future versions. You do not need to manually clean up previews anymore. cf. https://github.com/bpmn-io/diagram-js/pull/906")};Kt.prototype.getGfx=function(e){return this._elementRegistry.getGraphics(e)};Kt.prototype.addDragger=function(e,t,n,i="djs-dragger"){n=n||this.getGfx(e);var r=gp(n),o=n.getBoundingClientRect();return this._cloneMarkers(Mn(r),i),U(r,this._styles.cls(i,[],{x:o.top,y:o.left})),ae(t,r),U(r,"data-preview-support-element-id",e.id),r};Kt.prototype.addFrame=function(e,t){var n=oe("rect",{class:"djs-resize-overlay",width:e.width,height:e.height,x:e.x,y:e.y});return ae(t,n),U(n,"data-preview-support-element-id",e.id),n};Kt.prototype._cloneMarkers=function(e,t="djs-dragger",n=e){var i=this;if(e.childNodes)for(var r=0;r<e.childNodes.length;r++)i._cloneMarkers(e.childNodes[r],t,n);Ev(e)&&vv.forEach(function(o){if(U(e,o)){var s=yv(e,o,i._canvas.getContainer());s&&i._cloneMarker(n,e,s,o,t)}})};Kt.prototype._cloneMarker=function(e,t,n,i,r="djs-dragger"){var o=[n.id,r,mv.next()].join("-"),s=xe("marker#"+n.id,e);e=e||this._canvas._svg;var a=s||gp(n);a.id=o,ce(a).add(r);var c=xe(":scope > defs",e);c||(c=oe("defs"),ae(e,c)),ae(c,a);var l=bv(a.id);U(t,i,l)};function yv(e,t,n){var i=_v(U(e,t));return xe("marker#"+i,n||document)}function _v(e){return e.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function bv(e){return"url(#"+e+")"}function Ev(e){return gv.indexOf(e.nodeName)!==-1}const Gn={__init__:["previewSupport"],previewSupport:["type",Kt]},Ki="complex-preview";class au{constructor(t,n,i){this._canvas=t,this._graphicsFactory=n,this._previewSupport=i,this._markers=[]}create(t){this.cleanUp();const{created:n=[],moved:i=[],removed:r=[],resized:o=[]}=t,s=this._canvas.getLayer(Ki);n.filter(a=>!xv(a)).forEach(a=>{let c;se(a)?(c=this._graphicsFactory._createContainer("connection",oe("g")),this._graphicsFactory.drawConnection(Mn(c),a)):(c=this._graphicsFactory._createContainer("shape",oe("g")),this._graphicsFactory.drawShape(Mn(c),a),Le(c,a.x,a.y)),this._previewSupport.addDragger(a,s,c)}),i.forEach(({element:a,delta:c})=>{this._previewSupport.addDragger(a,s,void 0,"djs-dragging"),this._canvas.addMarker(a,"djs-element-hidden"),this._markers.push([a,"djs-element-hidden"]);const l=this._previewSupport.addDragger(a,s);se(a)?Le(l,c.x,c.y):Le(l,a.x+c.x,a.y+c.y)}),r.forEach(a=>{this._previewSupport.addDragger(a,s,void 0,"djs-dragging"),this._canvas.addMarker(a,"djs-element-hidden"),this._markers.push([a,"djs-element-hidden"])}),o.forEach(({shape:a,bounds:c})=>{this._canvas.addMarker(a,"djs-hidden"),this._markers.push([a,"djs-hidden"]),this._previewSupport.addDragger(a,s,void 0,"djs-dragging");const l=this._graphicsFactory._createContainer("shape",oe("g"));this._graphicsFactory.drawShape(Mn(l),a,{width:c.width,height:c.height}),Le(l,c.x,c.y),this._previewSupport.addDragger(a,s,l)})}cleanUp(){ya(this._canvas.getLayer(Ki)),this._markers.forEach(([t,n])=>this._canvas.removeMarker(t,n)),this._markers=[]}show(){this._canvas.showLayer(Ki)}hide(){this._canvas.hideLayer(Ki)}}au.$inject=["canvas","graphicsFactory","previewSupport"];function xv(e){return e.hidden}const wv={__depends__:[Gn],__init__:["complexPreview"],complexPreview:["type",au]};var Ia=["top","bottom","left","right"],Yi=10;function Aa(e,t){C.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],function(r){var o=r.context,s=o.connection,a=s.source,c=s.target,l=o.hints||{};l.createElementsBehavior!==!1&&(n(a),n(c))}),this.postExecuted(["label.create"],function(r){var o=r.context,s=o.shape,a=o.hints||{};a.createElementsBehavior!==!1&&n(s.labelTarget)}),this.postExecuted(["elements.create"],function(r){var o=r.context,s=o.elements,a=o.hints||{};a.createElementsBehavior!==!1&&s.forEach(function(c){n(c)})});function n(r){if(Dr(r)){var o=Cv(r);o&&i(r,o)}}function i(r,o){var s=V(r),a=r.label,c=V(a);if(a.parent){var l=B(r),p;switch(o){case"top":p={x:s.x,y:l.top-Yi-a.height/2};break;case"left":p={x:l.left-Yi-a.width/2,y:s.y};break;case"bottom":p={x:s.x,y:l.bottom+Yi+a.height/2};break;case"right":p={x:l.right+Yi+a.width/2,y:s.y};break}var u=Rt(p,c);t.moveShape(a,u)}}}O(Aa,C);Aa.$inject=["eventBus","modeling"];function Sv(e){var t=e.host,n=V(e),i=Ie(n,t),r;i.indexOf("-")>=0?r=i.split("-"):r=[i];var o=Ia.filter(function(s){return r.indexOf(s)===-1});return o}function Pv(e){var t=V(e),n=[].concat(e.incoming.map(function(i){return i.waypoints[i.waypoints.length-2]}),e.outgoing.map(function(i){return i.waypoints[1]})).map(function(i){return su(t,i)});return n}function Cv(e){var t=V(e.label),n=V(e),i=su(n,t);if(Tv(i)){var r=Pv(e);if(e.host){var o=Sv(e);r=r.concat(o)}var s=Ia.filter(function(a){return r.indexOf(a)===-1});if(s.indexOf(i)===-1)return s[0]}}function su(e,t){return Ie(t,e,5)}function Tv(e){return Ia.indexOf(e)!==-1}function $a(e){C.call(this,e),this.preExecute("shape.append",function(t){var n=t.source,i=t.shape;t.position||(g(i,"bpmn:TextAnnotation")?t.position={x:n.x+n.width/2+75,y:n.y-50-i.height/2}:t.position={x:n.x+n.width+80+i.width/2,y:n.y+n.height/2})},!0)}O($a,C);$a.$inject=["eventBus"];function Oa(e,t){e.invoke(C,this),this.postExecute("shape.move",function(n){var i=n.newParent,r=n.shape,o=K(r.incoming.concat(r.outgoing),function(s){return g(s,"bpmn:Association")});x(o,function(s){t.moveConnection(s,{x:0,y:0},i)})},!0)}O(Oa,C);Oa.$inject=["injector","modeling"];var Ec=500;function jr(e,t){t.invoke(C,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",Ec,function(i){var r=i.elements;r=r.filter(function(o){var s=o.host;return xc(o,s)}),r.length===1&&r.map(function(o){return r.indexOf(o)}).forEach(function(o){var s=r[o];i.elements[o]=n._replaceShape(r[o],s)})},!0),this.preExecute("elements.move",Ec,function(i){var r=i.shapes,o=i.newHost;if(r.length===1){var s=r[0];xc(s,o)&&(i.shapes=[n._replaceShape(s,o)])}},!0)}jr.$inject=["bpmnReplace","injector"];O(jr,C);jr.prototype._replaceShape=function(e,t){var n=Rv(e),i={type:"bpmn:BoundaryEvent",host:t};return n&&(i.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(e,i,{layoutConnection:!1})};function Rv(e){var t=D(e),n=t.eventDefinitions;return n&&n[0]}function xc(e,t){return!ee(e)&&X(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function La(e,t){C.call(this,e);function n(i){return K(i.attachers,function(r){return g(r,"bpmn:BoundaryEvent")})}this.postExecute("connection.create",function(i){var r=i.context.source,o=i.context.target,s=n(o);g(r,"bpmn:EventBasedGateway")&&g(o,"bpmn:ReceiveTask")&&s.length>0&&t.removeElements(s)}),this.postExecute("connection.reconnect",function(i){var r=i.context.oldSource,o=i.context.newSource;g(r,"bpmn:Gateway")&&g(o,"bpmn:EventBasedGateway")&&x(o.outgoing,function(s){var a=s.target,c=n(a);g(a,"bpmn:ReceiveTask")&&c.length>0&&t.removeElements(c)})})}La.$inject=["eventBus","modeling"];O(La,C);function Ba(e,t,n){C.call(this,e),this.preExecute("shape.replace",a,!0),this.postExecuted("shape.replace",c,!0),this.preExecute("connection.create",r,!0),this.postExecuted("connection.delete",i,!0),this.postExecuted("connection.reconnect",o,!0),this.postExecuted("element.updateProperties",s,!0);function i(v){const b=v.source,E=v.target;xn(b)&&Qn(E)&&p(E)}function r(v){const b=v.connection,E=v.source,y=v.target;xn(E)&&qi(y)&&(l(y),d(E,[b]))}function o(v){const b=v.newTarget,E=v.oldSource,y=v.oldTarget;if(y!==b){const _=E;Qn(y)&&p(y),xn(_)&&qi(b)&&l(b)}}function s(v){const{element:b}=v;Qn(b)?(u(b),f(b)):qi(b)&&m(b)}function a(v){const{newData:b,oldShape:E}=v;if(xn(v.oldShape)&&b.eventDefinitionType!=="bpmn:CompensateEventDefinition"||b.type!=="bpmn:BoundaryEvent"){const y=E.outgoing.find(({target:_})=>Qn(_));y&&y.target&&(v._connectionTarget=y.target)}else if(!xn(v.oldShape)&&b.eventDefinitionType==="bpmn:CompensateEventDefinition"&&b.type==="bpmn:BoundaryEvent"){const y=E.outgoing.find(({target:_})=>qi(_));y&&y.target&&(v._connectionTarget=y.target),h(E)}}function c(v){const{_connectionTarget:b,newShape:E}=v;b&&t.connect(E,b)}function l(v){t.updateProperties(v,{isForCompensation:!0})}function p(v){t.updateProperties(v,{isForCompensation:void 0})}function u(v){for(const b of v.incoming)n.canConnect(b.source,v)||t.removeConnection(b);for(const b of v.outgoing)n.canConnect(v,b.target)||t.removeConnection(b)}function d(v,b){v.outgoing.filter(_=>g(_,"bpmn:Association")).filter(_=>Qn(_.target)&&!b.includes(_)).forEach(_=>t.removeConnection(_))}function f(v){const b=v.attachers.slice();b.length&&t.removeElements(b)}function m(v){const b=v.incoming.filter(E=>xn(E.source));t.removeElements(b)}function h(v){const b=v.outgoing.filter(E=>g(E,"bpmn:SequenceFlow"));t.removeElements(b)}}O(Ba,C);Ba.$inject=["eventBus","modeling","bpmnRules"];function Qn(e){const t=D(e);return t&&t.get("isForCompensation")}function xn(e){return e&&g(e,"bpmn:BoundaryEvent")&&yp(e,"bpmn:CompensateEventDefinition")}function qi(e){return e&&g(e,"bpmn:Activity")&&!Ne(e)}function Na(e){e.invoke(C,this),this.preExecute("shape.create",1500,function(t){var n=t.context,i=n.parent,r=n.shape;g(i,"bpmn:Lane")&&!g(r,"bpmn:Lane")&&(n.parent=hi(i,"bpmn:Participant"))})}Na.$inject=["injector"];O(Na,C);function ja(e,t){C.call(this,e),this.preExecute("shape.create",function(n){var i=n.context,r=i.shape;if(g(r,"bpmn:DataObjectReference")&&r.type!=="label"){var o=t.create("bpmn:DataObject");r.businessObject.dataObjectRef=o}})}ja.$inject=["eventBus","bpmnFactory"];O(ja,C);var qo=20,Zo=20,cu=30,Zi=2e3;function Ha(e,t,n){C.call(this,t),t.on(["create.start","shape.move.start"],Zi,function(r){var o=r.context,s=o.shape,a=e.getRootElement();if(!(!g(s,"bpmn:Participant")||!g(a,"bpmn:Process")||!a.children.length)){var c=a.children.filter(function(u){return!g(u,"bpmn:Group")&&!ee(u)&&!se(u)});if(c.length){var l=Xe(c),p=kv(s,l);S(s,p),o.createConstraints=Mv(s,l)}}}),t.on("create.start",Zi,function(r){var o=r.context,s=o.shape,a=e.getRootElement(),c=e.getGraphics(a);function l(p){p.element=a,p.gfx=c}g(s,"bpmn:Participant")&&g(a,"bpmn:Process")&&(t.on("element.hover",Zi,l),t.once("create.cleanup",function(){t.off("element.hover",l)}))});function i(){var r=e.getRootElement();return g(r,"bpmn:Collaboration")?r:n.makeCollaboration()}this.preExecute("elements.create",Zi,function(r){var o=r.elements,s=r.parent,a=Dv(o),c;a&&g(s,"bpmn:Process")&&(r.parent=i(),c=r.hints=r.hints||{},c.participant=a,c.process=s,c.processRef=D(a).get("processRef"))},!0),this.preExecute("shape.create",function(r){var o=r.parent,s=r.shape;g(s,"bpmn:Participant")&&g(o,"bpmn:Process")&&(r.parent=i(),r.process=o,r.processRef=D(s).get("processRef"))},!0),this.execute("shape.create",function(r){var o=r.hints||{},s=r.process||o.process,a=r.shape,c=o.participant;s&&(!c||a===c)&&D(a).set("processRef",D(s))},!0),this.revert("shape.create",function(r){var o=r.hints||{},s=r.process||o.process,a=r.processRef||o.processRef,c=r.shape,l=o.participant;s&&(!l||c===l)&&D(c).set("processRef",a)},!0),this.postExecute("shape.create",function(r){var o=r.hints||{},s=r.process||r.hints.process,a=r.shape,c=o.participant;if(s){var l=s.children.slice();c?a===c&&n.moveElements(l,{x:0,y:0},c):n.moveElements(l,{x:0,y:0},a)}},!0)}Ha.$inject=["canvas","eventBus","modeling"];O(Ha,C);function kv(e,t){t={width:t.width+qo*2+cu,height:t.height+Zo*2};var n=Math.max(e.width,t.width),i=Math.max(e.height,t.height);return{x:-n/2,y:-i/2,width:n,height:i}}function Mv(e,t){return t=B(t),{bottom:t.top+e.height/2-Zo,left:t.right-e.width/2+qo,top:t.bottom-e.height/2+Zo,right:t.left+e.width/2-qo-cu}}function Dv(e){return ue(e,function(t){return g(t,"bpmn:Participant")})}var wc="__targetRef_placeholder";function Va(e,t){C.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Sc(o)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Sc(o));function n(s,a,c){var l=s.get("dataInputAssociations");return ue(l,function(p){return p!==c&&p.targetRef===a})}function i(s,a){var c=s.get("properties"),l=ue(c,function(p){return p.name===wc});return!l&&a&&(l=t.create("bpmn:Property",{name:wc}),we(c,l)),l}function r(s,a){var c=i(s);c&&(n(s,c,a)||be(s.get("properties"),c))}function o(s){var a=s.context,c=a.connection,l=c.businessObject,p=c.target,u=p&&p.businessObject,d=a.newTarget,f=d&&d.businessObject,m=a.oldTarget||a.target,h=m&&m.businessObject,v=c.businessObject,b;h&&h!==u&&r(h,l),f&&f!==u&&r(f,l),u?(b=i(u,!0),v.targetRef=b):v.targetRef=null}}Va.$inject=["eventBus","bpmnFactory"];O(Va,C);function Sc(e){return function(t){var n=t.context,i=n.connection;if(g(i,"bpmn:DataInputAssociation"))return e(t)}}function Hr(e){this._bpmnUpdater=e}Hr.$inject=["bpmnUpdater"];Hr.prototype.execute=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.newSemanticParent,r=e.newDiParent;return e.oldSemanticParent=t.$parent,e.oldDiParent=n.$parent,this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};Hr.prototype.revert=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.oldSemanticParent,r=e.oldDiParent;return this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};function Fa(e,t,n,i){C.call(this,i),t.registerHandler("dataStore.updateContainment",Hr);function r(){return n.filter(function(a){return g(a,"bpmn:Participant")&&D(a).processRef})[0]}function o(a){return a.children.filter(function(c){return g(c,"bpmn:DataStoreReference")&&!c.labelTarget})}function s(a,c){var l=a.businessObject||a;if(c=c||r(),c){var p=c.businessObject||c;t.execute("dataStore.updateContainment",{dataStoreBo:l,dataStoreDi:ie(a),newSemanticParent:p.processRef||p,newDiParent:ie(c)})}}this.preExecute("shape.create",function(a){var c=a.context,l=c.shape;g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&(c.hints||(c.hints={}),c.hints.autoResize=!1)}),this.preExecute("elements.move",function(a){var c=a.context,l=c.shapes,p=l.filter(function(u){return g(u,"bpmn:DataStoreReference")});p.length&&(c.hints||(c.hints={}),c.hints.autoResize=l.filter(function(u){return!g(u,"bpmn:DataStoreReference")}))}),this.postExecute("shape.create",function(a){var c=a.context,l=c.shape,p=l.parent;g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&g(p,"bpmn:Collaboration")&&s(l)}),this.postExecute("shape.move",function(a){var c=a.context,l=c.shape,p=c.oldParent,u=l.parent;if(!g(p,"bpmn:Collaboration")&&g(l,"bpmn:DataStoreReference")&&l.type!=="label"&&g(u,"bpmn:Collaboration")){var d=g(p,"bpmn:Participant")?p:Av(p,"bpmn:Participant");s(l,d)}}),this.postExecute("shape.delete",function(a){var c=a.context,l=c.shape,p=e.getRootElement();X(l,["bpmn:Participant","bpmn:SubProcess"])&&g(p,"bpmn:Collaboration")&&o(p).filter(function(u){return Iv(u,l)}).forEach(function(u){s(u)})}),this.postExecute("canvas.updateRoot",function(a){var c=a.context,l=c.oldRoot,p=c.newRoot,u=o(l);u.forEach(function(d){g(p,"bpmn:Process")&&s(d,p)})})}Fa.$inject=["canvas","commandStack","elementRegistry","eventBus"];O(Fa,C);function Iv(e,t){for(var n=e.businessObject||e,i=t.businessObject||t;n.$parent;){if(n.$parent===i.processRef||i)return!0;n=n.$parent}return!1}function Av(e,t){for(;e.parent;){if(g(e.parent,t))return e.parent;e=e.parent}}var br=Math.max,Er=Math.min,$v=20;function lu(e,t){return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}}function Ov(e,t,n){var i=n.x,r=n.y,o={x:e.x,y:e.y,width:e.width,height:e.height};return t.indexOf("n")!==-1?(o.y=e.y+r,o.height=e.height-r):t.indexOf("s")!==-1&&(o.height=e.height+r),t.indexOf("e")!==-1?o.width=e.width+i:t.indexOf("w")!==-1&&(o.x=e.x+i,o.width=e.width-i),o}function Lv(e,t){return{x:e.x+(t.left||0),y:e.y+(t.top||0),width:e.width-(t.left||0)+(t.right||0),height:e.height-(t.top||0)+(t.bottom||0)}}function Ji(e,t,n){var i=t[e],r=n.min&&n.min[e],o=n.max&&n.max[e];return Y(r)&&(i=(/top|left/.test(e)?Er:br)(i,r)),Y(o)&&(i=(/top|left/.test(e)?br:Er)(i,o)),i}function Bv(e,t){if(!t)return e;var n=B(e);return va({top:Ji("top",n,t),right:Ji("right",n,t),bottom:Ji("bottom",n,t),left:Ji("left",n,t)})}function Nv(e,t,n,i){var r=B(t),o={top:/n/.test(e)?r.bottom-n.height:r.top,left:/w/.test(e)?r.right-n.width:r.left,bottom:/s/.test(e)?r.top+n.height:r.bottom,right:/e/.test(e)?r.left+n.width:r.right},s=i?B(i):o,a={top:Er(o.top,s.top),left:Er(o.left,s.left),bottom:br(o.bottom,s.bottom),right:br(o.right,s.right)};return va(a)}function ei(e,t){return typeof e<"u"?e:$v}function jv(e,t){var n,i,r,o;return typeof t=="object"?(n=ei(t.left),i=ei(t.right),r=ei(t.top),o=ei(t.bottom)):n=i=r=o=ei(t),{x:e.x-n,y:e.y-r,width:e.width+n+i,height:e.height+r+o}}function Hv(e){return!(e.waypoints||e.type==="label")}function pu(e,t){var n;if(e.length===void 0?n=K(e.children,Hv):n=e,n.length)return jv(Xe(n),t)}var jt=Math.abs;function Vv(e,t){return lu(B(t),B(e))}var Fv=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],qe=30;function Vr(e,t){return t=t||[],e.children.filter(function(n){g(n,"bpmn:Lane")&&(Vr(n,t),t.push(n))}),t}function Yt(e){return e.children.filter(function(t){return g(t,"bpmn:Lane")})}function Ze(e){return hi(e,Fv)||e}function zv(e,t){var n=Ze(e),i=g(n,"bpmn:Process")?[]:[n],r=Vr(n,i),o=B(e),s=B(t),a=Vv(e,t),c=[],l=Me(e);return r.forEach(function(p){if(p!==e){var u=l?0:a.top,d=l?a.right:0,f=l?0:a.bottom,m=l?a.left:0,h=B(p);a.top&&(jt(h.bottom-o.top)<10&&(f=s.top-h.bottom),jt(h.top-o.top)<5&&(u=s.top-h.top)),a.left&&(jt(h.right-o.left)<10&&(d=s.left-h.right),jt(h.left-o.left)<5&&(m=s.left-h.left)),a.bottom&&(jt(h.top-o.bottom)<10&&(u=s.bottom-h.top),jt(h.bottom-o.bottom)<5&&(f=s.bottom-h.bottom)),a.right&&(jt(h.left-o.right)<10&&(m=s.right-h.left),jt(h.right-o.right)<5&&(d=s.right-h.right)),(u||d||f||m)&&c.push({shape:p,newBounds:Lv(p,{top:u,right:d,bottom:f,left:m})})}}),c}var Gv=500;function za(e,t){C.call(this,e);function n(i,r){var o=Me(i),s=Yt(r),a=[],c=[],l=[],p=[];if(Ir(s,function(v){return o?v.y>i.y?c.push(v):a.push(v):v.x>i.x?p.push(v):l.push(v),v.children}),!!s.length){var u;o?c.length&&a.length?u=i.height/2:u=i.height:p.length&&l.length?u=i.width/2:u=i.width;var d,f,m,h;a.length&&(d=t.calculateAdjustments(a,"y",u,i.y-10),t.makeSpace(d.movingShapes,d.resizingShapes,{x:0,y:u},"s")),c.length&&(f=t.calculateAdjustments(c,"y",-u,i.y+i.height+10),t.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:-u},"n")),l.length&&(m=t.calculateAdjustments(l,"x",u,i.x-10),t.makeSpace(m.movingShapes,m.resizingShapes,{x:u,y:0},"e")),p.length&&(h=t.calculateAdjustments(p,"x",-u,i.x+i.width+10),t.makeSpace(h.movingShapes,h.resizingShapes,{x:-u,y:0},"w"))}}this.postExecuted("shape.delete",Gv,function(i){var r=i.context,o=r.hints,s=r.shape,a=r.oldParent;g(s,"bpmn:Lane")&&(o&&o.nested||n(s,a))})}za.$inject=["eventBus","spaceTool"];O(za,C);var Pc=500;function Fr(e,t){t.invoke(C,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",Pc,function(i){var r=i.elements;r.filter(function(o){var s=o.host;return Cc(o,s)}).map(function(o){return r.indexOf(o)}).forEach(function(o){i.elements[o]=n._replaceShape(r[o])})},!0),this.preExecute("elements.move",Pc,function(i){var r=i.shapes,o=i.newHost;r.forEach(function(s,a){var c=s.host;Cc(s,Uv(r,c)?c:o)&&(r[a]=n._replaceShape(s))})},!0)}Fr.$inject=["bpmnReplace","injector"];O(Fr,C);Fr.prototype._replaceShape=function(e){var t=Wv(e),n;return t?n={type:"bpmn:IntermediateCatchEvent",eventDefinitionType:t.$type}:n={type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,n,{layoutConnection:!1})};function Wv(e){var t=D(e),n=t.eventDefinitions;return n&&n[0]}function Cc(e,t){return!ee(e)&&g(e,"bpmn:BoundaryEvent")&&!t}function Uv(e,t){return e.indexOf(t)!==-1}function Ga(e,t,n){C.call(this,e);function i(r,o,s){var a=o.waypoints,c,l,p,u,d,f,m,h=r.outgoing.slice(),v=r.incoming.slice(),b;Y(s.width)?b=V(s):b=s;var E=Wo(a,b);if(E){if(c=a.slice(0,E.index),l=a.slice(E.index+(E.bendpoint?1:0)),!c.length||!l.length)return;p=E.bendpoint?a[E.index]:b,(c.length===1||!Tc(r,c[c.length-1]))&&c.push(Rc(p)),(l.length===1||!Tc(r,l[0]))&&l.unshift(Rc(p))}u=o.source,d=o.target,t.canConnect(u,r,o)&&(n.reconnectEnd(o,r,c||b),f=o),t.canConnect(r,d,o)&&(f?m=n.connect(r,d,{type:o.type,waypoints:l}):(n.reconnectStart(o,r,l||b),m=o));var y=[].concat(f&&K(v,function(_){return _.source===f.source})||[],m&&K(h,function(_){return _.target===m.target})||[]);y.length&&n.removeElements(y)}this.preExecute("elements.move",function(r){var o=r.newParent,s=r.shapes,a=r.delta,c=s[0];if(!(!c||!o)){o&&o.waypoints&&(r.newParent=o=o.parent);var l=V(c),p={x:l.x+a.x,y:l.y+a.y},u=ue(o.children,function(d){var f=t.canInsert(s,d);return f&&Wo(d.waypoints,p)});u&&(r.targetFlow=u,r.position=p)}},!0),this.postExecuted("elements.move",function(r){var o=r.shapes,s=r.targetFlow,a=r.position;s&&i(o[0],s,a)},!0),this.preExecute("shape.create",function(r){var o=r.parent,s=r.shape;t.canInsert(s,o)&&(r.targetFlow=o,r.parent=o.parent)},!0),this.postExecuted("shape.create",function(r){var o=r.shape,s=r.targetFlow,a=r.position;s&&i(o,s,a)},!0)}O(Ga,C);Ga.$inject=["eventBus","bpmnRules","modeling"];function Tc(e,t){var n=t.x,i=t.y;return n>=e.x&&n<=e.x+e.width&&i>=e.y&&i<=e.y+e.height}function Rc(e){return S({},e)}function Wa(e,t){C.call(this,e),this.preExecuted("connection.create",function(n){var i=n.context,r=i.connection,o=i.source,s=i.target,a=i.hints;if(!(a&&a.createElementsBehavior===!1)&&wn(r)){var c=[];g(o,"bpmn:EventBasedGateway")?c=s.incoming.filter(l=>l!==r&&wn(l)):c=s.incoming.filter(l=>l!==r&&wn(l)&&g(l.source,"bpmn:EventBasedGateway")),c.forEach(function(l){t.removeConnection(l)})}}),this.preExecuted("shape.replace",function(n){var i=n.context,r=i.newShape;if(g(r,"bpmn:EventBasedGateway")){var o=r.outgoing.filter(wn).reduce(function(s,a){return s.includes(a.target)?s:s.concat(a.target)},[]);o.forEach(function(s){s.incoming.filter(wn).forEach(function(a){const c=s.incoming.filter(wn).filter(function(l){return l.source===r});(a.source!==r||c.length>1)&&t.removeConnection(a)})})}})}Wa.$inject=["eventBus","modeling"];O(Wa,C);function wn(e){return g(e,"bpmn:SequenceFlow")}var Qi=1500,kc=2e3;function uu(e,t,n){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Qi,function(i){var r=i.context,o=r.shape||i.shape,s=i.hover;g(s,"bpmn:Lane")&&!X(o,["bpmn:Lane","bpmn:Participant"])&&(i.hover=Ze(s),i.hoverGfx=e.getGraphics(i.hover));var a=n.getRootElement();s!==a&&(o.labelTarget||X(o,["bpmn:Group","bpmn:TextAnnotation"]))&&(i.hover=a,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Qi,function(i){var r=i.hover;g(r,"bpmn:Lane")&&(i.hover=Ze(r)||r,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["bendpoint.move.hover"],Qi,function(i){var r=i.context,o=i.hover,s=r.type;g(o,"bpmn:Lane")&&/reconnect/.test(s)&&(i.hover=Ze(o)||o,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.start"],Qi,function(i){var r=i.context,o=r.start;g(o,"bpmn:Lane")&&(r.start=Ze(o)||o)}),t.on("shape.move.start",kc,function(i){var r=i.shape;g(r,"bpmn:Lane")&&(i.shape=Ze(r)||r)}),t.on("spaceTool.move",kc,function(i){var r=i.hover;r&&g(r,"bpmn:Lane")&&(i.hover=Ze(r))})}uu.$inject=["elementRegistry","eventBus","canvas"];function Xv(e){return e.create("bpmn:Category")}function Kv(e){return e.create("bpmn:CategoryValue")}function Yv(e,t,n){return we(t.get("categoryValue"),e),e.$parent=t,we(n.get("rootElements"),t),t.$parent=n,e}function qv(e){var t=e.$parent;return t&&(be(t.get("categoryValue"),e),e.$parent=null),e}function Zv(e){var t=e.$parent;return t&&(be(t.get("rootElements"),e),e.$parent=null),e}var Mc=770;function Ua(e,t,n,i,r,o){r.invoke(C,this);function s(){return n.filter(function(m){return g(m,"bpmn:Group")})}function a(m,h){return m.some(function(v){var b=D(v),E=b.categoryValueRef&&b.categoryValueRef.$parent;return E===h})}function c(m,h){return m.some(function(v){var b=D(v);return b.categoryValueRef===h})}function l(m,h,v){var b=s().filter(function(E){return E.businessObject!==v});h&&!a(b,h)&&Zv(h),m&&!c(b,m)&&qv(m)}function p(m,h){return Yv(m,h,t.getDefinitions())}function u(m,h){var v=D(m),b=v.categoryValueRef;b||(b=v.categoryValueRef=h.categoryValue=h.categoryValue||Kv(e));var E=b.$parent;E||(E=b.$parent=h.category=h.category||Xv(e)),p(b,E,t.getDefinitions())}function d(m,h){var v=h.category,b=h.categoryValue,E=D(m);b?(E.categoryValueRef=null,l(b,v,E)):l(null,E.categoryValueRef.$parent,E)}this.execute("label.create",function(m){var h=m.context,v=h.labelTarget;g(v,"bpmn:Group")&&u(v,h)}),this.revert("label.create",function(m){var h=m.context,v=h.labelTarget;g(v,"bpmn:Group")&&d(v,h)}),this.execute("shape.delete",function(m){var h=m.context,v=h.shape,b=D(v);if(!(!g(v,"bpmn:Group")||v.labelTarget)){var E=h.categoryValue=b.categoryValueRef,y;E&&(y=h.category=E.$parent,l(E,y,b),b.categoryValueRef=null)}}),this.reverted("shape.delete",function(m){var h=m.context,v=h.shape;if(!(!g(v,"bpmn:Group")||v.labelTarget)){var b=h.category,E=h.categoryValue,y=D(v);E&&(y.categoryValueRef=E,p(E,b))}}),this.execute("shape.create",function(m){var h=m.context,v=h.shape;!g(v,"bpmn:Group")||v.labelTarget||D(v).categoryValueRef&&u(v,h)}),this.reverted("shape.create",function(m){var h=m.context,v=h.shape;!g(v,"bpmn:Group")||v.labelTarget||D(v).categoryValueRef&&d(v,h)});function f(m,h){var v=e.create(m.$type);return o.copyElement(m,v,null,h)}i.on("copyPaste.copyElement",Mc,function(m){var h=m.descriptor,v=m.element;if(!(!g(v,"bpmn:Group")||v.labelTarget)){var b=D(v);if(b.categoryValueRef){var E=b.categoryValueRef;h.categoryValue=f(E,!0),E.$parent&&(h.category=f(E.$parent,!0))}}}),i.on("copyPaste.pasteElement",Mc,function(m){var h=m.descriptor,v=h.businessObject,b=h.categoryValue,E=h.category;b&&(b=v.categoryValueRef=f(b)),E&&(b.$parent=f(E)),delete h.category,delete h.categoryValue})}Ua.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"];O(Ua,C);function Jo(e,t,n,i){var r,o,s,a,c;return r=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y),r==0?null:(o=e.y-n.y,s=e.x-n.x,c=(i.x-n.x)*o-(i.y-n.y)*s,a=c/r,{x:Math.round(e.x+a*(t.x-e.x)),y:Math.round(e.y+a*(t.y-e.y))})}function du(e){function t(i,r,o){var s={x:o.x,y:o.y-50},a={x:o.x-50,y:o.y},c=Jo(i,r,o,s),l=Jo(i,r,o,a),p;c&&l?Dc(c,o)>Dc(l,o)?p=l:p=c:p=c||l,i.original=p}function n(i){var r=i.waypoints;t(r[0],r[1],V(i.source)),t(r[r.length-1],r[r.length-2],V(i.target))}e.on("bpmnElement.added",function(i){var r=i.element;r.waypoints&&n(r)})}du.$inject=["eventBus"];function Dc(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Xa(e){C.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],function(n){var i=n.context.shape,r=D(i),o=ie(i);if(X(r,t)){var s=o.get("isHorizontal");s===void 0&&(s=!0),o.set("isHorizontal",s)}})}Xa.$inject=["eventBus"];O(Xa,C);var fu=Math.sqrt,hu=Math.min,Jv=Math.max,Ic=Math.abs;function Ac(e){return Math.pow(e,2)}function ti(e,t){return fu(Ac(e.x-t.x)+Ac(e.y-t.y))}function Qv(e,t){var n=0,i,r,o,s,a,c,l,p,u,d,f;for(n=0;n<t.length-1;n++){if(i=t[n],r=t[n+1],Oc(i,r)?l=[i]:(o=ti(e,i),s=ti(e,r),c=hu(o,s),l=eg(i,r,e,c)),l.length<1)throw new Error("expected between [1, 2] circle -> line intersections");l.length===1&&(p={type:"bendpoint",position:l[0],segmentIndex:n,bendpointIndex:Oc(i,l[0])?n:n+1}),l.length===2&&(a=ng(l[0],l[1]),p={type:"segment",position:a,segmentIndex:n,relativeLocation:ti(i,a)/ti(i,r)}),u=ti(p.position,e),(!f||d>u)&&(f=p,d=u)}return f}function eg(e,t,n,i){var r=t.x-e.x,o=t.y-e.y,s=n.x-e.x,a=n.y-e.y,c=r*r+o*o,l=r*s+o*a,p=s*s+a*a-i*i,u=l/c,d=p/c,f=u*u-d;if(f<0&&f>-1e-6&&(f=0),f<0)return[];var m=fu(f),h=-u+m,v=-u-m,b={x:e.x-r*h,y:e.y-o*h};if(f===0)return[b];var E={x:e.x-r*v,y:e.y-o*v};return[b,E].filter(function(y){return tg(y,e,t)})}function tg(e,t,n){return $c(e.x,t.x,n.x)&&$c(e.y,t.y,n.y)}function $c(e,t,n){return e>=hu(t,n)-xr&&e<=Jv(t,n)+xr}function ng(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}var xr=.1;function Oc(e,t){return Ic(e.x-t.x)<=xr&&Ic(e.y-t.y)<=xr}function ig(e,t,n,i){var r=n.segmentIndex,o=t.length-e.length;if(i.segmentMove){var s=i.segmentMove.segmentStartIndex,a=i.segmentMove.newSegmentStartIndex;return r===s?a:r>=a?r+o<a?a:r+o:r}if(i.bendpointMove){var c=i.bendpointMove.insert,l=i.bendpointMove.bendpointIndex,p;if(o===0)return r;if(r>=l&&(p=c?r+1:r-1),r<l&&(p=r,c&&n.type!=="bendpoint"&&l-1===r)){var u=vu(t,l);u<n.relativeLocation&&p++}return p}return o===0?r:i.connectionStart&&r===0?0:i.connectionEnd&&r===e.length-2?t.length-2:Math.floor((t.length-2)/2)}function mu(e,t,n,i){var r=0,o=0,s={point:e,delta:{x:0,y:0}},a=Qv(e,n),c=a.segmentIndex,l=ig(n,t,a,i);if(l<0||l>t.length-2||l===null)return s;var p=Lc(n,c),u=Lc(t,l),d=a.position,f=og(p,d),m=rg(p,u);if(a.type==="bendpoint"){var h=t.length-n.length,v=a.bendpointIndex,b=n[v];if(t.indexOf(b)!==-1)return s;if(h===0){var E=t[v];return r=E.x-a.position.x,o=E.y-a.position.y,{delta:{x:r,y:o},point:{x:e.x+r,y:e.y+o}}}h<0&&v!==0&&v<n.length-1&&(f=vu(n,v))}var y={x:(u[1].x-u[0].x)*f+u[0].x,y:(u[1].y-u[0].y)*f+u[0].y},_=Km({x:e.x-d.x,y:e.y-d.y},m);return r=y.x+_.x-e.x,o=y.y+_.y-e.y,{point:di(y),delta:di({x:r,y:o})}}function vu(e,t){var n=yr(e[t-1],e[t]),i=yr(e[t],e[t+1]),r=n/(n+i);return r}function rg(e,t){var n=ac(e),i=ac(t);return i-n}function Lc(e,t){return[e[t],e[t+1]]}function og(e,t){var n=yr(e[0],e[1]),i=yr(e[0],t);return n===0?0:i/n}function ag(e,t,n,i){var r=V(e);return mu(r,t,n,i).delta}function Si(e,t,n){var i=si(t),r=si(n),o=Rt(e,i),s={x:o.x*(n.width/t.width),y:o.y*(n.height/t.height)};return di({x:r.x+s.x,y:r.y+s.y})}function Bc(e,t,n){var i=si(e),r=si(t),o=si(n),s=Rt(e,i),a=Rt(i,r),c=sg(i,t,n);if(c)return c;var l={x:a.x*(n.width/t.width),y:a.y*(n.height/t.height)},p={x:o.x+l.x,y:o.y+l.y};return di({x:p.x+s.x-e.x,y:p.y+s.y-e.y})}function sg(e,t,n){var i=B(t),r=B(n);if(cg(i,r))return null;var o=Ie(t,e),s,a,c;if(o==="top")s={x:0,y:r.bottom-i.bottom};else if(o==="bottom")s={x:0,y:r.top-i.top};else if(o==="right")s={x:r.left-i.left,y:0};else if(o==="left")s={x:r.right-i.right,y:0};else return null;return a={x:e.x+s.x,y:e.y+s.y},c=Ie(n,a),c!==o?null:s}function cg(e,t){return lg(e,t)||pg(e,t)}function lg(e,t){return e.right!==t.right&&e.left!==t.left}function pg(e,t){return e.top!==t.top&&e.bottom!==t.bottom}var Nc="name",jc="text";function Ka(e,t,n,i){C.call(this,e),this.postExecute("element.updateProperties",r),this.postExecute("element.updateModdleProperties",s=>{D(s.context.element)===s.context.moddleElement&&r(s)});function r(s){var a=s.context,c=a.element,l=a.properties;if(Nc in l&&t.updateLabel(c,l[Nc]),jc in l&&g(c,"bpmn:TextAnnotation")){var p=i.getTextAnnotationBounds({x:c.x,y:c.y,width:c.width,height:c.height},l[jc]||"");t.updateLabel(c,l.text,p)}}this.postExecute(["shape.create","connection.create"],function(s){var a=s.context,c=a.hints||{};if(c.createElementsBehavior!==!1){var l=a.shape||a.connection;ee(l)||!In(l)||Ut(l)&&t.updateLabel(l,Ut(l))}}),this.postExecute("shape.delete",function(s){var a=s.context,c=a.labelTarget,l=a.hints||{};c&&l.unsetLabel!==!1&&t.updateLabel(c,null,null,{removeShape:!1})});function o(s){var a=s.context,c=a.connection,l=c.label,p=S({},a.hints),u=a.newWaypoints||c.waypoints,d=a.oldWaypoints;return typeof p.startChanged>"u"&&(p.startChanged=!!p.connectionStart),typeof p.endChanged>"u"&&(p.endChanged=!!p.connectionEnd),ag(l,u,d,p)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(s){var a=s.context,c=a.hints||{};if(c.labelBehavior!==!1){var l=a.connection,p=l.label,u;!p||!p.parent||(u=o(s),t.moveShape(p,u))}}),this.postExecute(["shape.replace"],function(s){var a=s.context,c=a.newShape,l=a.oldShape,p=D(c);p&&In(p)&&l.label&&c.label&&(c.label.x=l.label.x,c.label.y=l.label.y)}),this.postExecute("shape.resize",function(s){var a=s.context,c=a.shape,l=a.newBounds,p=a.oldBounds;if(Dr(c)){var u=c.label,d=V(u),f=fg(p),m=dg(d,f),h=ug(m,p,l);t.moveShape(u,h)}})}O(Ka,C);Ka.$inject=["eventBus","modeling","bpmnFactory","textRenderer"];function ug(e,t,n){var i=Si(e,t,n);return di(Rt(i,e))}function dg(e,t){if(t.length){var n=hg(e,t);return Ra(e,n)}}function fg(e){return[[{x:e.x,y:e.y},{x:e.x+(e.width||0),y:e.y}],[{x:e.x+(e.width||0),y:e.y},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y+(e.height||0)},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y},{x:e.x,y:e.y+(e.height||0)}]]}function hg(e,t){var n=t.map(function(r){return{line:r,distance:Up(e,r)}}),i=gt(n,"distance");return i[0].line}function mg(e,t,n,i){return mu(e,t,n,i).point}function Ya(e,t){C.call(this,e);function n(i,r){var o=i.context,s=o.connection,a=S({},o.hints),c=o.newWaypoints||s.waypoints,l=o.oldWaypoints;return typeof a.startChanged>"u"&&(a.startChanged=!!a.connectionStart),typeof a.endChanged>"u"&&(a.endChanged=!!a.connectionEnd),mg(r,c,l,a)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(i){var r=i.context,o=r.connection,s=o.outgoing,a=o.incoming;a.forEach(function(c){var l=c.waypoints[c.waypoints.length-1],p=n(i,l),u=[].concat(c.waypoints.slice(0,-1),[p]);t.updateWaypoints(c,u)}),s.forEach(function(c){var l=c.waypoints[0],p=n(i,l),u=[].concat([p],c.waypoints.slice(1));t.updateWaypoints(c,u)})}),this.postExecute(["connection.move"],function(i){var r=i.context,o=r.connection,s=o.outgoing,a=o.incoming,c=r.delta;a.forEach(function(l){var p=l.waypoints[l.waypoints.length-1],u={x:p.x+c.x,y:p.y+c.y},d=[].concat(l.waypoints.slice(0,-1),[u]);t.updateWaypoints(l,d)}),s.forEach(function(l){var p=l.waypoints[0],u={x:p.x+c.x,y:p.y+c.y},d=[].concat([u],l.waypoints.slice(1));t.updateWaypoints(l,d)})})}O(Ya,C);Ya.$inject=["eventBus","modeling"];function zr(e,t,n){var i=Wr(e),r=yu(i,t),o=i[0];return r.length?r[r.length-1]:Si(o.original||o,n,t)}function Gr(e,t,n){var i=Wr(e),r=yu(i,t),o=i[i.length-1];return r.length?r[0]:Si(o.original||o,n,t)}function qa(e,t,n){var i=Wr(e),r=gu(t,n),o=i[0];return Si(o.original||o,r,t)}function Za(e,t,n){var i=Wr(e),r=gu(t,n),o=i[i.length-1];return Si(o.original||o,r,t)}function gu(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}function Wr(e){var t=e.waypoints;if(!t.length)throw new Error("connection#"+e.id+": no waypoints");return t}function yu(e,t){var n=Ge(e,gg);return K(n,function(i){return vg(i,t)})}function vg(e,t){return Ie(t,e,1)==="intersect"}function gg(e){return e.original||e}function Ja(e,t){C.call(this,e),this.postExecute("shape.replace",function(n){var i=n.oldShape,r=n.newShape;if(yg(i,r)){var o=_g(i);o.incoming.forEach(function(s){var a=Gr(s,r,i);t.reconnectEnd(s,r,a)}),o.outgoing.forEach(function(s){var a=zr(s,r,i);t.reconnectStart(s,r,a)})}},!0)}Ja.$inject=["eventBus","modeling"];O(Ja,C);function yg(e,t){return g(e,"bpmn:Participant")&&Q(e)&&g(t,"bpmn:Participant")&&!Q(t)}function _g(e){var t=_i([e],!1),n=[],i=[];return t.forEach(function(r){r!==e&&(r.incoming.forEach(function(o){g(o,"bpmn:MessageFlow")&&n.push(o)}),r.outgoing.forEach(function(o){g(o,"bpmn:MessageFlow")&&i.push(o)}))},[]),{incoming:n,outgoing:i}}const bg=["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:EscalationEventDefinition","bpmn:ConditionalEventDefinition","bpmn:SignalEventDefinition"];function _u(e){const t=D(e);if(!g(t,"bpmn:BoundaryEvent")&&!(g(t,"bpmn:StartEvent")&&Ne(t.$parent)))return!1;const n=t.get("eventDefinitions");return!n||!n.length?!1:bg.some(i=>g(n[0],i))}function bu(e){return g(e,"bpmn:BoundaryEvent")?"cancelActivity":"isInterrupting"}function Qa(e,t){e.invoke(C,this),this.postExecuted("shape.replace",function(n){const i=n.context.oldShape,r=n.context.newShape,o=n.context.hints;if(!_u(r))return;const s=bu(r);if(o.targetElement&&o.targetElement[s]!==void 0)return;const c=D(i).get(s),l=D(r).get(s);c!==l&&t.updateProperties(r,{[s]:c})})}Qa.$inject=["injector","modeling"];O(Qa,C);function es(e,t){C.call(this,e),this.preExecute("shape.resize",function(n){var i=n.shape,r=ie(i),o=r&&r.get("label"),s=o&&o.get("bounds");s&&t.updateModdleProperties(i,o,{bounds:void 0})},!0)}O(es,C);es.$inject=["eventBus","modeling"];function ts(e,t,n){C.call(this,e),this.preExecute("shape.delete",function(i){var r=i.context.shape;if(!(r.incoming.length!==1||r.outgoing.length!==1)){var o=r.incoming[0],s=r.outgoing[0];if(!(!g(o,"bpmn:SequenceFlow")||!g(s,"bpmn:SequenceFlow"))&&t.canConnect(o.source,s.target,o)){var a=Eg(o.waypoints,s.waypoints);n.reconnectEnd(o,s.target,a)}}})}O(ts,C);ts.$inject=["eventBus","bpmnRules","modeling"];function Sn(e){return e.original||e}function Eg(e,t){var n=Jo(Sn(e[e.length-2]),Sn(e[e.length-1]),Sn(t[1]),Sn(t[0]));return n?[].concat(e.slice(0,e.length-1),[n],t.slice(1)):[Sn(e[0]),Sn(t[t.length-1])]}function ns(e,t){C.call(this,e),this.preExecute("shape.delete",function(n){var i=n.shape,r=i.parent;g(i,"bpmn:Participant")&&(n.collaborationRoot=r)},!0),this.postExecute("shape.delete",function(n){var i=n.collaborationRoot;if(i&&!i.businessObject.participants.length){var r=t.makeProcess(),o=i.children.slice();t.moveElements(o,{x:0,y:0},r)}},!0)}ns.$inject=["eventBus","modeling"];O(ns,C);function is(e,t,n,i){C.call(this,e);var r=i.get("dragging",!1);function o(c){var l=c.source,p=c.target,u=c.parent;if(u){var d,f;g(c,"bpmn:SequenceFlow")&&(n.canConnectSequenceFlow(l,p)||(f=!0),n.canConnectMessageFlow(l,p)&&(d="bpmn:MessageFlow")),g(c,"bpmn:MessageFlow")&&(n.canConnectMessageFlow(l,p)||(f=!0),n.canConnectSequenceFlow(l,p)&&(d="bpmn:SequenceFlow")),f&&t.removeConnection(c),d&&t.connect(l,p,{type:d,waypoints:c.waypoints.slice()})}}function s(c){var l=c.context,p=l.connection,u=l.newSource||p.source,d=l.newTarget||p.target,f,m;f=n.canConnect(u,d),!(!f||f.type===p.type)&&(m=t.connect(u,d,{type:f.type,associationDirection:f.associationDirection,waypoints:p.waypoints.slice()}),p.parent&&t.removeConnection(p),l.connection=m,r&&a(p,m))}function a(c,l){var p=r.context(),u=p&&p.payload.previousSelection,d;!u||!u.length||(d=u.indexOf(c),d!==-1&&u.splice(d,1,l))}this.postExecuted("elements.move",function(c){var l=c.closure,p=l.allConnections;x(p,o)},!0),this.preExecute("connection.reconnect",s),this.postExecuted("element.updateProperties",function(c){var l=c.context,p=l.properties,u=l.element,d=u.businessObject,f;p.default&&(f=ue(u.outgoing,Tt({id:u.businessObject.default.id})),f&&t.updateProperties(f,{conditionExpression:void 0})),p.conditionExpression&&d.sourceRef.default===d&&t.updateProperties(u.source,{default:void 0})})}O(is,C);is.$inject=["eventBus","modeling","bpmnRules","injector"];function Ur(e,t,n,i,r,o){i.invoke(C,this),this._bpmnReplace=e,this._elementRegistry=n,this._selection=o,this.postExecuted(["elements.create"],500,function(s){var a=s.context,c=a.parent,l=a.elements,p=Xt(l,function(u,d){var f=t.canReplace([d],d.host||d.parent||c);return f?u.concat(f.replacements):u},[]);p.length&&this._replaceElements(l,p)},this),this.postExecuted(["elements.move"],500,function(s){var a=s.context,c=a.newParent,l=a.newHost,p=[];x(a.closure.topLevel,function(d){Ne(d)?p=p.concat(d.children):p=p.concat(d)}),p.length===1&&l&&(c=l);var u=t.canReplace(p,c);u&&this._replaceElements(p,u.replacements,l)},this),this.postExecute(["shape.replace"],1500,function(s){var a=s.context,c=a.oldShape,l=a.newShape,p=c.attachers,u;p&&p.length&&(u=t.canReplace(p,l),this._replaceElements(p,u.replacements))},this),this.postExecuted(["shape.replace"],1500,function(s){var a=s.context,c=a.oldShape,l=a.newShape;r.unclaimId(c.businessObject.id,c.businessObject),r.updateProperties(l,{id:c.id})})}O(Ur,C);Ur.prototype._replaceElements=function(e,t){var n=this._elementRegistry,i=this._bpmnReplace,r=this._selection;x(t,function(o){var s={type:o.newElementType},a=n.get(o.oldElementId),c=e.indexOf(a);e[c]=i.replaceElement(a,s,{select:!1})}),t&&r.select(e)};Ur.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var xg=1500,wg={width:140,height:120},rs={width:300,height:60},os={width:60,height:300},ur={width:300,height:150},dr={width:150,height:300},Eu={width:140,height:120},xu={width:50,height:30};function wu(e){e.on("resize.start",xg,function(t){var n=t.context,i=n.shape,r=n.direction,o=n.balanced;(g(i,"bpmn:Lane")||g(i,"bpmn:Participant"))&&(n.resizeConstraints=Rg(i,r,o)),g(i,"bpmn:SubProcess")&&Q(i)&&(n.minDimensions=Eu),g(i,"bpmn:TextAnnotation")&&(n.minDimensions=xu)})}wu.$inject=["eventBus"];var Ht=Math.abs,Sg=Math.min,Pg=Math.max;function Su(e,t,n,i){var r=e[t];e[t]=r===void 0?n:i(n,r)}function Pn(e,t,n){return Su(e,t,n,Sg)}function Cn(e,t,n){return Su(e,t,n,Pg)}var Cg={top:20,left:50,right:20,bottom:20},Tg={top:50,left:20,right:20,bottom:20};function Rg(e,t,n){var i=Ze(e),r=!0,o=!0,s=Vr(i,[i]),a=B(e),c={},l={},p=Me(e),u=p?rs:os;/n/.test(t)?l.top=a.bottom-u.height:/e/.test(t)?l.right=a.left+u.width:/s/.test(t)?l.bottom=a.top+u.height:/w/.test(t)&&(l.left=a.right-u.width),s.forEach(function(m){var h=B(m);/n/.test(t)&&(p&&h.top<a.top-10&&(r=!1),n&&Ht(a.top-h.bottom)<10&&Cn(c,"top",h.top+u.height),Ht(a.top-h.top)<5&&Pn(l,"top",h.bottom-u.height)),/e/.test(t)&&(!p&&h.right>a.right+10&&(o=!1),n&&Ht(a.right-h.left)<10&&Pn(c,"right",h.right-u.width),Ht(a.right-h.right)<5&&Cn(l,"right",h.left+u.width)),/s/.test(t)&&(p&&h.bottom>a.bottom+10&&(o=!1),n&&Ht(a.bottom-h.top)<10&&Pn(c,"bottom",h.bottom-u.height),Ht(a.bottom-h.bottom)<5&&Cn(l,"bottom",h.top+u.height)),/w/.test(t)&&(!p&&h.left<a.left-10&&(r=!1),n&&Ht(a.left-h.right)<10&&Cn(c,"left",h.left+u.width),Ht(a.left-h.left)<5&&Pn(l,"left",h.right-u.width))});var d=i.children.filter(function(m){return!m.hidden&&!m.waypoints&&(g(m,"bpmn:FlowElement")||g(m,"bpmn:Artifact"))}),f=p?Cg:Tg;return d.forEach(function(m){var h=B(m);r&&/n/.test(t)&&Pn(l,"top",h.top-f.top),o&&/e/.test(t)&&Cn(l,"right",h.right+f.right),o&&/s/.test(t)&&Cn(l,"bottom",h.bottom+f.bottom),r&&/w/.test(t)&&Pn(l,"left",h.left-f.left)}),{min:l,max:c}}var Hc=1001;function Pu(e,t){e.on("resize.start",Hc+500,function(n){var i=n.context,r=i.shape;(g(r,"bpmn:Lane")||g(r,"bpmn:Participant"))&&(i.balanced=!fi(n))}),e.on("resize.end",Hc,function(n){var i=n.context,r=i.shape,o=i.canExecute,s=i.newBounds;if(g(r,"bpmn:Lane")||g(r,"bpmn:Participant"))return o&&(s=_p(s),t.resizeLane(r,s,i.balanced)),!1})}Pu.$inject=["eventBus","modeling"];var kg=500;function as(e,t,n,i,r){n.invoke(C,this);function o(p){return X(p,["bpmn:ReceiveTask","bpmn:SendTask"])||Mg(p,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function s(p){var u=e.getDefinitions(),d=u.get("rootElements");return!!ue(d,Tt({id:p.id}))}function a(p){if(g(p,"bpmn:ErrorEventDefinition"))return"errorRef";if(g(p,"bpmn:EscalationEventDefinition"))return"escalationRef";if(g(p,"bpmn:MessageEventDefinition"))return"messageRef";if(g(p,"bpmn:SignalEventDefinition"))return"signalRef"}function c(p){if(X(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.get("messageRef");var u=p.get("eventDefinitions"),d=u[0];return d.get(a(d))}function l(p,u){if(X(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.set("messageRef",u);var d=p.get("eventDefinitions"),f=d[0];return f.set(a(f),u)}this.executed(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.shape||p.element;if(o(u)){var d=D(u),f=c(d),m;f&&!s(f)&&(m=e.getDefinitions().get("rootElements"),we(m,f),p.addedRootElement=f)}},!0),this.reverted(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.addedRootElement;if(u){var d=e.getDefinitions().get("rootElements");be(d,u)}},!0),t.on("copyPaste.copyElement",function(p){var u=p.descriptor,d=p.element;if(!(d.labelTarget||!o(d))){var f=D(d),m=c(f);m&&(u.referencedRootElement=m)}}),t.on("copyPaste.pasteElement",kg,function(p){var u=p.descriptor,d=u.businessObject,f=u.referencedRootElement;f&&(s(f)||(f=i.copyElement(f,r.create(f.$type))),l(d,f),delete u.referencedRootElement)})}as.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"];O(as,C);function Mg(e,t){return J(t)||(t=[t]),bi(t,function(n){return yp(e,n)})}var Cu=Math.max;function Tu(e){e.on("spaceTool.getMinDimensions",function(t){var n=t.shapes,i=t.axis,r=t.start,o={};return x(n,function(s){var a=s.id;g(s,"bpmn:Participant")&&(o[a]=Ig(s,i,r)),g(s,"bpmn:Lane")&&(o[a]=Me(s)?rs:os),g(s,"bpmn:SubProcess")&&Q(s)&&(o[a]=Eu),g(s,"bpmn:TextAnnotation")&&(o[a]=xu),g(s,"bpmn:Group")&&(o[a]=wg)}),o})}Tu.$inject=["eventBus"];function Dg(e){return e==="x"}function Ig(e,t,n){var i=Me(e);if(!Og(e))return i?ur:dr;var r=Dg(t),o={};return r?i?o=ur:o={width:$g(e,n,r),height:dr.height}:i?o={width:ur.width,height:Ag(e,n,r)}:o=dr,o}function Ag(e,t,n){var i;return i=Lg(e,t,n),Cu(ur.height,i)}function $g(e,t,n){var i;return i=Bg(e,t,n),Cu(dr.width,i)}function Og(e){return!!Yt(e).length}function Lg(e,t,n){var i=Yt(e),r;return r=ss(i,t,n),e.height-r.height+rs.height}function Bg(e,t,n){var i=Yt(e),r;return r=ss(i,t,n),e.width-r.width+os.width}function ss(e,t,n){var i,r,o;for(i=0;i<e.length;i++)if(r=e[i],!n&&t>=r.y&&t<=r.y+r.height||n&&t>=r.x&&t<=r.x+r.width)return o=Yt(r),o.length?ss(o,t,n):r}var Vc=400,Ng=600,Fc={x:180,y:160};function qt(e,t,n,i,r,o,s){C.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=n,this._elementFactory=i,this._bpmnFactory=r,this._bpmnjs=o,this._elementRegistry=s;var a=this;function c(u){return g(u,"bpmn:SubProcess")&&!Q(u)}function l(u){var d=u.shape,f=u.newRootElement,m=D(d);f=a._addDiagram(f||m),u.newRootElement=e.addRootElement(f)}function p(u){var d=u.shape,f=D(d);a._removeDiagram(f);var m=u.newRootElement=s.get(Tn(f));e.removeRootElement(m)}this.executed("shape.create",function(u){var d=u.shape;c(d)&&l(u)},!0),this.postExecuted("shape.create",function(u){var d=u.shape,f=u.newRootElement;!f||!d.children||(a._showRecursively(d.children),a._moveChildrenToShape(d,f))},!0),this.reverted("shape.create",function(u){var d=u.shape;c(d)&&p(u)},!0),this.preExecuted("shape.delete",function(u){var d=u.shape;if(c(d)){var f=s.get(Tn(d));f&&n.removeElements(f.children.slice())}},!0),this.executed("shape.delete",function(u){var d=u.shape;c(d)&&p(u)},!0),this.reverted("shape.delete",function(u){var d=u.shape;c(d)&&l(u)},!0),this.preExecuted("shape.replace",function(u){var d=u.oldShape,f=u.newShape;!c(d)||!c(f)||(u.oldRoot=e.removeRootElement(Tn(d)))},!0),this.postExecuted("shape.replace",function(u){var d=u.newShape,f=u.oldRoot,m=e.findRoot(Tn(d));if(!(!f||!m)){var h=f.children;n.moveElements(h,{x:0,y:0},m)}},!0),this.executed("element.updateProperties",function(u){var d=u.element;if(g(d,"bpmn:SubProcess")){var f=u.properties,m=u.oldProperties,h=m.id,v=f.id;if(h!==v){if(pr(d)){s.updateId(d,cn(v)),s.updateId(h,v);return}var b=s.get(cn(h));b&&s.updateId(cn(h),cn(v))}}},!0),this.reverted("element.updateProperties",function(u){var d=u.element;if(g(d,"bpmn:SubProcess")){var f=u.properties,m=u.oldProperties,h=m.id,v=f.id;if(h!==v){if(pr(d)){s.updateId(d,cn(h)),s.updateId(v,h);return}var b=s.get(cn(v));b&&s.updateId(b,cn(h))}}},!0),t.on("element.changed",function(u){var d=u.element;if(pr(d)){var f=d,m=s.get(Ks(f));!m||m===f||t.fire("element.changed",{element:m})}}),this.executed("shape.toggleCollapse",Vc,function(u){var d=u.shape;g(d,"bpmn:SubProcess")&&(Q(d)?p(u):(l(u),a._showRecursively(d.children)))},!0),this.reverted("shape.toggleCollapse",Vc,function(u){var d=u.shape;g(d,"bpmn:SubProcess")&&(Q(d)?p(u):(l(u),a._showRecursively(d.children)))},!0),this.postExecuted("shape.toggleCollapse",Ng,function(u){var d=u.shape;if(g(d,"bpmn:SubProcess")){var f=u.newRootElement;f&&(Q(d)?a._moveChildrenToShape(f,d):a._moveChildrenToShape(d,f))}},!0),t.on("copyPaste.createTree",function(u){var d=u.element,f=u.children;if(c(d)){var m=Tn(d),h=s.get(m);h&&f.push.apply(f,h.children)}}),t.on("copyPaste.copyElement",function(u){var d=u.descriptor,f=u.element,m=u.elements,h=f.parent,v=g(ie(h),"bpmndi:BPMNPlane");if(v){var b=Ks(h),E=ue(m,function(y){return y.id===b});E&&(d.parent=E.id)}}),t.on("copyPaste.pasteElement",function(u){var d=u.descriptor;d.parent&&(c(d.parent)||d.parent.hidden)&&(d.hidden=!0)})}O(qt,C);qt.prototype._moveChildrenToShape=function(e,t){var n=this._modeling,i=e.children,r;if(i){i=i.concat(i.reduce(function(l,p){return p.label&&p.label.parent!==e?l.concat(p.label):l},[]));var o=i.filter(function(l){return!l.hidden});if(!o.length){n.moveElements(i,{x:0,y:0},t,{autoResize:!1});return}var s=Xe(o);if(!t.x)r={x:Fc.x-s.x,y:Fc.y-s.y};else{var a=V(t),c=V(s);r={x:a.x-c.x,y:a.y-c.y}}n.moveElements(i,r,t,{autoResize:!1})}};qt.prototype._showRecursively=function(e,t){var n=this,i=[];return e.forEach(function(r){r.hidden=!!t,i=i.concat(r),r.children&&(i=i.concat(n._showRecursively(r.children,r.collapsed||t)))}),i};qt.prototype._addDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),n.push(e.di.$parent),e};qt.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,n=this._elementFactory,i=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),r=t.create("bpmndi:BPMNDiagram",{plane:i});i.$parent=r;var o=n.createRoot({id:Tn(e),type:e.$type,di:i,businessObject:e,collapsed:!0});return o};qt.prototype._removeDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams,i=ue(n,function(r){return r.plane.bpmnElement.id===e.id});return n.splice(n.indexOf(i),1),i};qt.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"];function cs(e,t){e.invoke(C,this),this.postExecuted("shape.replace",function(n){var i=n.context.oldShape,r=n.context.newShape;if(!(!g(r,"bpmn:SubProcess")||!(g(i,"bpmn:Task")||g(i,"bpmn:CallActivity"))||!Q(r))){var o=jg(r);t.createShape({type:"bpmn:StartEvent"},o,r)}})}cs.$inject=["injector","modeling"];O(cs,C);function jg(e){return{x:e.x+e.width/6,y:e.y+e.height/2}}function ls(e){C.call(this,e),this.preExecute("connection.create",function(t){const{target:n}=t;g(n,"bpmn:TextAnnotation")&&(t.parent=n.parent)},!0),this.preExecute(["shape.create","shape.resize","elements.move"],function(t){const n=t.shapes||[t.shape];n.length===1&&g(n[0],"bpmn:TextAnnotation")&&(t.hints=t.hints||{},t.hints.autoResize=!1)},!0)}O(ls,C);ls.$inject=["eventBus"];function ps(e,t){C.call(this,e),this.postExecuted("shape.toggleCollapse",1500,function(n){var i=n.shape;if(Q(i))return;var r=_i(i);r.forEach(function(s){var a=s.incoming.slice(),c=s.outgoing.slice();x(a,function(l){o(l,!0)}),x(c,function(l){o(l,!1)})});function o(s,a){r.indexOf(s.source)!==-1&&r.indexOf(s.target)!==-1||(a?t.reconnectEnd(s,i,V(i)):t.reconnectStart(s,i,V(i)))}},!0)}O(ps,C);ps.$inject=["eventBus","modeling"];var Eo=500;function us(e,t,n){C.call(this,e);function i(s){s.length&&s.forEach(function(a){a.type==="label"&&!a.businessObject.name&&(a.hidden=!0)})}function r(s,a){var c=s.children,l=a,p,u;return p=Hg(c).concat([s]),u=pu(p),u?(l.width=Math.max(u.width,l.width),l.height=Math.max(u.height,l.height),l.x=u.x+(u.width-l.width)/2,l.y=u.y+(u.height-l.height)/2):(l.x=s.x+(s.width-l.width)/2,l.y=s.y+(s.height-l.height)/2),l}function o(s,a){return{x:s.x+(s.width-a.width)/2,y:s.y+(s.height-a.height)/2,width:a.width,height:a.height}}this.executed(["shape.toggleCollapse"],Eo,function(s){var a=s.context,c=a.shape;g(c,"bpmn:SubProcess")&&(c.collapsed?ie(c).isExpanded=!1:(i(c.children),ie(c).isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],Eo,function(s){var a=s.context,c=a.shape;c.collapsed?ie(c).isExpanded=!1:ie(c).isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],Eo,function(s){var a=s.context.shape,c=t.getDefaultSize(a),l;a.collapsed?l=o(a,c):l=r(a,c),n.resizeShape(a,l,null,{autoResize:a.collapsed?!1:"nwse"})})}O(us,C);us.$inject=["eventBus","elementFactory","modeling"];function Hg(e){return e.filter(function(t){return!t.hidden})}function ds(e,t,n,i){t.invoke(C,this),this.preExecute("shape.delete",function(r){var o=r.context,s=o.shape,a=s.businessObject;ee(s)||(g(s,"bpmn:Participant")&&Q(s)&&n.ids.unclaim(a.processRef.id),i.unclaimId(a.id,a))}),this.preExecute("connection.delete",function(r){var o=r.context,s=o.connection,a=s.businessObject;i.unclaimId(a.id,a)}),this.preExecute("canvas.updateRoot",function(){var r=e.getRootElement(),o=r.businessObject;g(r,"bpmn:Collaboration")&&n.ids.unclaim(o.id)})}O(ds,C);ds.$inject=["canvas","injector","moddle","modeling"];function fs(e,t){C.call(this,e),this.preExecute("connection.delete",function(n){var i=n.context,r=i.connection,o=r.source;Vg(r,o)&&t.updateProperties(o,{default:null})})}O(fs,C);fs.$inject=["eventBus","modeling"];function Vg(e,t){if(!g(e,"bpmn:SequenceFlow"))return!1;var n=D(t),i=D(e);return n.get("default")===i}var Fg=500,zg=5e3;function hs(e,t){C.call(this,e);var n;function i(){return n=n||new Gg,n.enter(),n}function r(){if(!n)throw new Error("out of bounds release");return n}function o(){if(!n)throw new Error("out of bounds release");var a=n.leave();return a&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null),a}var s=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(s,zg,function(a){i()}),this.postExecuted(s,Fg,function(a){o()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(a){var c=a.context,l=c.shape,p=r();l.labelTarget||(g(l,"bpmn:Lane")&&p.addLane(l),g(l,"bpmn:FlowNode")&&p.addFlowNode(l))})}hs.$inject=["eventBus","modeling"];O(hs,C);function Gg(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}const Wg={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","compensateBoundaryEventBehaviour","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","layoutConnectionBehavior","messageFlowBehavior","nonInterruptingBehavior","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","textAnnotationBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior"],adaptiveLabelPositioningBehavior:["type",Aa],appendBehavior:["type",$a],associationBehavior:["type",Oa],attachEventBehavior:["type",jr],boundaryEventBehavior:["type",La],compensateBoundaryEventBehaviour:["type",Ba],createBehavior:["type",Na],createDataObjectBehavior:["type",ja],createParticipantBehavior:["type",Ha],dataInputAssociationBehavior:["type",Va],dataStoreBehavior:["type",Fa],deleteLaneBehavior:["type",za],detachEventBehavior:["type",Fr],dropOnFlowBehavior:["type",Ga],eventBasedGatewayBehavior:["type",Wa],fixHoverBehavior:["type",uu],groupBehavior:["type",Ua],importDockingFix:["type",du],isHorizontalFix:["type",Xa],labelBehavior:["type",Ka],layoutConnectionBehavior:["type",Ya],messageFlowBehavior:["type",Ja],nonInterruptingBehavior:["type",Qa],removeElementBehavior:["type",ts],removeEmbeddedLabelBoundsBehavior:["type",es],removeParticipantBehavior:["type",ns],replaceConnectionBehavior:["type",is],replaceElementBehaviour:["type",Ur],resizeBehavior:["type",wu],resizeLaneBehavior:["type",Pu],rootElementReferenceBehavior:["type",as],spaceToolBehavior:["type",Tu],subProcessPlaneBehavior:["type",qt],subProcessStartEventBehavior:["type",cs],textAnnotationBehavior:["type",ls],toggleCollapseConnectionBehaviour:["type",ps],toggleElementCollapseBehaviour:["type",us],unclaimIdBehavior:["type",ds],unsetDefaultFlowBehavior:["type",fs],updateFlowNodeRefsBehavior:["type",hs]};function Ru(e,t){var n=Ie(e,t,-15);return n!=="intersect"?n:null}function ke(e){et.call(this,e)}O(ke,et);ke.$inject=["eventBus"];ke.prototype.init=function(){this.addRule("connection.start",function(e){var t=e.source;return Ug(t)}),this.addRule("connection.create",function(e){var t=e.source,n=e.target,i=e.hints||{},r=i.targetParent,o=i.targetAttach;if(o)return!1;r&&(n.parent=r);try{return fr(t,n)}finally{r&&(n.parent=null)}}),this.addRule("connection.reconnect",function(e){var t=e.connection,n=e.source,i=e.target;return fr(n,i,t)}),this.addRule("connection.updateWaypoints",function(e){return{type:e.connection.type}}),this.addRule("shape.resize",function(e){var t=e.shape,n=e.newBounds;return Bu(t,n)}),this.addRule("elements.create",function(e){var t=e.elements,n=e.position,i=e.target;return se(i)&&!wr(t,i)?!1:Rr(t,function(r){return se(r)?fr(r.source,r.target,r):r.host?ci(r,r.host,null,n):na(r,i,null)})}),this.addRule("elements.move",function(e){var t=e.target,n=e.shapes,i=e.position;return ci(n,t,null,i)||Ou(n,t,i)||Lu(n,t)||wr(n,t)}),this.addRule("shape.create",function(e){return na(e.shape,e.target,e.source,e.position)}),this.addRule("shape.attach",function(e){return ci(e.shape,e.target,null,e.position)}),this.addRule("element.copy",function(e){var t=e.element,n=e.elements;return Fu(n,t)})};ke.prototype.canConnectMessageFlow=Hu;ke.prototype.canConnectSequenceFlow=Vu;ke.prototype.canConnectDataAssociation=vs;ke.prototype.canConnectAssociation=Nu;ke.prototype.canConnectCompensationAssociation=ju;ke.prototype.canMove=Lu;ke.prototype.canAttach=ci;ke.prototype.canReplace=Ou;ke.prototype.canDrop=On;ke.prototype.canInsert=wr;ke.prototype.canCreate=na;ke.prototype.canConnect=fr;ke.prototype.canResize=Bu;ke.prototype.canCopy=Fu;function Ug(e){return Qo(e)?null:X(e,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}function Qo(e){return!e||ee(e)}function Xg(e,t){return e===t}function zc(e){do{if(g(e,"bpmn:Process"))return D(e);if(g(e,"bpmn:Participant"))return D(e).processRef||D(e)}while(e=e.parent)}function ea(e){return g(e,"bpmn:TextAnnotation")}function ms(e){return g(e,"bpmn:Group")&&!e.labelTarget}function ku(e){return g(e,"bpmn:BoundaryEvent")&&mt(e,"bpmn:CompensateEventDefinition")}function Xr(e){return D(e).isForCompensation}function Kg(e,t){var n=zc(e),i=zc(t);return n===i}function Yg(e){return g(e,"bpmn:InteractionNode")&&!g(e,"bpmn:BoundaryEvent")&&(!g(e,"bpmn:Event")||g(e,"bpmn:ThrowEvent")&&Du(e,"bpmn:MessageEventDefinition"))}function qg(e){return g(e,"bpmn:InteractionNode")&&!Xr(e)&&(!g(e,"bpmn:Event")||g(e,"bpmn:CatchEvent")&&Du(e,"bpmn:MessageEventDefinition"))&&!(g(e,"bpmn:BoundaryEvent")&&!mt(e,"bpmn:MessageEventDefinition"))}function Gc(e){for(var t=e;t=t.parent;){if(g(t,"bpmn:FlowElementsContainer"))return D(t);if(g(t,"bpmn:Participant"))return D(t).processRef}return null}function Mu(e,t){var n=Gc(e),i=Gc(t);return n===i}function mt(e,t){var n=D(e);return!!ue(n.eventDefinitions||[],function(i){return g(i,t)})}function Du(e,t){var n=D(e);return(n.eventDefinitions||[]).every(function(i){return g(i,t)})}function Zg(e){return g(e,"bpmn:FlowNode")&&!g(e,"bpmn:EndEvent")&&!Ne(e)&&!(g(e,"bpmn:IntermediateThrowEvent")&&mt(e,"bpmn:LinkEventDefinition"))&&!ku(e)&&!Xr(e)}function Jg(e){return g(e,"bpmn:FlowNode")&&!g(e,"bpmn:StartEvent")&&!g(e,"bpmn:BoundaryEvent")&&!Ne(e)&&!(g(e,"bpmn:IntermediateCatchEvent")&&mt(e,"bpmn:LinkEventDefinition"))&&!Xr(e)}function Qg(e){return g(e,"bpmn:ReceiveTask")||g(e,"bpmn:IntermediateCatchEvent")&&(mt(e,"bpmn:MessageEventDefinition")||mt(e,"bpmn:TimerEventDefinition")||mt(e,"bpmn:ConditionalEventDefinition")||mt(e,"bpmn:SignalEventDefinition"))}function ey(e){for(var t=[];e;)e=e.parent,e&&t.push(e);return t}function ta(e,t){var n=ey(t);return n.indexOf(e)!==-1}function fr(e,t,n){if(Qo(e)||Qo(t))return null;if(!g(n,"bpmn:DataAssociation")){if(Hu(e,t))return{type:"bpmn:MessageFlow"};if(Vu(e,t))return{type:"bpmn:SequenceFlow"}}var i=vs(e,t);return i||(ju(e,t)?{type:"bpmn:Association",associationDirection:"One"}:Nu(e,t)?{type:"bpmn:Association",associationDirection:"None"}:!1)}function On(e,t){return ee(e)||ms(e)?!0:g(t,"bpmn:Participant")&&!Q(t)?!1:g(e,"bpmn:Participant")?g(t,"bpmn:Process")||g(t,"bpmn:Collaboration"):X(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:g(e,"bpmn:Lane")?g(t,"bpmn:Participant")||g(t,"bpmn:Lane"):g(e,"bpmn:BoundaryEvent")&&!ty(e)?!1:g(e,"bpmn:FlowElement")&&!g(e,"bpmn:DataStoreReference")?g(t,"bpmn:FlowElementsContainer")?Q(t):X(t,["bpmn:Participant","bpmn:Lane"]):g(e,"bpmn:DataStoreReference")&&g(t,"bpmn:Collaboration")?bi(D(t).get("participants"),function(n){return!!n.get("processRef")}):X(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?X(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):g(e,"bpmn:MessageFlow")?g(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t:!1}function ty(e){return D(e).cancelActivity&&(Iu(e)||Au(e))}function ny(e){return!ee(e)&&g(e,"bpmn:BoundaryEvent")}function iy(e){return g(e,"bpmn:Lane")}function ry(e){return ny(e)||g(e,"bpmn:IntermediateThrowEvent")&&Iu(e)?!0:g(e,"bpmn:IntermediateCatchEvent")&&Au(e)}function Iu(e){var t=D(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function Au(e){return $u(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function $u(e,t){return t.some(function(n){return mt(e,n)})}function oy(e){return g(e,"bpmn:ReceiveTask")&&ue(e.incoming,function(t){return g(t.source,"bpmn:EventBasedGateway")})}function ci(e,t,n,i){if(Array.isArray(e)||(e=[e]),e.length!==1)return!1;var r=e[0];return ee(r)||!ry(r)||Ne(t)||!g(t,"bpmn:Activity")||Xr(t)||i&&!Ru(i,t)||oy(t)?!1:"attach"}function Ou(e,t,n){if(!t)return!1;var i={replacements:[]};return x(e,function(r){Ne(t)||g(r,"bpmn:StartEvent")&&r.type!=="label"&&On(r,t)&&(th(r)||i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),(nh(r)||ih(r)||rh(r))&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),$u(r,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&g(t,"bpmn:SubProcess")&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"})),g(t,"bpmn:Transaction")||mt(r,"bpmn:CancelEventDefinition")&&r.type!=="label"&&(g(r,"bpmn:EndEvent")&&On(r,t)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:EndEvent"}),g(r,"bpmn:BoundaryEvent")&&ci(r,t,null,n)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:BoundaryEvent"}))}),i.replacements.length?i:!1}function Lu(e,t){return bi(e,iy)?!1:t?e.every(function(n){return On(n,t)}):!0}function na(e,t,n,i){return t?ee(e)||ms(e)?!0:Xg(n,t)||n&&ta(n,t)?!1:On(e,t)||wr(e,t):!1}function Bu(e,t){return g(e,"bpmn:SubProcess")?Q(e)&&(!t||t.width>=100&&t.height>=80):!!(g(e,"bpmn:Lane")||g(e,"bpmn:Participant")||ea(e)||ms(e))}function ay(e,t){var n=ea(e),i=ea(t);return(n||i)&&n!==i}function Nu(e,t){return ta(t,e)||ta(e,t)?!1:ay(e,t)?!0:!!vs(e,t)}function ju(e,t){return Mu(e,t)&&ku(e)&&g(t,"bpmn:Activity")&&!cy(t,e)&&!Ne(t)}function Hu(e,t){return Wc(e)&&!Wc(t)?!1:Yg(e)&&qg(t)&&!Kg(e,t)}function Vu(e,t){return Zg(e)&&Jg(t)&&Mu(e,t)&&!(g(e,"bpmn:EventBasedGateway")&&!Qg(t))}function vs(e,t){return X(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&X(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:X(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&X(e,["bpmn:Activity","bpmn:CatchEvent"])?{type:"bpmn:DataOutputAssociation"}:!1}function wr(e,t,n){if(!t)return!1;if(Array.isArray(e)){if(e.length!==1)return!1;e=e[0]}return t.source===e||t.target===e?!1:X(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!ee(t)&&g(e,"bpmn:FlowNode")&&!g(e,"bpmn:BoundaryEvent")&&On(e,t.parent)}function sy(e,t){return e&&t&&e.indexOf(t)!==-1}function Fu(e,t){return ee(t)?!0:!(g(t,"bpmn:Lane")&&!sy(e,t.parent))}function Wc(e){return hi(e,"bpmn:Process")||hi(e,"bpmn:Collaboration")}function cy(e,t){return e.attachers.includes(t)}const ly={__depends__:[bt],__init__:["bpmnRules"],bpmnRules:["type",ke]};var py=2e3;function zu(e,t){e.on("saveXML.start",py,n);function n(){var i=t.getRootElements();x(i,function(r){var o=ie(r),s,a;s=_i([r],!1),s=K(s,function(c){return c!==r&&!c.labelTarget}),a=Ge(s,ie),o.set("planeElement",a)})}}zu.$inject=["eventBus","canvas"];const uy={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",zu]};function Kr(e){C.call(this,e);var t=this;this.preExecute(["shape.create","connection.create"],function(n){var i=n.context,r=i.shape||i.connection,o=i.parent,s=t.getOrdering(r,o);s&&(s.parent!==void 0&&(i.parent=s.parent),i.parentIndex=s.index)}),this.preExecute(["shape.move","connection.move"],function(n){var i=n.context,r=i.shape||i.connection,o=i.newParent||r.parent,s=t.getOrdering(r,o);s&&(s.parent!==void 0&&(i.newParent=s.parent),i.newParentIndex=s.index)})}Kr.prototype.getOrdering=function(e,t){return null};O(Kr,C);function gs(e,t){Kr.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:9,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:TextAnnotation",order:{level:9}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function i(s){if(s.labelTarget)return{level:10};var a=ue(n,function(c){return X(s,[c.type])});return a&&a.order||{level:1}}function r(s){var a=s.order;if(a||(s.order=a=i(s)),!a)throw new Error(`no order for <${s.id}>`);return a}function o(s,a,c){for(var l=a;l&&!X(l,c);)l=l.parent;if(!l)throw new Error(`no parent for <${s.id}> in <${a&&a.id}>`);return l}this.getOrdering=function(s,a){if(s.labelTarget||g(s,"bpmn:TextAnnotation"))return{parent:t.findRoot(a)||t.getRootElement(),index:-1};var c=r(s);c.containers&&(a=o(s,a,c.containers));var l=a.children.indexOf(s),p=oh(a.children,function(u){return!s.labelTarget&&u.labelTarget?!1:c.level<r(u).level});return p!==-1&&l!==-1&&l<p&&(p-=1),{index:p,parent:a}}}gs.$inject=["eventBus","canvas"];O(gs,Kr);const dy={__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",gs]};function Pi(){}Pi.prototype.get=function(){return this._data};Pi.prototype.set=function(e){this._data=e};Pi.prototype.clear=function(){var e=this._data;return delete this._data,e};Pi.prototype.isEmpty=function(){return!this._data};const fy={clipboard:["type",Pi]};var hy="drop-ok",Uc="drop-not-ok",Xc="attach-ok",Kc="new-parent",Yc="create",my=2e3;function Gu(e,t,n,i,r){function o(c,l,p,u,d){if(!l)return!1;c=K(c,function(E){var y=E.labelTarget;return!E.parent&&!(ee(E)&&c.indexOf(y)!==-1)});var f=ue(c,function(E){return!se(E)}),m=!1,h=!1,v=!1;Zc(c)&&(m=r.allowed("shape.attach",{position:p,shape:f,target:l})),m||(Zc(c)?v=r.allowed("shape.create",{position:p,shape:f,source:u,target:l}):v=r.allowed("elements.create",{elements:c,position:p,target:l}));var b=d.connectionTarget;return v||m?(f&&u&&(h=r.allowed("connection.create",{source:b===u?f:u,target:b===u?u:f,hints:{targetParent:l,targetAttach:m}})),{attach:m,connect:h}):v===null||m===null?null:!1}function s(c,l){[Xc,hy,Uc,Kc].forEach(function(p){p===l?e.addMarker(c,p):e.removeMarker(c,p)})}n.on(["create.move","create.hover"],function(c){var l=c.context,p=l.elements,u=c.hover,d=l.source,f=l.hints||{};if(!u){l.canExecute=!1,l.target=null;return}qc(c);var m={x:c.x,y:c.y},h=l.canExecute=u&&o(p,u,m,d,f);u&&h!==null&&(l.target=u,h&&h.attach?s(u,Xc):s(u,h?Kc:Uc))}),n.on(["create.end","create.out","create.cleanup"],function(c){var l=c.hover;l&&s(l,null)}),n.on("create.end",function(c){var l=c.context,p=l.source,u=l.shape,d=l.elements,f=l.target,m=l.canExecute,h=m&&m.attach,v=m&&m.connect,b=l.hints||{};if(m===!1||!f)return!1;qc(c);var E={x:c.x,y:c.y};v?u=i.appendShape(p,u,E,f,{attach:h,connection:v===!0?{}:v,connectionTarget:b.connectionTarget}):(d=i.createElements(d,E,f,S({},b,{attach:h})),u=ue(d,function(y){return!se(y)})),S(l,{elements:d,shape:u}),S(c,{elements:d,shape:u})});function a(){var c=t.context();c&&c.prefix===Yc&&t.cancel()}n.on("create.init",function(){n.on("elements.changed",a),n.once(["create.cancel","create.end"],my,function(){n.off("elements.changed",a)})}),this.start=function(c,l,p){J(l)||(l=[l]);var u=ue(l,function(m){return!se(m)});if(u){p=S({elements:l,hints:{},shape:u},p||{}),x(l,function(m){Y(m.x)||(m.x=0),Y(m.y)||(m.y=0)});var d=K(l,function(m){return!m.hidden}),f=Xe(d);x(l,function(m){se(m)&&(m.waypoints=Ge(m.waypoints,function(h){return{x:h.x-f.x-f.width/2,y:h.y-f.y-f.height/2}})),S(m,{x:m.x-f.x-f.width/2,y:m.y-f.y-f.height/2})}),t.init(c,Yc,{cursor:"grabbing",autoActivate:!0,data:{shape:u,elements:l,context:p}})}}}Gu.$inject=["canvas","dragging","eventBus","modeling","rules"];function qc(e){var t=e.context,n=t.createConstraints;n&&(n.left&&(e.x=Math.max(e.x,n.left)),n.right&&(e.x=Math.min(e.x,n.right)),n.top&&(e.y=Math.max(e.y,n.top)),n.bottom&&(e.y=Math.min(e.y,n.bottom)))}function Zc(e){return e&&e.length===1&&!se(e[0])}var vy=750;function Wu(e,t,n,i,r){function o(s){var a=oe("g");U(a,r.cls("djs-drag-group",["no-events"]));var c=oe("g");return s.forEach(function(l){var p;l.hidden||(l.waypoints?(p=n._createContainer("connection",c),n.drawConnection(Mn(p),l)):(p=n._createContainer("shape",c),n.drawShape(Mn(p),l),Le(p,l.x,l.y)),i.addDragger(l,a,p))}),a}t.on("create.move",vy,function(s){var a=s.hover,c=s.context,l=c.elements,p=c.dragGroup;p||(p=c.dragGroup=o(l));var u;a?(p.parentNode||(u=e.getActiveLayer(),ae(u,p)),Le(p,s.x,s.y)):Be(p)}),t.on("create.cleanup",function(s){var a=s.context,c=a.dragGroup;c&&Be(c)})}Wu.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const Yr={__depends__:[$t,Gn,bt,It],__init__:["create","createPreview"],create:["type",Gu],createPreview:["type",Wu]};function ys(e){var t=this;this._lastMoveEvent=null;function n(i){t._lastMoveEvent=i}e.on("canvas.init",function(i){var r=t._svg=i.svg;r.addEventListener("mousemove",n)}),e.on("canvas.destroy",function(){t._lastMouseEvent=null,t._svg.removeEventListener("mousemove",n)})}ys.$inject=["eventBus"];ys.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||gy(0,0)};function gy(e,t){var n=document.createEvent("MouseEvent"),i=e,r=t,o=e,s=t;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,i,r,o,s,!1,!1,!1,!1,0,null),n}const Ci={__init__:["mouse"],mouse:["type",ys]};function ut(e,t,n,i,r,o,s,a){this._canvas=e,this._create=t,this._clipboard=n,this._elementFactory=i,this._eventBus=r,this._modeling=o,this._mouse=s,this._rules=a,r.on("copyPaste.copyElement",function(c){var l=c.descriptor,p=c.element,u=c.elements;l.priority=1,l.id=p.id;var d=ue(u,function(f){return f===p.parent});d&&(l.parent=p.parent.id),yy(p)&&(l.priority=2,l.host=p.host.id),se(p)&&(l.priority=3,l.source=p.source.id,l.target=p.target.id,l.waypoints=_y(p)),ee(p)&&(l.priority=4,l.labelTarget=p.labelTarget.id),x(["x","y","width","height"],function(f){Y(p[f])&&(l[f]=p[f])}),l.hidden=p.hidden,l.collapsed=p.collapsed}),r.on("copyPaste.pasteElements",function(c){var l=c.hints;S(l,{createElementsBehavior:!1})})}ut.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"];ut.prototype.copy=function(e){var t,n;return J(e)||(e=e?[e]:[]),t=this._eventBus.fire("copyPaste.canCopyElements",{elements:e}),t===!1?n={}:n=this.createTree(J(t)?t:e),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:e,tree:n}),n};ut.prototype.paste=function(e){var t=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=e&&e.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var i=this._createElements(t);if(e&&e.element&&e.point)return this._paste(i,e.element,e.point,n);this._create.start(this._mouse.getLastMoveEvent(),i,{hints:n||{}})}};ut.prototype._paste=function(e,t,n,i){x(e,function(o){Y(o.x)||(o.x=0),Y(o.y)||(o.y=0)});var r=Xe(e);return x(e,function(o){se(o)&&(o.waypoints=Ge(o.waypoints,function(s){return{x:s.x-r.x-r.width/2,y:s.y-r.y-r.height/2}})),S(o,{x:o.x-r.x-r.width/2,y:o.y-r.y-r.height/2})}),this._modeling.createElements(e,n,t,S({},i))};ut.prototype._createElements=function(e){var t=this,n=this._eventBus,i={},r=[];return x(e,function(o,s){o=gt(o,"priority"),x(o,function(a){var c=S({},Dt(a,["priority"]));i[a.parent]?c.parent=i[a.parent]:delete c.parent,n.fire("copyPaste.pasteElement",{cache:i,descriptor:c});var l;if(se(c)){c.source=i[a.source],c.target=i[a.target],l=i[a.id]=t.createConnection(c),r.push(l);return}if(ee(c)){c.labelTarget=i[c.labelTarget],l=i[a.id]=t.createLabel(c),r.push(l);return}c.host&&(c.host=i[c.host]),l=i[a.id]=t.createShape(c),r.push(l)})}),r};ut.prototype.createConnection=function(e){var t=this._elementFactory.createConnection(Dt(e,["id"]));return t};ut.prototype.createLabel=function(e){var t=this._elementFactory.createLabel(Dt(e,["id"]));return t};ut.prototype.createShape=function(e){var t=this._elementFactory.createShape(Dt(e,["id"]));return t};ut.prototype.hasRelations=function(e,t){var n,i,r;return!(se(e)&&(i=ue(t,Tt({id:e.source.id})),r=ue(t,Tt({id:e.target.id})),!i||!r)||ee(e)&&(n=ue(t,Tt({id:e.labelTarget.id})),!n))};ut.prototype.createTree=function(e){var t=this._rules,n=this,i={},r=[],o=kr(e);function s(l,p){return t.allowed("element.copy",{element:l,elements:p})}function a(l,p){var u=ue(r,function(d){return l===d.element});if(!u){r.push({element:l,depth:p});return}u.depth<p&&(r=c(u,r),r.push({element:u.element,depth:p}))}function c(l,p){var u=p.indexOf(l);return u!==-1&&p.splice(u,1),p}return Ir(o,function(l,p,u){if(ee(l))return;x(l.labels,function(m){a(m,u)});function d(m){m&&m.length&&x(m,function(h){x(h.labels,function(v){a(v,u)}),a(h,u)})}x([l.attachers,l.incoming,l.outgoing],d),a(l,u);var f=[];return l.children&&(f=l.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:l,children:f}),f}),e=Ge(r,function(l){return l.element}),r=Ge(r,function(l){return l.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:l.descriptor,element:l.element,elements:e}),l}),r=gt(r,function(l){return l.descriptor.priority}),e=Ge(r,function(l){return l.element}),x(r,function(l){var p=l.depth;if(!n.hasRelations(l.element,e)){Qc(l.element,e);return}if(!s(l.element,e)){Qc(l.element,e);return}i[p]||(i[p]=[]),i[p].push(l.descriptor)}),i};function yy(e){return!!e.host}function _y(e){return Ge(e.waypoints,function(t){return t=Jc(t),t.original&&(t.original=Jc(t.original)),t})}function Jc(e){return S({},e)}function Qc(e,t){var n=t.indexOf(e);return n===-1?t:t.splice(n,1)}const by={__depends__:[fy,Yr,Ci,bt],__init__:["copyPaste"],copyPaste:["type",ut]};function xo(e,t,n){J(n)||(n=[n]),x(n,function(i){bp(e[i])||(t[i]=e[i])})}var wo=750;function Uu(e,t,n){function i(c,l){var p=e.create(c.$type);return n.copyElement(c,p,null,l)}t.on("copyPaste.copyElement",wo,function(c){var l=c.descriptor,p=c.element,u=D(p);if(ee(p))return l;var d=l.businessObject=i(u,!0),f=l.di=i(ie(p),!0);f.bpmnElement=d,xo(d,l,"name"),xo(f,l,"isExpanded"),u.default&&(l.default=u.default.id)});var r="-bpmn-js-refs";function o(c){return c[r]=c[r]||{}}function s(c,l){c[r]=l}function a(c,l,p){var u=D(c);return c.default&&(p[c.default]={element:u,property:"default"}),c.host&&(D(c).attachedToRef=D(l[c.host])),Dt(p,Xt(p,function(d,f,m){var h=f.element,v=f.property;return m===c.id&&(h.set(v,u),d.push(c.id)),d},[]))}t.on("copyPaste.pasteElement",function(c){var l=c.cache,p=c.descriptor,u=p.businessObject,d=p.di;if(ee(p)){p.businessObject=D(l[p.labelTarget]),p.di=ie(l[p.labelTarget]);return}u=p.businessObject=i(u),d=p.di=i(d),d.bpmnElement=u,xo(p,u,["isExpanded","name"]),p.type=u.$type}),t.on("copyPaste.copyElement",wo,function(c){var l=c.descriptor,p=c.element;if(g(p,"bpmn:Participant")){var u=D(p);u.processRef&&(l.processRef=i(u.processRef,!0))}}),t.on("copyPaste.pasteElement",function(c){var l=c.descriptor,p=l.processRef;p&&(l.processRef=i(p))}),t.on("copyPaste.pasteElement",wo,function(c){var l=c.cache,p=c.descriptor;s(l,a(p,l,o(l)))})}Uu.$inject=["bpmnFactory","eventBus","moddleCopy"];var Ey=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing","categoryValue"];function Ti(e,t,n){this._bpmnFactory=t,this._eventBus=e,this._moddle=n,e.on("moddleCopy.canCopyProperties",function(i){var r=i.propertyNames;if(!(!r||!r.length))return gt(r,function(o){return o==="extensionElements"})}),e.on("moddleCopy.canCopyProperty",function(i){var r=i.parent,o=Mt(r)&&r.$descriptor,s=i.propertyName;if(s&&Ey.indexOf(s)!==-1||s&&o&&!ue(o.properties,Tt({name:s})))return!1}),e.on("moddleCopy.canSetCopiedProperty",function(i){var r=i.property;if(xy(r,"bpmn:ExtensionElements")&&(!r.values||!r.values.length))return!1})}Ti.$inject=["eventBus","bpmnFactory","moddle"];Ti.prototype.copyElement=function(e,t,n,i=!1){var r=this;n&&!J(n)&&(n=[n]),n=n||ia(e.$descriptor);var o=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:n,sourceElement:e,targetElement:t,clone:i});return o===!1||(J(o)&&(n=o),x(n,function(s){var a;zt(e,s)&&(a=e.get(s));var c=r.copyProperty(a,t,s,i);if(Ue(c)){var l=r._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:c,propertyName:s});l!==!1&&t.set(s,c)}})),t};Ti.prototype.copyProperty=function(e,t,n,i=!1){var r=this,o=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:n,clone:i});if(o!==!1){if(o)return Mt(o)&&o.$type&&!o.$parent&&(o.$parent=t),o;var s=this._moddle.getPropertyDescriptor(t,n);if(!s.isReference)return s.isId?e&&this._copyId(e,t,i):J(e)?Xt(e,function(a,c){return o=r.copyProperty(c,t,n,i),o?a.concat(o):a},[]):Mt(e)&&e.$type?this._moddle.getElementDescriptor(e).isGeneric?void 0:(o=r._bpmnFactory.create(e.$type),o.$parent=t,o=r.copyElement(e,o,null,i),o):e}};Ti.prototype._copyId=function(e,t,n=!1){if(n)return e;if(!this._moddle.ids.assigned(e))return this._moddle.ids.claim(e,t),e};function ia(e,t){return Xt(e.properties,function(n,i){return t&&i.default?n:n.concat(i.name)},[])}function xy(e,t){return e&&Qe(e.$instanceOf)&&e.$instanceOf(t)}const Xu={__depends__:[by],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",Uu],moddleCopy:["type",Ti]};var el=Math.round;function _s(e,t){this._modeling=e,this._eventBus=t}_s.$inject=["modeling","eventBus"];_s.prototype.replaceElement=function(e,t,n){if(e.waypoints)return null;var i=this._modeling,r=this._eventBus;r.fire("replace.start",{element:e,attrs:t,hints:n});var o=t.width||e.width,s=t.height||e.height,a=t.x||e.x,c=t.y||e.y,l=el(a+o/2),p=el(c+s/2),u=i.replaceShape(e,S({},t,{x:l,y:p,width:o,height:s}),n);return r.fire("replace.end",{element:e,newElement:u,hints:n}),u};function Ku(e,t){t.on("replace.end",500,function(n){const{newElement:i,hints:r={}}=n;r.select!==!1&&e.select(i)})}Ku.$inject=["selection","eventBus"];const wy={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Ku],replace:["type",_s]};function Sy(e,t,n){J(n)||(n=[n]),x(n,function(i){bp(e[i])||(t[i]=e[i])})}var Py=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function Cy(e,t){var n=e&&zt(e,"collapsed")?e.collapsed:!Q(e),i;return t&&(zt(t,"collapsed")||zt(t,"isExpanded"))?i=zt(t,"collapsed")?t.collapsed:!t.isExpanded:i=n,n!==i}function Yu(e,t,n,i,r,o){function s(a,c,l){l=l||{};var p=c.type,u=a.businessObject;if(er(u)&&p==="bpmn:SubProcess"&&Cy(a,c))return i.toggleCollapse(a),a;var d=e.create(p),f={type:p,businessObject:d};f.di={},p==="bpmn:ExclusiveGateway"&&(f.di.isMarkerVisible=!0),Sy(a.di,f.di,["fill","stroke","background-color","border-color","color"]);var m=ia(u.$descriptor),h=ia(d.$descriptor,!0),v=Ty(m,h);S(d,yt(c,Py));var b=K(v,function(_){return _==="eventDefinitions"?tl(a,c.eventDefinitionType):_==="loopCharacteristics"?!Ne(d):zt(d,_)||_==="processRef"&&c.isExpanded===!1||_==="triggeredByEvent"?!1:_==="isForCompensation"?!Ne(d):!0});if(d=n.copyElement(u,d,b),c.eventDefinitionType&&(tl(d,c.eventDefinitionType)||(f.eventDefinitionType=c.eventDefinitionType,f.eventDefinitionAttrs=c.eventDefinitionAttrs)),g(u,"bpmn:Activity")){if(er(u))f.isExpanded=Q(a);else if(c&&zt(c,"isExpanded")){f.isExpanded=c.isExpanded;var E=t.getDefaultSize(d,{isExpanded:f.isExpanded});f.width=E.width,f.height=E.height,f.x=a.x-(f.width-a.width)/2,f.y=a.y-(f.height-a.height)/2}Q(a)&&!g(u,"bpmn:Task")&&f.isExpanded&&(f.width=a.width,f.height=a.height)}if(er(u)&&!er(d)&&(l.moveChildren=!1),g(u,"bpmn:Participant")){c.isExpanded===!0?d.processRef=e.create("bpmn:Process"):l.moveChildren=!1;var y=Me(a);ie(a).isHorizontal||(ie(f).isHorizontal=y),f.width=y?a.width:t.getDefaultSize(f).width,f.height=y?t.getDefaultSize(f).height:a.height}return o.allowed("shape.resize",{shape:d})||(f.height=t.getDefaultSize(f).height,f.width=t.getDefaultSize(f).width),d.name=u.name,X(u,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&X(d,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(d.default=u.default),c.host&&!g(u,"bpmn:BoundaryEvent")&&g(d,"bpmn:BoundaryEvent")&&(f.host=c.host),(f.type==="bpmn:DataStoreReference"||f.type==="bpmn:DataObjectReference")&&(f.x=a.x+(a.width-f.width)/2),r.replaceElement(a,f,{...l,targetElement:c})}this.replaceElement=s}Yu.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules"];function er(e){return g(e,"bpmn:SubProcess")}function tl(e,t){var n=D(e);return t&&n.get("eventDefinitions").some(function(i){return g(i,t)})}function Ty(e,t){return e.filter(function(n){return t.includes(n)})}const qu={__depends__:[Xu,wy,It],bpmnReplace:["type",Yu]};var Ry=250;function vn(e){this._eventBus=e,this._tools=[],this._active=null}vn.$inject=["eventBus"];vn.prototype.registerTool=function(e,t){var n=this._tools;if(!t)throw new Error(`A tool has to be registered with it's "events"`);n.push(e),this.bindEvents(e,t)};vn.prototype.isActive=function(e){return e&&this._active===e};vn.prototype.length=function(e){return this._tools.length};vn.prototype.setActive=function(e){var t=this._eventBus;this._active!==e&&(this._active=e,t.fire("tool-manager.update",{tool:e}))};vn.prototype.bindEvents=function(e,t){var n=this._eventBus,i=[];n.on(t.tool+".init",function(r){var o=r.context;if(!o.reactivate&&this.isActive(e)){this.setActive(null);return}this.setActive(e)},this),x(t,function(r){i.push(r+".ended"),i.push(r+".canceled")}),n.on(i,Ry,function(r){this._active&&(ky(r)||this.setActive(null))},this)};function ky(e){var t=e.originalEvent&&e.originalEvent.target;return t&&yi(t,'.group[data-group="tools"]')}const qr={__depends__:[$t],__init__:["toolManager"],toolManager:["type",vn]};function My(e,t){if(e==="x"){if(t>0)return"e";if(t<0)return"w"}if(e==="y"){if(t>0)return"s";if(t<0)return"n"}return null}function Dy(e,t){var n=[];return x(e.concat(t),function(i){var r=i.incoming,o=i.outgoing;x(r.concat(o),function(s){var a=s.source,c=s.target;(ni(e,a)||ni(e,c)||ni(t,a)||ni(t,c))&&(ni(n,s)||n.push(s))})}),n}function ni(e,t){return e.indexOf(t)!==-1}function Iy(e,t,n){var i=e.x,r=e.y,o=e.width,s=e.height,a=n.x,c=n.y;switch(t){case"n":return{x:i,y:r+c,width:o,height:s-c};case"s":return{x:i,y:r,width:o,height:s+c};case"w":return{x:i+a,y:r,width:o-a,height:s};case"e":return{x:i,y:r,width:o+a,height:s};default:throw new Error("unknown direction: "+t)}}var So=Math.abs,Ay=Math.round,St={x:"width",y:"height"},Zu="crosshair",Vt={n:"top",w:"left",s:"bottom",e:"right"},$y=1500,tr={n:"s",w:"e",s:"n",e:"w"},nr=20;function tt(e,t,n,i,r,o,s){this._canvas=e,this._dragging=t,this._eventBus=n,this._modeling=i,this._rules=r,this._toolManager=o,this._mouse=s;var a=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",function(c){n.once("spaceTool.selection.ended",function(){a.activateMakeSpace(c.originalEvent)})}),n.on("spaceTool.move",$y,function(c){var l=c.context,p=l.initialized;p||(p=l.initialized=a.init(c,l)),p&&il(c)}),n.on("spaceTool.end",function(c){var l=c.context,p=l.axis,u=l.direction,d=l.movingShapes,f=l.resizingShapes,m=l.start;if(l.initialized){il(c);var h={x:0,y:0};h[p]=Ay(c["d"+p]),a.makeSpace(d,f,h,u,m),n.once("spaceTool.ended",function(v){a.activateSelection(v.originalEvent,!0,!0)})}})}tt.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"];tt.prototype.activateSelection=function(e,t,n){this._dragging.init(e,"spaceTool.selection",{autoActivate:t,cursor:Zu,data:{context:{reactivate:n}},trapClick:!1})};tt.prototype.activateMakeSpace=function(e){this._dragging.init(e,"spaceTool",{autoActivate:!0,cursor:Zu,data:{context:{}}})};tt.prototype.makeSpace=function(e,t,n,i,r){return this._modeling.createSpace(e,t,n,i,r)};tt.prototype.init=function(e,t){var n=So(e.dx)>So(e.dy)?"x":"y",i=e["d"+n],r=e[n]-i;if(So(i)<5)return!1;i<0&&(i*=-1),fi(e)&&(i*=-1);var o=My(n,i),s=this._canvas.getRootElement();!jo(e)&&e.hover&&(s=e.hover);var a=[..._i(s,!0),...s.attachers||[]],c=this.calculateAdjustments(a,n,i,r),l=this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:o,shapes:c.resizingShapes,start:r}),p=Oy(c,n,o,r,l);return S(t,c,{axis:n,direction:o,spaceToolConstraints:p,start:r}),hp("resize-"+(n==="x"?"ew":"ns")),!0};tt.prototype.calculateAdjustments=function(e,t,n,i){var r=this._rules,o=[],s=[],a=[],c=[];function l(d){o.includes(d)||o.push(d);var f=d.label;f&&!o.includes(f)&&o.push(f)}function p(d){s.includes(d)||s.push(d)}x(e,function(d){if(!(!d.parent||ee(d))){if(se(d)){c.push(d);return}var f=d[t],m=f+d[St[t]];if(Ly(d)&&(n>0&&V(d)[t]>i||n<0&&V(d)[t]<i)){a.push(d);return}if(n>0&&f>i||n<0&&m<i){l(d);return}if(f<i&&m>i&&r.allowed("shape.resize",{shape:d})){p(d);return}}}),x(o,function(d){var f=d.attachers;f&&x(f,function(m){l(m)})});var u=o.concat(s);return x(a,function(d){var f=d.host;dn(u,f)&&l(d)}),u=o.concat(s),x(c,function(d){var f=d.source,m=d.target,h=d.label;dn(u,f)&&dn(u,m)&&h&&l(h)}),{movingShapes:o,resizingShapes:s}};tt.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};tt.prototype.isActive=function(){var e=this._dragging.context();return e?/^spaceTool/.test(e.prefix):!1};function nl(e){return{top:e.top-nr,right:e.right+nr,bottom:e.bottom+nr,left:e.left-nr}}function il(e){var t=e.context,n=t.spaceToolConstraints;if(n){var i,r;Y(n.left)&&(i=Math.max(e.x,n.left),e.dx=e.dx+i-e.x,e.x=i),Y(n.right)&&(i=Math.min(e.x,n.right),e.dx=e.dx+i-e.x,e.x=i),Y(n.top)&&(r=Math.max(e.y,n.top),e.dy=e.dy+r-e.y,e.y=r),Y(n.bottom)&&(r=Math.min(e.y,n.bottom),e.dy=e.dy+r-e.y,e.y=r)}}function Oy(e,t,n,i,r){var o=e.movingShapes,s=e.resizingShapes;if(s.length){var a={},c,l;return x(s,function(p){var u=p.attachers,d=p.children,f=B(p),m=K(d,function(T){return!se(T)&&!ee(T)&&!dn(o,T)&&!dn(s,T)}),h=K(d,function(T){return!se(T)&&!ee(T)&&dn(o,T)}),v,b,E,y=[],_=[],w,P,R,j;m.length&&(b=nl(B(Xe(m))),v=i-f[Vt[n]]+b[Vt[n]],n==="n"?a.bottom=l=Y(l)?Math.min(l,v):v:n==="w"?a.right=l=Y(l)?Math.min(l,v):v:n==="s"?a.top=c=Y(c)?Math.max(c,v):v:n==="e"&&(a.left=c=Y(c)?Math.max(c,v):v)),h.length&&(E=nl(B(Xe(h))),v=i-E[Vt[tr[n]]]+f[Vt[tr[n]]],n==="n"?a.bottom=l=Y(l)?Math.min(l,v):v:n==="w"?a.right=l=Y(l)?Math.min(l,v):v:n==="s"?a.top=c=Y(c)?Math.max(c,v):v:n==="e"&&(a.left=c=Y(c)?Math.max(c,v):v)),u&&u.length&&(u.forEach(function(T){dn(o,T)?y.push(T):_.push(T)}),y.length&&(w=B(Xe(y.map(V))),P=f[Vt[tr[n]]]-(w[Vt[tr[n]]]-i)),_.length&&(R=B(Xe(_.map(V))),j=R[Vt[n]]-(f[Vt[n]]-i)),n==="n"?(v=Math.min(P||1/0,j||1/0),a.bottom=l=Y(l)?Math.min(l,v):v):n==="w"?(v=Math.min(P||1/0,j||1/0),a.right=l=Y(l)?Math.min(l,v):v):n==="s"?(v=Math.max(P||-1/0,j||-1/0),a.top=c=Y(c)?Math.max(c,v):v):n==="e"&&(v=Math.max(P||-1/0,j||-1/0),a.left=c=Y(c)?Math.max(c,v):v));var F=r&&r[p.id];F&&(n==="n"?(v=i+p[St[t]]-F[St[t]],a.bottom=l=Y(l)?Math.min(l,v):v):n==="w"?(v=i+p[St[t]]-F[St[t]],a.right=l=Y(l)?Math.min(l,v):v):n==="s"?(v=i-p[St[t]]+F[St[t]],a.top=c=Y(c)?Math.max(c,v):v):n==="e"&&(v=i-p[St[t]]+F[St[t]],a.left=c=Y(c)?Math.max(c,v):v))}),a}}function dn(e,t){return e.indexOf(t)!==-1}function Ly(e){return!!e.host}var Po="djs-dragging",rl="djs-resizing",By=250,ir=Math.max;function Ju(e,t,n,i,r){function o(s,a){x(s,function(c){r.addDragger(c,a),n.addMarker(c,Po)})}e.on("spaceTool.selection.start",function(s){var a=n.getLayer("space"),c=s.context,l={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},p=oe("g");U(p,i.cls("djs-crosshair-group",["no-events"])),ae(a,p);var u=oe("path");U(u,"d",l.x),ce(u).add("djs-crosshair"),ae(p,u);var d=oe("path");U(d,"d",l.y),ce(d).add("djs-crosshair"),ae(p,d),c.crosshairGroup=p}),e.on("spaceTool.selection.move",function(s){var a=s.context.crosshairGroup;Le(a,s.x,s.y)}),e.on("spaceTool.selection.cleanup",function(s){var a=s.context,c=a.crosshairGroup;c&&Be(c)}),e.on("spaceTool.move",By,function(s){var a=s.context,c=a.line,l=a.axis,p=a.movingShapes,u=a.resizingShapes;if(a.initialized){if(!a.dragGroup){var d=n.getLayer("space");c=oe("path"),U(c,"d","M0,0 L0,0"),ce(c).add("djs-crosshair"),ae(d,c),a.line=c;var f=oe("g");U(f,i.cls("djs-drag-group",["no-events"])),ae(n.getActiveLayer(),f),o(p,f);var m=a.movingConnections=t.filter(function(_){var w=!1;x(p,function(F){x(F.outgoing,function(T){_===T&&(w=!0)})});var P=!1;x(p,function(F){x(F.incoming,function(T){_===T&&(P=!0)})});var R=!1;x(u,function(F){x(F.outgoing,function(T){_===T&&(R=!0)})});var j=!1;return x(u,function(F){x(F.incoming,function(T){_===T&&(j=!0)})}),se(_)&&(w||R)&&(P||j)});o(m,f),a.dragGroup=f}if(!a.frameGroup){var h=oe("g");U(h,i.cls("djs-frame-group",["no-events"])),ae(n.getActiveLayer(),h);var v=[];x(u,function(_){var w=r.addFrame(_,h),P=w.getBBox();v.push({element:w,initialBounds:P}),n.addMarker(_,rl)}),a.frameGroup=h,a.frames=v}var b={x:"M"+s.x+", -10000 L"+s.x+", 10000",y:"M -10000, "+s.y+" L 10000, "+s.y};U(c,{d:b[l]});var E={x:"y",y:"x"},y={x:s.dx,y:s.dy};y[E[a.axis]]=0,Le(a.dragGroup,y.x,y.y),x(a.frames,function(_){var w=_.element,P=_.initialBounds,R,j;a.direction==="e"?U(w,{width:ir(P.width+y.x,5)}):(R=ir(P.width-y.x,5),U(w,{width:R,x:P.x+P.width-R})),a.direction==="s"?U(w,{height:ir(P.height+y.y,5)}):(j=ir(P.height-y.y,5),U(w,{height:j,y:P.y+P.height-j}))})}}),e.on("spaceTool.cleanup",function(s){var a=s.context,c=a.movingShapes,l=a.movingConnections,p=a.resizingShapes,u=a.line,d=a.dragGroup,f=a.frameGroup;x(c,function(m){n.removeMarker(m,Po)}),x(l,function(m){n.removeMarker(m,Po)}),d&&(Be(u),Be(d)),x(p,function(m){n.removeMarker(m,rl)}),f&&Be(f)})}Ju.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const Ny={__init__:["spaceToolPreview"],__depends__:[$t,bt,qr,Gn,Ci],spaceTool:["type",tt],spaceToolPreview:["type",Ju]};function Zr(e){e.invoke(tt,this)}Zr.$inject=["injector"];O(Zr,tt);Zr.prototype.calculateAdjustments=function(e,t,n,i){var r=tt.prototype.calculateAdjustments.call(this,e,t,n,i);return r.resizingShapes=r.resizingShapes.filter(function(o){return!(g(o,"bpmn:TextAnnotation")||jy(o)&&(t==="y"&&Me(o)||t==="x"&&!Me(o)))}),r};function jy(e){return g(e,"bpmn:Participant")&&!D(e).processRef}const Qu={__depends__:[Ny],spaceTool:["type",Zr]};function fe(e,t){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=t,this._eventBus=e,this._uid=1,e.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}fe.$inject=["eventBus","injector"];fe.prototype.execute=function(e,t){if(!e)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:e,context:t};this._pushAction(n),this._internalExecute(n),this._popAction()};fe.prototype.canExecute=function(e,t){const n={command:e,context:t},i=this._getHandler(e);let r=this._fire(e,"canExecute",n);if(r===void 0){if(!i)return!1;i.canExecute&&(r=i.canExecute(t))}return r};fe.prototype.clear=function(e){this._stack.length=0,this._stackIdx=-1,e!==!1&&this._fire("changed",{trigger:"clear"})};fe.prototype.undo=function(){let e=this._getUndoAction(),t;if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};fe.prototype.redo=function(){let e=this._getRedoAction(),t;if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};fe.prototype.register=function(e,t){this._setHandler(e,t)};fe.prototype.registerHandler=function(e,t){if(!e||!t)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(t);this.register(e,n)};fe.prototype.canUndo=function(){return!!this._getUndoAction()};fe.prototype.canRedo=function(){return!!this._getRedoAction()};fe.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};fe.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};fe.prototype._internalUndo=function(e){const t=e.command,n=e.context,i=this._getHandler(t);this._atomicDo(()=>{this._fire(t,"revert",e),i.revert&&this._markDirty(i.revert(n)),this._revertedAction(e),this._fire(t,"reverted",e)})};fe.prototype._fire=function(e,t,n){arguments.length<3&&(n=t,t=null);const i=t?[e+"."+t,t]:[e];let r;n=this._eventBus.createEvent(n);for(const o of i)if(r=this._eventBus.fire("commandStack."+o,n),n.cancelBubble)break;return r};fe.prototype._createId=function(){return this._uid++};fe.prototype._atomicDo=function(e){const t=this._currentExecution;t.atomic=!0;try{e()}finally{t.atomic=!1}};fe.prototype._internalExecute=function(e,t){const n=e.command,i=e.context,r=this._getHandler(n);if(!r)throw new Error("no command handler registered for <"+n+">");this._pushAction(e),t||(this._fire(n,"preExecute",e),r.preExecute&&r.preExecute(i),this._fire(n,"preExecuted",e)),this._atomicDo(()=>{this._fire(n,"execute",e),r.execute&&this._markDirty(r.execute(i)),this._executedAction(e,t),this._fire(n,"executed",e)}),t||(this._fire(n,"postExecute",e),r.postExecute&&r.postExecute(i),this._fire(n,"postExecuted",e)),this._popAction()};fe.prototype._pushAction=function(e){const t=this._currentExecution,n=t.actions,i=n[0];if(t.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+e.command+")");e.id||(e.id=i&&i.id||this._createId()),n.push(e)};fe.prototype._popAction=function(){const e=this._currentExecution,t=e.trigger,n=e.actions,i=e.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:ah("id",i.reverse())}),i.length=0,this._fire("changed",{trigger:t}),e.trigger=null)};fe.prototype._markDirty=function(e){const t=this._currentExecution;e&&(e=J(e)?e:[e],t.dirty=t.dirty.concat(e))};fe.prototype._executedAction=function(e,t){const n=++this._stackIdx;t||this._stack.splice(n,this._stack.length,e)};fe.prototype._revertedAction=function(e){this._stackIdx--};fe.prototype._getHandler=function(e){return this._handlerMap[e]};fe.prototype._setHandler=function(e,t){if(!e||!t)throw new Error("command and handler required");if(this._handlerMap[e])throw new Error("overriding handler for command <"+e+">");this._handlerMap[e]=t};const Hy={commandStack:["type",fe]};function Wt(e,t){if(typeof t!="function")throw new Error("removeFn iterator must be a function");if(e){for(var n;n=e[0];)t(n);return e}}var Vy=250,ol=1400;function bs(e,t,n){C.call(this,t);var i=e.get("movePreview",!1);t.on("shape.move.start",ol,function(r){var o=r.context,s=o.shapes,a=o.validatedShapes;o.shapes=al(s),o.validatedShapes=al(a)}),i&&t.on("shape.move.start",Vy,function(r){var o=r.context,s=o.shapes,a=[];x(s,function(c){x(c.labels,function(l){!l.hidden&&o.shapes.indexOf(l)===-1&&a.push(l),c.labelTarget&&a.push(c)})}),x(a,function(c){i.makeDraggable(o,c,!0)})}),this.preExecuted("elements.move",ol,function(r){var o=r.context,s=o.closure,a=s.enclosedElements,c=[];x(a,function(l){x(l.labels,function(p){a[p.id]||c.push(p)})}),s.addAll(c)}),this.preExecute(["connection.delete","shape.delete"],function(r){var o=r.context,s=o.connection||o.shape;Wt(s.labels,function(a){n.removeShape(a,{nested:!0})})}),this.execute("shape.delete",function(r){var o=r.context,s=o.shape,a=s.labelTarget;a&&(o.labelTargetIndex=_a(a.labels,s),o.labelTarget=a,s.labelTarget=null)}),this.revert("shape.delete",function(r){var o=r.context,s=o.shape,a=o.labelTarget,c=o.labelTargetIndex;a&&(we(a.labels,s,c),s.labelTarget=a)})}O(bs,C);bs.$inject=["injector","eventBus","modeling"];function al(e){return K(e,function(t){return e.indexOf(t.labelTarget)===-1})}const Fy={__init__:["labelSupport"],labelSupport:["type",bs]};var zy=251,sl=1401,cl="attach-ok";function Es(e,t,n,i,r){C.call(this,t);var o=e.get("movePreview",!1);t.on("shape.move.start",sl,function(s){var a=s.context,c=a.shapes,l=a.validatedShapes;a.shapes=Gy(c),a.validatedShapes=Wy(l)}),o&&t.on("shape.move.start",zy,function(s){var a=s.context,c=a.shapes,l=ra(c);x(l,function(p){o.makeDraggable(a,p,!0),x(p.labels,function(u){o.makeDraggable(a,u,!0)})})}),o&&t.on("shape.move.start",function(s){var a=s.context,c=a.shapes;if(c.length===1){var l=c[0],p=l.host;p&&(n.addMarker(p,cl),t.once(["shape.move.out","shape.move.cleanup"],function(){n.removeMarker(p,cl)}))}}),this.preExecuted("elements.move",sl,function(s){var a=s.context,c=a.closure,l=a.shapes,p=ra(l);x(p,function(u){c.add(u,c.topLevel[u.host.id])})}),this.postExecuted("elements.move",function(s){var a=s.context,c=a.shapes,l=a.newHost,p;l&&c.length!==1||(l?p=c:p=K(c,function(u){var d=u.host;return Uy(u)&&!Xy(c,d)}),x(p,function(u){r.updateAttachment(u,l)}))}),this.postExecuted("elements.move",function(s){var a=s.context.shapes;x(a,function(c){x(c.attachers,function(l){x(l.outgoing.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)}),x(l.incoming.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)})})})}),this.postExecute("shape.create",function(s){var a=s.context,c=a.shape,l=a.host;l&&r.updateAttachment(c,l)}),this.postExecute("shape.replace",function(s){var a=s.context,c=a.oldShape,l=a.newShape;Wt(c.attachers,function(p){var u=i.allowed("elements.move",{target:l,shapes:[p]});u==="attach"?r.updateAttachment(p,l):r.removeShape(p)}),l.attachers.length&&x(l.attachers,function(p){var u=Bc(p,c,l);r.moveShape(p,u,p.parent)})}),this.postExecute("shape.resize",function(s){var a=s.context,c=a.shape,l=a.oldBounds,p=a.newBounds,u=c.attachers,d=a.hints||{};d.attachSupport!==!1&&x(u,function(f){var m=Bc(f,l,p);r.moveShape(f,m,f.parent),x(f.labels,function(h){r.moveShape(h,m,h.parent)})})}),this.preExecute("shape.delete",function(s){var a=s.context.shape;Wt(a.attachers,function(c){r.removeShape(c)}),a.host&&r.updateAttachment(a,null)})}O(Es,C);Es.$inject=["injector","eventBus","canvas","rules","modeling"];function ra(e){return ha(Ge(e,function(t){return t.attachers||[]}))}function Gy(e){var t=ra(e);return sh("id",e,t)}function Wy(e){var t=Mr(e,"id");return K(e,function(n){for(;n;){if(n.host&&t[n.host.id])return!1;n=n.parent}return!0})}function Uy(e){return!!e.host}function Xy(e,t){return e.indexOf(t)!==-1}const Ky={__depends__:[bt],__init__:["attachSupport"],attachSupport:["type",Es]};function nt(e){this._model=e}nt.$inject=["moddle"];nt.prototype._needsId=function(e){return X(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])};nt.prototype._ensureId=function(e){if(e.id){this._model.ids.claim(e.id,e);return}var t;g(e,"bpmn:Activity")?t="Activity":g(e,"bpmn:Event")?t="Event":g(e,"bpmn:Gateway")?t="Gateway":X(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?t="Flow":t=(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e))};nt.prototype.create=function(e,t){var n=this._model.create(e,t||{});return this._ensureId(n),n};nt.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})};nt.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",S({bpmnElement:e,bounds:this.createDiBounds()},t))};nt.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)};nt.prototype.createDiWaypoints=function(e){var t=this;return Ge(e,function(n){return t.createDiWaypoint(n)})};nt.prototype.createDiWaypoint=function(e){return this.create("dc:Point",yt(e,["x","y"]))};nt.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",S({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))};nt.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",S({bpmnElement:e},t))};function We(e,t,n){C.call(this,e),this._bpmnFactory=t;var i=this;function r(f){var m=f.context,h=m.hints||{},v;!m.cropped&&h.createElementsBehavior!==!1&&(v=m.connection,v.waypoints=n.getCroppedWaypoints(v),m.cropped=!0)}this.executed(["connection.layout","connection.create"],r),this.reverted(["connection.layout"],function(f){delete f.context.cropped});function o(f){var m=f.context;i.updateParent(m.shape||m.connection,m.oldParent)}function s(f){var m=f.context,h=m.shape||m.connection,v=m.parent||m.newParent;i.updateParent(h,v)}this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ze(o)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ze(s));function a(f){var m=f.context,h=m.oldRoot,v=h.children;x(v,function(b){g(b,"bpmn:BaseElement")&&i.updateParent(b)})}this.executed(["canvas.updateRoot"],a),this.reverted(["canvas.updateRoot"],a);function c(f){var m=f.context.shape;g(m,"bpmn:BaseElement")&&i.updateBounds(m)}this.executed(["shape.move","shape.create","shape.resize"],ze(function(f){f.context.shape.type!=="label"&&c(f)})),this.reverted(["shape.move","shape.create","shape.resize"],ze(function(f){f.context.shape.type!=="label"&&c(f)})),e.on("shape.changed",function(f){f.element.type==="label"&&c({context:{shape:f.element}})});function l(f){i.updateConnection(f.context)}this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],ze(l)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],ze(l));function p(f){i.updateConnectionWaypoints(f.context.connection)}this.executed(["connection.layout","connection.move","connection.updateWaypoints"],ze(p)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],ze(p)),this.executed("connection.reconnect",ze(function(f){var m=f.context,h=m.connection,v=m.oldSource,b=m.newSource,E=D(h),y=D(v),_=D(b);E.conditionExpression&&!X(_,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(m.oldConditionExpression=E.conditionExpression,delete E.conditionExpression),v!==b&&y.default===E&&(m.oldDefault=y.default,delete y.default)})),this.reverted("connection.reconnect",ze(function(f){var m=f.context,h=m.connection,v=m.oldSource,b=m.newSource,E=D(h),y=D(v),_=D(b);m.oldConditionExpression&&(E.conditionExpression=m.oldConditionExpression),m.oldDefault&&(y.default=m.oldDefault,delete _.default)}));function u(f){i.updateAttachment(f.context)}this.executed(["element.updateAttachment"],ze(u)),this.reverted(["element.updateAttachment"],ze(u)),this.executed("element.updateLabel",ze(d)),this.reverted("element.updateLabel",ze(d));function d(f){const{element:m}=f.context,h=Ut(m),v=ie(m),b=v&&v.get("label");In(m)||pr(m)||(h&&!b?v.set("label",t.create("bpmndi:BPMNLabel")):!h&&b&&v.set("label",void 0))}}O(We,C);We.$inject=["eventBus","bpmnFactory","connectionDocking"];We.prototype.updateAttachment=function(e){var t=e.shape,n=t.businessObject,i=t.host;n.attachedToRef=i&&i.businessObject};We.prototype.updateParent=function(e,t){if(!ee(e)&&!(g(e,"bpmn:DataStoreReference")&&e.parent&&g(e.parent,"bpmn:Collaboration"))){var n=e.parent,i=e.businessObject,r=ie(e),o=n&&n.businessObject,s=ie(n);g(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(i,o,t&&t.businessObject),g(e,"bpmn:DataOutputAssociation")&&(e.source?o=e.source.businessObject:o=null),g(e,"bpmn:DataInputAssociation")&&(e.target?o=e.target.businessObject:o=null),this.updateSemanticParent(i,o),g(e,"bpmn:DataObjectReference")&&i.dataObjectRef&&this.updateSemanticParent(i.dataObjectRef,o),this.updateDiParent(r,s)}};We.prototype.updateBounds=function(e){var t=ie(e),n=qy(e);if(n){var i=Rt(n,t.get("bounds"));S(n,{x:e.x+i.x,y:e.y+i.y})}var r=ee(e)?this._getLabel(t):t,o=r.bounds;o||(o=this._bpmnFactory.createDiBounds(),r.set("bounds",o)),S(o,{x:e.x,y:e.y,width:e.width,height:e.height})};We.prototype.updateFlowNodeRefs=function(e,t,n){if(n!==t){var i,r;g(n,"bpmn:Lane")&&(i=n.get("flowNodeRef"),be(i,e)),g(t,"bpmn:Lane")&&(r=t.get("flowNodeRef"),we(r,e))}};We.prototype.updateDiConnection=function(e,t,n){var i=ie(e),r=ie(t),o=ie(n);i.sourceElement&&i.sourceElement.bpmnElement!==D(t)&&(i.sourceElement=t&&r),i.targetElement&&i.targetElement.bpmnElement!==D(n)&&(i.targetElement=n&&o)};We.prototype.updateDiParent=function(e,t){if(t&&!g(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var n=(t||e.$parent).get("planeElement");t?(n.push(e),e.$parent=t):(be(n,e),e.$parent=null)}};function Yy(e){for(;e&&!g(e,"bpmn:Definitions");)e=e.$parent;return e}We.prototype.getLaneSet=function(e){var t,n;return g(e,"bpmn:Lane")?(t=e.childLaneSet,t||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(g(e,"bpmn:Participant")&&(e=e.processRef),n=e.get("laneSets"),t=n[0],t||(t=this._bpmnFactory.create("bpmn:LaneSet"),t.$parent=e,n.push(t)),t)};We.prototype.updateSemanticParent=function(e,t,n){var i;if(e.$parent!==t&&!((g(e,"bpmn:DataInput")||g(e,"bpmn:DataOutput"))&&(g(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),"ioSpecification"in t&&t.ioSpecification===e.$parent))){if(g(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),i="lanes";else if(g(e,"bpmn:FlowElement")){if(t){if(g(t,"bpmn:Participant"))t=t.processRef;else if(g(t,"bpmn:Lane"))do t=t.$parent.$parent;while(g(t,"bpmn:Lane"))}i="flowElements"}else if(g(e,"bpmn:Artifact")){for(;t&&!g(t,"bpmn:Process")&&!g(t,"bpmn:SubProcess")&&!g(t,"bpmn:Collaboration");)if(g(t,"bpmn:Participant")){t=t.processRef;break}else t=t.$parent;i="artifacts"}else if(g(e,"bpmn:MessageFlow"))i="messageFlows";else if(g(e,"bpmn:Participant")){i="participants";var r=e.processRef,o;r&&(o=Yy(e.$parent||t),e.$parent&&(be(o.get("rootElements"),r),r.$parent=null),t&&(we(o.get("rootElements"),r),r.$parent=o))}else g(e,"bpmn:DataOutputAssociation")?i="dataOutputAssociations":g(e,"bpmn:DataInputAssociation")&&(i="dataInputAssociations");if(!i)throw new Error(`no parent for <${e.id}> in <${t.id}>`);var s;if(e.$parent&&(s=e.$parent.get(i),be(s,e)),t?(s=t.get(i),s.push(e),e.$parent=t):e.$parent=null,n){var a=n.get(i);be(s,e),t&&(a||(a=[],t.set(i,a)),a.push(e))}}};We.prototype.updateConnectionWaypoints=function(e){var t=ie(e);t.set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))};We.prototype.updateConnection=function(e){var t=e.connection,n=D(t),i=t.source,r=D(i),o=t.target,s=D(t.target),a;if(g(n,"bpmn:DataAssociation"))g(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=r,a=e.parent||e.newParent||s,this.updateSemanticParent(n,s,a)):g(n,"bpmn:DataOutputAssociation")&&(a=e.parent||e.newParent||r,this.updateSemanticParent(n,r,a),n.targetRef=s);else{var c=g(n,"bpmn:SequenceFlow");n.sourceRef!==r&&(c&&(be(n.sourceRef&&n.sourceRef.get("outgoing"),n),r&&r.get("outgoing")&&r.get("outgoing").push(n)),n.sourceRef=r),n.targetRef!==s&&(c&&(be(n.targetRef&&n.targetRef.get("incoming"),n),s&&s.get("incoming")&&s.get("incoming").push(n)),n.targetRef=s)}this.updateConnectionWaypoints(t),this.updateDiConnection(t,i,o)};We.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label};function ze(e){return function(t){var n=t.context,i=n.shape||n.connection||n.element;g(i,"bpmn:BaseElement")&&e(t)}}function qy(e){if(g(e,"bpmn:Activity")){var t=ie(e);if(t){var n=t.get("label");if(n)return n.get("bounds")}}}function Zt(e,t){ba.call(this),this._bpmnFactory=e,this._moddle=t}O(Zt,ba);Zt.$inject=["bpmnFactory","moddle"];Zt.prototype._baseCreate=ba.prototype.create;Zt.prototype.create=function(e,t){if(e==="label"){var n=t.di||this._bpmnFactory.createDiLabel();return this._baseCreate(e,S({type:"label",di:n},ch,t))}return this.createElement(e,t)};Zt.prototype.createElement=function(e,t){t=S({},t||{});var n,i=t.businessObject,r=t.di;if(!i){if(!t.type)throw new Error("no shape type specified");i=this._bpmnFactory.create(t.type),lh(i)}if(!Jy(r)){var o=S({},r||{},{id:i.id+"_di"});e==="root"?r=this._bpmnFactory.createDiPlane(i,o):e==="connection"?r=this._bpmnFactory.createDiEdge(i,o):r=this._bpmnFactory.createDiShape(i,o)}g(i,"bpmn:Group")&&(t=S({isFrame:!0},t)),t=Zy(i,t,["processRef","isInterrupting","associationDirection","isForCompensation"]),t.isExpanded&&(t=oa(r,t,"isExpanded")),X(i,["bpmn:Lane","bpmn:Participant"])&&(t=oa(r,t,"isHorizontal")),g(i,"bpmn:SubProcess")&&(t.collapsed=!Q(i,r)),g(i,"bpmn:ExclusiveGateway")&&(zt(r,"isMarkerVisible")?r.isMarkerVisible===void 0&&(r.isMarkerVisible=!1):r.isMarkerVisible=!0),Ue(t.triggeredByEvent)&&(i.triggeredByEvent=t.triggeredByEvent,delete t.triggeredByEvent),Ue(t.cancelActivity)&&(i.cancelActivity=t.cancelActivity,delete t.cancelActivity);var s,a;return t.eventDefinitionType&&(s=i.get("eventDefinitions")||[],a=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),t.eventDefinitionType==="bpmn:ConditionalEventDefinition"&&(a.condition=this._bpmnFactory.create("bpmn:FormalExpression")),s.push(a),a.$parent=i,i.eventDefinitions=s,delete t.eventDefinitionType),n=this.getDefaultSize(i,r),t=S({id:i.id},n,t,{businessObject:i,di:r}),this._baseCreate(e,t)};Zt.prototype.getDefaultSize=function(e,t){var n=D(e);if(t=t||ie(e),g(n,"bpmn:SubProcess"))return Q(n,t)?{width:350,height:200}:{width:100,height:80};if(g(n,"bpmn:Task"))return{width:100,height:80};if(g(n,"bpmn:Gateway"))return{width:50,height:50};if(g(n,"bpmn:Event"))return{width:36,height:36};if(g(n,"bpmn:Participant")){var i=t.isHorizontal===void 0||t.isHorizontal===!0;return Q(n,t)?i?{width:600,height:250}:{width:250,height:600}:i?{width:400,height:60}:{width:60,height:400}}return g(n,"bpmn:Lane")?{width:400,height:100}:g(n,"bpmn:DataObjectReference")?{width:36,height:50}:g(n,"bpmn:DataStoreReference")?{width:50,height:50}:g(n,"bpmn:TextAnnotation")?{width:100,height:30}:g(n,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}};Zt.prototype.createParticipantShape=function(e){return Mt(e)||(e={isExpanded:e}),e=S({type:"bpmn:Participant"},e||{}),e.isExpanded!==!1&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)};function Zy(e,t,n){return x(n,function(i){t=oa(e,t,i)}),t}function oa(e,t,n){return t[n]===void 0?t:(e[n]=t[n],Dt(t,[n]))}function Jy(e){return X(e,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])}function Jr(e,t){this._modeling=e,this._canvas=t}Jr.$inject=["modeling","canvas"];Jr.prototype.preExecute=function(e){var t=this._modeling,n=e.elements,i=e.alignment;x(n,function(r){var o={x:0,y:0};Ue(i.left)?o.x=i.left-r.x:Ue(i.right)?o.x=i.right-r.width-r.x:Ue(i.center)?o.x=i.center-Math.round(r.width/2)-r.x:Ue(i.top)?o.y=i.top-r.y:Ue(i.bottom)?o.y=i.bottom-r.height-r.y:Ue(i.middle)&&(o.y=i.middle-Math.round(r.height/2)-r.y),t.moveElements([r],o,r.parent)})};Jr.prototype.postExecute=function(e){};function Qr(e){this._modeling=e}Qr.$inject=["modeling"];Qr.prototype.preExecute=function(e){var t=e.source;if(!t)throw new Error("source required");var n=e.target||t.parent,i=e.shape,r=e.hints||{};i=e.shape=this._modeling.createShape(i,e.position,n,{attach:r.attach}),e.shape=i};Qr.prototype.postExecute=function(e){var t=e.hints||{};Qy(e.source,e.shape)||(t.connectionTarget===e.source?this._modeling.connect(e.shape,e.source,e.connection):this._modeling.connect(e.source,e.shape,e.connection))};function Qy(e,t){return bi(e.outgoing,function(n){return n.target===t})}function eo(e,t){this._canvas=e,this._layouter=t}eo.$inject=["canvas","layouter"];eo.prototype.execute=function(e){var t=e.connection,n=e.source,i=e.target,r=e.parent,o=e.parentIndex,s=e.hints;if(!n||!i)throw new Error("source and target required");if(!r)throw new Error("parent required");return t.source=n,t.target=i,t.waypoints||(t.waypoints=this._layouter.layoutConnection(t,s)),this._canvas.addConnection(t,r,o),t};eo.prototype.revert=function(e){var t=e.connection;return this._canvas.removeConnection(t),t.source=null,t.target=null,t};var rr=Math.round;function xs(e){this._modeling=e}xs.$inject=["modeling"];xs.prototype.preExecute=function(e){var t=e.elements,n=e.parent,i=e.parentIndex,r=e.position,o=e.hints,s=this._modeling;x(t,function(u){Y(u.x)||(u.x=0),Y(u.y)||(u.y=0)});var a=K(t,function(u){return!u.hidden}),c=Xe(a);x(t,function(u){se(u)&&(u.waypoints=Ge(u.waypoints,function(d){return{x:rr(d.x-c.x-c.width/2+r.x),y:rr(d.y-c.y-c.height/2+r.y)}})),S(u,{x:rr(u.x-c.x-c.width/2+r.x),y:rr(u.y-c.y-c.height/2+r.y)})});var l=kr(t),p={};x(t,function(u){if(se(u)){p[u.id]=Y(i)?s.createConnection(p[u.source.id],p[u.target.id],i,u,u.parent||n,o):s.createConnection(p[u.source.id],p[u.target.id],u,u.parent||n,o);return}var d=S({},o);l.indexOf(u)===-1&&(d.autoResize=!1),ee(u)&&(d=Dt(d,["attach"])),p[u.id]=Y(i)?s.createShape(u,yt(u,["x","y","width","height"]),u.parent||n,i,d):s.createShape(u,yt(u,["x","y","width","height"]),u.parent||n,d)}),e.elements=ma(p)};var ll=Math.round;function Jt(e){this._canvas=e}Jt.$inject=["canvas"];Jt.prototype.execute=function(e){var t=e.shape,n=e.position,i=e.parent,r=e.parentIndex;if(!i)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?S(t,n):S(t,{x:n.x-ll(t.width/2),y:n.y-ll(t.height/2)}),this._canvas.addShape(t,i,r),t};Jt.prototype.revert=function(e){var t=e.shape;return this._canvas.removeShape(t),t};function Ri(e){Jt.call(this,e)}O(Ri,Jt);Ri.$inject=["canvas"];var e_=Jt.prototype.execute;Ri.prototype.execute=function(e){var t=e.shape;return n_(t),t.labelTarget=e.labelTarget,e_.call(this,e)};var t_=Jt.prototype.revert;Ri.prototype.revert=function(e){return e.shape.labelTarget=null,t_.call(this,e)};function n_(e){["width","height"].forEach(function(t){typeof e[t]>"u"&&(e[t]=0)})}function ki(e,t){this._canvas=e,this._modeling=t}ki.$inject=["canvas","modeling"];ki.prototype.preExecute=function(e){var t=this._modeling,n=e.connection;Wt(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),Wt(n.outgoing,function(i){t.removeConnection(i,{nested:!0})})};ki.prototype.execute=function(e){var t=e.connection,n=t.parent;return e.parent=n,e.parentIndex=_a(n.children,t),e.source=t.source,e.target=t.target,this._canvas.removeConnection(t),t.source=null,t.target=null,t};ki.prototype.revert=function(e){var t=e.connection,n=e.parent,i=e.parentIndex;return t.source=e.source,t.target=e.target,we(n.children,t,i),this._canvas.addConnection(t,n),t};function ws(e,t){this._modeling=e,this._elementRegistry=t}ws.$inject=["modeling","elementRegistry"];ws.prototype.postExecute=function(e){var t=this._modeling,n=this._elementRegistry,i=e.elements;x(i,function(r){n.get(r.id)&&(r.waypoints?t.removeConnection(r):t.removeShape(r))})};function Mi(e,t){this._canvas=e,this._modeling=t}Mi.$inject=["canvas","modeling"];Mi.prototype.preExecute=function(e){var t=this._modeling,n=e.shape;Wt(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),Wt(n.outgoing,function(i){t.removeConnection(i,{nested:!0})}),Wt(n.children,function(i){se(i)?t.removeConnection(i,{nested:!0}):t.removeShape(i,{nested:!0})})};Mi.prototype.execute=function(e){var t=this._canvas,n=e.shape,i=n.parent;return e.oldParent=i,e.oldParentIndex=_a(i.children,n),t.removeShape(n),n};Mi.prototype.revert=function(e){var t=this._canvas,n=e.shape,i=e.oldParent,r=e.oldParentIndex;return we(i.children,n,r),t.addShape(n,i),n};function to(e){this._modeling=e}to.$inject=["modeling"];var pl={x:"y",y:"x"};to.prototype.preExecute=function(e){var t=this._modeling,n=e.groups,i=e.axis,r=e.dimension;function o(v,b){v.range.min=Math.min(b[i],v.range.min),v.range.max=Math.max(b[i]+b[r],v.range.max)}function s(v){return v[i]+v[r]/2}function a(v){return v.length-1}function c(v){return v.max-v.min}function l(v,b){var E={y:0};E[i]=v-s(b),E[i]&&(E[pl[i]]=0,t.moveElements([b],E,b.parent))}var p=n[0],u=a(n),d=n[u],f,m,h=0;x(n,function(v,b){var E,y,_;if(v.elements.length<2){b&&b!==n.length-1&&(o(v,v.elements[0]),h+=c(v.range));return}E=gt(v.elements,i),y=E[0],b===u&&(y=E[a(E)]),_=s(y),v.range=null,x(E,function(w){if(l(_,w),v.range===null){v.range={min:w[i],max:w[i]+w[r]};return}o(v,w)}),b&&b!==n.length-1&&(h+=c(v.range))}),m=Math.abs(d.range.min-p.range.max),f=Math.round((m-h)/(n.length-1)),!(f<n.length-1)&&x(n,function(v,b){var E={},y;v===p||v===d||(y=n[b-1],v.range.max=0,x(v.elements,function(_,w){E[pl[i]]=0,E[i]=y.range.max-_[i]+f,v.range.min!==_[i]&&(E[i]+=_[i]-v.range.min),E[i]&&t.moveElements([_],E,_.parent),v.range.max=Math.max(_[i]+_[r],w?v.range.max:0)}))})};to.prototype.postExecute=function(e){};function no(e,t){this._layouter=e,this._canvas=t}no.$inject=["layouter","canvas"];no.prototype.execute=function(e){var t=e.connection,n=t.waypoints;return S(e,{oldWaypoints:n}),t.waypoints=this._layouter.layoutConnection(t,e.hints),t};no.prototype.revert=function(e){var t=e.connection;return t.waypoints=e.oldWaypoints,t};function Ss(){}Ss.prototype.execute=function(e){var t=e.connection,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldParent=o,e.oldParentIndex=be(o.children,t),we(i.children,t,r),t.parent=i,x(t.waypoints,function(s){s.x+=n.x,s.y+=n.y,s.original&&(s.original.x+=n.x,s.original.y+=n.y)}),t};Ss.prototype.revert=function(e){var t=e.connection,n=t.parent,i=e.oldParent,r=e.oldParentIndex,o=e.delta;return be(n.children,t),we(i.children,t,r),t.parent=i,x(t.waypoints,function(s){s.x-=o.x,s.y-=o.y,s.original&&(s.original.x-=o.x,s.original.y-=o.y)}),t};function Ps(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}Ps.prototype.add=function(e,t){return this.addAll([e],t)};Ps.prototype.addAll=function(e,t){var n=ph(e,!!t,this);return S(this,n),this};function Di(e){this._modeling=e}Di.prototype.moveRecursive=function(e,t,n){return e?this.moveClosure(this.getClosure(e),t,n):[]};Di.prototype.moveClosure=function(e,t,n,i,r){var o=this._modeling,s=e.allShapes,a=e.allConnections,c=e.enclosedConnections,l=e.topLevel,p=!1;r&&r.parent===n&&(p=!0),x(s,function(u){o.moveShape(u,t,l[u.id]&&!p&&n,{recurse:!1,layout:!1})}),x(a,function(u){var d=!!s[u.source.id],f=!!s[u.target.id];c[u.id]&&d&&f?o.moveConnection(u,t,l[u.id]&&!p&&n):o.layoutConnection(u,{connectionStart:d&&qa(u,u.source,t),connectionEnd:f&&Za(u,u.target,t)})})};Di.prototype.getClosure=function(e){return new Ps().addAll(e,!0)};function io(e){this._helper=new Di(e)}io.$inject=["modeling"];io.prototype.preExecute=function(e){e.closure=this._helper.getClosure(e.shapes)};io.prototype.postExecute=function(e){var t=e.hints,n;t&&t.primaryShape&&(n=t.primaryShape,t.oldParent=n.parent),this._helper.moveClosure(e.closure,e.delta,e.newParent,e.newHost,n)};function gn(e){this._modeling=e,this._helper=new Di(e)}gn.$inject=["modeling"];gn.prototype.execute=function(e){var t=e.shape,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldBounds=yt(t,["x","y","width","height"]),e.oldParent=o,e.oldParentIndex=be(o.children,t),we(i.children,t,r),S(t,{parent:i,x:t.x+n.x,y:t.y+n.y}),t};gn.prototype.postExecute=function(e){var t=e.shape,n=e.delta,i=e.hints,r=this._modeling;i.layout!==!1&&(x(t.incoming,function(o){r.layoutConnection(o,{connectionEnd:Za(o,t,n)})}),x(t.outgoing,function(o){r.layoutConnection(o,{connectionStart:qa(o,t,n)})})),i.recurse!==!1&&this.moveChildren(e)};gn.prototype.revert=function(e){var t=e.shape,n=e.oldParent,i=e.oldParentIndex,r=e.delta;return we(n.children,t,i),S(t,{parent:n,x:t.x-r.x,y:t.y-r.y}),t};gn.prototype.moveChildren=function(e){var t=e.delta,n=e.shape;this._helper.moveRecursive(n.children,t,null)};gn.prototype.getNewParent=function(e){return e.newParent||e.shape.parent};function Ii(e){this._modeling=e}Ii.$inject=["modeling"];Ii.prototype.execute=function(e){var t=e.newSource,n=e.newTarget,i=e.connection,r=e.dockingOrPoints;if(!t&&!n)throw new Error("newSource or newTarget required");return J(r)&&(e.oldWaypoints=i.waypoints,i.waypoints=r),t&&(e.oldSource=i.source,i.source=t),n&&(e.oldTarget=i.target,i.target=n),i};Ii.prototype.postExecute=function(e){var t=e.connection,n=e.newSource,i=e.newTarget,r=e.dockingOrPoints,o=e.hints||{},s={};o.connectionStart&&(s.connectionStart=o.connectionStart),o.connectionEnd&&(s.connectionEnd=o.connectionEnd),o.layoutConnection!==!1&&(n&&(!i||o.docking==="source")&&(s.connectionStart=s.connectionStart||ul(J(r)?r[0]:r)),i&&(!n||o.docking==="target")&&(s.connectionEnd=s.connectionEnd||ul(J(r)?r[r.length-1]:r)),o.newWaypoints&&(s.waypoints=o.newWaypoints),this._modeling.layoutConnection(t,s))};Ii.prototype.revert=function(e){var t=e.oldSource,n=e.oldTarget,i=e.oldWaypoints,r=e.connection;return t&&(r.source=t),n&&(r.target=n),i&&(r.waypoints=i),r};function ul(e){return e.original||e}function Lt(e,t){this._modeling=e,this._rules=t}Lt.$inject=["modeling","rules"];Lt.prototype.preExecute=function(e){var t=this,n=this._modeling,i=this._rules,r=e.oldShape,o=e.newData,s=e.hints||{},a;function c(m,h,v){return i.allowed("connection.reconnect",{connection:v,source:m,target:h})}var l={x:o.x,y:o.y},p={x:r.x,y:r.y,width:r.width,height:r.height};a=e.newShape=e.newShape||t.createShape(o,l,r.parent,s),r.host&&n.updateAttachment(a,r.host);var u;s.moveChildren!==!1&&(u=r.children.slice(),n.moveElements(u,{x:0,y:0},a,s));var d=r.incoming.slice(),f=r.outgoing.slice();x(d,function(m){var h=m.source,v=c(h,a,m);v&&t.reconnectEnd(m,a,Gr(m,a,p),s)}),x(f,function(m){var h=m.target,v=c(a,h,m);v&&t.reconnectStart(m,a,zr(m,a,p),s)})};Lt.prototype.postExecute=function(e){var t=e.oldShape;this._modeling.removeShape(t)};Lt.prototype.execute=function(e){};Lt.prototype.revert=function(e){};Lt.prototype.createShape=function(e,t,n,i){return this._modeling.createShape(e,t,n,i)};Lt.prototype.reconnectStart=function(e,t,n,i){this._modeling.reconnectStart(e,t,n,i)};Lt.prototype.reconnectEnd=function(e,t,n,i){this._modeling.reconnectEnd(e,t,n,i)};function Ai(e){this._modeling=e}Ai.$inject=["modeling"];Ai.prototype.execute=function(e){var t=e.shape,n=e.newBounds,i=e.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(i&&(n.width<i.width||n.height<i.height))throw new Error("width and height cannot be less than minimum height and width");if(!i&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return e.oldBounds={width:t.width,height:t.height,x:t.x,y:t.y},S(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};Ai.prototype.postExecute=function(e){var t=this._modeling,n=e.shape,i=e.oldBounds,r=e.hints||{};r.layout!==!1&&(x(n.incoming,function(o){t.layoutConnection(o,{connectionEnd:Gr(o,n,i)})}),x(n.outgoing,function(o){t.layoutConnection(o,{connectionStart:zr(o,n,i)})}))};Ai.prototype.revert=function(e){var t=e.shape,n=e.oldBounds;return S(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};function Qt(e){this._modeling=e}Qt.$inject=["modeling"];Qt.prototype.preExecute=function(e){var t=e.delta,n=e.direction,i=e.movingShapes,r=e.resizingShapes,o=e.start,s={};this.moveShapes(i,t),x(r,function(a){s[a.id]=r_(a)}),this.resizeShapes(r,t,n),this.updateConnectionWaypoints(Dy(i,r),t,n,o,i,r,s)};Qt.prototype.execute=function(){};Qt.prototype.revert=function(){};Qt.prototype.moveShapes=function(e,t){var n=this;x(e,function(i){n._modeling.moveShape(i,t,null,{autoResize:!1,layout:!1,recurse:!1})})};Qt.prototype.resizeShapes=function(e,t,n){var i=this;x(e,function(r){var o=Iy(r,n,t);i._modeling.resizeShape(r,o,null,{attachSupport:!1,autoResize:!1,layout:!1})})};Qt.prototype.updateConnectionWaypoints=function(e,t,n,i,r,o,s){var a=this,c=r.concat(o);x(e,function(l){var p=l.source,u=l.target,d=i_(l),f=ed(n),m={};Ft(c,p)&&Ft(c,u)?(d=Ge(d,function(h){return fl(h,i,n)&&(h[f]=h[f]+t[f]),h.original&&fl(h.original,i,n)&&(h.original[f]=h.original[f]+t[f]),h}),a._modeling.updateWaypoints(l,d,{labelBehavior:!1})):(Ft(c,p)||Ft(c,u))&&(Ft(r,p)?m.connectionStart=qa(l,p,t):Ft(r,u)?m.connectionEnd=Za(l,u,t):Ft(o,p)?m.connectionStart=zr(l,p,s[p.id]):Ft(o,u)&&(m.connectionEnd=Gr(l,u,s[u.id])),a._modeling.layoutConnection(l,m))})};function dl(e){return S({},e)}function i_(e){return Ge(e.waypoints,function(t){return t=dl(t),t.original&&(t.original=dl(t.original)),t})}function ed(e){switch(e){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function fl(e,t,n){var i=ed(n);if(/e|s/.test(n))return e[i]>t;if(/n|w/.test(n))return e[i]<t}function Ft(e,t){return e.indexOf(t)!==-1}function r_(e){return{x:e.x,y:e.y,height:e.height,width:e.width}}function ro(e){this._modeling=e}ro.$inject=["modeling"];ro.prototype.execute=function(e){var t=e.shape,n=t.children;e.oldChildrenVisibility=td(n),t.collapsed=!t.collapsed;var i=nd(n,t.collapsed);return[t].concat(i)};ro.prototype.revert=function(e){var t=e.shape,n=e.oldChildrenVisibility,i=t.children,r=id(i,n);return t.collapsed=!t.collapsed,[t].concat(r)};function td(e){var t={};return x(e,function(n){t[n.id]=n.hidden,n.children&&(t=S({},t,td(n.children)))}),t}function nd(e,t){var n=[];return x(e,function(i){i.hidden=t,n=n.concat(i),i.children&&(n=n.concat(nd(i.children,i.collapsed||t)))}),n}function id(e,t){var n=[];return x(e,function(i){i.hidden=t[i.id],n=n.concat(i),i.children&&(n=n.concat(id(i.children,t)))}),n}function oo(e){this._modeling=e}oo.$inject=["modeling"];oo.prototype.execute=function(e){var t=e.shape,n=e.newHost,i=t.host;return e.oldHost=i,e.attacherIdx=rd(i,t),od(n,t),t.host=n,t};oo.prototype.revert=function(e){var t=e.shape,n=e.newHost,i=e.oldHost,r=e.attacherIdx;return t.host=i,rd(n,t),od(i,t,r),t};function rd(e,t){return be(e&&e.attachers,t)}function od(e,t,n){if(e){var i=e.attachers;i||(e.attachers=i=[]),we(i,t,n)}}function Cs(){}Cs.prototype.execute=function(e){var t=e.connection,n=e.newWaypoints;return e.oldWaypoints=t.waypoints,t.waypoints=n,t};Cs.prototype.revert=function(e){var t=e.connection,n=e.oldWaypoints;return t.waypoints=n,t};function re(e,t,n){this._eventBus=e,this._elementFactory=t,this._commandStack=n;var i=this;e.on("diagram.init",function(){i.registerHandlers(n)})}re.$inject=["eventBus","elementFactory","commandStack"];re.prototype.getHandlers=function(){return{"shape.append":Qr,"shape.create":Jt,"shape.delete":Mi,"shape.move":gn,"shape.resize":Ai,"shape.replace":Lt,"shape.toggleCollapse":ro,spaceTool:Qt,"label.create":Ri,"connection.create":eo,"connection.delete":ki,"connection.move":Ss,"connection.layout":no,"connection.updateWaypoints":Cs,"connection.reconnect":Ii,"elements.create":xs,"elements.move":io,"elements.delete":ws,"elements.distribute":to,"elements.align":Jr,"element.updateAttachment":oo}};re.prototype.registerHandlers=function(e){x(this.getHandlers(),function(t,n){e.registerHandler(n,t)})};re.prototype.moveShape=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=null);var o={shape:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("shape.move",o)};re.prototype.updateAttachment=function(e,t){var n={shape:e,newHost:t};this._commandStack.execute("element.updateAttachment",n)};re.prototype.moveElements=function(e,t,n,i){i=i||{};var r=i.attach,o=n,s;r===!0?(s=n,o=n.parent):r===!1&&(s=null);var a={shapes:e,delta:t,newParent:o,newHost:s,hints:i};this._commandStack.execute("elements.move",a)};re.prototype.moveConnection=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=void 0);var o={connection:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("connection.move",o)};re.prototype.layoutConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.layout",n)};re.prototype.createConnection=function(e,t,n,i,r,o){typeof n=="object"&&(o=r,r=i,i=n,n=void 0),i=this._create("connection",i);var s={source:e,target:t,parent:r,parentIndex:n,connection:i,hints:o};return this._commandStack.execute("connection.create",s),s.connection};re.prototype.createShape=function(e,t,n,i,r){typeof i!="number"&&(r=i,i=void 0),r=r||{};var o=r.attach,s,a;e=this._create("shape",e),o?(s=n.parent,a=n):s=n;var c={position:t,shape:e,parent:s,parentIndex:i,host:a,hints:r};return this._commandStack.execute("shape.create",c),c.shape};re.prototype.createElements=function(e,t,n,i,r){J(e)||(e=[e]),typeof i!="number"&&(r=i,i=void 0),r=r||{};var o={position:t,elements:e,parent:n,parentIndex:i,hints:r};return this._commandStack.execute("elements.create",o),o.elements};re.prototype.createLabel=function(e,t,n,i){n=this._create("label",n);var r={labelTarget:e,position:t,parent:i||e.parent,shape:n};return this._commandStack.execute("label.create",r),r.shape};re.prototype.appendShape=function(e,t,n,i,r){r=r||{},t=this._create("shape",t);var o={source:e,position:n,target:i,shape:t,connection:r.connection,connectionParent:r.connectionParent,hints:r};return this._commandStack.execute("shape.append",o),o.shape};re.prototype.removeElements=function(e){var t={elements:e};this._commandStack.execute("elements.delete",t)};re.prototype.distributeElements=function(e,t,n){var i={groups:e,axis:t,dimension:n};this._commandStack.execute("elements.distribute",i)};re.prototype.removeShape=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.delete",n)};re.prototype.removeConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.delete",n)};re.prototype.replaceShape=function(e,t,n){var i={oldShape:e,newData:t,hints:n||{}};return this._commandStack.execute("shape.replace",i),i.newShape};re.prototype.alignElements=function(e,t){var n={elements:e,alignment:t};this._commandStack.execute("elements.align",n)};re.prototype.resizeShape=function(e,t,n,i){var r={shape:e,newBounds:t,minBounds:n,hints:i};this._commandStack.execute("shape.resize",r)};re.prototype.createSpace=function(e,t,n,i,r){var o={delta:n,direction:i,movingShapes:e,resizingShapes:t,start:r};this._commandStack.execute("spaceTool",o)};re.prototype.updateWaypoints=function(e,t,n){var i={connection:e,newWaypoints:t,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",i)};re.prototype.reconnect=function(e,t,n,i,r){var o={connection:e,newSource:t,newTarget:n,dockingOrPoints:i,hints:r||{}};this._commandStack.execute("connection.reconnect",o)};re.prototype.reconnectStart=function(e,t,n,i){i||(i={}),this.reconnect(e,t,e.target,n,S(i,{docking:"source"}))};re.prototype.reconnectEnd=function(e,t,n,i){i||(i={}),this.reconnect(e,e.source,t,n,S(i,{docking:"target"}))};re.prototype.connect=function(e,t,n,i){return this.createConnection(e,t,n||{},e.parent,i)};re.prototype._create=function(e,t){return uh(t)?t:this._elementFactory.create(e,t)};re.prototype.toggleCollapse=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.toggleCollapse",n)};function $i(e){this._elementRegistry=e}$i.$inject=["elementRegistry"];$i.prototype.execute=function(e){var t=e.element,n=e.moddleElement,i=e.properties;if(!n)throw new Error("<moddleElement> required");var r=e.changed||this._getVisualReferences(n).concat(t),o=e.oldProperties||o_(n,Ho(i));return ad(n,i),e.oldProperties=o,e.changed=r,r};$i.prototype.revert=function(e){var t=e.oldProperties,n=e.moddleElement,i=e.changed;return ad(n,t),i};$i.prototype._getVisualReferences=function(e){var t=this._elementRegistry;return g(e,"bpmn:DataObject")?a_(e,t):[]};function o_(e,t){return Xt(t,function(n,i){return n[i]=e.get(i),n},{})}function ad(e,t){x(t,function(n,i){e.set(i,n)})}function a_(e,t){return t.filter(function(n){return g(n,"bpmn:DataObjectReference")&&D(n).dataObjectRef===e})}var ii="default",kt="id",sd="di",s_={width:0,height:0};function Oi(e,t,n,i){this._elementRegistry=e,this._moddle=t,this._modeling=n,this._textRenderer=i}Oi.$inject=["elementRegistry","moddle","modeling","textRenderer"];Oi.prototype.execute=function(e){var t=e.element,n=[t];if(!t)throw new Error("element required");var i=this._elementRegistry,r=this._moddle.ids,o=t.businessObject,s=d_(e.properties),a=e.oldProperties||c_(t,s);return cd(s,o)&&(r.unclaim(o[kt]),i.updateId(t,s[kt]),r.claim(s[kt],o)),ii in s&&(s[ii]&&n.push(i.get(s[ii].id)),o[ii]&&n.push(i.get(o[ii].id))),ld(t,s),e.oldProperties=a,e.changed=n,n};Oi.prototype.postExecute=function(e){var t=e.element,n=t.label,i=n&&D(n).name;if(i){var r=this._textRenderer.getExternalLabelBounds(n,i);this._modeling.resizeShape(n,r,s_)}};Oi.prototype.revert=function(e){var t=e.element,n=e.properties,i=e.oldProperties,r=t.businessObject,o=this._elementRegistry,s=this._moddle.ids;return ld(t,i),cd(n,r)&&(s.unclaim(n[kt]),o.updateId(t,i[kt]),s.claim(i[kt],r)),e.changed};function cd(e,t){return kt in e&&e[kt]!==t[kt]}function c_(e,t){var n=Ho(t),i=e.businessObject,r=ie(e);return Xt(n,function(o,s){return s!==sd?o[s]=i.get(s):o[s]=l_(r,Ho(t.di)),o},{})}function l_(e,t){return Xt(t,function(n,i){return n[i]=e&&e.get(i),n},{})}function ld(e,t){var n=e.businessObject,i=ie(e);x(t,function(r,o){o!==sd?n.set(o,r):i&&p_(i,r)})}function p_(e,t){x(t,function(n,i){e.set(i,n)})}var u_=["default"];function d_(e){var t=S({},e);return u_.forEach(function(n){n in e&&(t[n]=D(t[n]))}),t}function ao(e,t){this._canvas=e,this._modeling=t}ao.$inject=["canvas","modeling"];ao.prototype.execute=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=t.getRootElement(),o=r.businessObject,s=o.$parent,a=ie(r);return t.setRootElement(n),t.removeRootElement(r),we(s.rootElements,i),i.$parent=s,be(s.rootElements,o),o.$parent=null,r.di=null,a.bpmnElement=i,n.di=a,e.oldRoot=r,[]};ao.prototype.revert=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=e.oldRoot,o=r.businessObject,s=i.$parent,a=ie(n);return t.setRootElement(r),t.removeRootElement(n),be(s.rootElements,i),i.$parent=null,we(s.rootElements,o),o.$parent=s,n.di=null,a.bpmnElement=o,r.di=a,[]};function Ts(e,t){this._modeling=e,this._spaceTool=t}Ts.$inject=["modeling","spaceTool"];Ts.prototype.preExecute=function(e){var t=this._spaceTool,n=this._modeling,i=e.shape,r=e.location,o=Ze(i),s=o===i,a=s?i:i.parent,c=Yt(a),l=Me(i);if(l?r==="left"?r="top":r==="right"&&(r="bottom"):r==="top"?r="left":r==="bottom"&&(r="right"),!c.length){var p=l?{x:i.x+qe,y:i.y,width:i.width-qe,height:i.height}:{x:i.x,y:i.y+qe,width:i.width,height:i.height-qe};n.createShape({type:"bpmn:Lane",isHorizontal:l},p,a)}var u=[];Ir(o,function(_){return u.push(_),_.label&&u.push(_.label),_===i?[]:K(_.children,function(w){return w!==i})});var d,f,m,h,v;r==="top"?(d=-120,f=i.y,m=f+10,h="n",v="y"):r==="left"?(d=-120,f=i.x,m=f+10,h="w",v="x"):r==="bottom"?(d=120,f=i.y+i.height,m=f-10,h="s",v="y"):r==="right"&&(d=120,f=i.x+i.width,m=f-10,h="e",v="x");var b=t.calculateAdjustments(u,v,d,m),E=l?{x:0,y:d}:{x:d,y:0};t.makeSpace(b.movingShapes,b.resizingShapes,E,h,m);var y=l?{x:i.x+(s?qe:0),y:f-(r==="top"?120:0),width:i.width-(s?qe:0),height:120}:{x:f-(r==="left"?120:0),y:i.y+(s?qe:0),width:120,height:i.height-(s?qe:0)};e.newLane=n.createShape({type:"bpmn:Lane",isHorizontal:l},y,a)};function Rs(e){this._modeling=e}Rs.$inject=["modeling"];Rs.prototype.preExecute=function(e){var t=this._modeling,n=e.shape,i=e.count,r=Yt(n),o=r.length;if(o>i)throw new Error(`more than <${i}> child lanes`);var s=Me(n),a=s?n.height:n.width,c=Math.round(a/i),l,p,u,d;for(d=0;d<i;d++)d===i-1?l=a-c*d:l=c,p=s?{x:n.x+qe,y:n.y+d*c,width:n.width-qe,height:l}:{x:n.x+d*c,y:n.y+qe,width:l,height:n.height-qe},d<o?t.resizeShape(r[d],p):(u={type:"bpmn:Lane",isHorizontal:s},t.createShape(u,p,n))};function Li(e,t){this._modeling=e,this._spaceTool=t}Li.$inject=["modeling","spaceTool"];Li.prototype.preExecute=function(e){var t=e.shape,n=e.newBounds,i=e.balanced;i!==!1?this.resizeBalanced(t,n):this.resizeSpace(t,n)};Li.prototype.resizeBalanced=function(e,t){var n=this._modeling,i=zv(e,t);n.resizeShape(e,t),i.forEach(function(r){n.resizeShape(r.shape,r.newBounds)})};Li.prototype.resizeSpace=function(e,t){var n=this._spaceTool,i=B(e),r=B(t),o=lu(r,i),s=Ze(e),a=[],c=[];Ir(s,function(m){return a.push(m),(g(m,"bpmn:Lane")||g(m,"bpmn:Participant"))&&c.push(m),m.children});var l,p,u,d,f;(o.bottom||o.top)&&(l=o.bottom||o.top,p=e.y+(o.bottom?e.height:0)+(o.bottom?-10:10),u=o.bottom?"s":"n",d=o.top>0||o.bottom<0?-l:l,f=n.calculateAdjustments(a,"y",d,p),n.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:l},u)),(o.left||o.right)&&(l=o.right||o.left,p=e.x+(o.right?e.width:0)+(o.right?-10:100),u=o.right?"e":"w",d=o.left>0||o.right<0?-l:l,f=n.calculateAdjustments(c,"x",d,p),n.makeSpace(f.movingShapes,f.resizingShapes,{x:l,y:0},u))};var vi="flowNodeRef",ks="lanes";function Bi(e){this._elementRegistry=e}Bi.$inject=["elementRegistry"];Bi.prototype._computeUpdates=function(e,t){var n=[],i=[],r={},o=[];function s(p,u){var d=B(u),f={x:p.x+p.width/2,y:p.y+p.height/2};return f.x>d.left&&f.x<d.right&&f.y>d.top&&f.y<d.bottom}function a(p){n.indexOf(p)===-1&&(o.push(p),n.push(p))}function c(p){var u=Ze(p);return r[u.id]||(r[u.id]=Vr(u)),r[u.id]}function l(p){if(!p.parent)return[];var u=c(p);return u.filter(function(d){return s(p,d)}).map(function(d){return d.businessObject})}return t.forEach(function(p){var u=Ze(p);if(!(!u||n.indexOf(u)!==-1)){var d=u.children.filter(function(f){return g(f,"bpmn:FlowNode")});d.forEach(a),n.push(u)}}),e.forEach(a),o.forEach(function(p){var u=p.businessObject,d=u.get(ks),f=d.slice(),m=l(p);i.push({flowNode:u,remove:f,add:m})}),t.forEach(function(p){var u=p.businessObject;p.parent||u.get(vi).forEach(function(d){i.push({flowNode:d,remove:[u],add:[]})})}),i};Bi.prototype.execute=function(e){var t=e.updates;return t||(t=e.updates=this._computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach(function(n){var i=n.flowNode,r=i.get(ks);n.remove.forEach(function(o){be(r,o),be(o.get(vi),i)}),n.add.forEach(function(o){we(r,o),we(o.get(vi),i)})}),[]};Bi.prototype.revert=function(e){var t=e.updates;return t.forEach(function(n){var i=n.flowNode,r=i.get(ks);n.add.forEach(function(o){be(r,o),be(o.get(vi),i)}),n.remove.forEach(function(o){we(r,o),we(o.get(vi),i)})}),[]};function so(e){this._moddle=e}so.$inject=["moddle"];so.prototype.execute=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.claim(n,i):t.unclaim(n),[]};so.prototype.revert=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.unclaim(n):t.claim(n,i),[]};var f_={fill:void 0,stroke:void 0};function Ms(e){this._commandStack=e,this._normalizeColor=function(t){if(t){if(Cr(t)){var n=h_(t);if(n)return n}throw new Error(`invalid color value: ${t}`)}}}Ms.$inject=["commandStack"];Ms.prototype.postExecute=function(e){var t=e.elements,n=e.colors||f_,i=this,r={};"fill"in n&&S(r,{"background-color":this._normalizeColor(n.fill)}),"stroke"in n&&S(r,{"border-color":this._normalizeColor(n.stroke)}),x(t,function(o){var s=se(o)?yt(r,["border-color"]):r,a=ie(o);if(m_(s),ee(o))i._commandStack.execute("element.updateModdleProperties",{element:o,moddleElement:a.label,properties:{color:r["border-color"]}});else{if(!X(a,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;i._commandStack.execute("element.updateProperties",{element:o,properties:{di:s}})}})};function h_(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}function m_(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}var v_={width:0,height:0};function pd(e,t,n){function i(c,l){var p=c.label||c,u=c.labelTarget||c;return dh(p,l),[p,u]}function r(c){var l=c.element,p=l.businessObject,u=c.newLabel;if(!ee(l)&&In(l)&&!Dr(l)&&!hl(u)){var d=7,f=Ep(l);f={x:f.x,y:f.y+d},e.createLabel(l,f,{id:p.id+"_label",businessObject:p,di:l.di})}}function o(c){return c.oldLabel=Ut(c.element),i(c.element,c.newLabel)}function s(c){return i(c.element,c.oldLabel)}function a(c){var l=c.element,p=l.label||l,u=c.newLabel,d=c.newBounds,f=c.hints||{};if(!(!ee(p)&&!g(p,"bpmn:TextAnnotation"))){if(ee(p)&&hl(u)){f.removeShape!==!1&&e.removeShape(p,{unsetLabel:!1});return}var m=Ut(l);typeof d>"u"&&(d=t.getExternalLabelBounds(p,m)),d&&e.resizeShape(p,d,v_)}}this.preExecute=r,this.execute=o,this.revert=s,this.postExecute=a}pd.$inject=["modeling","textRenderer","bpmnFactory"];function hl(e){return!e||!e.trim()}function Ae(e,t,n,i){re.call(this,e,t,n),this._bpmnRules=i}O(Ae,re);Ae.$inject=["eventBus","elementFactory","commandStack","bpmnRules"];Ae.prototype.getHandlers=function(){var e=re.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=$i,e["element.updateProperties"]=Oi,e["canvas.updateRoot"]=ao,e["lane.add"]=Ts,e["lane.resize"]=Li,e["lane.split"]=Rs,e["lane.updateRefs"]=Bi,e["id.updateClaim"]=so,e["element.setColor"]=Ms,e["element.updateLabel"]=pd,e};Ae.prototype.updateLabel=function(e,t,n,i){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:n,hints:i||{}})};Ae.prototype.connect=function(e,t,n,i){var r=this._bpmnRules;if(n||(n=r.canConnect(e,t)),!!n)return this.createConnection(e,t,n,e.parent,i)};Ae.prototype.updateModdleProperties=function(e,t,n){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:n})};Ae.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})};Ae.prototype.resizeLane=function(e,t,n){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:n})};Ae.prototype.addLane=function(e,t){var n={shape:e,location:t};return this._commandStack.execute("lane.add",n),n.newLane};Ae.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})};Ae.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};Ae.prototype.makeProcess=function(){var e=this._create("root",{type:"bpmn:Process"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};Ae.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})};Ae.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})};Ae.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})};Ae.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})};function ud(){}ud.prototype.layoutConnection=function(e,t){return t=t||{},[t.connectionStart||V(t.source||e.source),t.connectionEnd||V(t.target||e.target)]};var or=20,g_=5,Sr=Math.round,ml=20,y_={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function __(e,t){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[t].test(e)}function b_(e,t){return{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[e].test(t)}function dd(e,t,n){var i=Ie(t,e,g_),r=n.split(":")[0],o=Sr((t.x-e.x)/2+e.x),s=Sr((t.y-e.y)/2+e.y),a,c,l=b_(r,i),p=/h|r|l/.test(r),u=!1,d=!1;return l?(a=p?{x:o,y:e.y}:{x:e.x,y:s},c=p?"h:h":"v:v"):(u=__(i,r),c=p?"h:v":"v:h",u?p?(d=s===e.y,a={x:e.x+or*(/l/.test(r)?-1:1),y:d?s+or:s}):(d=o===e.x,a={x:d?o+or:o,y:e.y+or*(/t/.test(r)?-1:1)}):a={x:o,y:s}),{waypoints:Ds(e,a,c).concat(a),directions:c,turnNextDirections:d}}function E_(e,t,n){return dd(e,t,n)}function x_(e,t,n){var i=dd(t,e,vl(n));return{waypoints:i.waypoints.slice().reverse(),directions:vl(i.directions),turnNextDirections:i.turnNextDirections}}function w_(e,t){var n=e.directions.split(":")[1],i=t.directions.split(":")[0];e.turnNextDirections&&(n=n=="h"?"v":"h"),t.turnNextDirections&&(i=i=="h"?"v":"h");var r=n+":"+i,o=Ds(e.waypoints[e.waypoints.length-1],t.waypoints[0],r);return{waypoints:o,directions:r}}function vl(e){return e.split(":").reverse().join(":")}function S_(e,t,n){var i=Sr((t.x-e.x)/2+e.x),r=Sr((t.y-e.y)/2+e.y);if(n==="h:v")return[{x:t.x,y:e.y}];if(n==="v:h")return[{x:e.x,y:t.y}];if(n==="h:h")return[{x:i,y:e.y},{x:i,y:t.y}];if(n==="v:v")return[{x:e.x,y:r},{x:t.x,y:r}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}function Ds(e,t,n){if(n=n||"h:h",!A_(n))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(fd(n)){var i=E_(e,t,n),r=x_(e,t,n),o=w_(i,r);return[].concat(i.waypoints,o.waypoints,r.waypoints)}return S_(e,t,n)}function P_(e,t,n){var i=Ds(e,t,n);return i.unshift(e),i.push(t),hd(i)}function C_(e,t,n,i,r){var o=r&&r.preferredLayouts||[],s=fh(o,"straight")[0]||"h:h",a=y_[s]||0,c=Ie(e,t,a),l=I_(c,s);n=n||V(e),i=i||V(t);var p=l.split(":"),u=yl(n,e,p[0],$_(c)),d=yl(i,t,p[1],c);return P_(u,d,l)}function T_(e,t,n,i,r,o){J(n)&&(r=n,o=i,n=V(e),i=V(t)),o=S({preferredLayouts:[]},o),r=r||[];var s=o.preferredLayouts,a=s.indexOf("straight")!==-1,c;return c=a&&k_(e,t,n,i,o),c||(c=o.connectionEnd&&D_(t,e,i,r),c)||(c=o.connectionStart&&M_(e,t,n,r),c)?c:!o.connectionStart&&!o.connectionEnd&&r&&r.length?r:C_(e,t,n,i,o)}function R_(e,t,n){return e>=t&&e<=n}function gl(e,t,n){var i={x:"width",y:"height"};return R_(t[e],n[e],n[e]+n[i[e]])}function k_(e,t,n,i,r){var o={},s,a;return a=Ie(e,t),/^(top|bottom|left|right)$/.test(a)?(/top|bottom/.test(a)&&(s="x"),/left|right/.test(a)&&(s="y"),r.preserveDocking==="target"?gl(s,i,e)?(o[s]=i[s],[{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y,original:{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y}},{x:i.x,y:i.y}]):null:gl(s,n,t)?(o[s]=n[s],[{x:n.x,y:n.y},{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y,original:{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y}}]):null):null}function M_(e,t,n,i){return Is(e,t,n,i)}function D_(e,t,n,i){var r=i.slice().reverse();return r=Is(e,t,n,r),r?r.reverse():null}function Is(e,t,n,i){function r(p){return p.length<3?!0:p.length>4?!1:!!ue(p,function(u,d){var f=p[d-1];return f&&mp(u,f)<3})}function o(p,u,d){var f=Pt(u,p);switch(f){case"v":return{x:d.x,y:p.y};case"h":return{x:p.x,y:d.y}}return{x:p.x,y:p.y}}function s(p,u,d){var f;for(f=p.length-2;f!==0;f--)if(Ys(p[f],u,ml)||Ys(p[f],d,ml))return p.slice(f);return p}if(r(i))return null;var a=i[0],c=i.slice(),l;return c[0]=n,c[1]=o(c[1],a,n),l=s(c,e,t),l!==c&&(c=Is(e,t,n,l)),c&&Pt(c)?null:c}function I_(e,t){if(fd(t))return t;switch(e){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return t}}function A_(e){return e&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e)}function fd(e){return e&&/t|r|b|l/.test(e)}function $_(e){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[e]}function yl(e,t,n,i){if(n==="h"&&(n=/left/.test(i)?"l":"r"),n==="v"&&(n=/top/.test(i)?"t":"b"),n==="t")return{original:e,x:e.x,y:t.y};if(n==="r")return{original:e,x:t.x+t.width,y:e.y};if(n==="b")return{original:e,x:e.x,y:t.y+t.height};if(n==="l")return{original:e,x:t.x,y:e.y};throw new Error("unexpected dockingDirection: <"+n+">")}function hd(e){return e.reduce(function(t,n,i){var r=t[t.length-1],o=e[i+1];return vp(r,o,n,0)||t.push(n),t},[])}var O_=-10,L_=40,B_={default:["h:h"],fromGateway:["v:h"],toGateway:["h:v"],loop:{fromTop:["t:r"],fromRight:["r:b"],fromLeft:["l:t"],fromBottom:["b:l"]},boundaryLoop:{alternateHorizontalSide:"b",alternateVerticalSide:"l",default:"v"},messageFlow:["straight","v:v"],subProcess:["straight","h:h"],isHorizontal:!0},N_={default:["v:v"],fromGateway:["h:v"],toGateway:["v:h"],loop:{fromTop:["t:l"],fromRight:["r:t"],fromLeft:["l:b"],fromBottom:["b:r"]},boundaryLoop:{alternateHorizontalSide:"t",alternateVerticalSide:"r",default:"h"},messageFlow:["straight","h:h"],subProcess:["straight","v:v"],isHorizontal:!1},As={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},oi={top:"t",right:"r",bottom:"b",left:"l"};function $s(){}O($s,ud);$s.prototype.layoutConnection=function(e,t){t||(t={});var n=t.source||e.source,i=t.target||e.target,r=t.waypoints||e.waypoints,o=t.connectionStart,s=t.connectionEnd,a,c;if(o||(o=_l(r&&r[0],n)),s||(s=_l(r&&r[r.length-1],i)),(g(e,"bpmn:Association")||g(e,"bpmn:DataAssociation"))&&r&&!bl(n,i))return[].concat([o],r.slice(1,-1),[s]);var l=$r(n)?B_:N_;return g(e,"bpmn:MessageFlow")?a=H_(n,i,l):(g(e,"bpmn:SequenceFlow")||bl(n,i))&&(n===i?a={preferredLayouts:U_(n,e,l)}:g(n,"bpmn:BoundaryEvent")?a={preferredLayouts:X_(n,i,s,l)}:gi(n)||gi(i)?a={preferredLayouts:l.subProcess,preserveDocking:F_(n)}:g(n,"bpmn:Gateway")?a={preferredLayouts:l.fromGateway}:g(i,"bpmn:Gateway")?a={preferredLayouts:l.toGateway}:a={preferredLayouts:l.default}),a&&(a=S(a,t),c=hd(T_(n,i,o,s,r,a))),c||[o,s]};function j_(e){var t=e.host;return Ie(V(e),t,O_)}function H_(e,t,n){return{preferredLayouts:n.messageFlow,preserveDocking:V_(e,t)}}function V_(e,t){return g(t,"bpmn:Participant")?"source":g(e,"bpmn:Participant")?"target":gi(t)?"source":gi(e)||g(t,"bpmn:Event")?"target":g(e,"bpmn:Event")?"source":null}function F_(e){return gi(e)?"target":"source"}function _l(e,t){return e?e.original||e:V(t)}function bl(e,t){return g(t,"bpmn:Activity")&&g(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function gi(e){return g(e,"bpmn:SubProcess")&&Q(e)}function fn(e,t){return e===t}function z_(e,t){return t.indexOf(e)!==-1}function Ln(e){var t=/right|left/.exec(e);return t&&t[0]}function Bn(e){var t=/top|bottom/.exec(e);return t&&t[0]}function El(e,t){return As[e]===t}function G_(e,t){var n=Ln(e),i=As[n];return t.indexOf(i)!==-1}function W_(e,t){var n=Bn(e),i=As[n];return t.indexOf(i)!==-1}function md(e){return e==="right"||e==="left"}function U_(e,t,n){var i=t.waypoints,r=i&&i.length&&Ie(i[0],e);return r==="top"?n.loop.fromTop:r==="right"?n.loop.fromRight:r==="left"?n.loop.fromLeft:n.loop.fromBottom}function X_(e,t,n,i){var r=V(e),o=V(t),s=j_(e),a,c,l=fn(e.host,t),p=z_(s,["top","right","bottom","left"]),u=Ie(o,r,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return l?K_(s,p,e,t,n,i):(a=Y_(s,u,p,i.isHorizontal),c=q_(s,u,p,i.isHorizontal),[a+":"+c])}function K_(e,t,n,i,r,o){var s=t?e:o.isHorizontal?Bn(e):Ln(e),a=oi[s],c;return t?md(e)?c=xl("y",n,i,r)?"h":o.boundaryLoop.alternateHorizontalSide:c=xl("x",n,i,r)?"v":o.boundaryLoop.alternateVerticalSide:c=o.boundaryLoop.default,[a+":"+c]}function xl(e,t,n,i){var r=L_;return!(Co(e,i,n,r)||Co(e,i,{x:n.x+n.width,y:n.y+n.height},r)||Co(e,i,V(t),r))}function Co(e,t,n,i){return Math.abs(t[e]-n[e])<i}function Y_(e,t,n,i){if(n)return oi[e];var r=Bn(e),o=Ln(e),s=Bn(t),a=Ln(t);if(i){if(fn(r,s)||El(o,a))return oi[r]}else if(fn(o,a)||El(r,s))return oi[o];return oi[i?o:r]}function q_(e,t,n,i){return n?md(e)?G_(e,t)||fn(e,t)?"h":"v":W_(e,t)||fn(e,t)?"v":"h":i?fn(Bn(e),Bn(t))?"h":"v":fn(Ln(e),Ln(t))?"v":"h"}function wl(e){return S({original:e.point.original||e.point},e.actual)}function en(e,t){this._elementRegistry=e,this._graphicsFactory=t}en.$inject=["elementRegistry","graphicsFactory"];en.prototype.getCroppedWaypoints=function(e,t,n){t=t||e.source,n=n||e.target;var i=this.getDockingPoint(e,t,!0),r=this.getDockingPoint(e,n),o=e.waypoints.slice(i.idx+1,r.idx);return o.unshift(wl(i)),o.push(wl(r)),o};en.prototype.getDockingPoint=function(e,t,n){var i=e.waypoints,r,o,s;return r=n?0:i.length-1,o=i[r],s=this._getIntersection(t,e,n),{point:o,actual:s||o,idx:r}};en.prototype._getIntersection=function(e,t,n){var i=this._getShapePath(e),r=this._getConnectionPath(t);return No(i,r,n)};en.prototype._getConnectionPath=function(e){return this._graphicsFactory.getConnectionPath(e)};en.prototype._getShapePath=function(e){return this._graphicsFactory.getShapePath(e)};en.prototype._getGfx=function(e){return this._elementRegistry.getGraphics(e)};const vd={__init__:["modeling","bpmnUpdater"],__depends__:[Wg,ly,uy,dy,qu,Hy,Fy,Ky,It,xp,Qu],bpmnFactory:["type",nt],bpmnUpdater:["type",We],elementFactory:["type",Zt],modeling:["type",Ae],layouter:["type",$s],connectionDocking:["type",en]},Sl=Math.round;function co(e,t,n,i,r,o){this._complexPreview=e,this._connectionDocking=t,this._elementFactory=n,this._eventBus=i,this._layouter=r,this._rules=o}co.prototype.create=function(e,t,n){const i=this._complexPreview,r=this._connectionDocking,o=this._elementFactory,s=this._eventBus,a=this._layouter,c=this._rules,l=o.createShape(S({type:t},n)),p=s.fire("autoPlace",{source:e,shape:l});if(!p)return;S(l,{x:p.x-Sl(l.width/2),y:p.y-Sl(l.height/2)});const u=c.allowed("connection.create",{source:e,target:l,hints:{targetParent:e.parent}});let d=null;u&&(d=o.createConnection(u),d.waypoints=a.layoutConnection(d,{source:e,target:l}),d.waypoints=r.getCroppedWaypoints(d,e,l)),i.create({created:[l,d].filter(f=>!Bo(f))})};co.prototype.cleanUp=function(){this._complexPreview.cleanUp()};co.$inject=["complexPreview","connectionDocking","elementFactory","eventBus","layouter","rules"];const Z_={__depends__:[Ca,wv,vd],__init__:["appendPreview"],appendPreview:["type",co]};var Pl=Math.min,Cl=Math.max;function To(e){e.preventDefault()}function li(e){e.stopPropagation()}function J_(e){return e.nodeType===Node.TEXT_NODE}function Q_(e){return[].slice.call(e)}function dt(e){this.container=e.container,this.parent=Pe('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=xe("[contenteditable]",this.parent),this.keyHandler=e.keyHandler||function(){},this.resizeHandler=e.resizeHandler||function(){},this.autoResize=An(this.autoResize,this),this.handlePaste=An(this.handlePaste,this)}dt.prototype.create=function(e,t,n,i){var r=this,o=this.parent,s=this.content,a=this.container;i=this.options=i||{},t=this.style=t||{};var c=yt(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);S(o.style,{width:e.width+"px",height:e.height+"px",maxWidth:e.maxWidth+"px",maxHeight:e.maxHeight+"px",minWidth:e.minWidth+"px",minHeight:e.minHeight+"px",left:e.x+"px",top:e.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var l=yt(t,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return S(s.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},l),i.centerVertically&&S(s.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},l),s.innerText=n,G.bind(s,"keydown",this.keyHandler),G.bind(s,"mousedown",li),G.bind(s,"paste",r.handlePaste),i.autoResize&&G.bind(s,"input",this.autoResize),i.resizable&&this.resizable(t),a.appendChild(o),this.setSelection(s.lastChild,s.lastChild&&s.lastChild.length),o};dt.prototype.handlePaste=function(e){var t=this.options,n=this.style;e.preventDefault();var i;if(e.clipboardData?i=e.clipboardData.getData("text/plain"):i=window.clipboardData.getData("Text"),this.insertText(i),t.autoResize){var r=this.autoResize(n);r&&this.resizeHandler(r)}};dt.prototype.insertText=function(e){e=eb(e);var t=document.execCommand("insertText",!1,e);t||this._insertTextIE(e)};dt.prototype._insertTextIE=function(e){var t=this.getSelection(),n=t.startContainer,i=t.endContainer,r=t.startOffset,o=t.endOffset,s=t.commonAncestorContainer,a=Q_(s.childNodes),c,l;if(J_(s)){var p=n.textContent;n.textContent=p.substring(0,r)+e+p.substring(o),c=n,l=r+e.length}else if(n===this.content&&i===this.content){var u=document.createTextNode(e);this.content.insertBefore(u,a[r]),c=u,l=u.textContent.length}else{var d=a.indexOf(n),f=a.indexOf(i);a.forEach(function(m,h){h===d?m.textContent=n.textContent.substring(0,r)+e+i.textContent.substring(o):h>d&&h<=f&&Dn(m)}),c=n,l=r+e.length}c&&l!==void 0&&setTimeout(function(){self.setSelection(c,l)})};dt.prototype.autoResize=function(){var e=this.parent,t=this.content,n=parseInt(this.style.fontSize)||12;if(t.scrollHeight>e.offsetHeight||t.scrollHeight<e.offsetHeight-n){var i=e.getBoundingClientRect(),r=t.scrollHeight;e.style.height=r+"px",this.resizeHandler({width:i.width,height:i.height,dx:0,dy:r-i.height})}};dt.prototype.resizable=function(){var e=this,t=this.parent,n=this.resizeHandle,i=parseInt(this.style.minWidth)||0,r=parseInt(this.style.minHeight)||0,o=parseInt(this.style.maxWidth)||1/0,s=parseInt(this.style.maxHeight)||1/0;if(!n){n=this.resizeHandle=Pe('<div class="djs-direct-editing-resize-handle"></div>');var a,c,l,p,u=function(m){To(m),li(m),a=m.clientX,c=m.clientY;var h=t.getBoundingClientRect();l=h.width,p=h.height,G.bind(document,"mousemove",d),G.bind(document,"mouseup",f)},d=function(m){To(m),li(m);var h=Pl(Cl(l+m.clientX-a,i),o),v=Pl(Cl(p+m.clientY-c,r),s);t.style.width=h+"px",t.style.height=v+"px",e.resizeHandler({width:l,height:p,dx:m.clientX-a,dy:m.clientY-c})},f=function(m){To(m),li(m),G.unbind(document,"mousemove",d,!1),G.unbind(document,"mouseup",f,!1)};G.bind(n,"mousedown",u)}S(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),t.appendChild(n)};dt.prototype.destroy=function(){var e=this.parent,t=this.content,n=this.resizeHandle;t.innerText="",e.removeAttribute("style"),t.removeAttribute("style"),G.unbind(t,"keydown",this.keyHandler),G.unbind(t,"mousedown",li),G.unbind(t,"input",this.autoResize),G.unbind(t,"paste",this.handlePaste),n&&(n.removeAttribute("style"),Dn(n)),Dn(e)};dt.prototype.getValue=function(){return this.content.innerText.trim()};dt.prototype.getSelection=function(){var e=window.getSelection(),t=e.getRangeAt(0);return t};dt.prototype.setSelection=function(e,t){var n=document.createRange();e===null?n.selectNodeContents(this.content):(n.setStart(e,t),n.setEnd(e,t));var i=window.getSelection();i.removeAllRanges(),i.addRange(n)};function eb(e){return e.replace(/\r\n|\r|\n/g,`
`)}function it(e,t){this._eventBus=e,this._providers=[],this._textbox=new dt({container:t.getContainer(),keyHandler:An(this._handleKey,this),resizeHandler:An(this._handleResize,this)})}it.$inject=["eventBus","canvas"];it.prototype.registerProvider=function(e){this._providers.push(e)};it.prototype.isActive=function(e){return!!(this._active&&(!e||this._active.element===e))};it.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())};it.prototype._fire=function(e,t){this._eventBus.fire("directEditing."+e,t||{active:this._active})};it.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0};it.prototype.complete=function(){var e=this._active;if(e){var t,n=e.context.bounds,i=this.$textbox.getBoundingClientRect(),r=this.getValue(),o=e.context.text;(r!==o||i.height!==n.height||i.width!==n.width)&&(t=this._textbox.container.getBoundingClientRect(),e.provider.update(e.element,r,e.context.text,{x:i.left-t.left,y:i.top-t.top,width:i.width,height:i.height})),this._fire("complete"),this.close()}};it.prototype.getValue=function(){return this._textbox.getValue()};it.prototype._handleKey=function(e){e.stopPropagation();var t=e.keyCode||e.charCode;if(t===27)return e.preventDefault(),this.cancel();if(t===13&&!e.shiftKey)return e.preventDefault(),this.complete()};it.prototype._handleResize=function(e){this._fire("resize",e)};it.prototype.activate=function(e){this.isActive()&&this.cancel();var t,n=ue(this._providers,function(i){return(t=i.activate(e))?i:null});return t&&(this.$textbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this._active={element:e,context:t,provider:n},t.options&&t.options.resizable&&(this.resizable=!0),this._fire("activate")),!!t};const gd={__depends__:[fa],__init__:["directEditing"],directEditing:["type",it]};function Tl(e){return function(t){var n=t.target,i=D(e),r=i.eventDefinitions&&i.eventDefinitions[0],o=i.$type===n.type,s=(r&&r.$type)===n.eventDefinitionType,a=!!n.triggeredByEvent==!!i.triggeredByEvent,c=n.isExpanded===void 0||n.isExpanded===Q(e);return!o||!s||!a||!c}}var tb=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],nb=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],ib=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link intermediate catch event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link intermediate throw event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],rb=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel end event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate end event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],ob=[{label:"Exclusive gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event-based gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],ab=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],yd=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],sb=yd,Rl=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"Manual task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business rule task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub-process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],cb=[{label:"Data store reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],lb=[{label:"Data object reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],pb=[{label:"Message boundary event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!0}},{label:"Timer boundary event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!0}},{label:"Escalation boundary event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!0}},{label:"Conditional boundary event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!0}},{label:"Error boundary event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",cancelActivity:!0}},{label:"Cancel boundary event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition",cancelActivity:!0}},{label:"Signal boundary event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!0}},{label:"Compensation boundary event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",cancelActivity:!0}},{label:"Message boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],ub=[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!0}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!0}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!0}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!0}},{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",isInterrupting:!0}},{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!0}},{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",isInterrupting:!0}},{label:"Message start event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer start event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional start event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal start event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation start event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],db=[{label:"Sequence flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],fb=[{label:"Expanded pool/participant",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty pool/participant";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}];const kl={"start-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
    <g transform="translate(0 995.64)">
      <path d="m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z" fill="none" stroke="currentColor" stroke-dasharray="418.310422, 361.2328165" stroke-linecap="round" stroke-width="100"/>
    </g>
  </svg>`,"intermediate-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
     <g transform="translate(0 995.64)" fill="none" stroke="currentColor" stroke-linecap="round">
        <circle cx="1024" cy="28.357" r="875" stroke-dasharray="418.310422, 361.2328165" stroke-width="100"/>
        <circle cx="1024" cy="28.357" r="685" stroke-dasharray="348.31044857,261.23283643" stroke-dashoffset="500" stroke-width="100"/>
     </g>
  </svg>`};function $e(e,t,n,i,r,o,s,a){this._bpmnFactory=e,this._popupMenu=t,this._modeling=n,this._moddle=i,this._bpmnReplace=r,this._rules=o,this._translate=s,this._moddleCopy=a,this._register()}$e.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate","moddleCopy"];$e.prototype._register=function(){this._popupMenu.registerProvider("bpmn-replace",this)};$e.prototype.getPopupMenuEntries=function(e){var t=e.businessObject,n=this._rules,i=[];if(J(e)||!n.allowed("shape.replace",{element:e}))return{};var r=Tl(e);return g(t,"bpmn:DataObjectReference")?this._createEntries(e,cb):g(t,"bpmn:DataStoreReference")&&!g(e.parent,"bpmn:Collaboration")?this._createEntries(e,lb):g(t,"bpmn:StartEvent")&&!g(t.$parent,"bpmn:SubProcess")?(i=K(tb,r),this._createEntries(e,i)):g(t,"bpmn:Participant")?(i=K(fb,function(o){return Q(e)!==o.target.isExpanded}),this._createEntries(e,i)):g(t,"bpmn:StartEvent")&&Ne(t.$parent)?(i=K(ub,function(o){var s=o.target,a=s.isInterrupting!==!1,c=t.isInterrupting===a;return r(o)||!r(o)&&!c}),this._createEntries(e,i)):g(t,"bpmn:StartEvent")&&!Ne(t.$parent)&&g(t.$parent,"bpmn:SubProcess")?(i=K(nb,r),this._createEntries(e,i)):g(t,"bpmn:EndEvent")?(i=K(rb,function(o){var s=o.target;return s.eventDefinitionType=="bpmn:CancelEventDefinition"&&!g(t.$parent,"bpmn:Transaction")?!1:r(o)}),this._createEntries(e,i)):g(t,"bpmn:BoundaryEvent")?(i=K(pb,function(o){var s=o.target;if(s.eventDefinitionType=="bpmn:CancelEventDefinition"&&!g(t.attachedToRef,"bpmn:Transaction"))return!1;var a=s.cancelActivity!==!1,c=t.cancelActivity==a;return r(o)||!r(o)&&!c}),this._createEntries(e,i)):g(t,"bpmn:IntermediateCatchEvent")||g(t,"bpmn:IntermediateThrowEvent")?(i=K(ib,r),this._createEntries(e,i)):g(t,"bpmn:Gateway")?(i=K(ob,r),this._createEntries(e,i)):g(t,"bpmn:Transaction")?(i=K(yd,r),this._createEntries(e,i)):Ne(t)&&Q(e)?(i=K(sb,r),this._createEntries(e,i)):g(t,"bpmn:SubProcess")&&Q(e)?(i=K(ab,r),this._createEntries(e,i)):g(t,"bpmn:AdHocSubProcess")&&!Q(e)?(i=K(Rl,function(o){var s=o.target,a=s.type==="bpmn:SubProcess",c=s.isExpanded===!0;return Tl(s)&&(!a||c)}),this._createEntries(e,i)):g(t,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,db):g(t,"bpmn:FlowNode")?(i=K(Rl,r),g(t,"bpmn:SubProcess")&&!Q(e)&&(i=K(i,function(o){return o.label!=="Sub-process (collapsed)"})),this._createEntries(e,i)):{}};$e.prototype.getPopupMenuHeaderEntries=function(e){var t={};return g(e,"bpmn:Activity")&&!Ne(e)&&(t={...t,...this._getLoopCharacteristicsHeaderEntries(e)}),g(e,"bpmn:DataObjectReference")&&(t={...t,...this._getCollectionHeaderEntries(e)}),g(e,"bpmn:Participant")&&(t={...t,...this._getParticipantMultiplicityHeaderEntries(e)}),g(e,"bpmn:SubProcess")&&!g(e,"bpmn:Transaction")&&!Ne(e)&&(t={...t,...this._getAdHocHeaderEntries(e)}),_u(e)&&(t={...t,...this._getNonInterruptingHeaderEntries(e)}),t};$e.prototype._createEntries=function(e,t){var n={},i=this;return x(t,function(r){n[r.actionName]=i._createEntry(r,e)}),n};$e.prototype._createSequenceFlowEntries=function(e,t){var n=D(e),i={},r=this._modeling,o=this._moddle,s=this;return x(t,function(a){switch(a.actionName){case"replace-with-default-flow":n.sourceRef.default!==n&&(g(n.sourceRef,"bpmn:ExclusiveGateway")||g(n.sourceRef,"bpmn:InclusiveGateway")||g(n.sourceRef,"bpmn:ComplexGateway")||g(n.sourceRef,"bpmn:Activity"))&&(i={...i,[a.actionName]:s._createEntry(a,e,function(){r.updateProperties(e.source,{default:n})})});break;case"replace-with-conditional-flow":!n.conditionExpression&&g(n.sourceRef,"bpmn:Activity")&&(i={...i,[a.actionName]:s._createEntry(a,e,function(){var c=o.create("bpmn:FormalExpression",{body:""});r.updateProperties(e,{conditionExpression:c})})});break;default:g(n.sourceRef,"bpmn:Activity")&&n.conditionExpression&&(i={...i,[a.actionName]:s._createEntry(a,e,function(){r.updateProperties(e,{conditionExpression:void 0})})}),(g(n.sourceRef,"bpmn:ExclusiveGateway")||g(n.sourceRef,"bpmn:InclusiveGateway")||g(n.sourceRef,"bpmn:ComplexGateway")||g(n.sourceRef,"bpmn:Activity"))&&n.sourceRef.default===n&&(i={...i,[a.actionName]:s._createEntry(a,e,function(){r.updateProperties(e.source,{default:void 0})})})}}),i};$e.prototype._createEntry=function(e,t,n){var i=this._translate,r=this._bpmnReplace.replaceElement,o=function(){return r(t,e.target)},s=e.label;return s&&typeof s=="function"&&(s=s(t)),n=n||o,{label:i(s),className:e.className,action:n}};$e.prototype._getLoopCharacteristicsHeaderEntries=function(e){var t=this,n=this._translate;function i(l,p){if(p.active){t._modeling.updateProperties(e,{loopCharacteristics:void 0});return}const u=e.businessObject.get("loopCharacteristics"),d=t._moddle.create(p.options.loopCharacteristics);u&&t._moddleCopy.copyElement(u,d),d.set("isSequential",p.options.isSequential),t._modeling.updateProperties(e,{loopCharacteristics:d})}var r=D(e),o=r.loopCharacteristics,s,a,c;return o&&(s=o.isSequential,a=o.isSequential===void 0,c=o.isSequential!==void 0&&!o.isSequential),{"toggle-parallel-mi":{className:"bpmn-icon-parallel-mi-marker",title:n("Parallel multi-instance"),active:c,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},"toggle-sequential-mi":{className:"bpmn-icon-sequential-mi-marker",title:n("Sequential multi-instance"),active:s,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},"toggle-loop":{className:"bpmn-icon-loop-marker",title:n("Loop"),active:a,action:i,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}}};$e.prototype._getCollectionHeaderEntries=function(e){var t=this,n=this._translate,i=e.businessObject.dataObjectRef;if(!i)return{};function r(s,a){t._modeling.updateModdleProperties(e,i,{isCollection:!a.active})}var o=i.isCollection;return{"toggle-is-collection":{className:"bpmn-icon-parallel-mi-marker",title:n("Collection"),active:o,action:r}}};$e.prototype._getParticipantMultiplicityHeaderEntries=function(e){var t=this,n=this._bpmnFactory,i=this._translate;function r(s,a){var c=a.active,l;c||(l=n.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:l})}var o=e.businessObject.participantMultiplicity;return{"toggle-participant-multiplicity":{className:"bpmn-icon-parallel-mi-marker",title:i("Participant multiplicity"),active:!!o,action:r}}};$e.prototype._getAdHocHeaderEntries=function(e){var t=this._translate,n=D(e),i=g(n,"bpmn:AdHocSubProcess"),r=this._bpmnReplace.replaceElement;return{"toggle-adhoc":{className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:i,action:function(o,s){return i?r(e,{type:"bpmn:SubProcess"},{autoResize:!1,layoutConnection:!1}):r(e,{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}}}};$e.prototype._getNonInterruptingHeaderEntries=function(e){const t=this._translate,n=D(e),i=this,r=bu(e),o=g(e,"bpmn:BoundaryEvent")?kl["intermediate-event-non-interrupting"]:kl["start-event-non-interrupting"],s=!n[r];return{"toggle-non-interrupting":{imageHtml:o,title:t("Toggle non-interrupting"),active:s,action:function(){i._modeling.updateProperties(e,{[r]:!!s})}}}};const hb={__depends__:[wa,qu,Ca],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",$e]};function Ni(e,t,n,i,r,o,s,a,c,l,p,u,d){e=e||{},i.registerProvider(this),this._contextPad=i,this._modeling=r,this._elementFactory=o,this._connect=s,this._create=a,this._popupMenu=c,this._canvas=l,this._rules=p,this._translate=u,this._eventBus=n,this._appendPreview=d,e.autoPlace!==!1&&(this._autoPlace=t.get("autoPlace",!1)),n.on("create.end",250,function(f){var m=f.context,h=m.shape;if(!(!fi(f)||!i.isOpen(h))){var v=i.getEntries(h);v.replace&&v.replace.action.click(f,h)}}),n.on("contextPad.close",function(){d.cleanUp()})}Ni.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","appendPreview"];Ni.prototype.getMultiElementContextPadEntries=function(e){var t=this._modeling,n={};return this._isDeleteAllowed(e)&&S(n,{delete:{group:"edit",className:"bpmn-icon-trash",title:this._translate("Delete"),action:{click:function(i,r){t.removeElements(r.slice())}}}}),n};Ni.prototype._isDeleteAllowed=function(e){var t=this._rules.allowed("elements.delete",{elements:e});return J(t)?Rr(e,n=>t.includes(n)):t};Ni.prototype.getContextPadEntries=function(e){var t=this._contextPad,n=this._modeling,i=this._elementFactory,r=this._connect,o=this._create,s=this._popupMenu,a=this._autoPlace,c=this._translate,l=this._appendPreview,p={};if(e.type==="label")return this._isDeleteAllowed([e])&&S(p,m()),p;var u=e.businessObject;function d(y,_){r.start(y,_)}function f(y,_){n.removeElements([_])}function m(){return{delete:{group:"edit",className:"bpmn-icon-trash",title:c("Delete"),action:{click:f}}}}function h(y){var _=5,w=t.getPad(y).html,P=w.getBoundingClientRect(),R={x:P.left,y:P.bottom+_};return R}function v(y,_,w,P){function R(T,A){var H=i.createShape(S({type:y},P));o.start(T,H,{source:A})}var j=a?function(T,A){var H=i.createShape(S({type:y},P));a.append(A,H)}:R,F=a?function(T,A){return l.create(A,y,P),()=>{l.cleanUp()}}:null;return{group:"model",className:_,title:w,action:{dragstart:R,click:j,hover:F}}}function b(y){return function(_,w){n.splitLane(w,y),t.open(w,!0)}}if(X(u,["bpmn:Lane","bpmn:Participant"])&&Q(e)){var E=Yt(e);S(p,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:c("Add lane above"),action:{click:function(y,_){n.addLane(_,"top")}}}}),E.length<2&&((Me(e)?e.height>=120:e.width>=120)&&S(p,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:c("Divide into two lanes"),action:{click:b(2)}}}),(Me(e)?e.height>=180:e.width>=180)&&S(p,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:c("Divide into three lanes"),action:{click:b(3)}}})),S(p,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:c("Add lane below"),action:{click:function(y,_){n.addLane(_,"bottom")}}}})}return g(u,"bpmn:FlowNode")&&(g(u,"bpmn:EventBasedGateway")?S(p,{"append.receive-task":v("bpmn:ReceiveTask","bpmn-icon-receive-task",c("Append receive task")),"append.message-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",c("Append message intermediate catch event"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",c("Append timer intermediate catch event"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",c("Append conditional intermediate catch event"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",c("Append signal intermediate catch event"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):Ml(u,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?S(p,{"append.compensation-activity":v("bpmn:Task","bpmn-icon-task",c("Append compensation activity"),{isForCompensation:!0})}):!g(u,"bpmn:EndEvent")&&!u.isForCompensation&&!Ml(u,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!Ne(u)&&S(p,{"append.end-event":v("bpmn:EndEvent","bpmn-icon-end-event-none",c("Append end event")),"append.gateway":v("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",c("Append gateway")),"append.append-task":v("bpmn:Task","bpmn-icon-task",c("Append task")),"append.intermediate-event":v("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",c("Append intermediate/boundary event"))})),s.isEmpty(e,"bpmn-replace")||S(p,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:c("Change element"),action:{click:function(y,_){var w=S(h(_),{cursor:{x:y.x,y:y.y}});s.open(_,"bpmn-replace",w,{title:c("Change element"),width:300,search:!0})}}}}),g(u,"bpmn:SequenceFlow")&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation"))}),X(u,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation")),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect to other element"),action:{click:d,dragstart:d}}}),g(u,"bpmn:TextAnnotation")&&S(p,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect using association"),action:{click:d,dragstart:d}}}),X(u,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&S(p,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect using data input association"),action:{click:d,dragstart:d}}}),g(u,"bpmn:Group")&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation"))}),this._isDeleteAllowed([e])&&S(p,m()),p};function Ml(e,t,n){var i=e.$instanceOf(t),r=!1,o=e.eventDefinitions||[];return x(o,function(s){s.$type===n&&(r=!0)}),i&&r}const mb={__depends__:[Z_,gd,Ip,It,Da,Yr,hb],__init__:["contextPadProvider"],contextPadProvider:["type",Ni]};var vb={horizontal:["x","width"],vertical:["y","height"]},Dl=5;function Bt(e,t){this._modeling=e,this._filters=[],this.registerFilter(function(n){var i=t.allowed("elements.distribute",{elements:n});return J(i)?i:i?n:[]})}Bt.$inject=["modeling","rules"];Bt.prototype.registerFilter=function(e){if(typeof e!="function")throw new Error("the filter has to be a function");this._filters.push(e)};Bt.prototype.trigger=function(e,t){var n=this._modeling,i,r;if(!(e.length<3)&&(this._setOrientation(t),r=this._filterElements(e),i=this._createGroups(r),!(i.length<=2)))return n.distributeElements(i,this._axis,this._dimension),i};Bt.prototype._filterElements=function(e){var t=this._filters,n=this._axis,i=this._dimension,r=[].concat(e);return t.length?(x(t,function(o){r=o(r,n,i)}),r):e};Bt.prototype._createGroups=function(e){var t=[],n=this,i=this._axis,r=this._dimension;if(!i)throw new Error('must have a defined "axis" and "dimension"');var o=gt(e,i);return x(o,function(s,a){var c=n._findRange(s,i,r),l,p=t[t.length-1];p&&n._hasIntersection(p.range,c)?t[t.length-1].elements.push(s):(l={range:c,elements:[s]},t.push(l))}),t};Bt.prototype._setOrientation=function(e){var t=vb[e];this._axis=t[0],this._dimension=t[1]};Bt.prototype._hasIntersection=function(e,t){return Math.max(e.min,e.max)>=Math.min(t.min,t.max)&&Math.min(e.min,e.max)<=Math.max(t.min,t.max)};Bt.prototype._findRange=function(e){var t=e[this._axis],n=e[this._dimension];return{min:t+Dl,max:t+n-Dl}};const gb={__init__:["distributeElements"],distributeElements:["type",Bt]};function lo(e){et.call(this,e)}lo.$inject=["eventBus"];O(lo,et);lo.prototype.init=function(){this.addRule("elements.distribute",function(e){var t=e.elements;return t=K(t,function(n){var i=X(n,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(n.labelTarget||i)}),t=kr(t),t.length<3?!1:t})};var yb={horizontal:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
                <polyline points="450 400 450 150 1350 150 1350 400" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
                <rect x="150" y="450" width="600" height="1200" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
                <rect x="1050" y="450" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
              </svg>`,vertical:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
              <polyline points="400 1350 150 1350 150 450 400 450" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
              <rect x="450" y="150" width="1200" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="450" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
            </svg>`};const Il=yb;var _b=900;function ji(e,t,n,i){this._distributeElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",_b,this)}ji.$inject=["popupMenu","distributeElements","translate","rules"];ji.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};ji.prototype._isAllowed=function(e){return this._rules.allowed("elements.distribute",{elements:e})};ji.prototype._getEntries=function(e){var t=this._distributeElements,n=this._translate,i=this._popupMenu,r={"distribute-elements-horizontal":{group:"distribute",title:n("Distribute elements horizontally"),className:"bjs-align-elements-menu-entry",imageHtml:Il.horizontal,action:function(o,s){t.trigger(e,"horizontal"),i.close()}},"distribute-elements-vertical":{group:"distribute",title:n("Distribute elements vertically"),imageHtml:Il.vertical,action:function(o,s){t.trigger(e,"vertical"),i.close()}}};return r};const bb={__depends__:[wa,gb],__init__:["bpmnDistributeElements","distributeElementsMenuProvider"],bpmnDistributeElements:["type",lo],distributeElementsMenuProvider:["type",ji]};var _d="is not a registered action",Eb="is already registered";function rt(e,t){this._actions={};var n=this;e.on("diagram.init",function(){n._registerDefaultActions(t),e.fire("editorActions.init",{editorActions:n})})}rt.$inject=["eventBus","injector"];rt.prototype._registerDefaultActions=function(e){var t=e.get("commandStack",!1),n=e.get("modeling",!1),i=e.get("selection",!1),r=e.get("zoomScroll",!1),o=e.get("copyPaste",!1),s=e.get("canvas",!1),a=e.get("rules",!1),c=e.get("keyboardMove",!1),l=e.get("keyboardMoveSelection",!1);t&&(this.register("undo",function(){t.undo()}),this.register("redo",function(){t.redo()})),o&&i&&this.register("copy",function(){var p=i.get();if(p.length)return o.copy(p)}),o&&this.register("paste",function(){o.paste()}),r&&this.register("stepZoom",function(p){r.stepZoom(p.value)}),s&&this.register("zoom",function(p){s.zoom(p.value)}),n&&i&&a&&this.register("removeSelection",function(){var p=i.get();if(p.length){var u=a.allowed("elements.delete",{elements:p}),d;u!==!1&&(J(u)?d=u:d=p,d.length&&n.removeElements(d.slice()))}}),c&&this.register("moveCanvas",function(p){c.moveCanvas(p)}),l&&this.register("moveSelection",function(p){l.moveSelection(p.direction,p.accelerated)})};rt.prototype.trigger=function(e,t){if(!this._actions[e])throw Os(e,_d);return this._actions[e](t)};rt.prototype.register=function(e,t){var n=this;if(typeof e=="string")return this._registerAction(e,t);x(e,function(i,r){n._registerAction(r,i)})};rt.prototype._registerAction=function(e,t){if(this.isRegistered(e))throw Os(e,Eb);this._actions[e]=t};rt.prototype.unregister=function(e){if(!this.isRegistered(e))throw Os(e,_d);this._actions[e]=void 0};rt.prototype.getActions=function(){return Object.keys(this._actions)};rt.prototype.isRegistered=function(e){return!!this._actions[e]};function Os(e,t){return new Error(e+" "+t)}const xb={__init__:["editorActions"],editorActions:["type",rt]};function po(e){e.invoke(rt,this)}O(po,rt);po.$inject=["injector"];po.prototype._registerDefaultActions=function(e){rt.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),n=e.get("elementRegistry",!1),i=e.get("selection",!1),r=e.get("spaceTool",!1),o=e.get("lassoTool",!1),s=e.get("handTool",!1),a=e.get("globalConnect",!1),c=e.get("distributeElements",!1),l=e.get("alignElements",!1),p=e.get("directEditing",!1),u=e.get("searchPad",!1),d=e.get("modeling",!1),f=e.get("contextPad",!1);t&&n&&i&&this._registerAction("selectElements",function(){var m=t.getRootElement(),h=n.filter(function(v){return v!==m});return i.select(h),h}),r&&this._registerAction("spaceTool",function(){r.toggle()}),o&&this._registerAction("lassoTool",function(){o.toggle()}),s&&this._registerAction("handTool",function(){s.toggle()}),a&&this._registerAction("globalConnectTool",function(){a.toggle()}),i&&c&&this._registerAction("distributeElements",function(m){var h=i.get(),v=m.type;h.length&&c.trigger(h,v)}),i&&l&&this._registerAction("alignElements",function(m){var h=i.get(),v=[],b=m.type;h.length&&(v=K(h,function(E){return!g(E,"bpmn:Lane")}),l.trigger(v,b))}),i&&d&&this._registerAction("setColor",function(m){var h=i.get();h.length&&d.setColor(h,m)}),i&&p&&this._registerAction("directEditing",function(){var m=i.get();m.length&&p.activate(m[0])}),u&&this._registerAction("find",function(){u.toggle()}),t&&d&&this._registerAction("moveToOrigin",function(){var m=t.getRootElement(),h,v;g(m,"bpmn:Collaboration")?v=n.filter(function(b){return g(b.parent,"bpmn:Collaboration")}):v=n.filter(function(b){return b!==m&&!g(b.parent,"bpmn:SubProcess")}),h=Xe(v),d.moveElements(v,{x:-h.x,y:-h.y},m)}),i&&f&&this._registerAction("replaceElement",function(m){f.triggerEntry("replace","click",m)})};const wb={__depends__:[xb],editorActions:["type",po]};function bd(e){e.on(["create.init","shape.move.init"],function(t){var n=t.context,i=t.shape;X(i,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(n.gridSnappingContext||(n.gridSnappingContext={}),n.gridSnappingContext.snapLocation="top-left")})}bd.$inject=["eventBus"];var hr=10;function Ro(e,t,n){return n||(n="round"),Math[n](e/t)*t}var Sb=1200,Pb=800;function tn(e,t,n){var i=!n||n.active!==!1;this._eventBus=t;var r=this;t.on("diagram.init",Pb,function(){r.setActive(i)}),t.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],Sb,function(o){var s=o.originalEvent;if(!(!r.active||s&&Ke(s))){var a=o.context,c=a.gridSnappingContext;c||(c=a.gridSnappingContext={}),["x","y"].forEach(function(l){var p={},u=Tb(o,l,e);u&&(p.offset=u);var d=Cb(o,l);d&&S(p,d),$n(o,l)||r.snapEvent(o,l,p)})}})}tn.prototype.snapEvent=function(e,t,n){var i=this.snapValue(e[t],n);ge(e,t,i)};tn.prototype.getGridSpacing=function(){return hr};tn.prototype.snapValue=function(e,t){var n=0;t&&t.offset&&(n=t.offset),e+=n,e=Ro(e,hr);var i,r;return t&&t.min&&(i=t.min,Y(i)&&(i=Ro(i+n,hr,"ceil"),e=Math.max(e,i))),t&&t.max&&(r=t.max,Y(r)&&(r=Ro(r+n,hr,"floor"),e=Math.min(e,r))),e-=n,e};tn.prototype.isActive=function(){return this.active};tn.prototype.setActive=function(e){this.active=e,this._eventBus.fire("gridSnapping.toggle",{active:e})};tn.prototype.toggleActive=function(){this.setActive(!this.active)};tn.$inject=["elementRegistry","eventBus","config.gridSnapping"];function Cb(e,t){var n=e.context,i=n.createConstraints,r=n.resizeConstraints||{},o=n.gridSnappingContext,s=o.snapConstraints;if(s&&s[t])return s[t];s||(s=o.snapConstraints={}),s[t]||(s[t]={});var a=n.direction;i&&(mr(t)?(s.x.min=i.left,s.x.max=i.right):(s.y.min=i.top,s.y.max=i.bottom));var c=r.min,l=r.max;return c&&(mr(t)?$l(a)?s.x.max=c.left:s.x.min=c.right:Al(a)?s.y.max=c.top:s.y.min=c.bottom),l&&(mr(t)?$l(a)?s.x.min=l.left:s.x.max=l.right:Al(a)?s.y.min=l.top:s.y.max=l.bottom),s[t]}function Tb(e,t,n){var i=e.context,r=e.shape,o=i.gridSnappingContext,s=o.snapLocation,a=o.snapOffset;return a&&Y(a[t])||(a||(a=o.snapOffset={}),Y(a[t])||(a[t]=0),!r)||(n.get(r.id)||(mr(t)?a[t]+=r[t]+r.width/2:a[t]+=r[t]+r.height/2),!s)||(t==="x"?/left/.test(s)?a[t]-=r.width/2:/right/.test(s)&&(a[t]+=r.width/2):/top/.test(s)?a[t]-=r.height/2:/bottom/.test(s)&&(a[t]+=r.height/2)),a[t]}function mr(e){return e==="x"}function Al(e){return e.indexOf("n")!==-1}function $l(e){return e.indexOf("w")!==-1}function yn(e,t){C.call(this,e),this._gridSnapping=t;var n=this;this.preExecute("shape.resize",function(i){var r=i.context,o=r.hints||{},s=o.autoResize;if(s){var a=r.shape,c=r.newBounds;Cr(s)?r.newBounds=n.snapComplex(c,s):r.newBounds=n.snapSimple(a,c)}})}yn.$inject=["eventBus","gridSnapping","modeling"];O(yn,C);yn.prototype.snapSimple=function(e,t){var n=this._gridSnapping;return t.width=n.snapValue(t.width,{min:t.width}),t.height=n.snapValue(t.height,{min:t.height}),t.x=e.x+e.width/2-t.width/2,t.y=e.y+e.height/2-t.height/2,t};yn.prototype.snapComplex=function(e,t){return/w|e/.test(t)&&(e=this.snapHorizontally(e,t)),/n|s/.test(t)&&(e=this.snapVertically(e,t)),e};yn.prototype.snapHorizontally=function(e,t){var n=this._gridSnapping,i=/w/.test(t),r=/e/.test(t),o={};return o.width=n.snapValue(e.width,{min:e.width}),r&&(i?(o.x=n.snapValue(e.x,{max:e.x}),o.width+=n.snapValue(e.x-o.x,{min:e.x-o.x})):e.x=e.x+e.width-o.width),S(e,o),e};yn.prototype.snapVertically=function(e,t){var n=this._gridSnapping,i=/n/.test(t),r=/s/.test(t),o={};return o.height=n.snapValue(e.height,{min:e.height}),i&&(r?(o.y=n.snapValue(e.y,{max:e.y}),o.height+=n.snapValue(e.y-o.y,{min:e.y-o.y})):e.y=e.y+e.height-o.height),S(e,o),e};var Rb=2e3;function Ed(e,t){e.on(["spaceTool.move","spaceTool.end"],Rb,function(n){var i=n.context;if(i.initialized){var r=i.axis,o;r==="x"?(o=t.snapValue(n.dx),n.x=n.x+o-n.dx,n.dx=o):(o=t.snapValue(n.dy),n.y=n.y+o-n.dy,n.dy=o)}})}Ed.$inject=["eventBus","gridSnapping"];const kb={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",yn],gridSnappingSpaceToolBehavior:["type",Ed]},Mb={__depends__:[kb],__init__:["gridSnapping"],gridSnapping:["type",tn]};var Db=2e3;function xd(e,t){e.on("autoPlace",Db,function(n){var i=n.source,r=V(i),o=n.shape,s=Hp(i,o);return["x","y"].forEach(function(a){var c={};s[a]!==r[a]&&(s[a]>r[a]?c.min=s[a]:c.max=s[a],g(o,"bpmn:TextAnnotation")&&(Ib(a)?c.offset=-o.width/2:c.offset=-o.height/2),s[a]=t.snapValue(s[a],c))}),s})}xd.$inject=["eventBus","gridSnapping"];function Ib(e){return e==="x"}var Ab=1750;function wd(e,t,n){t.on(["create.start","shape.move.start"],Ab,function(i){var r=i.context,o=r.shape,s=e.getRootElement();if(!(!g(o,"bpmn:Participant")||!g(s,"bpmn:Process")||!s.children.length)){var a=r.createConstraints;a&&(o.width=n.snapValue(o.width,{min:o.width}),o.height=n.snapValue(o.height,{min:o.height}))}})}wd.$inject=["canvas","eventBus","gridSnapping"];var $b=3e3;function uo(e,t,n){C.call(this,e),this._gridSnapping=t;var i=this;this.postExecuted(["connection.create","connection.layout"],$b,function(r){var o=r.context,s=o.connection,a=o.hints||{},c=s.waypoints;a.connectionStart||a.connectionEnd||a.createElementsBehavior===!1||Ob(c)&&n.updateWaypoints(s,i.snapMiddleSegments(c))})}uo.$inject=["eventBus","gridSnapping","modeling"];O(uo,C);uo.prototype.snapMiddleSegments=function(e){var t=this._gridSnapping,n;e=e.slice();for(var i=1;i<e.length-2;i++)n=Nb(t,e[i],e[i+1]),e[i]=n[0],e[i+1]=n[1];return e};function Ob(e){return e.length>3}function Lb(e){return e==="h"}function Bb(e){return e==="v"}function Nb(e,t,n){var i=Pt(t,n),r={};return Lb(i)&&(r.y=e.snapValue(t.y)),Bb(i)&&(r.x=e.snapValue(t.x)),("x"in r||"y"in r)&&(t=S({},t,r),n=S({},n,r)),[t,n]}const jb={__init__:["gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",xd],gridSnappingParticipantBehavior:["type",wd],gridSnappingLayoutConnectionBehavior:["type",uo]},Hb={__depends__:[Mb,jb],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",bd]};var Vb=30,Sd=30;function Hi(e,t){this._interactionEvents=t;var n=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],function(i){var r=i.element,o=i.gfx;if(g(r,"bpmn:Lane"))return n._createParticipantHit(r,o);if(g(r,"bpmn:Participant"))return Q(r)?n._createParticipantHit(r,o):n._createDefaultHit(r,o);if(g(r,"bpmn:SubProcess"))return Q(r)?n._createSubProcessHit(r,o):n._createDefaultHit(r,o)})}Hi.$inject=["eventBus","interactionEvents"];Hi.prototype._createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0};Hi.prototype._createParticipantHit=function(e,t){this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height});var n=Me(e)?{width:Vb,height:e.height}:{width:e.width,height:Sd};return this._interactionEvents.createBoxHit(t,"all",n),!0};Hi.prototype._createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:Sd}),!0};const Fb={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",Hi]};function fo(e){e.invoke(jn,this)}O(fo,jn);fo.$inject=["injector"];fo.prototype.registerBindings=function(e,t){jn.prototype.registerBindings.call(this,e,t);function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("selectElements",function(i){var r=i.keyEvent;if(e.isKey(["a","A"],r)&&e.isCmd(r))return t.trigger("selectElements"),!0}),n("find",function(i){var r=i.keyEvent;if(e.isKey(["f","F"],r)&&e.isCmd(r))return t.trigger("find"),!0}),n("spaceTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["s","S"],r))return t.trigger("spaceTool"),!0}),n("lassoTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["l","L"],r))return t.trigger("lassoTool"),!0}),n("handTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["h","H"],r))return t.trigger("handTool"),!0}),n("globalConnectTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["c","C"],r))return t.trigger("globalConnectTool"),!0}),n("directEditing",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["e","E"],r))return t.trigger("directEditing"),!0}),n("replaceElement",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["r","R"],r))return t.trigger("replaceElement",r),!0})};const zb={__depends__:[xa],__init__:["keyboardBindings"],keyboardBindings:["type",fo]};var Gb={moveSpeed:1,moveSpeedAccelerated:10},Wb=1500,Ol="left",Ll="up",Bl="right",Nl="down",Ub={ArrowLeft:Ol,Left:Ol,ArrowUp:Ll,Up:Ll,ArrowRight:Bl,Right:Bl,ArrowDown:Nl,Down:Nl},Xb={left:function(e){return{x:-e,y:0}},up:function(e){return{x:0,y:-e}},right:function(e){return{x:e,y:0}},down:function(e){return{x:0,y:e}}};function Pd(e,t,n,i,r){var o=this;this._config=S({},Gb,e||{}),t.addListener(Wb,function(s){var a=s.keyEvent,c=Ub[a.key];if(c&&!t.isCmd(a)){var l=t.isShift(a);return o.moveSelection(c,l),!0}}),this.moveSelection=function(s,a){var c=r.get();if(c.length){var l=this._config[a?"moveSpeedAccelerated":"moveSpeed"],p=Xb[s](l),u=i.allowed("elements.move",{shapes:c});u&&n.moveElements(c,p)}}}Pd.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Kb={__depends__:[xa,It],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Pd]};var jl=10;function Vi(e,t,n,i){this._dragging=i,this._rules=t;var r=this;function o(c,l){var p=c.shape,u=c.direction,d=c.resizeConstraints,f;c.delta=l,f=Ov(p,u,l),c.newBounds=Bv(f,d),c.canExecute=r.canResize(c)}function s(c){var l=c.resizeConstraints,p=c.minBounds;l===void 0&&(p===void 0&&(p=r.computeMinResizeBox(c)),c.resizeConstraints={min:B(p)})}function a(c){var l=c.shape,p=c.canExecute,u=c.newBounds;if(p){if(u=_p(u),!Yb(l,u))return;n.resizeShape(l,u)}}e.on("resize.start",function(c){s(c.context)}),e.on("resize.move",function(c){var l={x:c.dx,y:c.dy};o(c.context,l)}),e.on("resize.end",function(c){a(c.context)})}Vi.prototype.canResize=function(e){var t=this._rules,n=yt(e,["newBounds","shape","delta","direction"]);return t.allowed("shape.resize",n)};Vi.prototype.activate=function(e,t,n){var i=this._dragging,r,o;if(typeof n=="string"&&(n={direction:n}),r=S({shape:t},n),o=r.direction,!o)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");i.init(e,Cd(t,o),"resize",{autoActivate:!0,cursor:qb(o),data:{shape:t,context:r}})};Vi.prototype.computeMinResizeBox=function(e){var t=e.shape,n=e.direction,i,r;return i=e.minDimensions||{width:jl,height:jl},r=pu(t,e.childrenBoxPadding),Nv(n,t,i,r)};Vi.$inject=["eventBus","rules","modeling","dragging"];function Yb(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function Cd(e,t){var n=V(e),i=B(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function qb(e){var t="resize-";return e==="n"||e==="s"?t+"ns":e==="e"||e==="w"?t+"ew":e==="nw"||e==="se"?t+"nwse":t+"nesw"}var Hl="djs-resizing",Vl="resize-not-ok",Zb=500;function Td(e,t,n){function i(o){var s=o.shape,a=o.newBounds,c=o.frame;c||(c=o.frame=n.addFrame(s,t.getActiveLayer()),t.addMarker(s,Hl)),a.width>5&&U(c,{x:a.x,width:a.width}),a.height>5&&U(c,{y:a.y,height:a.height}),o.canExecute?ce(c).remove(Vl):ce(c).add(Vl)}function r(o){var s=o.shape,a=o.frame;a&&Be(o.frame),t.removeMarker(s,Hl)}e.on("resize.move",Zb,function(o){i(o.context)}),e.on("resize.cleanup",function(o){r(o.context)})}Td.$inject=["eventBus","canvas","previewSupport"];var ar=-6,sr=8,cr=20,ri="djs-resizer",Jb=["n","w","s","e","nw","ne","se","sw"];function nn(e,t,n,i){this._resize=i,this._canvas=t;var r=this;e.on("selection.changed",function(o){var s=o.newSelection;r.removeResizers(),s.length===1&&x(s,An(r.addResizer,r))}),e.on("shape.changed",function(o){var s=o.element;n.isSelected(s)&&(r.removeResizers(),r.addResizer(s))})}nn.prototype.makeDraggable=function(e,t,n){var i=this._resize;function r(o){ga(o)&&i.activate(o,e,n)}G.bind(t,"mousedown",r),G.bind(t,"touchstart",r)};nn.prototype._createResizer=function(e,t,n,i){var r=this._getResizersParent(),o=Qb(i),s=oe("g");ce(s).add(ri),ce(s).add(ri+"-"+e.id),ce(s).add(ri+"-"+i),ae(r,s);var a=oe("rect");U(a,{x:-sr/2+o.x,y:-sr/2+o.y,width:sr,height:sr}),ce(a).add(ri+"-visual"),ae(s,a);var c=oe("rect");return U(c,{x:-cr/2+o.x,y:-cr/2+o.y,width:cr,height:cr}),ce(c).add(ri+"-hit"),ae(s,c),hh(s,t,n),s};nn.prototype.createResizer=function(e,t){var n=Cd(e,t),i=this._createResizer(e,n.x,n.y,t);this.makeDraggable(e,i,t)};nn.prototype.addResizer=function(e){var t=this;se(e)||!this._resize.canResize({shape:e})||x(Jb,function(n){t.createResizer(e,n)})};nn.prototype.removeResizers=function(){var e=this._getResizersParent();ya(e)};nn.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};nn.$inject=["eventBus","canvas","selection","resize"];function Qb(e){var t={x:0,y:0};return e.indexOf("e")!==-1?t.x=-ar:e.indexOf("w")!==-1&&(t.x=ar),e.indexOf("s")!==-1?t.y=-ar:e.indexOf("n")!==-1&&(t.y=ar),t}const Rd={__depends__:[bt,$t,Gn],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Vi],resizePreview:["type",Td],resizeHandles:["type",nn]};var eE=2e3;function Fi(e,t,n,i,r,o,s){this._bpmnFactory=t,this._canvas=n,this._modeling=r,this._textRenderer=s,i.registerProvider(this),e.on("element.dblclick",function(c){a(c.element,!0)}),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set","selection.changed"],function(){i.isActive()&&i.complete()}),e.on(["shape.remove","connection.remove"],eE,function(c){i.isActive(c.element)&&i.cancel()}),e.on(["commandStack.changed"],function(c){i.isActive()&&i.cancel()}),e.on("directEditing.activate",function(c){o.removeResizers()}),e.on("create.end",500,function(c){var l=c.context,p=l.shape,u=c.context.canExecute,d=c.isTouch;d||u&&(l.hints&&l.hints.createElementsBehavior===!1||a(p))}),e.on("autoPlace.end",500,function(c){a(c.shape)});function a(c,l){(l||X(c,["bpmn:Task","bpmn:TextAnnotation","bpmn:Participant"])||Ls(c))&&i.activate(c)}}Fi.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"];Fi.prototype.activate=function(e){var t=Ut(e);if(t!==void 0){var n={text:t},i=this.getEditingBBox(e);S(n,i);var r={},o=n.style||{};return S(o,{backgroundColor:null,border:null}),(X(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||Ls(e))&&S(r,{centerVertically:!0}),In(e)&&(S(r,{autoResize:!0}),S(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),g(e,"bpmn:TextAnnotation")&&(S(r,{resizable:!0,autoResize:!0}),S(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),S(n,{options:r,style:o}),n}};Fi.prototype.getEditingBBox=function(e){var t=this._canvas,n=e.label||e,i=t.getAbsoluteBBox(n),r={x:i.x+i.width/2,y:i.y+i.height/2},o={x:i.x,y:i.y},s=t.zoom(),a=this._textRenderer.getDefaultStyle(),c=this._textRenderer.getExternalStyle(),l=c.fontSize*s,p=c.lineHeight,u=a.fontSize*s,d=a.lineHeight,f={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};if(g(e,"bpmn:Lane")||iE(e)){var m=Me(e),h=m?{width:i.height,height:30*s,x:i.x-i.height/2+15*s,y:r.y-30*s/2}:{width:i.width,height:30*s};S(o,h),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*s+"px",paddingBottom:7*s+"px",paddingLeft:5*s+"px",paddingRight:5*s+"px",transform:m?"rotate(-90deg)":null})}if(nE(e)){var v=Me(e),b=v?{width:i.width,height:i.height}:{width:i.height,height:i.width,x:r.x-i.height/2,y:r.y-i.width/2};S(o,b),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*s+"px",paddingBottom:7*s+"px",paddingLeft:5*s+"px",paddingRight:5*s+"px",transform:v?null:"rotate(-90deg)"})}(X(e,["bpmn:Task","bpmn:CallActivity"])||Ls(e))&&(S(o,{width:i.width,height:i.height}),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*s+"px",paddingBottom:7*s+"px",paddingLeft:5*s+"px",paddingRight:5*s+"px"})),tE(e)&&(S(o,{width:i.width,x:i.x}),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*s+"px",paddingBottom:7*s+"px",paddingLeft:5*s+"px",paddingRight:5*s+"px"}));var E=90*s,y=7*s,_=4*s;if(n.labelTarget&&(S(o,{width:E,height:i.height+y+_,x:r.x-E/2,y:i.y-y}),S(f,{fontSize:l+"px",lineHeight:p,paddingTop:y+"px",paddingBottom:_+"px"})),In(n)&&!Dr(n)&&!ee(n)){var w=Ep(e),P=t.getAbsoluteBBox({x:w.x,y:w.y,width:0,height:0}),R=l+y+_;S(o,{width:E,height:R,x:P.x-E/2,y:P.y-R/2}),S(f,{fontSize:l+"px",lineHeight:p,paddingTop:y+"px",paddingBottom:_+"px"})}return g(e,"bpmn:TextAnnotation")&&(S(o,{width:i.width,height:i.height,minWidth:30*s,minHeight:10*s}),S(f,{textAlign:"left",paddingTop:5*s+"px",paddingBottom:7*s+"px",paddingLeft:7*s+"px",paddingRight:5*s+"px",fontSize:u+"px",lineHeight:d})),{bounds:o,style:f}};Fi.prototype.update=function(e,t,n,i){var r,o;g(e,"bpmn:TextAnnotation")&&(o=this._canvas.getAbsoluteBBox(e),r={x:e.x,y:e.y,width:e.width/o.width*i.width,height:e.height/o.height*i.height}),rE(t)&&(t=null),this._modeling.updateLabel(e,t,r)};function Ls(e){return g(e,"bpmn:SubProcess")&&!Q(e)}function tE(e){return g(e,"bpmn:SubProcess")&&Q(e)}function nE(e){return g(e,"bpmn:Participant")&&!Q(e)}function iE(e){return g(e,"bpmn:Participant")&&Q(e)}function rE(e){return!e||!e.trim()}var Fl="djs-element-hidden",zl="djs-label-hidden";function kd(e,t,n){var i=this,r=t.getDefaultLayer(),o,s,a;e.on("directEditing.activate",function(c){var l=c.active;if(o=l.element.label||l.element,g(o,"bpmn:TextAnnotation")){s=t.getAbsoluteBBox(o),a=oe("g");var p=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:o.height,position:{mx:0,my:0}}),u=i.path=oe("path");U(u,{d:p,strokeWidth:2,stroke:oE(o)}),ae(a,u),ae(r,a),Le(a,o.x,o.y)}g(o,"bpmn:TextAnnotation")||o.labelTarget?t.addMarker(o,Fl):(g(o,"bpmn:Task")||g(o,"bpmn:CallActivity")||g(o,"bpmn:SubProcess")||g(o,"bpmn:Participant"))&&t.addMarker(o,zl)}),e.on("directEditing.resize",function(c){if(g(o,"bpmn:TextAnnotation")){var l=c.height,p=c.dy,u=Math.max(o.height/s.height*(l+p),0),d=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:u,position:{mx:0,my:0}});U(i.path,{d})}}),e.on(["directEditing.complete","directEditing.cancel"],function(c){var l=c.active;l&&(t.removeMarker(l.element.label||l.element,Fl),t.removeMarker(o,zl)),o=void 0,s=void 0,a&&(Be(a),a=void 0)})}kd.$inject=["eventBus","canvas","pathMap"];function oE(e,t){var n=ie(e);return n.get("stroke")||t||"black"}const aE={__depends__:[xp,Rd,gd],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",Fi],labelEditingPreview:["type",kd]};var sE=new da("tt");function cE(e){var t=Pe('<div class="djs-tooltip-container" />');return Ar(t,{position:"absolute",width:"0",height:"0"}),e.insertBefore(t,e.firstChild),t}function lE(e,t,n){Ar(e,{left:t+"px",top:n+"px"})}function Bs(e,t){e.style.display=t===!1?"none":""}var Md="djs-tooltip",ko="."+Md;function Ve(e,t){this._eventBus=e,this._canvas=t,this._ids=sE,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=cE(t.getContainer());var n=this;lt.bind(this._tooltipRoot,ko,"mousedown",function(i){i.stopPropagation()}),lt.bind(this._tooltipRoot,ko,"mouseover",function(i){n.trigger("mouseover",i)}),lt.bind(this._tooltipRoot,ko,"mouseout",function(i){n.trigger("mouseout",i)}),this._init()}Ve.$inject=["eventBus","canvas"];Ve.prototype.add=function(e){if(!e.position)throw new Error("must specifiy tooltip position");if(!e.html)throw new Error("must specifiy tooltip html");var t=this._ids.next();return e=S({},this._tooltipDefaults,e,{id:t}),this._addTooltip(e),e.timeout&&this.setTimeout(e),t};Ve.prototype.trigger=function(e,t){var n=t.delegateTarget||t.target,i=this.get(He(n,"data-tooltip-id"));i&&(e==="mouseover"&&i.timeout&&this.clearTimeout(i),e==="mouseout"&&i.timeout&&(i.timeout=1e3,this.setTimeout(i)))};Ve.prototype.get=function(e){return typeof e!="string"&&(e=e.id),this._tooltips[e]};Ve.prototype.clearTimeout=function(e){if(e=this.get(e),!!e){var t=e.removeTimer;t&&(clearTimeout(t),e.removeTimer=null)}};Ve.prototype.setTimeout=function(e){if(e=this.get(e),!!e){this.clearTimeout(e);var t=this;e.removeTimer=setTimeout(function(){t.remove(e)},e.timeout)}};Ve.prototype.remove=function(e){var t=this.get(e);t&&(Dn(t.html),Dn(t.htmlContainer),delete t.htmlContainer,delete this._tooltips[t.id])};Ve.prototype.show=function(){Bs(this._tooltipRoot)};Ve.prototype.hide=function(){Bs(this._tooltipRoot,!1)};Ve.prototype._updateRoot=function(e){var t=e.scale||1,n=e.scale||1,i="matrix("+t+",0,0,"+n+","+-1*e.x*t+","+-1*e.y*n+")";this._tooltipRoot.style.transform=i,this._tooltipRoot.style["-ms-transform"]=i};Ve.prototype._addTooltip=function(e){var t=e.id,n=e.html,i,r=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),Cr(n)&&(n=Pe(n)),i=Pe('<div data-tooltip-id="'+t+'" class="'+Md+'">'),Ar(i,{position:"absolute"}),i.appendChild(n),e.type&&De(i).add("djs-tooltip-"+e.type),e.className&&De(i).add(e.className),e.htmlContainer=i,r.appendChild(i),this._tooltips[t]=e,this._updateTooltip(e)};Ve.prototype._updateTooltip=function(e){var t=e.position,n=e.htmlContainer;lE(n,t.x,t.y)};Ve.prototype._updateTooltipVisibilty=function(e){x(this._tooltips,function(t){var n=t.show,i=t.htmlContainer,r=!0;n&&((n.minZoom>e.scale||n.maxZoom<e.scale)&&(r=!1),Bs(i,r))})};Ve.prototype._init=function(){var e=this;function t(n){e._updateRoot(n),e._updateTooltipVisibilty(n),e.show()}this._eventBus.on("canvas.viewbox.changing",function(n){e.hide()}),this._eventBus.on("canvas.viewbox.changed",function(n){t(n.viewbox)})};const pE={__init__:["tooltips"],tooltips:["type",Ve]};var uE="flow elements must be children of pools/participants";function Dd(e,t,n){function i(r,o,s){t.add({position:{x:r.x+5,y:r.y+5},type:"error",timeout:s||2e3,html:"<div>"+o+"</div>"})}e.on(["shape.move.rejected","create.rejected"],function(r){var o=r.context,s=o.shape,a=o.target;g(a,"bpmn:Collaboration")&&g(s,"bpmn:FlowNode")&&i(r,n(uE))})}Dd.$inject=["eventBus","tooltips","translate"];const dE={__depends__:[pE],__init__:["modelingFeedback"],modelingFeedback:["type",Dd]};var fE=500,hE=1250,mE=1500,Pr=Math.round;function vE(e){return{x:e.x+Pr(e.width/2),y:e.y+Pr(e.height/2)}}function Id(e,t,n,i,r){function o(a,c,l,p){return r.allowed("elements.move",{shapes:a,delta:c,position:l,target:p})}e.on("shape.move.start",mE,function(a){var c=a.context,l=a.shape,p=i.get().slice();p.indexOf(l)===-1&&(p=[l]),p=gE(p),S(c,{shapes:p,validatedShapes:p,shape:l})}),e.on("shape.move.start",hE,function(a){var c=a.context,l=c.validatedShapes,p;if(p=c.canExecute=o(l),!p)return!1}),e.on("shape.move.move",fE,function(a){var c=a.context,l=c.validatedShapes,p=a.hover,u={x:a.dx,y:a.dy},d={x:a.x,y:a.y},f;if(f=o(l,u,d,p),c.delta=u,c.canExecute=f,f===null){c.target=null;return}c.target=p}),e.on("shape.move.end",function(a){var c=a.context,l=c.delta,p=c.canExecute,u=p==="attach",d=c.shapes;if(p===!1)return!1;l.x=Pr(l.x),l.y=Pr(l.y),!(l.x===0&&l.y===0)&&n.moveElements(d,l,c.target,{primaryShape:c.shape,attach:u})}),e.on("element.mousedown",function(a){if(ga(a)){var c=fp(a);if(!c)throw new Error("must supply DOM mousedown event");return s(c,a.element)}});function s(a,c,l,p){if(Mt(l)&&(p=l,l=!1),!(c.waypoints||!c.parent)&&!ce(a.target).has("djs-hit-no-move")){var u=vE(c);return t.init(a,u,"shape.move",{cursor:"grabbing",autoActivate:l,data:{shape:c,context:p||{}}}),!0}}this.start=s}Id.$inject=["eventBus","dragging","modeling","selection","rules"];function gE(e){var t=Mr(e,"id");return K(e,function(n){for(;n=n.parent;)if(t[n.id])return!1;return!0})}var Gl=499,Mo="djs-dragging",Wl="drop-ok",Ul="drop-not-ok",Xl="new-parent",Kl="attach-ok";function Ad(e,t,n,i){function r(c){var l=o(c),p=yE(l);return p}function o(c){var l=_i(c,!0),p=l.flatMap(f=>(f.incoming||[]).concat(f.outgoing||[])),u=l.concat(p),d=[...new Set(u)];return d}function s(c,l){[Kl,Wl,Ul,Xl].forEach(function(p){p===l?t.addMarker(c,p):t.removeMarker(c,p)})}function a(c,l,p){i.addDragger(l,c.dragGroup),p&&t.addMarker(l,Mo),c.allDraggedElements?c.allDraggedElements.push(l):c.allDraggedElements=[l]}e.on("shape.move.start",Gl,function(c){var l=c.context,p=l.shapes,u=l.allDraggedElements,d=r(p);if(!l.dragGroup){var f=oe("g");U(f,n.cls("djs-drag-group",["no-events"]));var m=t.getActiveLayer();ae(m,f),l.dragGroup=f}d.forEach(function(h){i.addDragger(h,l.dragGroup)}),u?u=ha([u,o(p)]):u=o(p),x(u,function(h){t.addMarker(h,Mo)}),l.allDraggedElements=u,l.differentParents=_E(p)}),e.on("shape.move.move",Gl,function(c){var l=c.context,p=l.dragGroup,u=l.target,d=l.shape.parent,f=l.canExecute;u&&(f==="attach"?s(u,Kl):l.canExecute&&d&&u.id!==d.id?s(u,Xl):s(u,l.canExecute?Wl:Ul)),Le(p,c.dx,c.dy)}),e.on(["shape.move.out","shape.move.cleanup"],function(c){var l=c.context,p=l.target;p&&s(p,null)}),e.on("shape.move.cleanup",function(c){var l=c.context,p=l.allDraggedElements,u=l.dragGroup;x(p,function(d){t.removeMarker(d,Mo)}),u&&Be(u)}),this.makeDraggable=a}Ad.$inject=["eventBus","canvas","styles","previewSupport"];function yE(e){var t=K(e,function(n){return se(n)?ue(e,Tt({id:n.source.id}))&&ue(e,Tt({id:n.target.id})):!0});return t}function _E(e){return mh(Mr(e,function(t){return t.parent&&t.parent.id}))!==1}const bE={__depends__:[fa,It,vh,bt,$t,Gn],__init__:["move","movePreview"],move:["type",Id],movePreview:["type",Ad]};var $d=".djs-palette-toggle",Od=".entry",EE=$d+", "+Od,aa="djs-palette-",xE="shown",sa="open",Yl="two-column",wE=1e3;function ye(e,t){this._eventBus=e,this._canvas=t;var n=this;e.on("tool-manager.update",function(i){var r=i.tool;n.updateToolHighlight(r)}),e.on("i18n.changed",function(){n._update()}),e.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}ye.$inject=["eventBus","canvas"];ye.prototype.registerProvider=function(e,t){t||(t=e,e=wE),this._eventBus.on("palette.getProviders",e,function(n){n.providers.push(t)}),this._rebuild()};ye.prototype.getEntries=function(){var e=this._getProviders();return e.reduce(PE,{})};ye.prototype._rebuild=function(){if(this._diagramInitialized){var e=this._getProviders();e.length&&(this._container||this._init(),this._update())}};ye.prototype._init=function(){var e=this,t=this._eventBus,n=this._getParentContainer(),i=this._container=Pe(ye.HTML_MARKUP);n.appendChild(i),De(n).add(aa+xE),lt.bind(i,EE,"click",function(r){var o=r.delegateTarget;if(Tr(o,$d))return e.toggle();e.trigger("click",r)}),G.bind(i,"mousedown",function(r){r.stopPropagation()}),lt.bind(i,Od,"dragstart",function(r){e.trigger("dragstart",r)}),t.on("canvas.resized",this._layoutChanged,this),t.fire("palette.create",{container:i})};ye.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};ye.prototype._toggleState=function(e){e=e||{};var t=this._getParentContainer(),n=this._container,i=this._eventBus,r,o=De(n),s=De(t);"twoColumn"in e?r=e.twoColumn:r=this._needsCollapse(t.clientHeight,this._entries||{}),o.toggle(Yl,r),s.toggle(aa+Yl,r),"open"in e&&(o.toggle(sa,e.open),s.toggle(aa+sa,e.open)),i.fire("palette.changed",{twoColumn:r,open:this.isOpen()})};ye.prototype._update=function(){var e=xe(".djs-palette-entries",this._container),t=this._entries=this.getEntries();wp(e),x(t,function(n,i){var r=n.group||"default",o=xe("[data-group="+pi(r)+"]",e);o||(o=Pe('<div class="group"></div>'),He(o,"data-group",r),e.appendChild(o));var s=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),a=Pe(s);if(o.appendChild(a),!n.separator&&(He(a,"data-action",i),n.title&&He(a,"title",n.title),n.className&&SE(a,n.className),n.imageUrl)){var c=Pe("<img>");He(c,"src",n.imageUrl),a.appendChild(c)}}),this.open()};ye.prototype.trigger=function(e,t,n){var i,r,o=t.delegateTarget||t.target;return o?(i=He(o,"data-action"),r=t.originalEvent||t,this.triggerEntry(i,e,r,n)):t.preventDefault()};ye.prototype.triggerEntry=function(e,t,n,i){var r=this._entries,o,s;if(o=r[e],!!o&&(s=o.action,this._eventBus.fire("palette.trigger",{entry:o,event:n})!==!1)){if(Qe(s)){if(t==="click")return s(n,i)}else if(s[t])return s[t](n,i);n.preventDefault()}};ye.prototype._layoutChanged=function(){this._toggleState({})};ye.prototype._needsCollapse=function(e,t){var n=50,i=Object.keys(t).length*46;return e<i+n};ye.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};ye.prototype.open=function(){this._toggleState({open:!0})};ye.prototype.toggle=function(){this.isOpen()?this.close():this.open()};ye.prototype.isActiveTool=function(e){return e&&this._activeTool===e};ye.prototype.updateToolHighlight=function(e){var t,n;this._toolsContainer||(t=xe(".djs-palette-entries",this._container),this._toolsContainer=xe("[data-group=tools]",t)),n=this._toolsContainer,x(n.children,function(i){var r=i.getAttribute("data-action");if(r){var o=De(i);r=r.replace("-tool",""),o.contains("entry")&&r===e?o.add("highlighted-entry"):o.remove("highlighted-entry")}})};ye.prototype.isOpen=function(){return De(this._container).has(sa)};ye.prototype._getParentContainer=function(){return this._canvas.getContainer()};ye.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function SE(e,t){var n=De(e),i=J(t)?t:t.split(/\s+/g);i.forEach(function(r){n.add(r)})}function PE(e,t){var n=t.getPaletteEntries();return Qe(n)?n(e):(x(n,function(i,r){e[r]=i}),e)}const CE={__init__:["palette"],palette:["type",ye]};var Ld="crosshair";function _n(e,t,n,i,r,o,s){this._selection=r,this._dragging=n,this._mouse=s;var a=this,c={create:function(l){var p=t.getActiveLayer(),u;u=l.frame=oe("rect"),U(u,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),ae(p,u)},update:function(l){var p=l.frame,u=l.bbox;U(p,{x:u.x,y:u.y,width:u.width,height:u.height})},remove:function(l){l.frame&&Be(l.frame)}};o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),e.on("lasso.selection.end",function(l){var p=l.originalEvent.target;!l.hover&&!(p instanceof SVGElement)||e.once("lasso.selection.ended",function(){a.activateLasso(l.originalEvent,!0)})}),e.on("lasso.end",0,function(l){var p=l.context,u=Do(l),d=i.filter(function(m){return m}),f=jo(l);a.select(d,u,f?p.selection:[])}),e.on("lasso.start",function(l){var p=l.context;p.bbox=Do(l),c.create(p),p.selection=r.get()}),e.on("lasso.move",function(l){var p=l.context;p.bbox=Do(l),c.update(p)}),e.on("lasso.cleanup",function(l){var p=l.context;c.remove(p)}),e.on("element.mousedown",1500,function(l){if(jo(l))return a.activateLasso(l.originalEvent),!0})}_n.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];_n.prototype.activateLasso=function(e,t){this._dragging.init(e,"lasso",{autoActivate:t,cursor:Ld,data:{context:{}}})};_n.prototype.activateSelection=function(e,t){this._dragging.init(e,"lasso.selection",{trapClick:!1,autoActivate:t,cursor:Ld,data:{context:{}},keepSelection:!0})};_n.prototype.select=function(e,t,n=[]){var i=gh(e,t);this._selection.select([...n,...ma(i)])};_n.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};_n.prototype.isActive=function(){var e=this._dragging.context();return e&&/^lasso/.test(e.prefix)};function Do(e){var t={x:e.x-e.dx,y:e.y-e.dy},n={x:e.x,y:e.y},i;return t.x<=n.x&&t.y<n.y||t.x<n.x&&t.y<=n.y?i={x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y}:t.x>=n.x&&t.y<n.y||t.x>n.x&&t.y<=n.y?i={x:n.x,y:t.y,width:t.x-n.x,height:n.y-t.y}:t.x<=n.x&&t.y>n.y||t.x<n.x&&t.y>=n.y?i={x:t.x,y:n.y,width:n.x-t.x,height:t.y-n.y}:t.x>=n.x&&t.y>n.y||t.x>n.x&&t.y>=n.y?i={x:n.x,y:n.y,width:t.x-n.x,height:t.y-n.y}:i={x:n.x,y:n.y,width:0,height:0},i}const TE={__depends__:[qr,Ci],__init__:["lassoTool"],lassoTool:["type",_n]};var Io=1500,Bd="grab";function Wn(e,t,n,i,r,o){this._dragging=n,this._mouse=o;var s=this,a=i.get("keyboard",!1);r.registerTool("hand",{tool:"hand",dragging:"hand.move"}),e.on("element.mousedown",Io,function(c){if(fi(c))return s.activateMove(c.originalEvent,!0),!1}),a&&a.addListener(Io,function(c){if(!(!ql(c.keyEvent)||s.isActive())){var l=s._mouse.getLastMoveEvent();s.activateMove(l,!!l)}},"keyboard.keydown"),a&&a.addListener(Io,function(c){!ql(c.keyEvent)||!s.isActive()||s.toggle()},"keyboard.keyup"),e.on("hand.end",function(c){var l=c.originalEvent.target;if(!c.hover&&!(l instanceof SVGElement))return!1;e.once("hand.ended",function(){s.activateMove(c.originalEvent,{reactivate:!0})})}),e.on("hand.move.move",function(c){var l=t.viewbox().scale;t.scroll({dx:c.dx*l,dy:c.dy*l})}),e.on("hand.move.end",function(c){var l=c.context,p=l.reactivate;return!fi(c)&&p&&e.once("hand.move.ended",function(u){s.activateHand(u.originalEvent,!0,!0)}),!1})}Wn.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];Wn.prototype.activateMove=function(e,t,n){typeof t=="object"&&(n=t,t=!1),this._dragging.init(e,"hand.move",{autoActivate:t,cursor:Bd,data:{context:n||{}}})};Wn.prototype.activateHand=function(e,t,n){this._dragging.init(e,"hand",{trapClick:!1,autoActivate:t,cursor:Bd,data:{context:{reactivate:n}}})};Wn.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateHand(e,!!e)};Wn.prototype.isActive=function(){var e=this._dragging.context();return e?/^(hand|hand\.move)$/.test(e.prefix):!1};function ql(e){return Ee("Space",e)}const RE={__depends__:[qr,Ci],__init__:["handTool"],handTool:["type",Wn]};var Zl="connect-ok",Jl="connect-not-ok";function Un(e,t,n,i,r,o,s){var a=this;this._dragging=t,this._rules=o,this._mouse=s,r.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),e.on("global-connect.hover",function(c){var l=c.context,p=c.hover,u=l.canStartConnect=a.canStartConnect(p);u!==null&&(l.startTarget=p,i.addMarker(p,u?Zl:Jl))}),e.on(["global-connect.out","global-connect.cleanup"],function(c){var l=c.context.startTarget,p=c.context.canStartConnect;l&&i.removeMarker(l,p?Zl:Jl)}),e.on(["global-connect.ended"],function(c){var l=c.context,p=l.startTarget,u={x:c.x,y:c.y},d=a.canStartConnect(p);if(d)return e.once("element.out",function(){e.once(["connect.ended","connect.canceled"],function(){e.fire("global-connect.drag.ended")}),n.start(null,p,u)}),!1})}Un.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"];Un.prototype.start=function(e,t){this._dragging.init(e,"global-connect",{autoActivate:t,trapClick:!1,data:{context:{}}})};Un.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();return this.start(e,!!e)};Un.prototype.isActive=function(){var e=this._dragging.context();return e&&/^global-connect/.test(e.prefix)};Un.prototype.canStartConnect=function(e){return this._rules.allowed("connection.start",{source:e})};const kE={__depends__:[Da,bt,$t,qr,Ci],globalConnect:["type",Un]};function Ns(e,t,n,i,r,o,s,a){this._palette=e,this._create=t,this._elementFactory=n,this._spaceTool=i,this._lassoTool=r,this._handTool=o,this._globalConnect=s,this._translate=a,e.registerProvider(this)}Ns.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];Ns.prototype.getPaletteEntries=function(){var e={},t=this._create,n=this._elementFactory,i=this._spaceTool,r=this._lassoTool,o=this._handTool,s=this._globalConnect,a=this._translate;function c(u,d,f,m,h){function v(b){var E=n.createShape(S({type:u},h));t.start(b,E)}return{group:d,className:f,title:m,action:{dragstart:v,click:v}}}function l(u){var d=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),f=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:d});t.start(u,[d,f],{hints:{autoSelect:[d]}})}function p(u){t.start(u,n.createParticipantShape())}return S(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:a("Activate hand tool"),action:{click:function(u){o.activateHand(u)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:a("Activate lasso tool"),action:{click:function(u){r.activateSelection(u)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:a("Activate create/remove space tool"),action:{click:function(u){i.activateSelection(u)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:a("Activate global connect tool"),action:{click:function(u){s.start(u)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",a("Create start event")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",a("Create intermediate/boundary event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",a("Create end event")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",a("Create gateway")),"create.task":c("bpmn:Task","activity","bpmn-icon-task",a("Create task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",a("Create data object reference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",a("Create data store reference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:a("Create expanded sub-process"),action:{dragstart:l,click:l}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:a("Create pool/participant"),action:{dragstart:p,click:p}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",a("Create group"))}),e};const ME={__depends__:[CE,Yr,Qu,TE,RE,kE,Sp],__init__:["paletteProvider"],paletteProvider:["type",Ns]};var DE=250;function js(e,t,n,i,r){C.call(this,e);function o(a){var c=a.canExecute.replacements;x(c,function(l){var p=l.oldElementId,u={type:l.newElementType};if(!a.visualReplacements[p]){var d=t.get(p);S(u,{x:d.x,y:d.y});var f=n.createShape(u);i.addShape(f,d.parent);var m=xe('[data-element-id="'+pi(d.id)+'"]',a.dragGroup);m&&U(m,{display:"none"});var h=r.addDragger(f,a.dragGroup);a.visualReplacements[p]=h,i.removeShape(f)}})}function s(a){var c=a.visualReplacements;x(c,function(l,p){var u=xe('[data-element-id="'+pi(p)+'"]',a.dragGroup);u&&U(u,{display:"inline"}),l.remove(),c[p]&&delete c[p]})}e.on("shape.move.move",DE,function(a){var c=a.context,l=c.canExecute;c.visualReplacements||(c.visualReplacements={}),l&&l.replacements?o(c):s(c)})}js.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"];O(js,C);const IE={__depends__:[Gn],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",js]};var AE=1250,Ao=40,$E=20,OE=10,Ql=20,Nd=["x","y"],LE=Math.abs;function jd(e){e.on(["connect.hover","connect.move","connect.end"],AE,function(t){var n=t.context,i=n.canExecute,r=n.start,o=n.hover,s=n.source,a=n.target;t.originalEvent&&Ke(t.originalEvent)||(n.initialConnectionStart||(n.initialConnectionStart=n.connectionStart),i&&o&&BE(t,o,VE(o)),o&&HE(i,["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"])?(n.connectionStart=Je(r),X(o,["bpmn:Event","bpmn:Gateway"])&&ep(t,Je(o)),X(o,["bpmn:Task","bpmn:SubProcess"])&&NE(t,o),g(s,"bpmn:BoundaryEvent")&&a===s.host&&jE(t)):Hd(i,"bpmn:MessageFlow")?(g(r,"bpmn:Event")&&(n.connectionStart=Je(r)),g(o,"bpmn:Event")&&ep(t,Je(o))):n.connectionStart=n.initialConnectionStart)})}jd.$inject=["eventBus"];function BE(e,t,n){Nd.forEach(function(i){var r=Vd(i,t);e[i]<t[i]+n?ge(e,i,t[i]+n):e[i]>t[i]+r-n&&ge(e,i,t[i]+r-n)})}function NE(e,t){var n=Je(t);Nd.forEach(function(i){FE(e,t,i)&&ge(e,i,n[i])})}function jE(e){var t=e.context,n=t.source,i=t.target;if(!zE(t)){var r=Je(n),o=Ie(r,i,-10),s=[];/top|bottom/.test(o)&&s.push("x"),/left|right/.test(o)&&s.push("y"),s.forEach(function(a){var c=e[a],l;LE(c-r[a])<Ao&&(c>r[a]?l=r[a]+Ao:l=r[a]-Ao,ge(e,a,l))})}}function ep(e,t){ge(e,"x",t.x),ge(e,"y",t.y)}function Hd(e,t){return e&&e.type===t}function HE(e,t){return bi(t,function(n){return Hd(e,n)})}function Vd(e,t){return e==="x"?t.width:t.height}function VE(e){return g(e,"bpmn:Task")?OE:$E}function FE(e,t,n){return e[n]>t[n]+Ql&&e[n]<t[n]+Vd(n,t)-Ql}function zE(e){var t=e.hover,n=e.source;return t&&n&&t===n}function rn(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}rn.prototype.getSnapOrigin=function(e){return this._snapOrigins[e]};rn.prototype.setSnapOrigin=function(e,t){this._snapOrigins[e]=t,this._snapLocations.indexOf(e)===-1&&this._snapLocations.push(e)};rn.prototype.addDefaultSnap=function(e,t){var n=this._defaultSnaps[e];n||(n=this._defaultSnaps[e]=[]),n.push(t)};rn.prototype.getSnapLocations=function(){return this._snapLocations};rn.prototype.setSnapLocations=function(e){this._snapLocations=e};rn.prototype.pointsForTarget=function(e){var t=e.id||e,n=this._targets[t];return n||(n=this._targets[t]=new ho,n.initDefaults(this._defaultSnaps)),n};function ho(){this._snapValues={}}ho.prototype.add=function(e,t){var n=this._snapValues[e];n||(n=this._snapValues[e]={x:[],y:[]}),n.x.indexOf(t.x)===-1&&n.x.push(t.x),n.y.indexOf(t.y)===-1&&n.y.push(t.y)};ho.prototype.snap=function(e,t,n,i){var r=this._snapValues[t];return r&&av(e[n],r[n],i)};ho.prototype.initDefaults=function(e){var t=this;x(e||{},function(n,i){x(n,function(r){t.add(i,r)})})};var GE=1250;function Et(e,t,n){var i=this;this._elementRegistry=e,t.on(["create.start","shape.move.start"],function(r){i.initSnap(r)}),t.on(["create.move","create.end","shape.move.move","shape.move.end"],GE,function(r){var o=r.context,s=o.shape,a=o.snapContext,c=o.target;if(!(r.originalEvent&&Ke(r.originalEvent))&&!($n(r)||!c)){var l=a.pointsForTarget(c);l.initialized||(l=i.addSnapTargetPoints(l,s,c),l.initialized=!0),n.snap(r,l)}}),t.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}Et.$inject=["elementRegistry","eventBus","snapping"];Et.prototype.initSnap=function(e){var t=this._elementRegistry,n=e.context,i=n.shape,r=n.snapContext;r||(r=n.snapContext=new rn);var o;t.get(i.id)?o=Je(i,e):o={x:e.x+Je(i).x,y:e.y+Je(i).y};var s={x:o.x-i.width/2,y:o.y-i.height/2},a={x:o.x+i.width/2,y:o.y+i.height/2};return r.setSnapOrigin("mid",{x:o.x-e.x,y:o.y-e.y}),ee(i)||(r.setSnapOrigin("top-left",{x:s.x-e.x,y:s.y-e.y}),r.setSnapOrigin("bottom-right",{x:a.x-e.x,y:a.y-e.y})),r};Et.prototype.addSnapTargetPoints=function(e,t,n){var i=this.getSnapTargets(t,n);return x(i,function(r){if(ee(r)){ee(t)&&e.add("mid",Je(r));return}if(se(r)){if(r.waypoints.length<3)return;var o=r.waypoints.slice(1,-1);x(o,function(s){e.add("mid",s)});return}e.add("mid",Je(r))}),!Y(t.x)||!Y(t.y)||this._elementRegistry.get(t.id)&&e.add("mid",Je(t)),e};Et.prototype.getSnapTargets=function(e,t){return nu(t).filter(function(n){return!WE(n)})};function WE(e){return!!e.hidden}var tp=1500;function Xn(e,t){t.invoke(Et,this),e.on(["create.move","create.end"],tp,YE),e.on(["create.move","create.end","shape.move.move","shape.move.end"],tp,function(n){var i=n.context,r=i.canExecute,o=i.target,s=r&&(r==="attach"||r.attach);s&&!$n(n)&&UE(n,o)})}O(Xn,Et);Xn.$inject=["eventBus","injector"];Xn.prototype.initSnap=function(e){var t=Et.prototype.initSnap.call(this,e),n=e.shape,i=!!this._elementRegistry.get(n.id);return x(n.outgoing,function(r){var o=r.waypoints[0];o=o.original||o,t.setSnapOrigin(r.id+"-docking",ip(o,i,e))}),x(n.incoming,function(r){var o=r.waypoints[r.waypoints.length-1];o=o.original||o,t.setSnapOrigin(r.id+"-docking",ip(o,i,e))}),g(n,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t};Xn.prototype.addSnapTargetPoints=function(e,t,n){Et.prototype.addSnapTargetPoints.call(this,e,t,n);var i=this.getSnapTargets(t,n);x(i,function(o){(KE(o)||XE([t,o],"bpmn:TextAnnotation"))&&(e.add("top-left",eu(o)),e.add("bottom-right",tu(o)))});var r=this._elementRegistry;return x(t.incoming,function(o){if(r.get(t.id)){np(i,o.source)||e.add("mid",V(o.source));var s=o.waypoints[0];e.add(o.id+"-docking",s.original||s)}}),x(t.outgoing,function(o){if(r.get(t.id)){np(i,o.target)||e.add("mid",V(o.target));var s=o.waypoints[o.waypoints.length-1];e.add(o.id+"-docking",s.original||s)}}),g(n,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,n.parent)),e};Xn.prototype.getSnapTargets=function(e,t){return Et.prototype.getSnapTargets.call(this,e,t).filter(function(n){return!g(n,"bpmn:Lane")})};function UE(e,t){var n=B(t),i=Ru(e,t),r=e.context,o=r.shape,s;o.parent?s={x:0,y:0}:s=V(o),/top/.test(i)?ge(e,"y",n.top-s.y):/bottom/.test(i)&&ge(e,"y",n.bottom-s.y),/left/.test(i)?ge(e,"x",n.left-s.x):/right/.test(i)&&ge(e,"x",n.right-s.x)}function XE(e,t){return e.every(function(n){return g(n,t)})}function KE(e){return g(e,"bpmn:SubProcess")&&Q(e)?!0:g(e,"bpmn:Participant")}function YE(e){var t=e.context,n=t.createConstraints;if(n){var i=n.top,r=n.right,o=n.bottom,s=n.left;(s&&s>=e.x||r&&r<=e.x)&&ge(e,"x",e.x),(i&&i>=e.y||o&&o<=e.y)&&ge(e,"y",e.y)}}function np(e,t){return e.indexOf(t)!==-1}function ip(e,t,n){return t?{x:e.x-n.x,y:e.y-n.y}:{x:e.x,y:e.y}}var qE=1250;function zi(e,t){var n=this;e.on(["resize.start"],function(i){n.initSnap(i)}),e.on(["resize.move","resize.end"],qE,function(i){var r=i.context,o=r.shape,s=o.parent,a=r.direction,c=r.snapContext;if(!(i.originalEvent&&Ke(i.originalEvent))&&!$n(i)){var l=c.pointsForTarget(s);l.initialized||(l=n.addSnapTargetPoints(l,o,s,a),l.initialized=!0),QE(a)&&ge(i,"x",i.x),ex(a)&&ge(i,"y",i.y),t.snap(i,l)}}),e.on(["resize.cleanup"],function(){t.hide()})}zi.prototype.initSnap=function(e){var t=e.context,n=t.shape,i=t.direction,r=t.snapContext;r||(r=t.snapContext=new rn);var o=Fd(n,i);return r.setSnapOrigin("corner",{x:o.x-e.x,y:o.y-e.y}),r};zi.prototype.addSnapTargetPoints=function(e,t,n,i){var r=this.getSnapTargets(t,n);return x(r,function(o){e.add("corner",tu(o)),e.add("corner",eu(o))}),e.add("corner",Fd(t,i)),e};zi.$inject=["eventBus","snapping"];zi.prototype.getSnapTargets=function(e,t){return nu(t).filter(function(n){return!ZE(n,e)&&!se(n)&&!JE(n)&&!ee(n)})};function Fd(e,t){var n=V(e),i=B(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function ZE(e,t){return e.host===t}function JE(e){return!!e.hidden}function QE(e){return e==="n"||e==="s"}function ex(e){return e==="e"||e==="w"}var tx=7,nx=1e3;function on(e){this._canvas=e,this._asyncHide=yh(An(this.hide,this),nx)}on.$inject=["canvas"];on.prototype.snap=function(e,t){var n=e.context,i=n.snapContext,r=i.getSnapLocations(),o={x:$n(e,"x"),y:$n(e,"y")};x(r,function(s){var a=i.getSnapOrigin(s),c={x:e.x+a.x,y:e.y+a.y};if(x(["x","y"],function(l){var p;o[l]||(p=t.snap(c,s,l,tx),p!==void 0&&(o[l]={value:p,originValue:p-a[l]}))}),o.x&&o.y)return!1}),this.showSnapLine("vertical",o.x&&o.x.value),this.showSnapLine("horizontal",o.y&&o.y.value),x(["x","y"],function(s){var a=o[s];Mt(a)&&ge(e,s,a.originValue)})};on.prototype._createLine=function(e){var t=this._canvas.getLayer("snap"),n=oe("path");return U(n,{d:"M0,0 L0,0"}),ce(n).add("djs-snap-line"),ae(t,n),{update:function(i){Y(i)?e==="horizontal"?U(n,{d:"M-100000,"+i+" L+100000,"+i,display:""}):U(n,{d:"M "+i+",-100000 L "+i+", +100000",display:""}):U(n,{display:"none"})}}};on.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};on.prototype.showSnapLine=function(e,t){var n=this.getSnapLine(e);n&&n.update(t),this._asyncHide()};on.prototype.getSnapLine=function(e){return this._snapLines||this._createSnapLines(),this._snapLines[e]};on.prototype.hide=function(){x(this._snapLines,function(e){e.update()})};const ix={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",Et],resizeSnapping:["type",zi],snapping:["type",on]},rx={__depends__:[ix],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",jd],createMoveSnapping:["type",Xn]};function N(e,t,n,i,r){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=e,this._eventBus=t,this._overlays=n,this._selection=i,this._translate=r,this._container=this._getBoxHtml(),this._searchInput=xe(N.INPUT_SELECTOR,this._container),this._resultsContainer=xe(N.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),t.on(["canvas.destroy","diagram.destroy"],this.close,this)}N.$inject=["canvas","eventBus","overlays","selection","translate"];N.prototype._bindEvents=function(){var e=this;function t(n,i,r,o){e._eventMaps.push({el:n,type:r,listener:lt.bind(n,i,r,o)})}t(document,"html","click",function(n){e.close()}),t(this._container,N.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),t(this._container,N.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),e._scrollToNode(n.delegateTarget),e._preselect(n.delegateTarget)}),t(this._container,N.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),e._select(n.delegateTarget)}),t(this._container,N.INPUT_SELECTOR,"keydown",function(n){Ee("ArrowUp",n)&&n.preventDefault(),Ee("ArrowDown",n)&&n.preventDefault()}),t(this._container,N.INPUT_SELECTOR,"keyup",function(n){if(Ee("Escape",n))return e.close();if(Ee("Enter",n)){var i=e._getCurrentResult();return i?e._select(i):e.close()}if(Ee("ArrowUp",n))return e._scrollToDirection(!0);if(Ee("ArrowDown",n))return e._scrollToDirection();Ee(["ArrowLeft","ArrowRight"],n)||e._search(n.delegateTarget.value)})};N.prototype._unbindEvents=function(){this._eventMaps.forEach(function(e){lt.unbind(e.el,e.type,e.listener)})};N.prototype._search=function(e){var t=this;if(this._clearResults(),!(!e||e==="")){var n=this._searchProvider.find(e);if(n.length){n.forEach(function(r){var o=r.element.id,s=t._createResultNode(r,o);t._results[o]={element:r.element,node:s}});var i=xe(N.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(i),this._preselect(i)}}};N.prototype._scrollToDirection=function(e){var t=this._getCurrentResult();if(t){var n=e?t.previousElementSibling:t.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};N.prototype._scrollToNode=function(e){if(!(!e||e===this._getCurrentResult())){var t=e.offsetTop,n=this._resultsContainer.scrollTop,i=t-this._resultsContainer.clientHeight+e.clientHeight;t<n?this._resultsContainer.scrollTop=t:n<i&&(this._resultsContainer.scrollTop=i)}};N.prototype._clearResults=function(){wp(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")};N.prototype._getCurrentResult=function(){return xe(N.RESULT_SELECTED_SELECTOR,this._resultsContainer)};N.prototype._createResultNode=function(e,t){var n=Pe(N.RESULT_HTML);return e.primaryTokens.length>0&&rp(n,e.primaryTokens,N.RESULT_PRIMARY_HTML),rp(n,e.secondaryTokens,N.RESULT_SECONDARY_HTML),He(n,N.RESULT_ID_ATTRIBUTE,t),this._resultsContainer.appendChild(n),n};N.prototype.registerProvider=function(e){this._searchProvider=e};N.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,De(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};N.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,De(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))};N.prototype.toggle=function(){this.isOpen()?this.close():this.open()};N.prototype.isOpen=function(){return this._open};N.prototype._preselect=function(e){var t=this._getCurrentResult();if(e!==t){t&&De(t).remove(N.RESULT_SELECTED_CLASS);var n=He(e,N.RESULT_ID_ATTRIBUTE),i=this._results[n].element;De(e).add(N.RESULT_SELECTED_CLASS),this._resetOverlay(i),this._canvas.scrollToElement(i,{top:400}),this._selection.select(i),this._eventBus.fire("searchPad.preselected",i)}};N.prototype._select=function(e){var t=He(e,N.RESULT_ID_ATTRIBUTE),n=this._results[t].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};N.prototype._resetOverlay=function(e){if(this._overlayId&&this._overlays.remove(this._overlayId),e){var t=Xe(e),n=ox(t);this._overlayId=this._overlays.add(e,n)}};N.prototype._getBoxHtml=function(){const e=Pe(N.BOX_HTML),t=xe(N.INPUT_SELECTOR,e);return t&&t.setAttribute("aria-label",this._translate("Search in diagram")),e};function ox(e){var t=6,n=e.width+t*2,i=e.height+t*2,r={width:n+"px",height:i+"px"},o=Pe('<div class="'+N.OVERLAY_CLASS+'"></div>');return Ar(o,r),{position:{bottom:i-t,right:n-t},show:!0,html:o}}function rp(e,t,n){var i=ax(t),r=Pe(n);r.innerHTML=i,e.appendChild(r)}function ax(e){var t="";return e.forEach(function(n){n.matched?t+='<strong class="'+N.RESULT_HIGHLIGHT_CLASS+'">'+qs(n.matched)+"</strong>":t+=qs(n.normal)}),t!==""?t:null}N.CONTAINER_SELECTOR=".djs-search-container";N.INPUT_SELECTOR=".djs-search-input input";N.RESULTS_CONTAINER_SELECTOR=".djs-search-results";N.RESULT_SELECTOR=".djs-search-result";N.RESULT_SELECTED_CLASS="djs-search-result-selected";N.RESULT_SELECTED_SELECTOR="."+N.RESULT_SELECTED_CLASS;N.RESULT_ID_ATTRIBUTE="data-result-id";N.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";N.OVERLAY_CLASS="djs-search-overlay";N.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>';N.RESULT_HTML='<div class="djs-search-result"></div>';N.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';N.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const sx={__depends__:[Sp,dp,It],searchPad:["type",N]};function Hs(e,t,n){this._elementRegistry=e,this._canvas=n,t.registerProvider(this)}Hs.$inject=["elementRegistry","searchPad","canvas"];Hs.prototype.find=function(e){var t=this._canvas.getRootElements(),n=this._elementRegistry.filter(function(i){return!i.labelTarget});return n=K(n,function(i){return!t.includes(i)}),n=Ge(n,function(i){return{primaryTokens:ap(Ut(i),e),secondaryTokens:ap(i.id,e),element:i}}),n=K(n,function(i){return op(i.primaryTokens)||op(i.secondaryTokens)}),n=gt(n,function(i){return Ut(i.element)+i.element.id}),n};function op(e){var t=K(e,function(n){return!!n.matched});return t.length>0}function ap(e,t){var n=[],i=e;if(!e)return n;e=e.toLowerCase(),t=t.toLowerCase();var r=e.indexOf(t);return r>-1?(r!==0&&n.push({normal:i.substr(0,r)}),n.push({matched:i.substr(r,t.length)}),t.length+r<e.length&&n.push({normal:i.substr(t.length+r,e.length)})):n.push({normal:i}),n}const cx={__depends__:[sx],__init__:["bpmnSearch"],bpmnSearch:["type",Hs]};var lx='<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>';function pt(e){Ei.call(this,e)}O(pt,Ei);pt.Viewer=mn;pt.NavigatedViewer=mi;pt.prototype.createDiagram=function(){return this.importXML(lx)};pt.prototype._interactionModules=[Dp,pa,ua];pt.prototype._modelingModules=[_m,Ca,Fm,Lm,cv,Da,hv,mb,Xu,Yr,bb,wb,Hb,Fb,zb,Kb,aE,vd,dE,bE,ME,IE,Rd,rx,cx];pt.prototype._modules=[].concat(mn.prototype._modules,pt.prototype._interactionModules,pt.prototype._modelingModules);const px={name:"bpmn-llm",props:{url:{type:String},bpmn:{type:String},options:{type:Object},isViewMode:{type:Boolean},currentActivities:{type:Array}},data:function(){return{diagramXML:null,openPanel:!1,moddle:null,bpmnStore:null,bpmnViewer:null}},computed:{async getXML(){return await this.bpmnViewer.saveXML({format:!0,preamble:!0})}},mounted(){var e=this.$refs.container,t=this;this.bpmnStore=ca();var n=Object.assign({container:e,keyboard:{bindTo:window},moddleExtensions:{uengine:Go}},this.options);t.isViewMode?(t.bpmnViewer=new mn(n),t.bpmnStore.setModeler(t.bpmnViewer)):(t.bpmnViewer=new pt(n),t.bpmnStore.setModeler(t.bpmnViewer));var i=this.bpmnViewer.get("eventBus");i.on("import.render.complete",async function(r){console.log("complete?");var o=r.error,s=r.warnings;let a=t.bpmnViewer.getDefinitions();t.$emit("definition",a),o?t.$emit("error",o):t.$emit("shown",s),console.log(a);var c=t.bpmnViewer.get("canvas");c.zoom("fit-viewport"),t.isViewMode&&t.currentActivities&&t.currentActivities.length>0&&t.currentActivities.forEach(l=>{l&&c.addMarker(l,"highlight")}),console.log(i),i.on("shape.added",async function(l){const p=l.element,u=p.businessObject;if(console.log(p),console.log(u),u.extensionElements)return;let d=await t.getXML;console.log(d),t.extendUEngineProperties(p)}),t.isViewMode?i.on("element.dblclick",function(l){l.element.type.includes("CallActivity")?t.$emit("openDefinition",l.element.businessObject):t.$emit("openPanel",l.element.id)}):i.on("element.dblclick",function(l){t.$emit("openPanel",l.element.id)})}),this.url?this.fetchDiagram(this.url):this.bpmn?this.diagramXML=this.bpmn:this.diagramXML='<?xml version="1.0" encoding="UTF-8"?> <bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:uengine="http://uengine" id="Definitions_0bfky9r" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="16.4.0"> <bpmn:process id="Process_1oscmbn" isExecutable="false"> <uengine:ProcessVariables id="ProcessVariables_1"> <uengine:ProcessVariable key="variable1" value="value1"/> <uengine:ProcessVariable key="variable2" value="value2"/> </uengine:ProcessVariables> </bpmn:process> <bpmndi:BPMNDiagram id="BPMNDiagram_1"> <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1oscmbn" /> </bpmndi:BPMNDiagram> </bpmn:definitions>'},beforeDestroy(){this.bpmnViewer.destroy()},watch:{url(e){this.$emit("loading"),this.fetchDiagram(e)},sortByIdWithParticipantFirst(e){return e.sort((t,n)=>{const i=t.id.toLowerCase().startsWith("participant"),r=n.id.toLowerCase().startsWith("participant");return i&&!r?-1:!i&&r?1:t.id.localeCompare(n.id)})},diagramXML(e){console.log(e),this.bpmnViewer.importXML(e)}},methods:{extendUEngineProperties(e){var o;let t=this;if((o=e.extensionElements)!=null&&o.values)return;const n=t.bpmnViewer.get("bpmnFactory"),i=n.create("uengine:Properties",{role:"",pythonCode:"",description:"",definition:""});i.checkpoints=[],i.instanceData=[],i.ExtendedProperties=[];const r=n.create("bpmn:ExtensionElements");r.get("values").push(i),e.extensionElements=r},updateElement(e,t){this.bpmnViewer.get("modeling").updateProperties(e,{extensionElements:t})},openProcess(e){alert(e)},diagramObject(e){function t(i,r){Array.isArray(i)?i.forEach(o=>t(o,r)):i&&typeof i=="object"&&(i.$parent=r,Object.keys(i).forEach(o=>{if(o==="$type"||o==="$parent")return;const s=i[o];(Array.isArray(s)||s&&typeof s=="object")&&t(s,i)}))}t(e,null);const n=new Map;e.rootElements.forEach(i=>{i.participants&&(n.set(i.id,i),i.participants.forEach(r=>{n.set(r.id,r)})),i.flowElements&&i.flowElements.forEach(r=>{n.set(r.id,r)}),i.laneSets&&i.laneSets.forEach(r=>{n.set(r.id,r),r.lanes.forEach(o=>{n.set(o.id,o)})})}),e.diagrams.forEach(i=>{const r=n.get(i.plane.bpmnElement);r&&(i.plane.bpmnElement=r),i.plane&&i.plane.planeElement&&i.plane.planeElement.forEach(o=>{if(typeof o.bpmnElement=="string"){const s=n.get(o.bpmnElement);s&&(o.bpmnElement=s)}if(o.bpmnElement.sourceRef&&o.bpmnElement.targetRef){const s=n.get(o.bpmnElement.sourceRef),a=n.get(o.bpmnElement.targetRef);o.bpmnElement.sourceRef=s,o.bpmnElement.targetRef=a}})}),e.diagrams[0].plane.planeElement=this.sortByIdWithParticipantFirst(e.diagrams[0].plane.planeElement),console.log(e),this.bpmnViewer.importDefinitions(e)},sortByIdWithParticipantFirst(e){return e.sort((t,n)=>{const i=t.id.toLowerCase().startsWith("participant"),r=n.id.toLowerCase().startsWith("participant");return i&&!r?-1:!i&&r?1:t.id.localeCompare(n.id)})},parseJsonToModdle(e){const t=new Pp;return JSON.parse(e,function(i,r){return r&&typeof r=="object"&&r.$type?t.create(r.$type,r):r})},createModdleElement(e){let t=this.bpmnViewer.get("moddle");const{$type:n,...i}=e;return t.create(n,i)},convertToModdleElements(e){const{rootElements:t,diagrams:n,...i}=e,r=t.map(s=>{const{flowElements:a,laneSets:c,...l}=s,p=a.map(createModdleElement),u=c.map(d=>{const{lanes:f,...m}=d,h=f.map(createModdleElement);return createModdleElement({...m,lanes:h})});return createModdleElement({...l,flowElements:p,laneSets:u})}),o=n.map(s=>{const{plane:a,...c}=s,{planeElement:l,...p}=a,u=l.map(createModdleElement),d=createModdleElement({...p,planeElement:u});return createModdleElement({...c,plane:d})});return createModdleElement({...i,rootElements:r,diagrams:o})},fetchDiagram(e){var t=this;fetch(e).then(n=>n.text()).then(n=>{t.diagramXML=n}).catch(n=>{t.$emit("error",n)})}}},ux={ref:"container",class:"vue-bpmn-diagram-container"};function dx(e,t,n,i,r,o){return L(),q("div",ux,null,512)}const fx=_t(px,[["render",dx]]),hx={name:"bpmn-uengine",props:{url:{type:String},bpmn:{type:String},options:{type:Object},isViewMode:{type:Boolean},isPreviewMode:{type:Boolean},adminMode:{type:Boolean,default:!1},currentActivities:{type:Array},executionScopeActivities:{type:Object},selectedExecutionScope:{type:Object},taskStatus:{type:Object},generateFormTask:{type:Object}},data:function(){return{diagramXML:null,openPanel:!1,moddle:null,bpmnStore:null,bpmnViewer:null}},computed:{async getXML(){return await this.bpmnViewer.saveXML({format:!0,preamble:!0})}},mounted(){this.initializeViewer();var e=this,t=this.bpmnViewer.get("eventBus");t.on("import.done",async function(n){e.$emit("done")}),t.on("import.render.complete",async function(n){let i=performance.now();var r=n.error,o=n.warnings;let s=e.bpmnViewer.getDefinitions();e.$emit("definition",s),r?e.$emit("error",r):e.$emit("shown",o);var a=e.bpmnViewer.get("canvas"),c=e.bpmnViewer.get("elementRegistry"),l=c.filter(h=>h.type==="bpmn:Participant");if(l.length>1){var p=l[0],u=a.getAbsoluteBBox(p);a.viewbox({x:u.x-50,y:u.y-50,width:u.width+100,height:u.height+100})}else{a.zoom("fit-viewport");var d=a.viewbox();a.viewbox({x:d.x-50,y:d.y-50,width:d.width+100,height:d.height+100})}if(e.isPreviewMode&&window.$mode=="ProcessGPT"&&e.currentActivities&&e.currentActivities.length>0&&e.currentActivities.forEach(h=>{h&&a.addMarker(h,"highlight")}),e.isViewMode&&e.taskStatus&&Object.keys(e.taskStatus).forEach(h=>{let v=e.taskStatus[h];v=="Completed"?a.addMarker(h,"completed"):v=="Running"?a.addMarker(h,"running"):v=="Stopped"?a.addMarker(h,"stopped"):v=="Cancelled"&&a.addMarker(h,"cancelled")}),e.adminMode){var f=e.bpmnViewer.get("overlays");e.currentActivities&&e.currentActivities.length>0&&e.currentActivities.forEach(h=>{const b=e.bpmnViewer.get("elementRegistry").get(h);if(b&&b.type!="bpmn:SubProcess"&&b.type!="bpmn:CallActivity"){var E=$('<img src="/assets/images/icon/tdesign-rollback.svg" style="width: 20px; height: 20px;" alt="rollback">');E.click(function(y){e.$emit("rollback",b)}),h&&f.add(h,"note",{position:{bottom:10,right:0},html:E})}}),e.executionScopeActivities&&Object.keys(e.executionScopeActivities).length>0&&Object.keys(e.executionScopeActivities).forEach(h=>{let v=0;Object.keys(e.executionScopeActivities[h]).forEach(b=>{if(e.executionScopeActivities[h][b].parent){if(e.selectedExecutionScope){if(e.selectedExecutionScope.executionScope==e.executionScopeActivities[h][b].parent){let E=`<button class="v-btn v-btn--block v-btn--elevated v-theme--light rounded-xl  v-btn--variant-elevated">${b}</buton>
`,y=$(`<div >${E}</div>`);y.click(function(_){let w={executionScope:b,parent:e.executionScopeActivities[h][b].parent};e.$emit("selectedExecutionScope",w)}),f.add(h,"note",{position:{bottom:80-v*30,right:-10},html:y}),v=v+1}else if(e.selectedExecutionScope.parent==e.executionScopeActivities[h][b].parent){let E=`<button class="v-btn v-btn--block v-btn--elevated v-theme--light rounded-xl  v-btn--variant-elevated">${b}</buton>
`,y=$(`<div >${E}</div>`);y.click(function(_){let w={executionScope:b,parent:e.executionScopeActivities[h][b].parent};e.$emit("selectedExecutionScope",w)}),f.add(h,"note",{position:{bottom:80-v*30,right:-10},html:y}),v=v+1}}}else{let E=`<button class="v-btn v-btn--block v-btn--elevated v-theme--light rounded-xl  v-btn--variant-elevated">${b}</buton>
`,y=$(`<div >${E}</div>`);y.click(function(_){let w={executionScope:b,parent:null};e.$emit("selectedExecutionScope",w)}),f.add(h,"note",{position:{bottom:80-v*30,right:-10},html:y}),v=v+1}})}),e.taskStatus&&Object.keys(e.taskStatus).forEach(h=>{let v=e.taskStatus[h];v=="Completed"?a.addMarker(h,"completed"):v=="Running"?a.addMarker(h,"running"):v=="Stopped"?a.addMarker(h,"stopped"):v=="Cancelled"&&a.addMarker(h,"cancelled")})}t.on("shape.added",async function(h){const v=h.element,b=v.businessObject;b.extensionElements&&(b.extensionElements.values[0].json="{}");try{let E=await e.getXML;e.extendUEngineProperties(v)}catch(E){alert(E)}}),e.isViewMode?t.on("element.dblclick",function(h){h.element.type.includes("CallActivity")?e.$emit("openDefinition",h.element.businessObject):e.$emit("openPanel",h.element.id)}):t.on("element.dblclick",function(h){e.$emit("openPanel",h.element.id)}),t.on("drag.end",function(h){e.$nextTick(async()=>{e.$emit("change")})}),t.on("shape.removed",function(h){e.$nextTick(async()=>{e.$emit("change")})}),t.on("connection.removed",function(h){e.$nextTick(async()=>{e.$emit("change")})}),t.on("connection.added",function(h){e.$nextTick(async()=>{e.$emit("change")})}),t.on("undo",function(h){e.$nextTick(async()=>{e.$emit("change")})}),t.on("redo",function(h){e.$nextTick(async()=>{e.$emit("change")})}),e.debounce(()=>{e.$emit("change")},100);let m=performance.now();console.log(`initializeViewer Result Time :  ${m-i} ms`)}),this.url?this.fetchDiagram(this.url):this.bpmn?this.diagramXML=this.bpmn:this.diagramXML='<?xml version="1.0" encoding="UTF-8"?> <bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:uengine="http://uengine" id="Definitions_0bfky9r" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="16.4.0"> <bpmn:process id="Process_1oscmbn" isExecutable="false"> <bpmn:extensionElements> <uengine:properties> </uengine:properties> </bpmn:extensionElements> </bpmn:process> <bpmndi:BPMNDiagram id="BPMNDiagram_1"> <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1oscmbn" /> </bpmndi:BPMNDiagram> </bpmn:definitions>'},beforeDestroy(){this.bpmnViewer.destroy()},watch:{isViewMode(e){this.bpmnViewer.destroy(),this.initializeViewer()},url(e){this.$emit("loading"),this.fetchDiagram(e)},sortByIdWithParticipantFirst(e){return e.sort((t,n)=>{const i=t.id.toLowerCase().startsWith("participant"),r=n.id.toLowerCase().startsWith("participant");return i&&!r?-1:!i&&r?1:t.id.localeCompare(n.id)})},diagramXML(e){this.bpmnViewer.importXML(e)},options:{handler(e){var t=this.bpmnViewer.get("eventBus"),n=this.$refs.container,i=this,r=Object.assign({container:n,keyboard:{bindTo:window},moddleExtensions:{uengine:Go}},i.options);t.fire("config.changed",{config:r})},deep:!0},generateFormTask:{handler(e){if(e&&Object.keys(e).length>0){var t=this.bpmnViewer.get("canvas");Object.keys(e).forEach(n=>{e[n]==="generating"?t.addMarker(n,"running"):e[n]==="finished"&&t.addMarker(n,"generated")})}},deep:!0}},methods:{closeModelingDialog(){},debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(this,i)},t)}},initializeViewer(){var e=this.$refs.container,t=this;t.bpmnStore=ca();var n=Object.assign({container:e,keyboard:{bindTo:window},moddleExtensions:{uengine:Go}},t.options);if(t.isViewMode){var i={...n,additionalModules:[...Array.isArray(n.additionalModules)?n.additionalModules:[],ua,pa]};t.bpmnViewer=new mn(i),t.bpmnStore.setModeler(t.bpmnViewer)}else t.bpmnViewer=new pt(n),t.bpmnStore.setModeler(t.bpmnViewer);t.diagramXML&&t.bpmnViewer.importXML(t.diagramXML)},extendUEngineProperties(e){var o,s,a;let t=this;if((s=(o=e==null?void 0:e.businessObject)==null?void 0:o.extensionElements)!=null&&s.values||(a=e.extensionElements)!=null&&a.values)return;const n=t.bpmnViewer.get("bpmnFactory"),i=n.create("uengine:Properties",{json:""});i.json="{}";const r=n.create("bpmn:ExtensionElements");r.get("values").push(i),e.businessObject.extensionElements=r,e.businessObject&&e.businessObject.$type=="bpmn:Participant"&&(e.businessObject.processRef.isExecutable=!0)},updateElement(e,t){this.bpmnViewer.get("modeling").updateProperties(e,{extensionElements:t})},openProcess(e){alert(e)},diagramObject(e){function t(i,r){Array.isArray(i)?i.forEach(o=>t(o,r)):i&&typeof i=="object"&&(i.$parent=r,Object.keys(i).forEach(o=>{if(o==="type"||o==="$parent")return;const s=i[o];(Array.isArray(s)||s&&typeof s=="object")&&t(s,i)}))}t(e,null);const n=new Map;e.rootElements.forEach(i=>{i.participants&&(n.set(i.id,i),i.participants.forEach(r=>{n.set(r.id,r)})),i.flowElements&&i.flowElements.forEach(r=>{n.set(r.id,r)}),i.laneSets&&i.laneSets.forEach(r=>{n.set(r.id,r),r.lanes.forEach(o=>{n.set(o.id,o)})})}),e.diagrams.forEach(i=>{const r=n.get(i.plane.bpmnElement);r&&(i.plane.bpmnElement=r),i.plane&&i.plane.planeElement&&i.plane.planeElement.forEach(o=>{if(typeof o.bpmnElement=="string"){const s=n.get(o.bpmnElement);s&&(o.bpmnElement=s)}if(o.bpmnElement.sourceRef&&o.bpmnElement.targetRef){const s=n.get(o.bpmnElement.sourceRef),a=n.get(o.bpmnElement.targetRef);o.bpmnElement.sourceRef=s,o.bpmnElement.targetRef=a}})}),e.diagrams[0].plane.planeElement=this.sortByIdWithParticipantFirst(e.diagrams[0].plane.planeElement),this.bpmnViewer.importDefinitions(e)},sortByIdWithParticipantFirst(e){return e.sort((t,n)=>{const i=t.id.toLowerCase().startsWith("participant"),r=n.id.toLowerCase().startsWith("participant");return i&&!r?-1:!i&&r?1:t.id.localeCompare(n.id)})},parseJsonToModdle(e){const t=new Pp;return JSON.parse(e,function(i,r){return r&&typeof r=="object"&&r.type?t.create(r.type,r):r})},createModdleElement(e){let t=this.bpmnViewer.get("moddle");const{type:n,...i}=e;return t.create(n,i)},convertToModdleElements(e){const{rootElements:t,diagrams:n,...i}=e,r=t.map(s=>{const{flowElements:a,laneSets:c,...l}=s,p=a.map(createModdleElement),u=c.map(d=>{const{lanes:f,...m}=d,h=f.map(createModdleElement);return createModdleElement({...m,lanes:h})});return createModdleElement({...l,flowElements:p,laneSets:u})}),o=n.map(s=>{const{plane:a,...c}=s,{planeElement:l,...p}=a,u=l.map(createModdleElement),d=createModdleElement({...p,planeElement:u});return createModdleElement({...c,plane:d})});return createModdleElement({...i,rootElements:r,diagrams:o})},fetchDiagram(e){var t=this;fetch(e).then(n=>n.text()).then(n=>{t.diagramXML=n}).catch(n=>{t.$emit("error",n)})}}},mx={ref:"container",class:"vue-bpmn-diagram-container"};function vx(e,t,n,i,r,o){return L(),q("div",mx,null,512)}const gx=_t(hx,[["render",vx]]);function Vs(e,t,n,i,r,o,s,a,c,l){this._create=t,this._elementFactory=n,this._spaceTool=i,this._lassoTool=r,this._handTool=o,this._globalConnect=s,this._translate=a,this._commandStack=c,this._isMac=/mac/i.test(navigator.platform),e.registerProvider(this)}Vs.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate","commandStack","eventBus"];Vs.prototype.getPaletteEntries=function(e){var t={},n=this._create,i=this._elementFactory,r=this._spaceTool,o=this._lassoTool,s=this._handTool,a=this._globalConnect;this._translate;var c=this._commandStack,l=this._isMac;function p(d,f,m,h,v){function b(_){var w=i.createShape(S({type:d},v));n.start(_,w)}var E=d.replace(/^bpmn:/,""),y=te.global.t(`PaletteProvider.${E}`);return{group:f,className:m,title:h||y,action:{dragstart:b,click:b}}}function u(d,f,m){var h=i.createParticipantShape({isHorizontal:m,width:m?450:300,height:m?200:400});n.start(d,h)}return S(t,{undo:{group:"tools",className:"mdi mdi-undo-variant",title:l?te.global.t("PaletteProvider.undoCmdZ"):te.global.t("PaletteProvider.undoCtrlZ"),action:{click:function(d){c.undo()}}},redo:{group:"tools",className:"mdi mdi-redo-variant",title:l?te.global.t("PaletteProvider.RedoCmdShiftZ"):te.global.t("PaletteProvider.RedoCtrlY"),action:{click:function(d){c.redo()}}},"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:te.global.t("PaletteProvider.handTool"),action:{click:function(d){s.activateHand(d)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:te.global.t("PaletteProvider.lassoTool"),action:{click:function(d){o.activateSelection(d)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:te.global.t("PaletteProvider.spaceTool"),action:{click:function(d){r.activateSelection(d)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:te.global.t("PaletteProvider.globalConnectTool"),action:{click:function(d){a.toggle(d)}}},"create.start-event":p("bpmn:StartEvent","event","bpmn-icon-start-event-none"),"create.intermediate-event":p("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none"),"create.end-event":p("bpmn:EndEvent","event","bpmn-icon-end-event-none"),"create.exclusive-gateway":p("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-xor"),"create.task":p("bpmn:Task","activity","bpmn-icon-task"),"create.subprocess-expanded":p("bpmn:SubProcess","activity","bpmn-icon-subprocess-expanded",te.global.t("PaletteProvider.expandedSubProcess"),{isExpanded:!0}),"create.data-store":p("bpmn:DataStoreReference","data-object","bpmn-icon-data-store",te.global.t("PaletteProvider.dataStore")),"create.data-object":p("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",te.global.t("PaletteProvider.dataObject")),"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:te.global.t("PaletteProvider.participantCollapsed"),action:{dragstart:function(d){u(d,!1,!0)},click:function(d){u(d,!1,!0)}}},"create.participant-collapsed":{group:"collaboration",className:"bpmn-icon-participant icon-rotate-90",title:te.global.t("PaletteProvider.participantExpanded"),action:{dragstart:function(d){u(d,!0,!1)},click:function(d){u(d,!0,!1)}}}}),t};const yx={__init__:["paletteProvider"],paletteProvider:["type",Vs]};function Fs(e,t,n,i,r,o,s,a,c,l,p,u){const d=t.get("contextPadProvider");this._config=e,this._injector=t,this._eventBus=n,this._contextPad=i,this._modeling=r,this._elementFactory=o,this._connect=s,this._create=a,this._popupMenu=c,this._canvas=l,this._rules=p,this._translate=u,i.registerProvider(this),this._originalGetContextPadEntries=d.getContextPadEntries.bind(d)}Fs.$inject=["config","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"];Fs.prototype.getContextPadEntries=function(e){const{_modeling:t,_translate:n,_connect:i,_elementFactory:r,_create:o}=this;function s(d,f){i.start(d,f)}const a=this._popupMenu;function c(d){t.splitLane(e,d)}function l(d){t.splitLane(e,2)}function p(d){t.splitLane(e,3)}const u=this._originalGetContextPadEntries(e);if(e.type==="bpmn:Participant"||e.type==="bpmn:Lane"){const d=e.di.isHorizontal;S(u,{"lane-insert-above":{group:"lane",className:d?"bpmn-icon-lane-insert-above":"bpmn-icon-lane-insert-above icon-rotate-270",title:d?te.global.t("customContextPad.laneAbove"):te.global.t("customContextPad.laneToTheLeft"),action:{click:function(f,m){t.addLane(m,"top")}}},"lane-insert-below":{group:"lane",className:d?"bpmn-icon-lane-insert-below":"bpmn-icon-lane-insert-below icon-rotate-270",title:d?te.global.t("customContextPad.laneBelow"):te.global.t("customContextPad.laneToTheRight"),action:{click:function(f,m){t.addLane(m,"bottom")}}},"lane-divide-two":{group:"lane",className:d?"bpmn-icon-lane-divide-two":"bpmn-icon-lane-divide-two icon-rotate-270",title:te.global.t("customContextPad.laneDivideTwo"),action:{click:l}},"lane-divide-three":{group:"lane",className:d?"bpmn-icon-lane-divide-three":"bpmn-icon-lane-divide-three icon-rotate-270",title:te.global.t("customContextPad.laneDivideThree"),action:{click:p}},"lane-insert-single":{group:"lane",className:d?"bpmn-icon-participant":"bpmn-icon-participant icon-rotate-90",title:d?te.global.t("customContextPad.lane"):te.global.t("customContextPad.laneToTheLeft"),action:{click:function(f,m){m.children.filter(h=>h.type==="bpmn:Lane").length,c(1)}}},connect:{group:"connect",className:"bpmn-icon-connection-multi",title:te.global.t("customContextPad.connectionMulti"),action:{click:s,dragstart:s}}})}return u["append.end-event"]&&(u["append.end-event"].title=te.global.t("customContextPad.endEvent")),u["append.gateway"]&&(u["append.gateway"].title=te.global.t("customContextPad.gateway")),u["append.append-task"]&&(u["append.append-task"].title=te.global.t("customContextPad.task")),u["append.intermediate-event"]&&(u["append.intermediate-event"].title=te.global.t("customContextPad.intermediateEvent")),u["append.text-annotation"]&&(u["append.text-annotation"].title=te.global.t("customContextPad.textAnnotation")),u.replace&&(u.replace={group:"edit",className:"bpmn-icon-screw-wrench",title:te.global.t("customContextPad.replace"),action:{click:function(d,f){var m=S({x:d.x,y:d.y},{cursor:{x:d.x,y:d.y}});a.open(f,"bpmn-replace",m,{title:te.global.t("customContextPad.replace"),width:300,search:!0})}}}),u.connect&&(u.connect.title=te.global.t("customContextPad.connect")),u.delete&&(u.delete.title=te.global.t("customContextPad.delete")),u};const _x={__init__:["CustomContextPad"],CustomContextPad:["type",Fs]};function Gi(e,t,n,i,r,o,s,a){$e.call(this,e,t,n,i,r,o,s,a),this._bpmnFactory=e,this._popupMenu=t,this._modeling=n,this._moddle=i,this._bpmnReplace=r,this._rules=o,this._translate=s,this._moddleCopy=a,this._register()}Gi.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate","moddleCopy"];Gi.prototype=Object.create($e.prototype);Gi.prototype._createEntries=function(e,t){const n=$e.prototype._createEntries.call(this,e,t);return Object.keys(n).forEach(i=>{if(n[i].label){const r=`CustomReplaceElement.${i}`;n[i].label=te.global.t(r)}}),n};Gi.prototype.getPopupMenuHeaderEntries=function(e){const t=$e.prototype.getPopupMenuHeaderEntries.call(this,e);return Object.keys(t).forEach(n=>{if(t[n].title){const i=`CustomReplaceElement.${n}`;t[n].title=te.global.t(i)}}),t};const bx={__init__:["CustomReplaceElement"],CustomReplaceElement:["type",Gi]},$o=Nn.createBackend(),Ex={components:{AppBaseCard:Eh,WorkItem:Rp,OrganizationChart:Ph,UserSelectField:Ch},props:{definitionId:String},data:()=>({definition:null,workItem:null,roleMappings:[],organizationChart:{},userList:[],isMobile:!1}),created(){this.init(),this.checkIfMobile(),window.addEventListener("resize",this.checkIfMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkIfMobile)},methods:{init(){var e=this;e.$try({action:async()=>{const t=await $o.getRawDefinition(e.definitionId);e.definition=t.definition,e.roleMappings=e.definition.roles.map(r=>({name:r.name,endpoint:""}));const n=await $o.bindRole(e.definition.roles);n&&n.length>0&&n.forEach(r=>{let o=e.roleMappings.find(s=>s.name===r.roleName);o&&(o.endpoint=r.userId)});const i=e.definition.activities[0];if(i){let r=[],o={};if(i.properties){const a=JSON.parse(i.properties);a.parameters&&(r=a.parameters,r.forEach(c=>{c.variable.defaultValue=""})),a.variableForHtmlFormContext&&(o=a.variableForHtmlFormContext)}let s={};r.length>0&&r.forEach(a=>{s[a.argument.text]=a.variable.defaultValue}),e.workItem={worklist:{defId:e.definitionId,role:i.role,endpoint:"",instId:"",rootInstId:null,taskId:this.uuid(),startDate:new Date,dueDate:null,status:"TODO",description:i.description||"",tool:i.tool||""},activity:{name:i.name,tracingTag:i.id||"",parameters:r||[],variableForHtmlFormContext:o||{},tool:i.tool||"",instruction:i.instruction?i.instruction:"",checkpoints:i.checkpoints?i.checkpoints:[]},parameterValues:s||{}}}}})},closeDialog(){this.$emit("close")},async executeProcess(e){var t=this;t.$try({context:t,action:async()=>{let n={process_definition_id:t.definitionId,activity_id:t.workItem.activity.tracingTag,role_mappings:t.roleMappings,answer:e};t.roleMappings.forEach(r=>{t.workItem.worklist.role===r.name&&r.endpoint&&(t.workItem.worklist.endpoint=r.endpoint)});const i=await $o.start(n);i&&i.errors&&i.errors.length>0||(t.closeDialog(),t.EventBus.emit("instances-updated"),t.$router.push(`/instancelist/${btoa(i.instanceId)}`))},successMsg:this.$t("successMsg.processExecutionCompleted")})},uuid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},checkIfMobile(){this.isMobile=window.innerWidth<=1080}}},xx={class:"pa-4",style:{"min-width":"300px"}},wx=Z("div",{style:{"font-size":"20px","font-weight":"500"}},"Role Mapping",-1),Sx={class:"mt-4"},Px={class:"w-100 pa-2"},Cx={key:0},Tx={key:1};function Rx(e,t,n,i,r,o){const s=Te("user-select-field"),a=Te("WorkItem");return L(),ve(at,{flat:"",class:"w-100"},{default:I(()=>[Z("div",{class:cp({"d-flex":!e.isMobile})},[Z("div",xx,[wx,Z("div",Sx,[(L(!0),q(Gt,null,Ct(e.roleMappings,c=>(L(),q("div",{key:c.name},[k(s,{modelValue:c.endpoint,"onUpdate:modelValue":l=>c.endpoint=l,name:c.name,"item-value":"email"},null,8,["modelValue","onUpdate:modelValue","name"])]))),128))])]),Z("div",Px,[e.workItem!=null?(L(),q("div",Cx,[k(a,{definitionId:n.definitionId,dryRunWorkItem:e.workItem,isDryRun:!0,onClose:o.closeDialog,onExecuteProcess:o.executeProcess},null,8,["definitionId","dryRunWorkItem","onClose","onExecuteProcess"])])):(L(),q("div",Tx,[k(vt,{class:"ma-0 pa-0 execute-skeleton-top",style:{height:"100%"}},{default:I(()=>[k(ht,{cols:"12",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1})]),_:1}),k(vt,{class:"ma-0 pa-0 execute-skeleton-bottom",style:{height:"100%"}},{default:I(()=>[k(ht,{cols:"4",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1}),k(ht,{cols:"8",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1})]),_:1})]))])],2)]),_:1})}const kx=_t(Ex,[["render",Rx]]);var zd={exports:{}};(function(e){(function(){var t={118:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".no-margin-padding[data-v-3c430bce]{margin:0;padding:0}.margin-left-sm[data-v-3c430bce]{margin-left:8px}.assignment[data-v-3c430bce]{color:var(--xml-viewer-assignment-color)}.quote[data-v-3c430bce]{color:var(--xml-viewer-quote-color)}",""]),s.default=d},743:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".attribute-name[data-v-17010745]{color:var(--xml-viewer-attribute-name-color)}",""]),s.default=d},102:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".attribute-value[data-v-36c46cbc]{color:var(--xml-viewer-attribute-value-color);padding:0;margin:0}",""]),s.default=d},80:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".content[data-v-0fce587a]{color:var(--xml-viewer-cdata-content-color)}.inline[data-v-0fce587a]{display:inline}.no-margin-padding[data-v-0fce587a]{margin:0;padding:0}",""]),s.default=d},722:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".xml-element[data-v-d071a178]{white-space:nowrap;font-size:14px;font-family:Consolas,Menlo,Courier,monospace}.bracket[data-v-d071a178],.caret[data-v-d071a178],.dots[data-v-d071a178]{color:var(--xml-viewer-bracket-color)}.caret[data-v-d071a178]{fill:var(--xml-viewer-bracket-color)}.child-elements>div[data-v-d071a178]{margin-left:20px}.clickable[data-v-d071a178]{cursor:pointer}",""]),s.default=d},715:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".content[data-v-75f773a5]{color:var(--xml-viewer-element-content-color)}",""]),s.default=d},204:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".bracket[data-v-5a0ac6a5]{color:var(--xml-viewer-bracket-color)}.element-name[data-v-5a0ac6a5]{color:var(--xml-viewer-element-name-color)}",""]),s.default=d},904:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,".content[data-v-7bc574c6]{color:var(--xml-viewer-remark-content-color)}.inline[data-v-7bc574c6]{display:inline}.no-margin-padding[data-v-7bc574c6]{margin:0;padding:0}",""]),s.default=d},834:function(o,s,a){a.r(s);var c=a(246),l=a.n(c),p=a(143),u=a.n(p),d=u()(l());d.push([o.id,":root{--xml-viewer-bracket-color:#111;--xml-viewer-assignment-color:#986801;--xml-viewer-quote-color:#50a14f;--xml-viewer-attribute-name-color:#986801;--xml-viewer-attribute-value-color:#50a14f;--xml-viewer-cdata-content-color:#50a14f;--xml-viewer-element-content-color:#383a42;--xml-viewer-element-name-color:#e45649;--xml-viewer-remark-content-color:#a0a1a7}.dark{--xml-viewer-bracket-color:#e1e4e8;--xml-viewer-assignment-color:#b392f0;--xml-viewer-quote-color:#9ecbff;--xml-viewer-attribute-name-color:#b392f0;--xml-viewer-attribute-value-color:#9ecbff;--xml-viewer-cdata-content-color:#9ecbff;--xml-viewer-element-content-color:#e1e4e8;--xml-viewer-element-name-color:#85e89d;--xml-viewer-remark-content-color:#6a737d}",""]),s.default=d},143:function(o){o.exports=function(s){var a=[];return a.toString=function(){return this.map(function(l){var p="",u=typeof l[5]<"u";return l[4]&&(p+="@supports (".concat(l[4],") {")),l[2]&&(p+="@media ".concat(l[2]," {")),u&&(p+="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {")),p+=s(l),u&&(p+="}"),l[2]&&(p+="}"),l[4]&&(p+="}"),p}).join("")},a.i=function(l,p,u,d,f){typeof l=="string"&&(l=[[null,l,void 0]]);var m={};if(u)for(var h=0;h<this.length;h++){var v=this[h][0];v!=null&&(m[v]=!0)}for(var b=0;b<l.length;b++){var E=[].concat(l[b]);u&&m[E[0]]||(typeof f<"u"&&(typeof E[5]>"u"||(E[1]="@layer".concat(E[5].length>0?" ".concat(E[5]):""," {").concat(E[1],"}")),E[5]=f),p&&(E[2]&&(E[1]="@media ".concat(E[2]," {").concat(E[1],"}")),E[2]=p),d&&(E[4]?(E[1]="@supports (".concat(E[4],") {").concat(E[1],"}"),E[4]=d):E[4]="".concat(d)),a.push(E))}},a}},246:function(o){o.exports=function(s){return s[1]}},708:function(o,s){s.A=(a,c)=>{const l=a.__vccOpts||a;for(const[p,u]of c)l[p]=u;return l}},873:function(o,s,a){var c=a(118);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("f80e68c0",c,!0,{sourceMap:!1,shadowMode:!1})},656:function(o,s,a){var c=a(743);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("6c444b0c",c,!0,{sourceMap:!1,shadowMode:!1})},679:function(o,s,a){var c=a(102);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("df6a1d4a",c,!0,{sourceMap:!1,shadowMode:!1})},261:function(o,s,a){var c=a(80);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("f473a604",c,!0,{sourceMap:!1,shadowMode:!1})},309:function(o,s,a){var c=a(722);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("6c4cedf4",c,!0,{sourceMap:!1,shadowMode:!1})},174:function(o,s,a){var c=a(715);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("cb1de664",c,!0,{sourceMap:!1,shadowMode:!1})},643:function(o,s,a){var c=a(204);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("7a820381",c,!0,{sourceMap:!1,shadowMode:!1})},197:function(o,s,a){var c=a(904);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("0607c4c6",c,!0,{sourceMap:!1,shadowMode:!1})},417:function(o,s,a){var c=a(834);c.__esModule&&(c=c.default),typeof c=="string"&&(c=[[o.id,c,""]]),c.locals&&(o.exports=c.locals);var l=a(434).A;l("8f2d6e24",c,!0,{sourceMap:!1,shadowMode:!1})},434:function(o,s,a){a.d(s,{A:function(){return y}});function c(T,A){for(var H=[],z={},W=0;W<A.length;W++){var Oe=A[W],le=Oe[0],xt=Oe[1],ot=Oe[2],Kn=Oe[3],Ye={id:T+":"+W,css:xt,media:ot,sourceMap:Kn};z[le]?z[le].parts.push(Ye):H.push(z[le]={id:le,parts:[Ye]})}return H}var l=typeof document<"u";if(typeof DEBUG<"u"&&DEBUG&&!l)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var p={},u=l&&(document.head||document.getElementsByTagName("head")[0]),d=null,f=0,m=!1,h=function(){},v=null,b="data-vue-ssr-id",E=typeof navigator<"u"&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function y(T,A,H,z){m=H,v=z||{};var W=c(T,A);return _(W),function(le){for(var xt=[],ot=0;ot<W.length;ot++){var Kn=W[ot],Ye=p[Kn.id];Ye.refs--,xt.push(Ye)}le?(W=c(T,le),_(W)):W=[];for(var ot=0;ot<xt.length;ot++){var Ye=xt[ot];if(Ye.refs===0){for(var Yn=0;Yn<Ye.parts.length;Yn++)Ye.parts[Yn]();delete p[Ye.id]}}}}function _(T){for(var A=0;A<T.length;A++){var H=T[A],z=p[H.id];if(z){z.refs++;for(var W=0;W<z.parts.length;W++)z.parts[W](H.parts[W]);for(;W<H.parts.length;W++)z.parts.push(P(H.parts[W]));z.parts.length>H.parts.length&&(z.parts.length=H.parts.length)}else{for(var Oe=[],W=0;W<H.parts.length;W++)Oe.push(P(H.parts[W]));p[H.id]={id:H.id,refs:1,parts:Oe}}}}function w(){var T=document.createElement("style");return T.type="text/css",u.appendChild(T),T}function P(T){var A,H,z=document.querySelector("style["+b+'~="'+T.id+'"]');if(z){if(m)return h;z.parentNode.removeChild(z)}if(E){var W=f++;z=d||(d=w()),A=j.bind(null,z,W,!1),H=j.bind(null,z,W,!0)}else z=w(),A=F.bind(null,z),H=function(){z.parentNode.removeChild(z)};return A(T),function(le){if(le){if(le.css===T.css&&le.media===T.media&&le.sourceMap===T.sourceMap)return;A(T=le)}else H()}}var R=function(){var T=[];return function(A,H){return T[A]=H,T.filter(Boolean).join(`
`)}}();function j(T,A,H,z){var W=H?"":z.css;if(T.styleSheet)T.styleSheet.cssText=R(A,W);else{var Oe=document.createTextNode(W),le=T.childNodes;le[A]&&T.removeChild(le[A]),le.length?T.insertBefore(Oe,le[A]):T.appendChild(Oe)}}function F(T,A){var H=A.css,z=A.media,W=A.sourceMap;if(z&&T.setAttribute("media",z),v.ssrId&&T.setAttribute(b,A.id),W&&(H+=`
/*# sourceURL=`+W.sources[0]+" */",H+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(W))))+" */"),T.styleSheet)T.styleSheet.cssText=H;else{for(;T.firstChild;)T.removeChild(T.firstChild);T.appendChild(document.createTextNode(H))}}}},n={};function i(o){var s=n[o];if(s!==void 0)return s.exports;var a=n[o]={id:o,exports:{}};return t[o](a,a.exports,i),a.exports}(function(){i.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(s,{a:s}),s}})(),function(){i.d=function(o,s){for(var a in s)i.o(s,a)&&!i.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:s[a]})}}(),function(){i.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)}}(),function(){i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}}(),function(){i.p=""}();var r={};(function(){if(i.r(r),i.d(r,{default:function(){return kf}}),typeof window<"u"){var o=window.document.currentScript,s=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);s&&(i.p=s[1])}i(417);var a=If;function c(M,pe,Se,he,Ce,je){const Fe=(0,a.resolveComponent)("XmlElement");return(0,a.openBlock)(),(0,a.createElementBlock)("div",{class:(0,a.normalizeClass)(M.theme)},[(0,a.createVNode)(Fe,{node:M.rootNode},null,8,["node"])],2)}const l=M=>((0,a.pushScopeId)("data-v-d071a178"),M=M(),(0,a.popScopeId)(),M),p={class:"xml-element"},u=l(()=>(0,a.createElementVNode)("span",{class:"bracket"},"<",-1)),d={key:2,class:"bracket"},f={key:3,class:"dots"},m=l(()=>(0,a.createElementVNode)("span",{class:"bracket"},">",-1)),h={key:0,class:"child-elements"},v={key:1},b=l(()=>(0,a.createElementVNode)("span",{class:"bracket"},"<",-1)),E=l(()=>(0,a.createElementVNode)("span",{class:"bracket"},">",-1));function y(M,pe,Se,he,Ce,je){const Fe=(0,a.resolveComponent)("CaretDown"),Nt=(0,a.resolveComponent)("CaretRight"),bn=(0,a.resolveComponent)("XmlElementName"),mo=(0,a.resolveComponent)("XmlAttributeLine"),Gs=(0,a.resolveComponent)("XmlElement",!0),wt=(0,a.resolveComponent)("XmlElementContent"),Mf=(0,a.resolveComponent)("XmlCDataSection"),Df=(0,a.resolveComponent)("XmlRemark");return(0,a.openBlock)(),(0,a.createElementBlock)("div",p,[(0,a.createElementVNode)("div",null,[M.selfClosing?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},[M.collapsed?((0,a.openBlock)(),(0,a.createBlock)(Nt,{key:1,class:"caret",onClick:M.toggleCollapsed},null,8,["onClick"])):((0,a.openBlock)(),(0,a.createBlock)(Fe,{key:0,class:"caret",onClick:M.toggleCollapsed},null,8,["onClick"]))],64)),u,(0,a.createVNode)(bn,{class:"clickable",name:M.name,onClick:M.toggleCollapsed},null,8,["name","onClick"]),M.collapsed?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createBlock)(mo,{key:1,attributes:M.attributes},null,8,["attributes"])),M.selfClosing&&!M.collapsed?((0,a.openBlock)(),(0,a.createElementBlock)("span",d," /")):(0,a.createCommentVNode)("",!0),M.selfClosing&&M.collapsed?((0,a.openBlock)(),(0,a.createElementBlock)("span",f," ...")):(0,a.createCommentVNode)("",!0),m]),M.collapsed?(0,a.createCommentVNode)("",!0):((0,a.openBlock)(),(0,a.createElementBlock)("div",h,[(0,a.createElementVNode)("div",null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M.childElements,(an,sn)=>((0,a.openBlock)(),(0,a.createBlock)(Gs,{key:`e${sn}`,node:an},null,8,["node"]))),128)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M.childContents,(an,sn)=>((0,a.openBlock)(),(0,a.createBlock)(wt,{key:`t${sn}`,node:an},null,8,["node"]))),128)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M.cdataSections,(an,sn)=>((0,a.openBlock)(),(0,a.createBlock)(Mf,{key:`c${sn}`,cdataSection:an},null,8,["cdataSection"]))),128)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M.remarks,(an,sn)=>((0,a.openBlock)(),(0,a.createBlock)(Df,{key:`r${sn}`,remark:an},null,8,["remark"]))),128))])])),!M.selfClosing&&!M.collapsed?((0,a.openBlock)(),(0,a.createElementBlock)("div",v,[b,(0,a.createVNode)(bn,{name:M.name,closing:!0},null,8,["name"]),E])):(0,a.createCommentVNode)("",!0)])}const _={key:0,class:"bracket"};function w(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("span",null,[M.closing?((0,a.openBlock)(),(0,a.createElementBlock)("span",_,"/")):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("span",{onClick:pe[0]||(pe[0]=(...Fe)=>M.onClick&&M.onClick(...Fe)),class:"element-name"},(0,a.toDisplayString)(M.name),1)])}var P=(0,a.defineComponent)({props:{name:String,closing:Boolean},setup(M,{emit:pe}){return{onClick:()=>{pe("click")}}},emits:["click"]});i(643);var R=i(708),F=(0,R.A)(P,[["render",w],["__scopeId","data-v-5a0ac6a5"]]);const T={class:"content"};function A(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("div",T,(0,a.toDisplayString)(M.content),1)])}var H=(0,a.defineComponent)({props:{node:Text},setup(M){return{content:(0,a.computed)(()=>M.node.textContent)}}});i(174);var W=(0,R.A)(H,[["render",A],["__scopeId","data-v-75f773a5"]]);function Oe(M,pe,Se,he,Ce,je){const Fe=(0,a.resolveComponent)("XmlAttribute");return(0,a.openBlock)(),(0,a.createElementBlock)("span",null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(M.attributes,(Nt,bn)=>((0,a.openBlock)(),(0,a.createBlock)(Fe,{key:bn,attribute:Nt},null,8,["attribute"]))),128))])}const le=M=>((0,a.pushScopeId)("data-v-3c430bce"),M=M(),(0,a.popScopeId)(),M),xt=le(()=>(0,a.createElementVNode)("span",{class:"no-margin-padding assignment"},"=",-1)),ot=le(()=>(0,a.createElementVNode)("span",{class:"no-margin-padding quote"},'"',-1)),Kn=le(()=>(0,a.createElementVNode)("span",{class:"no-margin-padding quote"},'"',-1));function Ye(M,pe,Se,he,Ce,je){const Fe=(0,a.resolveComponent)("XmlAttributeName"),Nt=(0,a.resolveComponent)("XmlAttributeValue");return(0,a.openBlock)(),(0,a.createElementBlock)("span",null,[(0,a.createVNode)(Fe,{name:M.name,class:"margin-left-sm"},null,8,["name"]),xt,ot,(0,a.createVNode)(Nt,{value:M.value,class:"no-margin-padding"},null,8,["value"]),Kn])}const Yn={class:"attribute-name"};function Gd(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("span",null,[(0,a.createElementVNode)("span",Yn,(0,a.toDisplayString)(M.name),1)])}var Wd=(0,a.defineComponent)({props:{name:String}});i(656);var Ud=(0,R.A)(Wd,[["render",Gd],["__scopeId","data-v-17010745"]]);const Xd={class:"attribute-value"};function Kd(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("span",null,[(0,a.createElementVNode)("span",Xd,(0,a.toDisplayString)(M.value),1)])}var Yd=(0,a.defineComponent)({props:{value:String}});i(679);var qd=(0,R.A)(Yd,[["render",Kd],["__scopeId","data-v-36c46cbc"]]),Zd=(0,a.defineComponent)({name:"XmlElement",components:{XmlAttributeName:Ud,XmlAttributeValue:qd},props:{attribute:Attr},setup(M){const pe=(0,a.computed)(()=>M.attribute.name),Se=(0,a.computed)(()=>M.attribute.value);return{name:pe,value:Se}}});i(873);var Jd=(0,R.A)(Zd,[["render",Ye],["__scopeId","data-v-3c430bce"]]),Qd=(0,a.defineComponent)({name:"XmlElement",components:{XmlAttribute:Jd},props:{attributes:Array}}),ef=(0,R.A)(Qd,[["render",Oe]]);const zs=M=>((0,a.pushScopeId)("data-v-0fce587a"),M=M(),(0,a.popScopeId)(),M),tf={class:"content"},nf=zs(()=>(0,a.createElementVNode)("span",null,"<![CDATA[",-1)),rf={class:"inline no-margin-padding"},of=zs(()=>(0,a.createElementVNode)("span",null,"]]>",-1));function af(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("div",tf,[nf,(0,a.createElementVNode)("pre",rf,(0,a.toDisplayString)(M.content),1),of])])}var sf=(0,a.defineComponent)({props:{cdataSection:Text},setup(M){return{content:(0,a.computed)(()=>M.cdataSection.textContent)}}});i(261);var cf=(0,R.A)(sf,[["render",af],["__scopeId","data-v-0fce587a"]]);const lf={class:"content"},pf={class:"inline no-margin-padding"};function uf(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("div",lf,[(0,a.createTextVNode)(" <!-- "),(0,a.createElementVNode)("pre",pf,(0,a.toDisplayString)(M.content),1),(0,a.createTextVNode)(" --> ")])])}var df=(0,a.defineComponent)({props:{remark:Comment},setup(M){return{content:(0,a.computed)(()=>M.remark.textContent)}}});i(197);var ff=(0,R.A)(df,[["render",uf],["__scopeId","data-v-7bc574c6"]]);const hf={width:"1em",height:"1em",viewBox:"0 0 24 24"},mf=[(0,a.createElementVNode)("path",{fill:"currentColor",d:"m11.998 17l7-8h-14z"},null,-1)];function vf(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("svg",hf,mf)}var gf={name:"CaretDown"},yf=(0,R.A)(gf,[["render",vf]]);const _f={width:"1em",height:"1em",viewBox:"0 0 24 24"},bf=[(0,a.createElementVNode)("path",{fill:"currentColor",d:"m9 19l8-7l-8-7z"},null,-1)];function Ef(M,pe,Se,he,Ce,je){return(0,a.openBlock)(),(0,a.createElementBlock)("svg",_f,bf)}var xf={name:"CaretRight"},wf=(0,R.A)(xf,[["render",Ef]]),Sf=(0,a.defineComponent)({name:"XmlElement",components:{XmlElementName:F,XmlElementContent:W,XmlAttributeLine:ef,XmlCDataSection:cf,XmlRemark:ff,CaretDown:yf,CaretRight:wf},props:{node:Element},setup(M){const pe=(0,a.ref)(!1),Se=(0,a.computed)(()=>M.node.nodeName),he=(0,a.computed)(()=>Array.from(M.node.childNodes)),Ce=(0,a.computed)(()=>he.value&&he.value.filter(wt=>wt.nodeType===1)),je=(0,a.computed)(()=>he.value&&he.value.filter(wt=>wt.nodeType===3)),Fe=(0,a.computed)(()=>he.value&&he.value.filter(wt=>wt.nodeType===4)),Nt=(0,a.computed)(()=>he.value&&he.value.filter(wt=>wt.nodeType===8)),bn=(0,a.computed)(()=>M.node.attributes&&Array.from(M.node.attributes)||[]),mo=!Ce.value.length&&!je.value.length&&!Fe.value.length&&!Nt.value.length;return{name:Se,childElements:Ce,childContents:je,attributes:bn,cdataSections:Fe,remarks:Nt,selfClosing:mo,collapsed:pe,toggleCollapsed:()=>{pe.value=!pe.value}}}});i(309);var Pf=(0,R.A)(Sf,[["render",y],["__scopeId","data-v-d071a178"]]),Cf=(0,a.defineComponent)({components:{XmlElement:Pf},props:{xml:String,theme:{type:String,default:"light"}},setup(M){const pe=new DOMParser,Se=(0,a.ref)(),he=Ce=>{const Fe=pe.parseFromString(Ce,"text/xml").childNodes[0];Se.value=Fe};return(0,a.watch)(()=>M.xml,Ce=>{he(Ce)}),he(M.xml),{rootNode:Se}}}),Tf=(0,R.A)(Cf,[["render",c]]),Rf=Tf,kf=Rf})(),e.exports=r})()})(zd);var Mx=zd.exports;const Dx=Af(Mx);const Ix={name:"XMLEditor",data(){return{}},props:{xml:{type:String,required:!0}},methods:{changeBpmn(e){this.$emit("changeBpmn",this.xml)}}};function Ax(e,t,n,i,r,o){return L(),q("div",null,[$f(Z("textarea",{class:"xml-editor","onUpdate:modelValue":t[0]||(t[0]=s=>n.xml=s),onInput:t[1]||(t[1]=(...s)=>e.updateText&&e.updateText(...s)),onChange:t[2]||(t[2]=(...s)=>o.changeBpmn&&o.changeBpmn(...s))},null,544),[[Of,n.xml]])])}const $x=_t(Ix,[["render",Ax],["__scopeId","data-v-f74059bb"]]),Ox={props:{pattern:{type:String,default:""}},watch:{pattern:{handler(e){this.$emit("update",e)}}},computed:{explanation(){return`
                <h1> 패턴 작성법 </h1>
                JSP 태그을 이용한 패턴 사용으로 인스턴스명의 작성이 가능합니다.
                <br><br>
                <h3> 1. instance ID 이용한 패턴 작성.</h3>
                <span>
                <b> 예시: uEgnine_<%=instance.instanceId%></b><br>
                결과: uEgnine_13
                </span>
                <br><br>
                <h3> 2. 해당 Role의 Scope정보 설정 </h3>
                <span>
                <b> 예시: uEgnine_<%=roles.사용자.endpoint%></b><br>
                결과: uEgnine_manager
                </span>
                <br><br>
                <h3> 3. 프로세스명 으로 설정 </h3>
                <b> 예시: uEgnine_<%=definition.id%></b><br>
                결과: uEgnine_TroubleCenter
            `}}},Lx={class:"pa-2"},Bx=["innerHTML"];function Nx(e,t,n,i,r,o){return L(),q("div",Lx,[k(Lf,{label:"Pattern",modelValue:n.pattern,"onUpdate:modelValue":t[0]||(t[0]=s=>n.pattern=s)},null,8,["modelValue"]),Z("div",{innerHTML:o.explanation,class:"px-2 pb-5"},null,8,Bx)])}const jx=_t(Ox,[["render",Nx]]),Hx={components:{WorkItem:Rp},props:{definitionId:String,isSimulate:String},data:()=>({backend:null,dryRunWorkItem:void 0}),created(){let e=this;e.backend=Nn.createBackend(),e.dryRun()},methods:{dryRun(){var e=this;e.$try({context:e,action:async()=>{console.log(e.isSimulate),e.dryRunWorkItem=await e.backend.dryRun(e.definitionId,e.isSimulate)}})},closeDialog(){this.$emit("close")}}},Vx={key:0},Fx={key:1},zx={key:2};function Gx(e,t,n,i,r,o){const s=Te("WorkItem");return L(),ve(at,{style:{width:"100%",height:"100%"}},{default:I(()=>[k(Oo,null,{default:I(()=>[st(ne(e.$t("successMsg.runningTheProcess")),1)]),_:1}),k(ai,null,{default:I(()=>[e.dryRunWorkItem?(L(),q("div",Vx,[k(s,{definitionId:n.definitionId,"is-simulate":n.isSimulate,isDryRun:!0,dryRunWorkItem:e.dryRunWorkItem,onClose:o.closeDialog},null,8,["definitionId","is-simulate","dryRunWorkItem","onClose"])])):e.dryRunWorkItem==null?(L(),q("div",Fx,[k(vt,{class:"ma-0 pa-0 dry-run-process-skeleton",style:{height:"100%"}},{default:I(()=>[k(ht,{cols:"4",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1}),k(ht,{cols:"8",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1})]),_:1})])):(L(),q("div",zx,ne(e.$t("DryRunProcess.notFound")),1))]),_:1})]),_:1})}const Wx=_t(Hx,[["render",Gx]]);Nn.createBackend();const Ux={components:{},props:{idx:Number,selectedTask:Object},data:()=>({}),async created(){},methods:{executeProcess(){this.$emit("execute",this.idx)},deleteTest(){this.$emit("delete",this.idx)}}},Xx={key:0},Kx={key:1};function Yx(e,t,n,i,r,o){const s=Te("Icons"),a=Te("TrashIcon");return Object.values(n.selectedTask).some(c=>Array.isArray(c))?(L(!0),q(Gt,{key:0},Ct(n.selectedTask,(c,l,p)=>(L(),q("tr",{key:l},[Z("td",null,ne(l),1),Z("td",null,ne(c),1),p===Object.keys(n.selectedTask).length-1?(L(),q("td",Xx,[k(ft,{onClick:o.executeProcess,class:"cp-process-save",color:"primary",rounded:"",density:"comfortable"},{default:I(()=>[st(ne(e.$t("TestVariable.start")),1)]),_:1},8,["onClick"])])):ct("",!0)]))),128)):(L(),q("tr",Kx,[Z("td",null,[(L(!0),q(Gt,null,Ct(n.selectedTask,(c,l)=>(L(),q("div",{key:l},ne(l),1))),128))]),Z("td",null,[(L(!0),q(Gt,null,Ct(n.selectedTask,(c,l)=>(L(),q("div",{key:l},ne(c),1))),128))]),Z("td",null,[k(kn,{text:e.$t("TestVariable.start")},{activator:I(({props:c})=>[k(ft,Rn({density:"compact",icon:"",flat:"",onClick:o.executeProcess},c,{style:{"margin-right":"5px"}}),{default:I(()=>[k(s,{icon:"play-outline",size:17,"stroke-width":"1.5",color:"rgb(var(--v-theme-primary))"},null,8,["color"])]),_:2},1040,["onClick"])]),_:1},8,["text"]),k(kn,{text:e.$t("TestVariable.delete")},{activator:I(({props:c})=>[k(ft,Rn({density:"compact",icon:"",flat:"",onClick:o.deleteTest},c),{default:I(()=>[k(a,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:1},8,["text"])])]))}const qx=_t(Ux,[["render",Yx]]),lr=Nn.createBackend(),Zx={components:{TestVariable:qx,DefaultWorkItem:xh,FormWorkItem:wh,URLWorkItem:Sh},watch:{task(e){this.testList[e]&&(this.selectedTask=JSON.parse(this.testList[e]))}},props:{definitionId:String,task:String,taskId:String},data:()=>({testList:{},selectedTask:null,workItem:null,currentComponent:null,workItemDialog:!1}),async created(){await this.init()},methods:{runNewTest(e){this.$emit("executeTest",e)},runExistingTest(e){console.log(this.selectedTask[e]),delete this.selectedTask[e]._type,this.$emit("executeTest",this.selectedTask[e])},async deleteTest(e){console.log(this.task),await lr.deleteTest(this.definitionId,this.task,e),this.init()},async init(){let e=this;e.workItem=await lr.getWorkItem(e.taskId),e.workItem.worklist.execScope&&(e.workItem.execScope=e.workItem.worklist.execScope),e.workListByInstId=await lr.getWorkListByInstId(e.workItem.worklist.instId),e.currentComponent=e.workItem.worklist.tool.includes("urlHandler")?"URLWorkItem":e.workItem.worklist.tool.includes("formHandler")?"FormWorkItem":"DefaultWorkItem",this.$emit("type",e.currentComponent),this.$emit("workItem",e.workItem);const t=await lr.testList(this.workItem.worklist.defId);this.testList=t,console.log(this.task),this.testList[this.task]&&(this.selectedTask=JSON.parse(this.testList[this.task]))}}},Jx={class:"h-100",style:{width:"100%",height:"100%"},variant:"outlined"},Qx={style:{"max-height":"calc(100vh - 380px)",color:"black",overflow:"auto"}},ew={class:"text-left"},tw={class:"text-left"},nw={class:"text-left"};function iw(e,t,n,i,r,o){const s=Te("Icons"),a=Te("test-variable");return L(),q("div",Jx,[k(vt,{class:"ma-0 pa-0 mt-2",style:{position:"absolute",top:"0px",right:"5px"}},{default:I(()=>[k(Bf),k(ft,{onClick:t[0]||(t[0]=c=>e.workItemDialog=!e.workItemDialog),color:"primary",variant:"text",icon:"",density:"comfortable"},{default:I(()=>[k(s,{icon:"plus"})]),_:1})]),_:1}),Z("div",Qx,[e.selectedTask?(L(),ve(Nf,{key:0},{default:I(()=>[Z("thead",null,[Z("tr",null,[Z("th",ew,ne(e.$t("TestVariables.key")),1),Z("th",tw,ne(e.$t("TestVariables.value")),1),Z("th",nw,ne(e.$t("TestVariables.action")),1)])]),Z("tbody",null,[(L(!0),q(Gt,null,Ct(e.selectedTask,(c,l)=>(L(),ve(a,{key:l,idx:l,"selected-task":c,onExecute:t[1]||(t[1]=p=>o.runExistingTest(p)),onDelete:p=>o.deleteTest(p)},null,8,["idx","selected-task","onDelete"]))),128))])]),_:1})):(L(),ve(ai,{key:1,class:"pa-0"},{default:I(()=>[st(ne(e.$t("TestVariables.noData")),1)]),_:1}))]),k(lp,{modelValue:e.workItemDialog,"onUpdate:modelValue":t[2]||(t[2]=c=>e.workItemDialog=c),style:{width:"30%"}},{default:I(()=>[e.currentComponent?(L(),ve(at,{key:0,class:"work-item-dialog-card"},{default:I(()=>[(L(),ve(jf(e.currentComponent),{definitionId:n.definitionId,"work-item":e.workItem,workItemStatus:e.workItemStatus,isDryRun:!1,dryRunWorkItem:e.dryRunWorkItem,currentActivities:e.currentActivities,onUpdateCurrentActivities:e.updateCurrentActivities,onClose:e.close,onExecuteProcess:o.runNewTest,"is-simulate":"true"},null,8,["definitionId","work-item","workItemStatus","dryRunWorkItem","currentActivities","onUpdateCurrentActivities","onClose","onExecuteProcess"]))]),_:1})):ct("",!0)]),_:1},8,["modelValue"])])}const rw=_t(Zx,[["render",iw]]),ow={components:{TestVariables:rw,BpmnUengineViewer:_h},props:{definitionId:String},data:()=>({backend:null,dryRunWorkItem:void 0,isSimulate:"true",isDryRun:!0,taskId:null,bpmn:null,updatedDefKey:0,options:{propertiesPanel:{},additionalModules:[Vo]},eventList:[],workListByInstId:null,currentActivities:[],workItem:{},taskList:null,instanceId:null,tool:null,subBpmn:null,subBpmnKey:0,subTaskStatus:{},subCurrentActivities:null,taskStatus:null,bpmnKey:0}),created(){let e=this;e.backend=Nn.createBackend(),e.startProcess()},watch:{},methods:{async addWorkItem(e,t){let n=this;if(this.workItem[t]=e,console.log(e),e.worklist.instId!=e.worklist.rootInstId){let i=await n.backend.getActivitiesStatus(e.worklist.instId);n.subCurrentActivities||(n.subCurrentActivities={}),Object.keys(i).forEach(function(r){n.subCurrentActivities[e.worklist.instId]||(n.subCurrentActivities[e.worklist.instId]=[]),n.subCurrentActivities[e.worklist.instId].push(r)}),n.subBpmn==null&&(n.subBpmn={}),n.subBpmn[e.worklist.instId]=await n.backend.getRawDefinition(e.worklist.defId,{type:"bpmn"}),await n.setStatus(),n.updatedDefKey++}},executeTestProcess(e,t){var n=this;n.$try({context:n,action:async()=>{let i;this.tool=="FormWorkItem"&&n.saveForm(e,t),e.parameterValues?i=e:i={parameterValues:e},t!=null&&t.execScope&&(i.execScope=t.execScope),await n.backend.putWorkItemComplete(t.taskId,i,n.isSimulate);let r=await n.backend.findCurrentWorkItemByInstId(n.instanceId);n.taskList=r,n.setTaskInfo(),await n.setStatus()},successMsg:this.$t("successMsg.workCompleted")})},async saveForm(e,t){let n=this,i=n.workItem[t.taskId].activity.variableForHtmlFormContext.name,r={};r._type="org.uengine.contexts.HtmlFormContext";let o;Object.keys(e).forEach(function(s){o=e[s]}),r.valueMap=o,Object.keys(r.valueMap).forEach(s=>{var a;if(Array.isArray(r.valueMap[s])){if(!r.valueMap[s])return;(a=r.valueMap[s])==null||a.forEach(c=>{c&&c._type&&(c._type="java.util.HashMap")})}}),await n.backend.setVariableWithTaskId(n.instanceId,t.taskId,i,r),n.workItem.hasOwnProperty(t.taskId)&&delete n.workItem[t.taskId]},setStatus(){let e=this;e.subBpmn&&Object.keys(e.subBpmn).forEach(async function(t){e.subTaskStatus[t]=await e.backend.getActivitiesStatus(t),e.bpmnKey++,e.subBpmnKey++,e.updatedDefKey++})},startProcess(){var e=this;e.$try({context:e,action:async()=>{console.log(e.isSimulate);let t={processDefinitionId:e.definitionId,simulation:!0},n=await e.backend.start(t);this.instanceId=n.instanceId;let i=await e.backend.findCurrentWorkItemByInstId(n.instanceId);e.taskList=i,e.bpmn=await e.backend.getRawDefinition(e.taskList[0].defId,{type:"bpmn"}),e.setTaskInfo()}})},async setEventList(){let e=this;this.eventList=await e.backend.getEventList(this.instanceId)},async setTaskInfo(){let e=this;e.workListByInstId=await e.backend.getWorkListByInstId(e.instanceId),e.setEventList();let t=await e.backend.getActivitiesStatus(e.instanceId);console.log(t),Object.keys(t).forEach(function(n){console.log(n),e.currentActivities.push(n)}),window.$mode=="ProcessGPT"?atob(e.instanceId):e.instanceId,e.taskStatus=t,e.bpmnKey++,e.updatedDefKey++},async fireMessage(e){let t=this;await t.backend.fireMessage(t.instanceId,e);let n=await t.backend.findCurrentWorkItemByInstId(t.instanceId);t.taskList=n,t.setTaskInfo()}}},aw={key:0,style:{"border-bottom":"1px solid #E0E0E0"}},sw={key:1},cw={style:{"border-bottom":"1px solid #E0E0E0"}},lw={style:{"max-height":"calc(-270px + 100vh)",color:"black",overflow:"auto"}},pw={key:0},uw={key:1},dw={class:"text-h6 mb-1"},fw={class:"text-caption"},hw={class:"text-caption"};function mw(e,t,n,i,r,o){const s=Te("BpmnUengineViewer"),a=Te("test-variables");return L(),ve(at,{style:{width:"100%",height:"100%"}},{default:I(()=>[k(Oo,{class:"pb-0"},{default:I(()=>[st(ne(e.$t("TestProcess.title")),1)]),_:1}),Z("div",null,[k(vt,{class:cp(e.isMobile?"ma-0 pa-2 mt-2":"ma-0 pa-4 pt-0")},{default:I(()=>[k(ht,{class:"pa-0",cols:e.isMobile?12:(e.isSimulate,6)},{default:I(()=>[e.bpmn||e.subBpmn?(L(),ve(Hf,{key:0,class:"pa-0 mt-4",color:"#2196F3",variant:"outlined"},{default:I(()=>[Z("div",{class:"pa-2",style:pp(e.$globalState.state.isZoomed?"height: calc(100vh - 130px); overflow: auto":"height: calc(100vh - 240px); color: black; overflow: auto")},[(L(),q("div",{class:"pa-0",style:{height:"100%"},key:e.updatedDefKey},[e.bpmn?(L(),q("div",aw,[st(ne(e.$t("TestProcess.mainInstanceId"))+ne(e.instanceId)+" ",1),(L(),ve(s,{ref:"bpmnVue",key:e.bpmnKey,bpmn:e.bpmn,taskStatus:e.taskStatus,options:e.options,currentActivities:e.currentActivities,onOpenDefinition:t[0]||(t[0]=c=>e.openSubProcess(c)),style:{height:"100%"}},null,8,["bpmn","taskStatus","options","currentActivities"]))])):ct("",!0),e.subBpmn?(L(),q("div",sw,[(L(!0),q(Gt,null,Ct(e.subBpmn,(c,l)=>(L(),q("div",cw,[st(ne(e.$t("TestProcess.subInstanceId"))+ne(l)+" ",1),(L(),ve(s,{ref_for:!0,ref:"bpmnVue",key:e.subBpmnKey,bpmn:c,options:e.options,taskStatus:e.subTaskStatus[l],currentActivities:e.subCurrentActivities[l],onOpenDefinition:t[1]||(t[1]=p=>e.openSubProcess(p)),style:{height:"100%"}},null,8,["bpmn","options","taskStatus","currentActivities"]))]))),256))])):ct("",!0)]))],4)]),_:1})):(L(),ve(vt,{key:1,class:"ma-0 pa-0 test-process-skeleton",style:{height:"100%"}},{default:I(()=>[k(ht,{cols:"12",class:"pa-4"},{default:I(()=>[k(hn,{type:"card"})]),_:1})]),_:1}))]),_:1},8,["cols"]),k(ht,{class:"pa-4",cols:6},{default:I(()=>[k(Oo,{class:"pa-0"},{default:I(()=>[st(ne(e.$t("TestProcess.worklist")),1)]),_:1}),Z("div",lw,[e.eventList?(L(),q("div",pw,[(L(!0),q(Gt,null,Ct(e.eventList,c=>(L(),q("div",{key:c},[c.name?(L(),ve(ft,{key:0,onClick:l=>e.$try({context:this,action:()=>o.fireMessage(c.tracingTag),successMsg:`${c.name} ${this.$t("TestProcess.success")}`})},{default:I(()=>[st(ne(c.name),1)]),_:2},1032,["onClick"])):ct("",!0)]))),128))])):ct("",!0),e.taskList?(L(),q("div",uw,[(L(!0),q(Gt,null,Ct(e.taskList,c=>(L(),ve(at,{variant:"outlined",class:"pa-4 mb-0",key:c.taskId},{default:I(()=>[Z("div",null,[Z("div",dw,ne(c.title),1),Z("div",fw,ne(e.$t("TestProcess.taskID"))+ne(c.taskId),1),Z("div",hw,ne(e.$t("TestProcess.instanceID"))+ne(c.instId),1)]),k(a,{style:{height:"100%"},"definition-id":n.definitionId,task:c.trcTag,"task-id":c.taskId,onExecuteTest:l=>o.executeTestProcess(l,c),onType:t[2]||(t[2]=l=>e.tool=l),onWorkItem:l=>o.addWorkItem(l,c.taskId)},null,8,["definition-id","task","task-id","onExecuteTest","onWorkItem"])]),_:2},1024))),128))])):(L(),ve(vt,{key:2,class:"ma-0 pa-0 test-process-work-list-skeleton",style:{height:"100%"}},{default:I(()=>[k(ht,{cols:"12",class:"pa-0"},{default:I(()=>[k(hn,{type:"card"})]),_:1})]),_:1}))])]),_:1})]),_:1},8,["class"])])]),_:1})}const vw=_t(ow,[["render",mw]]);const sp=Nn.createBackend(),gw={name:"ProcessDefinition",components:{BpmnLLM:fx,BpmnuEngine:gx,BpmnPropertyPanel:Vf,ProcessVariable:Ff,Icon:zf,VDataTable:up,InstanceNamePatternForm:jx,"process-gpt-execute":kx,XmlViewer:Dx,XMLEditor:$x,DryRunProcess:Wx,TestProcess:vw},props:{processDefinition:Object,bpmn:String,isViewMode:Boolean,definitionChat:Object,definitionPath:String,isXmlMode:Boolean,validationList:Object,isAdmin:Boolean,generateFormTask:Object},data:()=>({panel:!1,panelId:null,roles:[],element:null,definitions:null,isViewProcessVariables:!1,processVariableTab:"variable",copyProcessDefinition:null,processVariablesWindow:!1,editDialog:!1,editedIndex:null,editedItem:null,lastEditedIndex:0,editComponentKey:0,bpmnModeler:null,processVariables:[],instanceNamePattern:null,executeDialog:!1,isSimulate:"false",record:!1,description:"",processVariableHeaders:[{title:"processDefinition.name",key:"name"},{title:"processDefinition.type",key:"type"},{title:"processDefinition.form",key:"form"},{title:"processDefinition.description",key:"description"},{title:"processDefinition.dataSource",key:"dataSource"},{title:"processDefinition.query",key:"query"},{title:"processDefinition.actions",key:"actions"}],taskStatus:null,bpmnKey:0,isPreviewMode:!1,currentStepIndex:0,stepIds:[],currentActivities:[]}),computed:{mode(){return window.$mode=="ProcessGPT"?"LLM":window.$mode},thisDefinition(){return{processVariables:this.processVariables}},executable(){return window.$jms?!1:!this.isViewMode&&this.$route.path!=="/definitions/chat"?!0:!!(this.isViewMode&&this.$route.path.includes("/definitions/")&&this.$route.path!=="/definitions/chat")},containerStyle(){return{height:this.isAdmin?"100%":"calc(100% - 50px)"}},options(){return{propertiesPanel:{invalidationList:this.validationList},additionalModules:this.isViewMode?[Vo]:[Vo,yx,_x,bx]}}},watch:{isSimulate(e){console.log(e)},copyProcessDefinition:{deep:!0,handler(e){console.log("********* watch  ********"),this.$emit("updateDefinition",e)}},definitions:{deep:!0,handler(e){let n=JSON.stringify(e,function(i,r){if(r&&typeof r=="object"&&!Array.isArray(r)){let o={...r};return r.bpmnElement&&(o.bpmnElement=r.bpmnElement.id),r.$parent&&(o.$parent=r.$parent.id),r.sourceRef&&(o.sourceRef=r.sourceRef.id),r.targetRef&&(o.targetRef=r.targetRef.id),o}return r});this.$emit("valueToStr",n)}},validationList:{handler(e){this.options.propertiesPanel.invalidationList=e}},panel:{handler(){let e=this;e.roles=[];const n=this.bpmnModeler.getDefinitions().rootElements.filter(i=>i.$type==="bpmn:Process");if(!n){console.error("bpmn:Process element not found");return}n.forEach(i=>{(i.laneSets||[]).forEach(r=>{(r.lanes||[]).forEach(o=>{var s;((s=o==null?void 0:o.name)==null?void 0:s.length)>0&&e.roles.push(o.name)})})})}},executeDialog(){let e=this;e.roles=[];const n=this.bpmnModeler.getDefinitions().rootElements.filter(i=>i.$type==="bpmn:Process");if(!n){console.error("bpmn:Process element not found");return}n.forEach(i=>{(i.laneSets||[]).forEach(r=>{(r.lanes||[]).forEach(o=>{var s;((s=o==null?void 0:o.name)==null?void 0:s.length)>0&&e.roles.push(o.name)})})})}},created(){},mounted(){var e=this;this.processDefinition?this.copyProcessDefinition=this.processDefinition:this.copyProcessDefinition={megaProcessId:"",majorProcessId:"",processDefinitionName:"",processDefinitionId:this.uuid(),events:[],gateways:[],participants:[],description:"",data:[],roles:[],activities:[],sequences:[]};const t=ca();t.setProcessDefinition(this),this.bpmnModeler=t.getModeler,this.EventBus.on("process-definition-updated",n=>{this.copyProcessDefinition=n}),e.$try({action:async()=>{if(e.$route.params&&e.$route.params.instId){const n=window.$mode=="ProcessGPT"?atob(e.$route.params.instId):e.$route.params.instId;e.taskStatus=await sp.getActivitiesStatus(n),e.bpmnKey++}}})},methods:{closeModelingDialog(){const e=this.$refs.bpmnVue;e&&e.closeModelingDialog()},updateCurrentStep(){this.closePanel(),this.isPreviewMode=!0,this.currentActivities=[this.stepIds[this.currentStepIndex]],this.bpmnKey++,this.openPanel(this.stepIds[this.currentStepIndex])},prevStep(){this.currentStepIndex>0&&this.currentStepIndex--,this.updateCurrentStep()},nextStep(){this.currentStepIndex<this.stepIds.length-1&&this.currentStepIndex++,this.updateCurrentStep()},setDefinition(){var s,a;let e=this;const t=this.bpmnModeler.getDefinitions();let n=this.bpmnModeler.get("bpmnFactory");const i=t.rootElements.find(c=>c.$type==="bpmn:Process");if(!i){console.error("bpmn:Process element not found");return}let r=i.extensionElements;r||(r=n.create("bpmn:ExtensionElements"),i.extensionElements=r);let o;if(r.values&&(o=r.values.find(c=>c.$type==="uengine:Properties")),o||(o=n.create("uengine:Properties"),r.get("values").push(o)),o.json){let c=JSON.parse(o.json);e.instanceNamePattern=c.instanceNamePattern?c.instanceNamePattern:"",e.description=(s=c==null?void 0:c.shortDescription)==null?void 0:s.text}(a=o==null?void 0:o.variables)==null||a.forEach(function(c){let l={name:c.$attrs.name,type:c.$attrs.type};c.json&&(l=JSON.parse(c.json)),l.name=c.$attrs.name,l.type=c.$attrs.type,e.processVariables.findIndex(p=>p.name==l.name&&p.type==l.type)==-1&&e.processVariables.push(l),c.$parent||(c.$parent=o)})},updateInstanceNamePattern(e){const n=this.bpmnModeler.getDefinitions().rootElements.find(s=>s.$type==="bpmn:Process");if(!n){console.error("bpmn:Process element not found");return}let i=n.extensionElements;i||(i=bpmnFactory.create("bpmn:ExtensionElements"));let r;i.values&&(r=i.values.find(s=>s.$type==="uengine:Properties"));let o={};r.json&&(o=JSON.parse(r.json)),o.instanceNamePattern=e,r.json=JSON.stringify(o)},changeElement(){this.$emit("change")},changeBpmn(e){this.$emit("changeBpmn",e)},previewProcess(){this.stepId=[],this.currentStepIndex=0;const e=this.processDefinition.sequences.flatMap(t=>[t.source,t.target]);this.stepIds=[...new Set(e)],this.stepIds.length>0&&(this.isPreviewMode=!0,this.currentActivities=[this.stepIds[this.currentStepIndex]],this.bpmnKey++,this.openPanel(this.stepIds[0]))},executeProcess(){this.executeDialog=!this.executeDialog},startProcess(){var e=this;e.$try({action:async()=>{const t={process_instance_id:"new",process_definition_id:e.processDefinition.processDefinitionId},n=await sp.start(t);if(n.instanceId){const i=window.$mode=="ProcessGPT"?atob(n.instanceId):n.instanceId;e.$router.push(`/instancelist/${i}`)}e.EventBus.emit("instances-updated")},successMsg:this.$t("successMsg.processExecutionCompleted")})},addUengineVariable(e){if(e.type=="Form"){let s={_type:"org.uengine.contexts.HtmlFormContext",formDefId:`${e.defaultValue}`,filePath:`${e.defaultValue}.form`};e.defaultValue=s}const t=this.bpmnModeler.get("bpmnFactory"),n=this.definitions.rootElements.find(s=>s.$type==="bpmn:Process");if(!n){console.error("bpmn:Process element not found");return}let i=n.extensionElements;i||(i=t.create("bpmn:ExtensionElements"),n.extensionElements=i);let r;i.values&&(r=i.values.find(s=>s.$type==="uengine:Properties")),r||(r=t.create("uengine:Properties"),i.get("values").push(r));const o=t.create("uengine:Variable",{name:e.name,type:e.type,json:JSON.stringify({defaultValue:e.defaultValue})});r.get("variables").push(o),this.processVariables.push(e)},openSubProcess(e){this.$emit("openSubProcess",e)},uuid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},onAddShape(e){console.log(e);let t;e.type.includes("Task")?(t=this.createActivity(e),this.copyProcessDefinition.activities.push(t)):e.type.includes("Participant")?(t=this.createParticipant(e),this.copyProcessDefinition.participants.push(t)):e.type.includes("Lane")&&(t=this.createRole(e),this.copyProcessDefinition.roles.push(t))},onChangeShape(e){},onChangeSequence(e){},onRemoveShape(e){},createParticipant(e){return{name:e.name,resolutionRule:"",pos:{x:e.x,y:e.y,width:e.width,height:e.height}}},createRole(e){return{name:e.name,resolutionRule:"",pos:{x:e.x,y:e.y,width:e.width,height:e.height}}},createActivity(e){let t=this.taskMapping(e.type);return{name:"",id:e.id,type:t,description:"",role:"",outputData:[],executeDialog:!1,inputData:[],pos:{x:e.x,y:e.y,width:e.width,height:e.height}}},editItem(e){this.editedIndex=this.processVariables.indexOf(e),this.editedItem=Object.assign({},e),this.processVariablesWindow==!0&&(this.processVariablesWindow=!1),this.editComponentKey^=1,this.lastEditedIndex==this.editedIndex?this.editDialog=!this.editDialog:this.editDialog=!0,this.lastEditedIndex=this.editedIndex},deleteItem(e){const t=this.processVariables.indexOf(e);if(confirm("Are you sure you want to delete this item?")){const n=this.definitions.rootElements.find(o=>o.$type==="bpmn:Process");if(!n){console.error("bpmn:Process element not found");return}let i=n.extensionElements,r;i.values&&(r=i.values.find(o=>o.$type==="uengine:Properties")),console.log(r.get("variables").findIndex(o=>o.$attrs.name===e.name)),t!==-1&&r.get("variables").splice(t,1),this.processVariables.splice(t,1)}},findElement(e,t,n){if(e.hasOwnProperty(t)&&e[t]===n)return e;for(let i in e)if(e[i]instanceof Object){let r=this.findElement(e[i],t,n);if(r)return r}return null},updateItemByKey(e,t,n,i){const r=e.findIndex(o=>o[t]===n);r!==-1&&(e[r]=i)},updateVariable(e){if(e.type=="Form"){let r={_type:"org.uengine.contexts.HtmlFormContext",formDefId:e.defaultValue.id,filePath:e.defaultValue.path};e.defaultValue=r}this.processVariables[this.editedIndex]=e;const t=this.definitions.rootElements.find(r=>r.$type==="bpmn:Process");if(!t){console.error("bpmn:Process element not found");return}let n=t.extensionElements,i;n.values&&(i=n.values.find(r=>r.$type==="uengine:Properties")),i.get("variables")[this.editedIndex].$attrs.name=e.name,i.get("variables")[this.editedIndex].$attrs.type=e.type,i.get("variables")[this.editedIndex].json=JSON.stringify(e),this.editDialog=!1},openProcessVariables(){this.isViewProcessVariables=!this.isViewProcessVariables},addProcessVariables(){this.editDialog==!0&&(this.editDialog=!1),this.processVariablesWindow=!this.processVariablesWindow},updateElement(e){this.$emit("update")},openPanel(e){if(console.log(e),this.element=this.findElement(this.definitions,"id",e),this.element){const t={};t.businessObject=this.element,this.panel=!0,this.$refs.bpmnVue.extendUEngineProperties(t)}},closePanel(){this.element=null,this.panel=!1,this.isPreviewMode=!1,this.currentActivities=[],this.$emit("change")},handleError(){console.error("failed to show diagram",err)},handleShown(){console.log("diagram shown")},handleLoading(){console.log("diagram loading")},taskMapping(e){switch(e){case"bpmn:ScriptTask":return"ScriptActivity";case"bpmn:sendTask":return"EmailActivity";default:return"UserActivity"}},convertElementToJSON(e){var t,n,i,r,o,s,a,c,l;if(console.log(e.name),e.$type.includes("Task")){let p=this.taskMapping(e.$type),u={},d={};(s=(o=(r=(i=(n=(t=this.copyElement)==null?void 0:t.extensionElements)==null?void 0:n.values)==null?void 0:i[0])==null?void 0:r.$children)==null?void 0:o[0])==null||s.$children.forEach(function(b){console.log(b),b.category=="input"?u[b.key]={mandatory:b.mandatory?b.mandatory:!1}:b.category=="output"&&(d[b.key]={mandatory:b.mandatory?b.mandatory:!1})});let f=Object.keys(u).length>0?[u]:[],m=Object.keys(d).length>0?[d]:[],h=[];(l=(c=(a=e.extensionElements)==null?void 0:a.values[0])==null?void 0:c.$children[0])==null||l.$children.forEach(function(b){h.push(b.checkpoint)});let v={checkpoints:h,description:e.extensionElements.values[0].description,id:e.id,inputData:f,instruction:"",name:e.name,outputData:m,role:e.extensionElements.values[0].role,type:p};e.extensionElements.values[0].pythonCode&&(v.pythonCode=e.extensionElements.values[0].pythonCode),console.log(v),this.updateItemByKey(this.copyProcessDefinition.activities,"id",v.id,v)}else if(e.$type.includes("Flow")){let p={name:e.name,source:e.sourceRef.id,target:e.targetRef.id,condition:e.extensionElements.values[0].$children[0].$children[0].$body};this.updateItemByKey(this.copyProcessDefinition.sequences,"source",p.source,p)}else e.$type.includes("Lane")}}},yw={key:0,style:{height:"calc(100% - 50px)","margin-top":"50px",overflow:"auto",padding:"10px"}},_w={key:0,style:{position:"fixed","z-index":"999",right:"0",height:"100%"}},bw={class:"d-flex"},Ew=st("mdi-close"),xw={class:"text-subtitle-1 font-weight-semibold"},ww={class:"text-subtitle-1"},Sw={class:"cp-v-type"},Pw={key:0,class:"text-subtitle-1"},Cw={key:1,class:"text-subtitle-1"},Tw={class:"text-subtitle-1"},Rw={class:"text-subtitle-1"},kw={class:"d-flex align-center"},Mw={style:{display:"flex","justify-content":"center","align-items":"center"}},Dw={key:0},Iw={key:1};function Aw(e,t,n,i,r,o){const s=Te("Icons"),a=Te("XmlViewer"),c=Te("XMLEditor"),l=Te("BpmnuEngine"),p=Te("bpmn-property-panel"),u=Te("PencilIcon"),d=Te("TrashIcon"),f=Te("process-variable"),m=Te("InstanceNamePatternForm");return L(),q("div",{style:pp(o.containerStyle)},[k(vt,{style:{height:"100%"},class:"ma-0"},{default:I(()=>[k(ht,{class:"d-flex ma-0 pa-0",style:{height:"100%"}},{default:I(()=>[k(at,{style:{"border-radius":"0px !important",border:"none",height:"100%"},flat:""},{default:I(()=>[k(vt,{class:"ma-0 pa-0 button-container"},{default:I(()=>[n.isViewMode?ct("",!0):(L(),ve(kn,{key:0,text:e.$t("processDefinition.processVariables")},{activator:I(({props:h})=>[k(ft,Rn({onClick:o.openProcessVariables},h,{class:"cp-process-variables btn-variables",icon:"",variant:"text"}),{default:I(()=>[k(s,{icon:"variable",width:32,height:32})]),_:2},1040,["onClick"])]),_:1},8,["text"])),n.isViewMode?ct("",!0):(L(),ve(kn,{key:1,text:e.$t("processDefinition.zoom")},{activator:I(({props:h})=>[k(ft,Rn(h,{onClick:t[0]||(t[0]=v=>e.$globalState.methods.toggleZoom()),class:"btn-zoom",icon:"",variant:"text"}),{default:I(()=>[k(s,{icon:e.$globalState.state.isZoomed?"zoom-in":"zoom-out",size:32},null,8,["icon"])]),_:2},1040)]),_:1},8,["text"]))]),_:1}),n.isXmlMode?(L(),q("div",yw,[n.isViewMode?(L(),ve(a,{key:0,xml:n.bpmn},null,8,["xml"])):(L(),ve(c,{key:1,xml:n.bpmn,onChangeBpmn:o.changeBpmn},null,8,["xml","onChangeBpmn"]))])):(L(),ve(l,{ref:"bpmnVue",key:e.bpmnKey,bpmn:n.bpmn,options:o.options,isViewMode:n.isViewMode,isPreviewMode:e.isPreviewMode,currentActivities:e.currentActivities,taskStatus:e.taskStatus,generateFormTask:n.generateFormTask,onError:o.handleError,onShown:o.handleShown,onOpenDefinition:t[1]||(t[1]=h=>o.openSubProcess(h)),onLoading:o.handleLoading,onOpenPanel:t[2]||(t[2]=h=>o.openPanel(h)),onUpdateXml:t[3]||(t[3]=h=>e.$emit("update-xml",h)),onDefinition:t[4]||(t[4]=h=>e.definitions=h),onAddShape:o.onAddShape,onDone:o.setDefinition,onChange:o.changeElement,style:{height:"100%"}},null,8,["bpmn","options","isViewMode","isPreviewMode","currentActivities","taskStatus","generateFormTask","onError","onShown","onLoading","onAddShape","onDone","onChange"]))]),_:1})]),_:1}),e.panel&&!n.isViewMode?(L(),q("div",_w,[k(at,{elevation:"1"},{default:I(()=>[(L(),ve(p,{element:e.element,onClose:o.closePanel,roles:e.roles,"process-variables":e.processVariables,key:e.element.id,isViewMode:n.isViewMode,onUpdateElement:t[5]||(t[5]=h=>o.updateElement(h)),definition:o.thisDefinition,processDefinitionId:n.definitionPath,processDefinition:n.processDefinition,validationList:n.validationList,isPreviewMode:e.isPreviewMode,onChangeSequence:o.onChangeSequence,onRemoveShape:o.onRemoveShape,onChangeShape:o.onChangeShape,onAddUengineVariable:o.addUengineVariable},null,8,["element","onClose","roles","process-variables","isViewMode","definition","processDefinitionId","processDefinition","validationList","isPreviewMode","onChangeSequence","onRemoveShape","onChangeShape","onAddUengineVariable"]))]),_:1})])):ct("",!0)]),_:1}),k(lp,{modelValue:e.isViewProcessVariables,"onUpdate:modelValue":t[11]||(t[11]=h=>e.isViewProcessVariables=h),"max-width":"1000"},{default:I(()=>[k(at,null,{default:I(()=>[Z("div",bw,[k(Gf,{modelValue:e.processVariableTab,"onUpdate:modelValue":t[6]||(t[6]=h=>e.processVariableTab=h),"bg-color":"transparent",height:"50",color:"primary"},{default:I(()=>[k(Ws,{value:"variable"},{default:I(()=>[st(ne(e.$t("processDefinition.editProcessData")),1)]),_:1}),k(Ws,{value:"pattern"},{default:I(()=>[st(ne(e.$t("processDefinition.instanceNamePattern")),1)]),_:1})]),_:1},8,["modelValue"]),k(ft,{icon:"",variant:"plain",class:"ml-auto cp-v-close",onClick:t[7]||(t[7]=h=>e.isViewProcessVariables=!1)},{default:I(()=>[k(Wf,null,{default:I(()=>[Ew]),_:1})]),_:1})]),k(ai,{style:{overflow:"auto",height:"calc(100vh - 150px)"}},{default:I(()=>[k(Uf,{modelValue:e.processVariableTab,"onUpdate:modelValue":t[10]||(t[10]=h=>e.processVariableTab=h)},{default:I(()=>[k(Us,{value:"variable"},{default:I(()=>[k(up,{headers:e.processVariableHeaders,items:e.processVariables,"item-key":"name","items-per-page":"10","hide-default-header":"",class:"process-variable-tbody",height:"200"},Xf({item:I(({item:h})=>[(L(),q("tr",{key:h.name},[Z("td",ww,ne(h.name),1),Z("td",Sw,ne(h.type),1),h.defaultValue?(L(),q("td",Pw,ne(h.defaultValue.formDefId),1)):(L(),q("td",Cw)),Z("td",Tw,ne(h.description),1),Z("td",Rw,ne(h.datasource?h.datasource.type:"None"),1),Z("td",null,ne(h.datasource?h.datasource.query:"None"),1),Z("td",null,[Z("div",kw,[k(kn,{text:e.$t("processDefinition.edit")},{activator:I(({props:v})=>[k(ft,Rn({density:"compact",icon:"",flat:"",onClick:b=>o.editItem(h)},v,{style:{"margin-right":"5px"}}),{default:I(()=>[k(u,{"stroke-width":"1.5",size:"20",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]),k(kn,{text:e.$t("processDefinition.delete")},{activator:I(({props:v})=>[k(ft,Rn({density:"compact",icon:"",flat:"",onClick:b=>o.deleteItem(h)},v),{default:I(()=>[k(d,{"stroke-width":"1.5",size:"20",class:"text-error"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])])])]))]),_:2},[Ct(e.processVariableHeaders,h=>({name:`header.${h.key}`,fn:I(({column:v})=>[Z("th",xw,ne(e.$t(h.title)),1)])}))]),1032,["headers","items"]),k(vt,{class:"ma-0",style:{margin:"10px 0px 10px 0px !important"}},{default:I(()=>[k(at,{onClick:o.addProcessVariables,elevation:"9",variant:"outlined",style:{padding:"10px",display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important"}},{default:I(()=>[Z("div",Mw,[k(s,{class:"cp-variables-add",icon:"plus",color:"#5eb2e8"})])]),_:1},8,["onClick"])]),_:1}),e.processVariablesWindow?(L(),q("div",Dw,[k(at,{variant:"outlined"},{default:I(()=>[k(ai,{class:"ma-0 pa-0"},{default:I(()=>[k(f,{class:"cp-v-add",mode:"add",onAddVariables:t[8]||(t[8]=h=>o.addUengineVariable(h))})]),_:1})]),_:1})])):ct("",!0),e.editDialog?(L(),q("div",Iw,[k(at,{variant:"outlined"},{default:I(()=>[k(ai,{class:"ma-0 pa-0"},{default:I(()=>[(L(),ve(f,{key:e.editComponentKey,variable:e.editedItem,mode:"edit",onUpdateVariables:t[9]||(t[9]=h=>o.updateVariable(h))},null,8,["variable"]))]),_:1})]),_:1})])):ct("",!0)]),_:1}),k(Us,{value:"pattern"},{default:I(()=>[k(m,{pattern:e.instanceNamePattern,onUpdate:o.updateInstanceNamePattern},null,8,["pattern","onUpdate"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],4)}const Qw=_t(gw,[["render",Aw],["__scopeId","data-v-5f59b585"]]);export{Wx as D,Qw as P,vw as T,kx as a};
