import{b0 as Y,b1 as E,as as de,a2 as _,a1 as me,aM as fe,a6 as pe,I as ge,r as O,o as i,c as h,b as e,w as a,a as f,W as F,V as C,aS as L,f as q,Q as D,U as H,d,t as c,R,m as J,cg as he,e as m,D as x,g as z,H as I,X as K,S as Q,F as S,i as W,J as N,P as Z,h as ve,a0 as we,C as A,A as X,ci as ye}from"./index-7b37f28a.js";import{V as T}from"./VSheet-beabeb52.js";import{V as ee}from"./VBadge-0c68c2c9.js";function _e(o,r){return Y(2,arguments),E(o).getTime()-E(r).getTime()}var G={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(r){return r<0?Math.ceil(r):Math.floor(r)}},xe="trunc";function Ve(o){return o?G[o]:G[xe]}function be(o,r,g){Y(2,arguments);var V=_e(o,r)/1e3;return Ve(g==null?void 0:g.roundingMethod)(V)}const Ce={class:"px-6 pt-3"},Ie={class:"d-flex"},ke={class:"d-flex align-center flex-fill border border-borderColor header-search rounded-pill px-5"},$e=d("mdi-chat-plus"),Le=d("mdi-account-circle"),De=["src","alt"],Re=["src","alt"],Se=f("small",{class:"textPrimary text-subtitle-2"},"Sent a Photo",-1),Ue={class:"textPrimary text-subtitle-2"},Me=d("mdi-dots-vertical"),Oe={props:{chatRoomList:Array,userList:Array,userInfo:Object,chatRoomId:String},emits:["chat-selected","create-chat-room","delete-chat-room"],setup(o,{emit:r}){const g=o,{proxy:V}=de(),v=s=>{const n=new Date(s);return be(new Date,n)<60?"now":ye(n,{addSuffix:!1})},w=_(Date.now()),$=()=>{w.value=Date.now()};let B;me(()=>{B=setInterval($,6e4)}),fe(()=>{clearInterval(B)});const U=_(null),te=s=>{U.value=s.id,r("chat-selected",s)};pe(()=>g.chatRoomId,s=>{s&&(U.value=s)},{immediate:!0});const ae=g.chatRoomList,M=_(""),le=ge(()=>ae.filter(s=>s.name.toLowerCase().includes(M.value.toLowerCase()))),j=s=>{let n=window.location.port==""?window.location.origin:"";if(s=="system@uengine.org")return`${n}/images/chat-icon.png`;{const p=g.userList.find(y=>y.email===s);if(p&&p.profile){if(p.profile.includes("defaultUser.png"))return`${n}/images/defaultUser.png`;{const y=new Image;return y.src=p.profile,y.onerror=()=>`${n}/images/defaultUser.png`,p.profile}}else return`${n}/images/defaultUser.png`}},b=_(!1),k=_(!1),u=_({name:"",participants:[]}),P=_(!1),se=[s=>!!s||V.$t("chatListing.enterChatRoomName")],ne=[s=>s&&s.length>0||V.$t("chatListing.selectAtLeastOneParticipant")],ie=()=>{if(!u.value.name||!u.value.participants.length){console.log("Invalid input");return}r("create-chat-room",u.value),b.value=!1},oe=()=>{u.value={name:"",participants:[]},P.value=!1,b.value=!0},re=s=>{u.value={...s},P.value=!0,b.value=!0},ue=s=>{u.value={...s},k.value=!0},ce=()=>{r("delete-chat-room",u.value.id),k.value=!1};return(s,n)=>{const p=O("Icons"),y=O("perfect-scrollbar");return i(),h(S,null,[e(T,null,{default:a(()=>[f("div",Ce,[f("div",Ie,[f("div",ke,[e(p,{icon:"magnifer-linear",size:22}),e(F,{modelValue:M.value,"onUpdate:modelValue":n[0]||(n[0]=l=>M.value=l),variant:"plain",density:"compact",class:"position-relative pt-0 ml-3 custom-placeholer-color",placeholder:s.$t("chatListing.search"),"single-line":"","hide-details":""},null,8,["modelValue","placeholder"])]),e(C,{density:"comfortable",icon:"",onClick:oe,style:{"margin-left":"10px"}},{default:a(()=>[e(L,null,{default:a(()=>[$e]),_:1})]),_:1})])])]),_:1}),e(K,{modelValue:b.value,"onUpdate:modelValue":n[4]||(n[4]=l=>b.value=l),persistent:"","max-width":"600px"},{default:a(()=>[e(q,{class:"ma-0 pa-4"},{default:a(()=>[e(D,{class:"ma-0 pa-0"},{default:a(()=>[e(H,{class:"pa-0"},{default:a(()=>[d(c(s.$t("chatListing.title")),1)]),_:1}),e(R),e(C,{onClick:n[1]||(n[1]=l=>b.value=!1),icon:"",variant:"text",density:"comfortable",style:{"margin-top":"-8px"}},{default:a(()=>[e(p,{icon:"close",size:16})]),_:1})]),_:1}),e(J,{class:"ma-0 pa-0 pb-2 pt-4"},{default:a(()=>[e(F,{label:s.$t("chatListing.chatRoomName"),modelValue:u.value.name,"onUpdate:modelValue":n[2]||(n[2]=l=>u.value.name=l),rules:se},null,8,["label","modelValue"]),e(he,{modelValue:u.value.participants,"onUpdate:modelValue":n[3]||(n[3]=l=>u.value.participants=l),items:o.userList,chips:"","closable-chips":"",color:"blue-grey-lighten-2","item-title":"username","item-value":l=>l,multiple:"",label:s.$t("chatListing.selectParticipants"),"small-chips":"","item-avatar":"image",rules:ne},{chip:a(({props:l,item:t})=>[t.raw.profile?(i(),m(z,x({key:0},l,{"prepend-avatar":t.raw.profile,text:t.raw.username?t.raw.username:t.raw.email}),null,16,["prepend-avatar","text"])):t.raw.id=="system_id"?(i(),m(z,x({key:1},l,{"prepend-avatar":"/src/assets/images/chat/chat-icon.png",text:"System"}),null,16)):(i(),m(z,x({key:2},l,{"prepend-icon":"mdi-account-circle",text:t.raw.username?t.raw.username:t.raw.email}),null,16,["text"]))]),item:a(({props:l,item:t})=>[t.raw.profile?(i(),m(I,x({key:0},l,{"prepend-avatar":t.raw.profile,title:t.raw.username?t.raw.username:t.raw.email,subtitle:t.raw.email}),null,16,["prepend-avatar","title","subtitle"])):t.raw.id=="system_id"?(i(),m(I,x({key:1},l,{"prepend-avatar":"/src/assets/images/chat/chat-icon.png",title:"System"}),null,16)):(i(),m(I,x({key:2},l,{title:t.raw.username?t.raw.username:t.raw.email,subtitle:t.raw.email}),{prepend:a(()=>[e(L,{style:{position:"relative","margin-right":"10px","margin-left":"-3px"},size:"48"},{default:a(()=>[Le]),_:1})]),_:2},1040,["title","subtitle"]))]),_:1},8,["modelValue","items","item-value","label"])]),_:1}),e(D,{class:"ma-0 pa-0"},{default:a(()=>[e(R),e(C,{color:"primary",class:"ma-0 pa-0",rounded:"",onClick:ie},{default:a(()=>[d(c(P.value?s.$t("chatListing.save"):s.$t("chatListing.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=l=>k.value=l),persistent:"","max-width":"600px"},{default:a(()=>[e(q,{class:"pa-4"},{default:a(()=>[e(D,{class:"ma-0 pa-0"},{default:a(()=>[e(H,{class:"ma-0 pa-0"},{default:a(()=>[d(c(s.$t("chatListing.deleteChatRoom")),1)]),_:1}),e(R),e(C,{onClick:n[5]||(n[5]=l=>k.value=!1),icon:"",variant:"text",density:"comfortable",size:"24"},{default:a(()=>[e(p,{icon:"close",size:16})]),_:1})]),_:1}),e(J,{class:"ma-0 pa-0 pt-4 pb-4"},{default:a(()=>[d(' "'+c(u.value.name)+'" '+c(s.$t("chatListing.confirmDeleteChatRoom")),1)]),_:1}),e(D,{class:"ma-0 pa-0"},{default:a(()=>[e(R),e(C,{color:"primary",rounded:"",onClick:ce},{default:a(()=>[d(c(s.$t("chatListing.delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(y,{class:"lgScroll"},{default:a(()=>[e(Q,null,{default:a(()=>[(i(!0),h(S,null,W(N(le),l=>(i(),m(I,{value:l.id,color:"primary",class:X(["text-no-wrap chatItem",{"selected-chat":l.id===U.value}]),key:l.id,lines:"two",onClick:t=>te(l)},{prepend:a(()=>[e(Z,{color:"#f0f5f9",size:"large",style:{width:"50px",height:"50px",display:"flex","flex-wrap":"wrap"}},{default:a(()=>[l.participants.length?(i(),h(S,{key:0},[l.participants.filter(t=>t.email!==o.userInfo.email).length===1?(i(),h("img",{key:0,src:j(l.participants.find(t=>t.email!==o.userInfo.email).email),alt:l.participants.find(t=>t.email!==o.userInfo.email).username,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,De)):(i(!0),h(S,{key:1},W(l.participants.filter(t=>t.email!==o.userInfo.email).slice(0,4),(t,Te)=>(i(),h("div",{key:t.id,style:{width:"50%",height:"50%",position:"relative"}},[f("img",{src:j(t.email),alt:t.username,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Re)]))),128))],64)):(i(),m(L,{key:1,icon:"mdi-account-multiple",size:"large"}))]),_:2},1024)]),append:a(()=>[(i(),h("div",{key:w.value},[f("small",Ue,[d(c(v(l.message.createdAt))+" ",1),l.participants.find(t=>t.email==o.userInfo.email).isExistUnReadMessage?(i(),m(ee,{key:0,style:{position:"relative",top:"1.5px"},dot:"",inline:"",color:"info"})):ve("",!0),e(we,{location:"end"},{activator:a(({props:t})=>[e(C,x(t,{size:"x-small",icon:""}),{default:a(()=>[e(L,null,{default:a(()=>[Me]),_:1})]),_:2},1040)]),default:a(()=>[e(Q,{style:{width:"70px","text-align-last":"center"}},{default:a(()=>[e(I,{onClick:t=>re(l)},{default:a(()=>[e(A,null,{default:a(()=>[d(c(s.$t("chatListing.setting")),1)]),_:1})]),_:2},1032,["onClick"]),e(I,{onClick:t=>ue(l)},{default:a(()=>[e(A,{style:{color:"red"}},{default:a(()=>[d(c(s.$t("chatListing.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]))]),default:a(()=>[e(A,{class:"text-subtitle-1 textPrimary w-100 font-weight-semibold"},{default:a(()=>[d(c(l.name),1)]),_:2},1024),l.message.type=="img"?(i(),m(T,{key:0},{default:a(()=>[Se]),_:1})):(i(),h("div",{key:1,class:X(["text-subtitle-2 textPrimary mt-1 text-truncate w-100",{"font-weight-bold":l.participants.find(t=>t.email==o.userInfo.email).isExistUnReadMessage}])},c(l.message.msg),3))]),_:2},1032,["value","onClick","class"]))),128))]),_:1})]),_:1})],64)}}},Pe={class:"d-flex gap-2 align-center pa-6"},ze=["src"],Ae={class:"text-subtitle-1 font-weight-semibold"},Ne=f("span",{class:"text-subtitle-2 font-weight-medium text-grey100"},"Admin",-1),Fe={setup(o){const r=localStorage.getItem("userName");localStorage.getItem("email");const g=localStorage.getItem("picture"),V=v=>{let w=window.location.port==""?window.location.origin:"";if(v){if(v.includes("defaultUser.png"))return`${w}/images/defaultUser.png`;{const $=new Image;return $.src=v,$.onerror=()=>`${w}/images/defaultUser.png`,v}}else return`${w}/images/defaultUser.png`};return(v,w)=>(i(),m(T,null,{default:a(()=>[f("div",Pe,[e(Z,{size:"large"},{default:a(()=>[f("img",{src:V(N(g)),alt:"pro",width:"54"},null,8,ze)]),_:1}),e(ee,{class:"badg-dotDetail",dot:"",color:"success"}),f("div",null,[f("h5",Ae,c(N(r)),1),Ne])])]),_:1}))}};export{Oe as _,Fe as a};
