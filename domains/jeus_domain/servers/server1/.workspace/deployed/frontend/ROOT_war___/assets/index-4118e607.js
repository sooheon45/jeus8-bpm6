import{Y as Re,Z as Ce,ch as De,N as z,a2 as te,r as R,o as p,c as _,b as d,w as m,V as D,W as Ie,a7 as Ae,I as L,$ as k,a as u,t as b,J as g,F as V,i as T,e as A,cc as $e,h as w,d as Pe,P as x,aa as Fe,a1 as Ne,k as K,ci as Q}from"./index-7b37f28a.js";import{V as C}from"./VSheet-beabeb52.js";import{V as Me}from"./VBadge-0c68c2c9.js";const se=Re({id:"chat",state:()=>({chats:[],chatContent:1}),getters:{},actions:{async fetchChats(){try{const n=await Ce.get("/api/data/chat/ChatData");this.chats=n.data}catch(n){alert(n),console.log(n)}},SelectChat(n){this.chatContent=n},sendMsg(n,e){const s={id:n,msg:e,type:"text",attachments:[],createdAt:De(new Date,{seconds:1}),senderId:n};this.chats=this.chats.filter(t=>t.id===n?{...t,...t.chatHistory.push(s)}:t)}}}),ke=z({setup(n){const e=te(""),s=se();function t(i){console.log(i),i.length!==0&&(s.sendMsg(s.chatContent,e.value),e.value="")}return(i,r)=>{const l=R("MoodSmileIcon"),a=R("SendIcon"),o=R("PhotoIcon"),h=R("PaperclipIcon");return p(),_("form",{class:"d-flex align-center pa-4",onSubmit:r[1]||(r[1]=Ae(y=>t(e.value),["prevent"]))},[d(D,{icon:"",variant:"text",class:"text-medium-emphasis"},{default:m(()=>[d(l,{size:"24"})]),_:1}),d(Ie,{variant:"solo","hide-details":"",modelValue:e.value,"onUpdate:modelValue":r[0]||(r[0]=y=>e.value=y),color:"primary",class:"shadow-none",density:"compact",placeholder:"Type a Message"},null,8,["modelValue"]),d(D,{icon:"",variant:"text",type:"submit",class:"text-medium-emphasis",disabled:!e.value},{default:m(()=>[d(a,{size:"20"})]),_:1},8,["disabled"]),d(D,{icon:"",variant:"text",class:"text-medium-emphasis"},{default:m(()=>[d(o,{size:"20"})]),_:1}),d(D,{icon:"",variant:"text",class:"text-medium-emphasis"},{default:m(()=>[d(h,{size:"20"})]),_:1})],32)}}});const je={key:0,class:"pa-6"},Ve={class:"text-h6 mb-3"},Te={key:0},Oe=["src"],Ee={class:"text-h6 mb-3 mt-7"},He=["src"],Se={class:"pl-4"},Be={class:"text-subtitle-1 font-weight-semibold"},Le={class:"text-subtitle-2 mt-1"},xe=Pe(" No Attachments Found! "),ze=z({props:{chatDetail:Object},setup(n){const e=n,s=L(()=>{var i;return k.uniq(k.flatten((i=e.chatDetail)==null?void 0:i.chatHistory.map(r=>r.attachment))).length}),t=L(()=>{var i;return k.uniq(k.flatten((i=e.chatDetail)==null?void 0:i.chatHistory.map(r=>(r==null?void 0:r.type)==="img"?r.msg:null))).length-1});return(i,r)=>n.chatDetail?(p(),_("div",je,[u("h6",Ve,"Media ("+b(g(t))+")",1),(p(!0),_(V,null,T(n.chatDetail.chatHistory,l=>(p(),_("div",{key:l.id},[l.type=="img"?(p(),_("div",Te,[u("img",{src:l.msg,alt:"img",width:"100"},null,8,Oe)])):w("",!0)]))),128)),u("h6",Ee,"Attachments ("+b(g(s))+")",1),g(s)!=0?(p(),A(C,{key:0},{default:m(()=>[(p(!0),_(V,null,T(n.chatDetail.chatHistory,l=>(p(),_("div",{key:l.id},[(p(!0),_(V,null,T(l.attachment,a=>(p(),_("div",{class:"d-flex align-center mt-7",key:a.file},[d(x,{class:"rounded-md bg-lightsecondary",size:"48"},{default:m(()=>[u("img",{width:"24",alt:"file",src:a.icon},null,8,He)]),_:2},1024),u("div",Se,[u("h6",Be,b(a.file),1),u("h5",Le,b(a.fileSize),1)])]))),128))]))),128))]),_:1})):(p(),A(C,{key:1},{default:m(()=>[d($e,{color:"error",type:"warning",density:"compact",variant:"tonal",class:"text-subtitle-1"},{default:m(()=>[xe]),_:1})]),_:1}))])):w("",!0)}}),We={key:0,class:"customHeight"},qe={class:"d-flex align-center gap-3 pa-4 justify-space-between"},Ue={class:"d-flex gap-2 align-center"},Ye=["src"],Ge={class:"text-h5 mb-n1"},Je={class:"textPrimary"},Xe={class:"d-flex"},Ze={class:"d-flex"},Ke={class:"w-100",style:{height:"calc(100vh - 360px)"}},Qe={key:0,class:"justify-end d-flex text-end mb-1"},et={key:0,class:"text-medium-emphasis text-subtitle-2"},tt={class:"text-body-1"},st=["src"],it={key:1,class:"d-flex align-items-start gap-3 mb-1"},rt=["src"],nt={key:0,class:"text-medium-emphasis text-subtitle-2"},lt={class:"text-body-1"},at=["src"],ot={key:0,class:"right-sidebar"},Nt=z({setup(n){const{lgAndUp:e}=Fe(),s=se();Ne(()=>{s.fetchChats()});const t=L(()=>s.chats[s.chatContent-1]),i=te(!!e);function r(){i.value=!i.value}return(l,a)=>{const o=R("PhoneIcon"),h=R("VideoPlusIcon"),y=R("DotsVerticalIcon"),v=R("perfect-scrollbar");return g(t)?(p(),_("div",We,[u("div",null,[u("div",qe,[u("div",Ue,[d(x,null,{default:m(()=>[u("img",{src:g(t).thumb,alt:"pro",width:"50"},null,8,Ye)]),_:1}),d(Me,{class:"badg-dotDetail",dot:"",color:g(t).status==="away"?"warning":g(t).status==="busy"?"error":g(t).status==="online"?"success":"containerBg"},null,8,["color"]),u("div",null,[u("h5",Ge,b(g(t).name),1),u("small",Je,b(g(t).status),1)])]),u("div",Xe,[d(D,{icon:"",variant:"text",class:"text-medium-emphasis"},{default:m(()=>[d(o,{size:"24"})]),_:1}),d(D,{icon:"",variant:"text",class:"text-medium-emphasis"},{default:m(()=>[d(h,{size:"24"})]),_:1}),d(D,{icon:"",variant:"text",class:"text-medium-emphasis",onClick:r},{default:m(()=>[d(y,{size:"24"})]),_:1})])]),d(K),d(v,{class:"rightpartHeight h-100"},{default:m(()=>[u("div",Ze,[u("div",Ke,[(p(!0),_(V,null,T(g(t).chatHistory,c=>(p(),_("div",{key:c.id,class:"pa-5"},[g(t).id===c.senderId?(p(),_("div",Qe,[u("div",null,[c.createdAt?(p(),_("small",et,b(g(Q)(new Date(c.createdAt),{addSuffix:!1}))+" ago",1)):w("",!0),c.type=="text"?(p(),A(C,{key:1,class:"bg-lightprimary rounded-md px-3 py-2 mb-1"},{default:m(()=>[u("p",tt,b(c.msg),1)]),_:2},1024)):w("",!0),c.type=="img"?(p(),A(C,{key:2,class:"mb-1"},{default:m(()=>[u("img",{src:c.msg,class:"rounded-md",alt:"pro",width:"250"},null,8,st)]),_:2},1024)):w("",!0)])])):(p(),_("div",it,[d(x,null,{default:m(()=>[u("img",{src:g(t).thumb,alt:"pro",width:"40"},null,8,rt)]),_:1}),u("div",null,[c.createdAt?(p(),_("small",nt,b(g(t).name)+", "+b(g(Q)(new Date(c.createdAt),{addSuffix:!1}))+" ago ",1)):w("",!0),c.type=="text"?(p(),A(C,{key:1,class:"bg-lightsecondary rounded-md px-3 py-2 mb-1"},{default:m(()=>[u("p",lt,b(c.msg),1)]),_:2},1024)):w("",!0),c.type=="img"?(p(),A(C,{key:2,class:"mb-1"},{default:m(()=>[u("img",{src:c.msg,class:"rounded-md",alt:"pro",width:"250"},null,8,at)]),_:2},1024)):w("",!0)])]))]))),128))]),i.value?(p(),_("div",ot,[d(C,null,{default:m(()=>[d(ze,{chatDetail:g(t)},null,8,["chatDetail"])]),_:1})])):w("",!0)])]),_:1})]),d(K),d(ke)])):w("",!0)}}});class ft{constructor(e){this.selfOptions=e||{},this.pipes={}}options(e){return e&&(this.selfOptions=e),this.selfOptions}pipe(e,s){let t=s;if(typeof e=="string"){if(typeof t>"u")return this.pipes[e];this.pipes[e]=t}if(e&&e.name){if(t=e,t.processor===this)return t;this.pipes[t.name]=t}return t.processor=this,t}process(e,s){let t=e;t.options=this.options();let i=s||e.pipe||"default",r;for(;i;)typeof t.nextAfterChildren<"u"&&(t.next=t.nextAfterChildren,t.nextAfterChildren=null),typeof i=="string"&&(i=this.pipe(i)),i.process(t),r=i,i=null,t&&t.next&&(t=t.next,i=t.pipe||r);return t.hasResult?t.result:void 0}}const ht=ft;class ct{constructor(e){this.name=e,this.filters=[]}process(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");const s=this.debug,t=this.filters.length,i=e;for(let r=0;r<t;r++){const l=this.filters[r];if(s&&this.log(`filter: ${l.filterName}`),l(i),typeof i=="object"&&i.exiting){i.exiting=!1;break}}!i.next&&this.resultCheck&&this.resultCheck(i)}log(e){console.log(`[jsondiffpatch] ${this.name} pipe, ${e}`)}append(...e){return this.filters.push(...e),this}prepend(...e){return this.filters.unshift(...e),this}indexOf(e){if(!e)throw new Error("a filter name is required");for(let s=0;s<this.filters.length;s++)if(this.filters[s].filterName===e)return s;throw new Error(`filter not found: ${e}`)}list(){return this.filters.map(e=>e.filterName)}after(e,...s){const t=this.indexOf(e);return this.filters.splice(t+1,0,...s),this}before(e,...s){const t=this.indexOf(e);return this.filters.splice(t,0,...s),this}replace(e,...s){const t=this.indexOf(e);return this.filters.splice(t,1,...s),this}remove(e){const s=this.indexOf(e);return this.filters.splice(s,1),this}clear(){return this.filters.length=0,this}shouldHaveResult(e){if(e===!1){this.resultCheck=null;return}if(!this.resultCheck)return this.resultCheck=s=>{if(!s.hasResult){console.log(s);const t=new Error(`${this.name} failed`);throw t.noResult=!0,t}},this}}const S=ct;class W{setResult(e){return this.result=e,this.hasResult=!0,this}exit(){return this.exiting=!0,this}push(e,s){return e.parent=this,typeof s<"u"&&(e.childName=s),e.root=this.root||this,e.options=e.options||this.options,this.children?(this.children[this.children.length-1].next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this}}function dt(n){const e=/^\/(.*)\/([gimyu]*)$/.exec(n.toString());return new RegExp(e[1],e[2])}function O(n){if(typeof n!="object")return n;if(n===null)return null;if(Array.isArray(n))return n.map(O);if(n instanceof Date)return new Date(n.getTime());if(n instanceof RegExp)return dt(n);const e={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=O(n[s]));return e}class ut extends W{constructor(e,s){super(),this.left=e,this.right=s,this.pipe="diff"}setResult(e){if(this.options.cloneDiffValues&&typeof e=="object"){const s=typeof this.options.cloneDiffValues=="function"?this.options.cloneDiffValues:O;typeof e[0]=="object"&&(e[0]=s(e[0])),typeof e[1]=="object"&&(e[1]=s(e[1]))}return super.setResult(e)}}const I=ut;class pt extends W{constructor(e,s){super(),this.left=e,this.delta=s,this.pipe="patch"}}const q=pt;class mt extends W{constructor(e){super(),this.delta=e,this.pipe="reverse"}}const U=mt,ie=function(e){if(e.left===e.right){e.setResult(void 0).exit();return}if(typeof e.left>"u"){if(typeof e.right=="function")throw new Error("functions are not supported");e.setResult([e.right]).exit();return}if(typeof e.right>"u"){e.setResult([e.left,0,0]).exit();return}if(typeof e.left=="function"||typeof e.right=="function")throw new Error("functions are not supported");if(e.leftType=e.left===null?"null":typeof e.left,e.rightType=e.right===null?"null":typeof e.right,e.leftType!==e.rightType){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="boolean"||e.leftType==="number"){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="object"&&(e.leftIsArray=Array.isArray(e.left)),e.rightType==="object"&&(e.rightIsArray=Array.isArray(e.right)),e.leftIsArray!==e.rightIsArray){e.setResult([e.left,e.right]).exit();return}e.left instanceof RegExp&&(e.right instanceof RegExp?e.setResult([e.left.toString(),e.right.toString()]).exit():e.setResult([e.left,e.right]).exit())};ie.filterName="trivial";const re=function(e){if(typeof e.delta>"u"){e.setResult(e.left).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const s=e.delta;if(s.length===1){e.setResult(s[0]).exit();return}if(s.length===2){if(e.left instanceof RegExp){const t=/^\/(.*)\/([gimyu]+)$/.exec(s[1]);if(t){e.setResult(new RegExp(t[1],t[2])).exit();return}}e.setResult(s[1]).exit();return}s.length===3&&s[2]===0&&e.setResult(void 0).exit()};re.filterName="trivial";const ne=function(e){if(typeof e.delta>"u"){e.setResult(e.delta).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const s=e.delta;if(s.length===1){e.setResult([s[0],0,0]).exit();return}if(s.length===2){e.setResult([s[1],s[0]]).exit();return}s.length===3&&s[2]===0&&e.setResult([s[0]]).exit()};ne.filterName="trivial";const le=n=>{if(!n||!n.children)return;const e=n.children.length;let s,t=n.result;for(let i=0;i<e;i++)s=n.children[i],!(typeof s.result>"u")&&(t=t||{},t[s.childName]=s.result);t&&n.leftIsArray&&(t._t="a"),n.setResult(t).exit()};le.filterName="collectChildren";const ae=n=>{if(n.leftIsArray||n.leftType!=="object")return;const e=n.left,s=n.right;let t,i;const r=n.options.propertyFilter;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r&&!r(t,n)||(i=new I(e[t],s[t]),n.push(i,t)));for(t in s)Object.prototype.hasOwnProperty.call(s,t)&&(r&&!r(t,n)||typeof e[t]>"u"&&(i=new I(void 0,s[t]),n.push(i,t)));if(!n.children||n.children.length===0){n.setResult(void 0).exit();return}n.exit()};ae.filterName="objects";const oe=function(e){if(!e.nested)return;const s=e.delta;if(s._t)return;const t=s;let i,r;for(i in t)r=new q(e.left[i],t[i]),e.push(r,i);e.exit()};oe.filterName="objects";const fe=function(e){if(!e||!e.children||e.delta._t)return;const t=e.left,i=e.children.length;let r;for(let l=0;l<i;l++){r=e.children[l];const a=r.childName;Object.prototype.hasOwnProperty.call(e.left,a)&&r.result===void 0?delete t[a]:t[a]!==r.result&&(t[a]=r.result)}e.setResult(t).exit()};fe.filterName="collectChildren";const he=function(e){if(!e.nested||e.delta._t)return;const t=e.delta;let i,r;for(i in t)r=new U(t[i]),e.push(r,i);e.exit()};he.filterName="objects";const ce=n=>{if(!n||!n.children||n.delta._t)return;const s=n.children.length;let t;const i={};for(let r=0;r<s;r++){t=n.children[r];const l=t.childName;i[l]!==t.result&&(i[l]=t.result)}n.setResult(i).exit()};ce.filterName="collectChildren";const yt=function(n,e,s,t){return n[s]===e[t]},gt=function(n,e,s,t){const i=n.length,r=e.length;let l,a;const o=new Array(i+1);for(l=0;l<i+1;l++)for(o[l]=new Array(r+1),a=0;a<r+1;a++)o[l][a]=0;for(o.match=s,l=1;l<i+1;l++)for(a=1;a<r+1;a++)s(n,e,l-1,a-1,t)?o[l][a]=o[l-1][a-1]+1:o[l][a]=Math.max(o[l-1][a],o[l][a-1]);return o},_t=function(n,e,s,t){let i=e.length,r=s.length;const l={sequence:[],indices1:[],indices2:[]};for(;i!==0&&r!==0;)if(n.match(e,s,i-1,r-1,t))l.sequence.unshift(e[i-1]),l.indices1.unshift(i-1),l.indices2.unshift(r-1),--i,--r;else{const o=n[i][r-1],h=n[i-1][r];o>h?--r:--i}return l},vt=function(n,e,s,t){const i=t||{},r=gt(n,e,s||yt,i);return _t(r,n,e,i)},bt={get:vt},$=3;function wt(n,e,s,t){for(let i=0;i<s;i++){const r=n[i];for(let l=0;l<t;l++){const a=e[l];if(i!==l&&r===a)return!0}}}function j(n,e,s,t,i){const r=n[s],l=e[t];if(r===l)return!0;if(typeof r!="object"||typeof l!="object")return!1;const a=i.objectHash;if(!a)return i.matchByPosition&&s===t;i.hashCache1=i.hashCache1||[];let o=i.hashCache1[s];if(typeof o>"u"&&(i.hashCache1[s]=o=a(r,s)),typeof o>"u")return!1;i.hashCache2=i.hashCache2||[];let h=i.hashCache2[t];return typeof h>"u"&&(i.hashCache2[t]=h=a(l,t)),typeof h>"u"?!1:o===h}const de=function(e){if(!e.leftIsArray)return;const s={objectHash:e.options&&e.options.objectHash,matchByPosition:e.options&&e.options.matchByPosition};let t=0,i=0,r,l,a;const o=e.left,h=e.right,y=o.length,v=h.length;let c;for(y>0&&v>0&&!s.objectHash&&typeof s.matchByPosition!="boolean"&&(s.matchByPosition=!wt(o,h,y,v));t<y&&t<v&&j(o,h,t,t,s);)r=t,c=new I(o[r],h[r]),e.push(c,r),t++;for(;i+t<y&&i+t<v&&j(o,h,y-1-i,v-1-i,s);)l=y-1-i,a=v-1-i,c=new I(o[l],h[a]),e.push(c,a),i++;let f;if(t+i===y){if(y===v){e.setResult(void 0).exit();return}for(f=f||{_t:"a"},r=t;r<v-i;r++)f[r]=[h[r]];e.setResult(f).exit();return}if(t+i===v){for(f=f||{_t:"a"},r=t;r<y-i;r++)f[`_${r}`]=[o[r],0,0];e.setResult(f).exit();return}delete s.hashCache1,delete s.hashCache2;const P=o.slice(t,y-i),Y=h.slice(t,v-i),F=bt.get(P,Y,j,s),N=[];for(f=f||{_t:"a"},r=t;r<y-i;r++)F.indices1.indexOf(r-t)<0&&(f[`_${r}`]=[o[r],0,0],N.push(r));let G=!0;e.options&&e.options.arrays&&e.options.arrays.detectMove===!1&&(G=!1);let J=!1;e.options&&e.options.arrays&&e.options.arrays.includeValueOnMove&&(J=!0);const X=N.length;for(r=t;r<v-i;r++){const H=F.indices2.indexOf(r-t);if(H<0){let Z=!1;if(G&&X>0){for(let M=0;M<X;M++)if(l=N[M],j(P,Y,l-t,r-t,s)){f[`_${l}`].splice(1,2,r,$),J||(f[`_${l}`][0]=""),a=r,c=new I(o[l],h[a]),e.push(c,a),N.splice(M,1),Z=!0;break}}Z||(f[r]=[h[r]])}else l=F.indices1[H]+t,a=F.indices2[H]+t,c=new I(o[l],h[a]),e.push(c,a)}e.setResult(f).exit()};de.filterName="arrays";const ee={numerically(n,e){return n-e},numericallyBy(n){return(e,s)=>e[n]-s[n]}},ue=function(e){if(!e.nested)return;const s=e.delta;if(s._t!=="a")return;let t,i;const r=s,l=e.left;let a=[],o=[];const h=[];for(t in r)if(t!=="_t")if(t[0]==="_"){const f=t;if(r[f][2]===0||r[f][2]===$)a.push(parseInt(t.slice(1),10));else throw new Error(`only removal or move can be applied at original array indices, invalid diff type: ${r[f][2]}`)}else{const f=t;r[f].length===1?o.push({index:parseInt(f,10),value:r[f][0]}):h.push({index:parseInt(f,10),delta:r[f]})}for(a=a.sort(ee.numerically),t=a.length-1;t>=0;t--){i=a[t];const f=r[`_${i}`],P=l.splice(i,1)[0];f[2]===$&&o.push({index:f[1],value:P})}o=o.sort(ee.numericallyBy("index"));const y=o.length;for(t=0;t<y;t++){const f=o[t];l.splice(f.index,0,f.value)}const v=h.length;let c;if(v>0)for(t=0;t<v;t++){const f=h[t];c=new q(l[f.index],f.delta),e.push(c,f.index)}if(!e.children){e.setResult(l).exit();return}e.exit()};ue.filterName="arrays";const pe=function(e){if(!e||!e.children||e.delta._t!=="a")return;const t=e.left,i=e.children.length;let r;for(let l=0;l<i;l++){r=e.children[l];const a=r.childName;t[a]=r.result}e.setResult(t).exit()};pe.filterName="arraysCollectChildren";const me=function(e){if(!e.nested){const l=e.delta;if(l[2]===$){const a=l;e.newName=`_${a[1]}`,e.setResult([a[0],parseInt(e.childName.substring(1),10),$]).exit()}return}const s=e.delta;if(s._t!=="a")return;const t=s;let i,r;for(i in t)i!=="_t"&&(r=new U(t[i]),e.push(r,i));e.exit()};me.filterName="arrays";const Rt=(n,e,s)=>{if(typeof e=="string"&&e[0]==="_")return parseInt(e.substring(1),10);if(Array.isArray(s)&&s[2]===0)return`_${e}`;let t=+e;for(const i in n){const r=n[i];if(Array.isArray(r))if(r[2]===$){const l=parseInt(i.substring(1),10),a=r[1];if(a===+e)return l;l<=t&&a>t?t++:l>=t&&a<t&&t--}else r[2]===0?parseInt(i.substring(1),10)<=t&&t++:r.length===1&&parseInt(i,10)<=t&&t--}return t},ye=n=>{if(!n||!n.children)return;const e=n.delta;if(e._t!=="a")return;const s=e,t=n.children.length;let i;const r={_t:"a"};for(let l=0;l<t;l++){i=n.children[l];let a=i.newName;typeof a>"u"&&(a=Rt(s,i.childName,i.result)),r[a]!==i.result&&(r[a]=i.result)}n.setResult(r).exit()};ye.filterName="arraysCollectChildren";const ge=function(e){e.left instanceof Date?(e.right instanceof Date?e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0):e.setResult([e.left,e.right]),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()};ge.filterName="dates";const E=2,Ct=60;let B=null;function _e(n,e){var s;if(!B){let t;if(!((s=n==null?void 0:n.textDiff)===null||s===void 0)&&s.diffMatchPatch)t=new n.textDiff.diffMatchPatch;else{if(!e)return null;const i=new Error("The diff-match-patch library was not provided. Pass the library in through the options or use the `jsondiffpatch/with-text-diffs` entry-point.");throw i.diff_match_patch_not_found=!0,i}B={diff:function(i,r){return t.patch_toText(t.patch_make(i,r))},patch:function(i,r){const l=t.patch_apply(t.patch_fromText(r),i);for(let a=0;a<l[1].length;a++)if(!l[1][a]){const o=new Error("text patch failed");o.textPatchFailed=!0}return l[0]}}}return B}const ve=function(e){if(e.leftType!=="string")return;const s=e.left,t=e.right,i=e.options&&e.options.textDiff&&e.options.textDiff.minLength||Ct;if(s.length<i||t.length<i){e.setResult([s,t]).exit();return}const r=_e(e.options);if(!r){e.setResult([s,t]).exit();return}const l=r.diff;e.setResult([l(s,t),0,E]).exit()};ve.filterName="texts";const be=function(e){if(e.nested)return;const s=e.delta;if(s[2]!==E)return;const t=s,i=_e(e.options,!0).patch;e.setResult(i(e.left,t[0])).exit()};be.filterName="texts";const Dt=function(n){let e,s,t,i,r=null;const l=/^@@ +-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;let a;const o=n.split(`
`);for(e=0,s=o.length;e<s;e++){t=o[e];const h=t.slice(0,1);h==="@"?(r=l.exec(t),a=e,o[a]="@@ -"+r[3]+","+r[4]+" +"+r[1]+","+r[2]+" @@"):h==="+"?(o[e]="-"+o[e].slice(1),o[e-1].slice(0,1)==="+"&&(i=o[e],o[e]=o[e-1],o[e-1]=i)):h==="-"&&(o[e]="+"+o[e].slice(1))}return o.join(`
`)},we=function(e){if(e.nested)return;const s=e.delta;if(s[2]!==E)return;const t=s;e.setResult([Dt(t[0]),0,E]).exit()};we.filterName="texts";class It{constructor(e){this.processor=new ht(e),this.processor.pipe(new S("diff").append(le,ie,ge,ve,ae,de).shouldHaveResult()),this.processor.pipe(new S("patch").append(fe,pe,re,be,oe,ue).shouldHaveResult()),this.processor.pipe(new S("reverse").append(ce,ye,ne,we,he,me).shouldHaveResult())}options(e){return this.processor.options(e)}diff(e,s){return this.processor.process(new I(e,s))}patch(e,s){return this.processor.process(new q(e,s))}reverse(e){return this.processor.process(new U(e))}unpatch(e,s){return this.patch(e,this.reverse(s))}clone(e){return O(e)}}const At=It;function Mt(n){return new At(n)}export{Nt as _,Mt as c};
