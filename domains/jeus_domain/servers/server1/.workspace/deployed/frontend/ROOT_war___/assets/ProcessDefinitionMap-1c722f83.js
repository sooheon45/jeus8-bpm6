import{bM as $e,_ as Q,bN as Ae,B as ne,r as M,o as a,c as m,b as o,w as i,f as x,U as Ve,d as $,t as B,m as be,e as h,h as b,bf as Ne,W as ye,b7 as we,V as A,X as he,ao as H,E as L,D as z,Q as F,R as de,bl as De,a7 as le,a as d,g as xe,F as X,i as J,b8 as Pe,aS as re,S as Ue,H as Le,C as ze,a0 as Oe,K as _e,A as Re}from"./index-7b37f28a.js";import{P as Fe,D as He,a as Ge}from"./ProcessDefinition-8367c465.js";import{P as Xe}from"./ProcessExecuteDialog-e186abe1.js";import Je from"./ProcessDefinitionChat-45490f52.js";import"./index-5e2cd834.js";import"./hooks.module-5c2ff6dd.js";import"./AppBaseCard.vue_vue_type_style_index_0_lang-764d25b8.js";import"./WorkItem-328dcf85.js";import"./DefaultForm-027b9cf9.js";import"./Chat-127d4b0d.js";import"./chat-icon-2658168f.js";import"./VSheet-beabeb52.js";import"./DynamicForm-9e8c830e.js";import"./customizer-3521e2ce.js";import"./VDatePicker-b7697b5c.js";import"./index-8f33dbb8.js";import"./OrganizationChart-bfb9b6f3.js";import"./ProcessDefinitionGenerator-5040ccf8.js";import"./FormDesignGenerator-cf42b57e.js";import"./FormDefinitionModule-1faf025f.js";import"./VSlider-11543daf.js";import"./index-4118e607.js";import"./VBadge-0c68c2c9.js";import"./ChatProfile-ae681fa1.js";var Ee={exports:{}};(function(e){(function(s){var t=Te(),r=je(),l=Be(),n=Ie(),c={imagePlaceholder:void 0,cacheBust:!1},g={toSvg:v,toPng:k,toJpeg:I,toBlob:fe,toPixelData:N,impl:{fontFaces:l,images:n,util:t,inliner:r,options:{}}};e.exports=g;function v(f,p){return p=p||{},T(p),Promise.resolve(f).then(function(P){return ke(P,p.filter,!0)}).then(Ce).then(Me).then(y).then(function(P){return Se(P,p.width||t.width(f),p.height||t.height(f))});function y(P){return p.bgcolor&&(P.style.backgroundColor=p.bgcolor),p.width&&(P.style.width=p.width+"px"),p.height&&(P.style.height=p.height+"px"),p.style&&Object.keys(p.style).forEach(function(C){P.style[C]=p.style[C]}),P}}function N(f,p){return Y(f,p||{}).then(function(y){return y.getContext("2d").getImageData(0,0,t.width(f),t.height(f)).data})}function k(f,p){return Y(f,p||{}).then(function(y){return y.toDataURL()})}function I(f,p){return p=p||{},Y(f,p).then(function(y){return y.toDataURL("image/jpeg",p.quality||1)})}function fe(f,p){return Y(f,p||{}).then(t.canvasToBlob)}function T(f){typeof f.imagePlaceholder>"u"?g.impl.options.imagePlaceholder=c.imagePlaceholder:g.impl.options.imagePlaceholder=f.imagePlaceholder,typeof f.cacheBust>"u"?g.impl.options.cacheBust=c.cacheBust:g.impl.options.cacheBust=f.cacheBust}function Y(f,p){return v(f,p).then(t.makeImage).then(t.delay(100)).then(function(P){var C=y(f);return C.getContext("2d").drawImage(P,0,0),C});function y(P){var C=document.createElement("canvas");if(C.width=p.width||t.width(P),C.height=p.height||t.height(P),p.bgcolor){var E=C.getContext("2d");E.fillStyle=p.bgcolor,E.fillRect(0,0,C.width,C.height)}return C}}function ke(f,p,y){if(!y&&p&&!p(f))return Promise.resolve();return Promise.resolve(f).then(P).then(function(_){return C(f,_,p)}).then(function(_){return E(f,_)});function P(_){return _ instanceof HTMLCanvasElement?t.makeImage(_.toDataURL()):_.cloneNode(!1)}function C(_,D,R){var K=_.childNodes;if(K.length===0)return Promise.resolve(D);return V(D,t.asArray(K),R).then(function(){return D});function V(ae,G,U){var Z=Promise.resolve();return G.forEach(function(oe){Z=Z.then(function(){return ke(oe,U)}).then(function(q){q&&ae.appendChild(q)})}),Z}}function E(_,D){if(!(D instanceof Element))return D;return Promise.resolve().then(R).then(K).then(V).then(ae).then(function(){return D});function R(){G(window.getComputedStyle(_),D.style);function G(U,Z){U.cssText?Z.cssText=U.cssText:oe(U,Z);function oe(q,ee){t.asArray(q).forEach(function(u){ee.setProperty(u,q.getPropertyValue(u),q.getPropertyPriority(u))})}}}function K(){[":before",":after"].forEach(function(U){G(U)});function G(U){var Z=window.getComputedStyle(_,U),oe=Z.getPropertyValue("content");if(oe===""||oe==="none")return;var q=t.uid();D.className=D.className+" "+q;var ee=document.createElement("style");ee.appendChild(u(q,U,Z)),D.appendChild(ee);function u(w,j,S){var O="."+w+":"+j,W=S.cssText?ge(S):ve(S);return document.createTextNode(O+"{"+W+"}");function ge(te){var se=te.getPropertyValue("content");return te.cssText+" content: "+se+";"}function ve(te){return t.asArray(te).map(se).join("; ")+";";function se(ce){return ce+": "+te.getPropertyValue(ce)+(te.getPropertyPriority(ce)?" !important":"")}}}}}function V(){_ instanceof HTMLTextAreaElement&&(D.innerHTML=_.value),_ instanceof HTMLInputElement&&D.setAttribute("value",_.value)}function ae(){D instanceof SVGElement&&(D.setAttribute("xmlns","http://www.w3.org/2000/svg"),D instanceof SVGRectElement&&["width","height"].forEach(function(G){var U=D.getAttribute(G);U&&D.style.setProperty(G,U)}))}}}function Ce(f){return l.resolveAll().then(function(p){var y=document.createElement("style");return f.appendChild(y),y.appendChild(document.createTextNode(p)),f})}function Me(f){return n.inlineAll(f).then(function(){return f})}function Se(f,p,y){return Promise.resolve(f).then(function(P){return P.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(P)}).then(t.escapeXhtml).then(function(P){return'<foreignObject x="0" y="0" width="100%" height="100%">'+P+"</foreignObject>"}).then(function(P){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+p+'" height="'+y+'">'+P+"</svg>"}).then(function(P){return"data:image/svg+xml;charset=utf-8,"+P})}function Te(){return{escape:ae,parseExtension:p,mimeType:y,dataAsUrl:V,isDataUrl:P,canvasToBlob:E,resolveUrl:_,getAndEncode:K,uid:D(),delay:G,asArray:U,escapeXhtml:Z,makeImage:R,width:oe,height:q};function f(){var u="application/font-woff",w="image/jpeg";return{woff:u,woff2:u,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:w,jpeg:w,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function p(u){var w=/\.([^\.\/]*?)$/g.exec(u);return w?w[1]:""}function y(u){var w=p(u).toLowerCase();return f()[w]||""}function P(u){return u.search(/^(data:)/)!==-1}function C(u){return new Promise(function(w){for(var j=window.atob(u.toDataURL().split(",")[1]),S=j.length,O=new Uint8Array(S),W=0;W<S;W++)O[W]=j.charCodeAt(W);w(new Blob([O],{type:"image/png"}))})}function E(u){return u.toBlob?new Promise(function(w){u.toBlob(w)}):C(u)}function _(u,w){var j=document.implementation.createHTMLDocument(),S=j.createElement("base");j.head.appendChild(S);var O=j.createElement("a");return j.body.appendChild(O),S.href=w,O.href=u,O.href}function D(){var u=0;return function(){return"u"+w()+u++;function w(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function R(u){return new Promise(function(w,j){var S=new Image;S.onload=function(){w(S)},S.onerror=j,S.src=u})}function K(u){var w=3e4;return g.impl.options.cacheBust&&(u+=(/\?/.test(u)?"&":"?")+new Date().getTime()),new Promise(function(j){var S=new XMLHttpRequest;S.onreadystatechange=ge,S.ontimeout=ve,S.responseType="blob",S.timeout=w,S.open("GET",u,!0),S.send();var O;if(g.impl.options.imagePlaceholder){var W=g.impl.options.imagePlaceholder.split(/,/);W&&W[1]&&(O=W[1])}function ge(){if(S.readyState===4){if(S.status!==200){O?j(O):te("cannot fetch resource: "+u+", status: "+S.status);return}var se=new FileReader;se.onloadend=function(){var ce=se.result.split(/,/)[1];j(ce)},se.readAsDataURL(S.response)}}function ve(){O?j(O):te("timeout of "+w+"ms occured while fetching resource: "+u)}function te(se){console.error(se),j("")}})}function V(u,w){return"data:"+w+";base64,"+u}function ae(u){return u.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function G(u){return function(w){return new Promise(function(j){setTimeout(function(){j(w)},u)})}}function U(u){for(var w=[],j=u.length,S=0;S<j;S++)w.push(u[S]);return w}function Z(u){return u.replace(/#/g,"%23").replace(/\n/g,"%0A")}function oe(u){var w=ee(u,"border-left-width"),j=ee(u,"border-right-width");return u.scrollWidth+w+j}function q(u){var w=ee(u,"border-top-width"),j=ee(u,"border-bottom-width");return u.scrollHeight+w+j}function ee(u,w){var j=window.getComputedStyle(u).getPropertyValue(w);return parseFloat(j.replace("px",""))}}function je(){var f=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:C,shouldProcess:p,impl:{readUrls:y,inline:P}};function p(E){return E.search(f)!==-1}function y(E){for(var _=[],D;(D=f.exec(E))!==null;)_.push(D[1]);return _.filter(function(R){return!t.isDataUrl(R)})}function P(E,_,D,R){return Promise.resolve(_).then(function(V){return D?t.resolveUrl(V,D):V}).then(R||t.getAndEncode).then(function(V){return t.dataAsUrl(V,t.mimeType(_))}).then(function(V){return E.replace(K(_),"$1"+V+"$3")});function K(V){return new RegExp(`(url\\(['"]?)(`+t.escape(V)+`)(['"]?\\))`,"g")}}function C(E,_,D){if(R())return Promise.resolve(E);return Promise.resolve(E).then(y).then(function(K){var V=Promise.resolve(E);return K.forEach(function(ae){V=V.then(function(G){return P(G,ae,_,D)})}),V});function R(){return!p(E)}}}function Be(){return{resolveAll:f,impl:{readAll:p}};function f(){return p().then(function(y){return Promise.all(y.map(function(P){return P.resolve()}))}).then(function(y){return y.join(`
`)})}function p(){return Promise.resolve(t.asArray(document.styleSheets)).then(P).then(y).then(function(E){return E.map(C)});function y(E){return E.filter(function(_){return _.type===CSSRule.FONT_FACE_RULE}).filter(function(_){return r.shouldProcess(_.style.getPropertyValue("src"))})}function P(E){var _=[];return E.forEach(function(D){try{t.asArray(D.cssRules||[]).forEach(_.push.bind(_))}catch(R){console.log("Error while reading CSS rules from "+D.href,R.toString())}}),_}function C(E){return{resolve:function(){var D=(E.parentStyleSheet||{}).href;return r.inlineAll(E.cssText,D)},src:function(){return E.style.getPropertyValue("src")}}}}}function Ie(){return{inlineAll:p,impl:{newImage:f}};function f(y){return{inline:P};function P(C){return t.isDataUrl(y.src)?Promise.resolve():Promise.resolve(y.src).then(C||t.getAndEncode).then(function(E){return t.dataAsUrl(E,t.mimeType(y.src))}).then(function(E){return new Promise(function(_,D){y.onload=_,y.onerror=D,y.src=E})})}}function p(y){if(!(y instanceof Element))return Promise.resolve(y);return P(y).then(function(){return y instanceof HTMLImageElement?f(y).inline():Promise.all(t.asArray(y.childNodes).map(function(C){return p(C)}))});function P(C){var E=C.style.getPropertyValue("background");return E?r.inlineAll(E).then(function(_){C.style.setProperty("background",_,C.style.getPropertyPriority("background"))}).then(function(){return C}):Promise.resolve(C)}}}})()})(Ee);var Ze=Ee.exports;const qe=$e(Ze),Ke={components:{ProcessDefinitionDisplay:Ae},props:{process:Object,enableEdit:Boolean,type:String,processDialogStatus:Boolean,processType:String,subProcessDialogStauts:Boolean},data:()=>({newProcess:{id:"",name:""},isNewDef:!1,definitions:null}),mounted(){this.processDialogStatus&&this.processType=="update"&&(this.newProcess.id=this.process.id,this.newProcess.name=this.process.name)},computed:{addType(){if(this.type=="map")return"mega";if(this.type=="mega")return"major";if(this.type=="major")return"sub"}},watch:{isNewDef(e){},processDialogStatus(e){e&&(this.processType=="add"||this.processType=="update"&&(this.newProcess.id=this.process.id,this.newProcess.name=this.process.name))}},created(){this.init()},methods:{async init(){const e=ne.createBackend();if(this.addType=="sub"){const s=await e.listDefinition();s&&s.length>0?this.definitions=s.map(t=>({...t,id:t.id?t.id:t.path.split(".")[0]})):this.definitions=null}},closeDialog(){this.isNewDef=!1,this.$emit("closeProcessDialog")},addProcess(){this.newProcess.name!=""&&(this.$emit("add",this.newProcess),this.addType==="sub"&&this.closeDialog())},updateProcess(){this.newProcess.id!=""&&(this.$emit("edit",this.newProcess),this.closeDialog())}}},We={key:0},Qe=$("저장"),Ye=$("닫기"),et={key:0},tt={"max-width":"500"};function st(e,s,t,r,l,n){const c=M("ProcessDefinitionDisplay"),g=M("Icons");return t.enableEdit?(a(),m("div",We,[o(he,{modelValue:t.subProcessDialogStauts,"onUpdate:modelValue":s[5]||(s[5]=v=>t.subProcessDialogStauts=v),"max-width":"500"},{default:i(()=>[o(x,null,{default:i(()=>[o(Ve,null,{default:i(()=>[$(B(n.addType.toUpperCase())+" 프로세스 추가 ",1)]),_:1}),o(be,null,{default:i(()=>[n.addType=="sub"&&!e.isNewDef&&e.definitions?(a(),h(c,{key:0,modelValue:e.newProcess,"onUpdate:modelValue":s[0]||(s[0]=v=>e.newProcess=v),"file-extensions":[".bpmn"],options:{label:"프로세스 정의",returnObject:!0}},null,8,["modelValue","file-extensions"])):b("",!0),n.addType=="sub"?(a(),h(Ne,{key:1,modelValue:e.isNewDef,"onUpdate:modelValue":s[1]||(s[1]=v=>e.isNewDef=v),class:"cp-custom-sub",label:"새로운 프로세스 정의 추가",color:"primary",density:"compact"},null,8,["modelValue"])):b("",!0),n.addType!="sub"||e.isNewDef?(a(),h(ye,{key:2,modelValue:e.newProcess.name,"onUpdate:modelValue":s[2]||(s[2]=v=>e.newProcess.name=v),class:"cp-process-name",label:"프로세스명"},null,8,["modelValue"])):b("",!0)]),_:1}),o(we,{class:"justify-center"},{default:i(()=>[o(A,{color:"primary",variant:"flat",class:"cp-process-save",disabled:e.isNewDef?e.newProcess.id==""&&e.newProcess.name=="":!1,onClick:s[3]||(s[3]=v=>n.addProcess())},{default:i(()=>[Qe]),_:1},8,["disabled"]),o(A,{color:"error",variant:"flat",onClick:s[4]||(s[4]=v=>n.closeDialog())},{default:i(()=>[Ye]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.processType==="add"&&!t.subProcessDialogStauts?(a(),m("div",et,[o(F,{class:"ma-0 pa-0",align:"center"},{default:i(()=>[o(H,{class:"ma-0 pa-0",cols:"12"},{default:i(()=>[n.addType=="sub"&&!e.isNewDef?(a(),h(F,{key:0,justify:"end",class:"ma-0 pa-0"},{default:i(()=>[o(L,{text:"닫기"},{activator:i(({props:v})=>[o(A,z({onClick:s[6]||(s[6]=N=>n.closeDialog()),icon:""},v,{density:"compact",size:"small"}),{default:i(()=>[o(g,{icon:"close",width:12,height:12})]),_:2},1040)]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}),e.isNewDef||n.addType==="mega"||n.addType==="major"?(a(),h(F,{key:0,justify:"end",class:"ma-0 pa-0",style:{"margin-top":"-22px !important"}},{default:i(()=>[o(de),o(L,{text:"닫기"},{activator:i(({props:v})=>[o(A,z({onClick:s[7]||(s[7]=N=>n.closeDialog()),icon:""},v,{density:"compact",size:"small"}),{default:i(()=>[o(g,{icon:"close",width:12,height:12})]),_:2},1040)]),_:1}),o(H,{cols:"12",class:"ma-0 pa-0"},{default:i(()=>[o(ye,{class:"cp-process-id",modelValue:e.newProcess.name,"onUpdate:modelValue":s[8]||(s[8]=v=>e.newProcess.name=v),label:`${n.addType.toUpperCase()} 프로세스 추가`,autofocus:"",onKeypress:s[9]||(s[9]=De(v=>n.addProcess(),["enter"])),onClick:s[10]||(s[10]=le(()=>{},["stop"]))},null,8,["modelValue","label"])]),_:1})]),_:1})):b("",!0)])):b("",!0),t.processType==="update"?(a(),h(F,{key:1,justify:"end",class:"ma-0 pa-0"},{default:i(()=>[o(de),o(L,{text:"닫기"},{activator:i(({props:v})=>[o(A,z({onClick:s[11]||(s[11]=le(N=>n.closeDialog(),["stop"])),icon:""},v,{density:"compact",size:"small"}),{default:i(()=>[o(g,{icon:"close",width:12,height:12})]),_:2},1040)]),_:1}),o(H,{cols:"12",class:"ma-0 pa-0"},{default:i(()=>[d("div",tt,[o(ye,{class:"delete-input-details",modelValue:e.newProcess.name,"onUpdate:modelValue":s[12]||(s[12]=v=>e.newProcess.name=v),autofocus:"",label:"프로세스 수정",onKeypress:De(n.updateProcess,["enter"]),onClick:s[13]||(s[13]=le(()=>{},["stop"]))},null,8,["modelValue","onKeypress"])])]),_:1})]),_:1})):b("",!0)])):b("",!0)}const ue=Q(Ke,[["render",st]]),ot={components:{ProcessDialog:ue},props:{size:Number,type:String,process:Object,enableEdit:Boolean},data:()=>({newProcess:{id:"",label:""},processDialogStatus:!1,processType:""}),computed:{addType(){if(this.type=="map")return"mega";if(this.type=="mega")return"major";if(this.type=="major")return"sub"}},watch:{},created(){},methods:{openEditDialog(e){this.$emit("editProcessdialog",e)},deleteProcess(){this.$emit("delete")},editProcess(){this.$emit("modeling")}}},it={key:0,class:"proc-menu-btn-box"};function nt(e,s,t,r,l,n){const c=M("Icons");return a(),m("div",null,[o(F,{class:"ma-0 pa-0"},{default:i(()=>[o(de),t.enableEdit?(a(),m("div",it,[t.type=="sub"?(a(),h(L,{key:0,text:"프로세스 편집"},{activator:i(({props:g})=>[o(A,z({onClick:le(n.editProcess,["stop"]),icon:""},g,{density:"compact",size:"small"}),{default:i(()=>[o(c,{icon:"pencil-cog",width:12,height:12})]),_:2},1040,["onClick"])]),_:1})):b("",!0),t.type!="map"?(a(),h(L,{key:1,text:"수정"},{activator:i(({props:g})=>[o(A,z({onClick:s[0]||(s[0]=le(v=>n.openEditDialog("update"),["stop"])),icon:""},g,{density:"compact",size:"small"}),{default:i(()=>[o(c,{icon:"pencil",width:12,height:12})]),_:2},1040)]),_:1})):b("",!0),t.type!="map"?(a(),h(L,{key:2,text:"삭제"},{activator:i(({props:g})=>[o(A,z({onClick:le(n.deleteProcess,["stop"]),icon:""},g,{density:"compact",size:"small"}),{default:i(()=>[o(c,{icon:"trash",width:12,height:12})]),_:2},1040,["onClick"])]),_:1})):b("",!0)])):b("",!0)]),_:1})])}const pe=Q(ot,[["render",nt]]),at={components:{},props:{},data:()=>({processDialogStatus:!1,hover:!1}),methods:{editProcess(e){this.value.id=e.id,this.value.label=e.label,this.value.name=e.name},editProcessdialog(e){this.processDialogStatus&&(this.processDialogStatus=!1),this.processType=e,this.processDialogStatus=!0},openProcessDialog(e){this.processDialogStatus&&(this.processDialogStatus=!1),this.processType=e,this.processDialogStatus=!0},closeProcessDialog(){this.processDialogStatus=!1},goProcess(e,s){if(!this.enableEdit)if(!e&&!s)this.$router.push("/definition-map");else{const t=encodeURIComponent(e);this.$router.push(`/definition-map/${s}/${t}`)}}}};function rt(e,s,t,r,l,n){return a(),m("div")}const me=Q(at,[["render",rt]]);const lt={components:{ProcessMenu:pe,ProcessDialog:ue},mixins:[me],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"sub",definition:null}),async created(){},methods:{handleClick(){window.$mode=="ProcessGPT"?this.goProcess(this.value.id,"sub"):this.$emit("clickProcess",this.value.path)},deleteProcess(){this.parent.sub_proc_list=this.parent.sub_proc_list.filter(e=>e.id!=this.value.id)},async editProcessModel(){const e=ne.createBackend(),s=this.value.id.replace(/ /g,"_"),t=s.substr(0,s.indexOf(".")),r={type:s.substr(s.indexOf(".")+1)};this.definition=await e.getRawDefinition(t,r);let l;this.definition&&this.definition.id?l=`/definitions/${this.definition.id}?modeling=true`:l=`/definitions/chat?id=${s}&name=${this.value.name}&modeling=true`,window.open(l,"_blank")}}},ct={class:"align-center pa-2 cursor-pointer sub-process-hover sub-process-style pr-3 pl-3"},dt={key:0,class:"text-subtitle-2 font-weight-semibold"},ut=$("New"),pt={class:"ml-auto add-sub-process"};function mt(e,s,t,r,l,n){const c=M("ProcessMenu"),g=M("ProcessDialog");return a(),m("div",ct,[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",dt,[o(F,{class:"ma-0 pa-0"},{default:i(()=>[o(H,{cols:t.enableEdit?"6":"12",class:"ma-0 pa-0 text-left align-center",onClick:n.handleClick},{default:i(()=>[d("div",null,[$(B(t.value.name)+" ",1),t.value.new?(a(),h(xe,{key:0,style:{"margin-left":"5px","margin-top":"-4px","background-color":"red",color:"white"},size:"x-small"},{default:i(()=>[ut]),_:1})):b("",!0)])]),_:1},8,["cols","onClick"]),o(H,{cols:t.enableEdit?"6":"",class:"ma-0 pa-0"},{default:i(()=>[d("div",pt,[o(c,{size:16,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog,onModeling:n.editProcessModel},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog","onModeling"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),h(g,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):b("",!0)])}const ft=Q(lt,[["render",mt],["__scopeId","data-v-77d4e180"]]);const ht={components:{ProcessMenu:pe,SubProcess:ft,ProcessDialog:ue},mixins:[me],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"major",subProcessDialogStauts:!1}),methods:{async addProcess(e){e.id||(e.id=`${this.parent.name}_${e.name}`),e.id=e.id.replace(/[/.]/g,"_"),this.value.sub_proc_list.push({id:e.id,name:e.name})},openSubProcessDialog(e){this.processType=e,this.processDialogStatus=!0,this.subProcessDialogStauts=!0},deleteProcess(){this.parent.major_proc_list=this.parent.major_proc_list.filter(e=>e.id!=this.value.id)},clickProcess(e){this.$emit("clickProcess",e)}}},gt={class:"mb-3 major-hover"},vt={key:0,class:"text-subtitle-1 font-weight-semibold"},yt={class:"ml-auto add-major-process"},_t={key:1};function bt(e,s,t,r,l,n){const c=M("ProcessMenu"),g=M("ProcessDialog"),v=M("SubProcess"),N=M("draggable"),k=M("PlusIcon");return a(),m("div",gt,[o(x,{class:"align-center pa-2 pr-3 pl-3 cp-major",elevation:"10",style:{"border-radius":"10px !important","margin-bottom":"5px",border:"5px solid rgba(var(--v-theme-primary), 0.2)"},onClick:s[0]||(s[0]=I=>e.goProcess(t.parent.name,"mega"))},{default:i(()=>[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",vt,[o(F,{class:"ma-0 pa-0"},{default:i(()=>[o(H,{cols:t.enableEdit?"8":"12",class:"ma-0 pa-0 text-left"},{default:i(()=>[d("div",null,B(t.value.name),1)]),_:1},8,["cols"]),o(H,{cols:t.enableEdit?"4":"",class:"ma-0 pa-0"},{default:i(()=>[d("div",yt,[o(c,{size:16,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),h(g,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):b("",!0)]),_:1}),t.enableEdit?(a(),h(N,{key:0,class:"dragArea list-group",list:t.value.sub_proc_list,animation:200,"ghost-class":"ghost-card",group:"subProcess"},{default:i(()=>[o(Pe,null,{default:i(()=>[(a(!0),m(X,null,J(t.value.sub_proc_list,I=>(a(),m("div",{key:I.id,class:"cursor-pointer"},[o(v,{value:I,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]))),128))]),_:1})]),_:1},8,["list"])):(a(),m("div",_t,[(a(!0),m(X,null,J(t.value.sub_proc_list,I=>(a(),m("div",{key:I.id},[o(v,{value:I,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]))),128))])),!e.processDialogStatus&&t.enableEdit?(a(),h(x,{key:2,onClick:s[1]||(s[1]=I=>n.openSubProcessDialog("add")),class:"add-sub-card",elevation:"9",variant:"outlined",color:"primary",style:{display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important",height:"26px"}},{default:i(()=>[o(F,{class:"pa-0 ma-0 definitionMap-add-card"},{default:i(()=>[o(k,{class:"cp-add-sub",size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addSub")),1)]),_:1})]),_:1})):e.processDialogStatus&&t.enableEdit&&e.processType==="add"?(a(),h(g,{key:3,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,subProcessDialogStauts:e.subProcessDialogStauts,processType:e.processType,type:e.type,onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog,style:{"margin-top":"20px !important"}},null,8,["enableEdit","process","processDialogStatus","subProcessDialogStauts","processType","type","onAdd","onCloseProcessDialog"])):b("",!0)])}const Pt=Q(ht,[["render",bt]]);const kt={components:{ProcessMenu:pe,MajorProcess:Pt,ProcessDialog:ue},mixins:[me],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"mega",hover:!1}),created(){},methods:{addProcess(e){const s=e.name.toLowerCase().replace(/[/.]/g,"_");this.value.major_proc_list.push({id:s,name:e.name,sub_proc_list:[]})},deleteProcess(){this.parent.mega_proc_list=this.parent.mega_proc_list.filter(e=>e.id!=this.value.id)},clickProcess(e){this.$emit("clickProcess",e)}}},Dt={class:"w-100 mega-hover"},wt={key:0,class:"text-h6 font-weight-semibold"},Et={class:"ml-auto add-major-process"},Ct={key:1};function Mt(e,s,t,r,l,n){const c=M("ProcessMenu"),g=M("ProcessDialog"),v=M("MajorProcess"),N=M("draggable"),k=M("PlusIcon");return a(),m("div",Dt,[o(x,{class:"align-center pa-3 mb-3 cp-mega",elevation:"10",style:{"border-radius":"10px !important","background-color":"rgba(var(--v-theme-primary), 0.2)"},onClick:s[0]||(s[0]=I=>e.goProcess(t.value.name,"mega"))},{default:i(()=>[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",wt,[o(F,{class:"ma-0 pa-0"},{default:i(()=>[o(H,{cols:t.enableEdit?"8":"12",class:"ma-0 pa-0 text-left"},{default:i(()=>[d("div",null,B(t.value.name),1)]),_:1},8,["cols"]),o(H,{cols:t.enableEdit?"4":"",class:"ma-0 pa-0"},{default:i(()=>[d("div",Et,[o(c,{class:"mega-proc-btn",size:20,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),h(g,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):b("",!0)]),_:1}),t.enableEdit?(a(),h(N,{key:0,class:"dragArea list-group",list:t.value.major_proc_list,animation:200,"ghost-class":"ghost-card",group:"majorProcess"},{default:i(()=>[o(Pe,null,{default:i(()=>[(a(!0),m(X,null,J(t.value.major_proc_list,I=>(a(),m("div",{key:I.id,class:"cursor-pointer"},[o(v,{value:I,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]))),128))]),_:1})]),_:1},8,["list"])):(a(),m("div",Ct,[(a(!0),m(X,null,J(t.value.major_proc_list,I=>(a(),m("div",{key:I.id},[o(v,{value:I,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]))),128))])),!e.processDialogStatus&&t.enableEdit?(a(),h(x,{key:2,onClick:s[1]||(s[1]=I=>e.openProcessDialog("add")),class:"cp-add-mega pa-2 add-major-card",elevation:"9",variant:"outlined",color:"primary",style:{display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important",height:"34px"}},{default:i(()=>[o(F,{class:"pa-0 ma-0 definitionMap-add-card"},{default:i(()=>[o(k,{class:"cp-add-major",size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addMajor")),1)]),_:1})]),_:1})):e.processDialogStatus&&t.enableEdit&&e.processType==="add"?(a(),h(g,{key:3,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog,style:{"margin-top":"20px !important"}},null,8,["enableEdit","process","processDialogStatus","processType","type","onAdd","onCloseProcessDialog"])):b("",!0)])}const St=Q(kt,[["render",Mt]]),Tt={components:{MegaProcess:St,ProcessDialog:ue},mixins:[me],props:{value:Object,enableEdit:Boolean},data:()=>({processType:"",processRenderer:0}),created(){this.classifyProcess()},watch:{enableEdit(e,s){e!==s&&this.classifyProcess()}},methods:{addProcess(e){var t={id:e.name.toLowerCase().replace(/[/.]/g,"_"),name:e.name,major_proc_list:[]};this.value.mega_proc_list.push(t)},async classifyProcess(){let e=[],s=-1;if(this.value.mega_proc_list.forEach((t,r)=>{t.id=="unclassified"?s=r:t.major_proc_list.forEach(l=>{e=[...e,...l.sub_proc_list]})}),e.length>0){e=e.map(c=>c.id);const t=ne.createBackend(),r=await t.listDefinition();let l=[];const n=async c=>{if(c.id=c.path,l.push(c),c.directory){const g=await t.listDefinition(c.path);for(const v of g)await n(v)}};for(const c of r)await n(c);l=l.filter(c=>!e.includes(c.id)&&c.path.includes(".bpmn")),l.length>0&&(l=l.map(c=>({id:c.id,name:c.name,path:c.path})),s==-1?this.value.mega_proc_list.push({id:"unclassified",name:"미분류",major_proc_list:[{id:"unclassified_major",name:"미분류",sub_proc_list:l}]}):this.value.mega_proc_list[s].major_proc_list=[{id:"unclassified_major",name:"미분류",sub_proc_list:l}])}},clickProcess(e){this.$emit("clickProcess",e)}}},jt={class:"pa-5"};function Bt(e,s,t,r,l,n){const c=M("MegaProcess"),g=M("PlusIcon"),v=M("ProcessDialog"),N=M("draggable");return a(),m("div",jt,[t.enableEdit?(a(),h(N,{key:0,class:"v-row dragArea list-group",list:t.value.mega_proc_list,animation:200,"ghost-class":"ghost-card",group:"megaProcess",draggable:".draggable-item"},{default:i(()=>[o(Pe,null,{default:i(()=>[(a(!0),m(X,null,J(t.value.mega_proc_list,k=>(a(),h(H,{key:k.id,class:"cursor-pointer draggable-item",cols:"12",md:"2",sm:"6"},{default:i(()=>[o(c,{value:k,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]),_:2},1024))),128)),o(H,{class:"cursor-pointer",cols:"12",md:"2",sm:"3"},{default:i(()=>[e.processDialogStatus?b("",!0):(a(),h(x,{key:0,onClick:s[0]||(s[0]=k=>e.openProcessDialog("add")),class:"cp-add-mega",elevation:"9",variant:"outlined",color:"primary",style:{padding:"10px",display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important"}},{default:i(()=>[o(F,{class:"pa-0 ma-0 definitionMap-add-card"},{default:i(()=>[o(g,{size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addMega")),1)]),_:1})]),_:1})),e.processDialogStatus?(a(),h(v,{key:1,enableEdit:t.enableEdit,process:t.value,processType:e.processType,type:"map",onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processType","onAdd","onCloseProcessDialog"])):b("",!0)]),_:1})]),_:1})]),_:1},8,["list","draggable"])):(a(),h(F,{key:1},{default:i(()=>[(a(!0),m(X,null,J(t.value.mega_proc_list,k=>(a(),h(H,{key:k.id,class:"cursor-pointer",cols:"12",md:"2",sm:"6"},{default:i(()=>[o(c,{value:k,parent:t.value,enableEdit:t.enableEdit,onClickProcess:n.clickProcess},null,8,["value","parent","enableEdit","onClickProcess"])]),_:2},1024))),128))]),_:1}))])}const It=Q(Tt,[["render",Bt]]),$t={components:{ProcessDefinition:Fe,ProcessExecuteDialog:Xe,"dry-run-process":He,"process-gpt-execute":Ge},mixins:[me],props:{value:Object,enableEdit:Boolean},data:()=>({onLoad:!1,bpmn:null,processDefinition:null,selectedProc:{mega:null,major:null},selectedSubProcess:null,subProcessBreadCrumb:[],defCnt:0,isViewMode:!0,executeDialog:!1}),computed:{mode(){return window.$mode},JMS(){return window.$jms}},watch:{"$route.params":{handler(e,s){e.id!==s.id&&this.init(e)}}},created(){this.init(this.$route.params)},methods:{jumpToProcessDefintionChat(){this.$router.push(`/definitions/${this.processDefinition.id}`)},goHistory(e){this.updateBpmn(this.subProcessBreadCrumb[e].xml),this.removeHistoryAfterIndex(e)},removeHistoryAfterIndex(e){if(e<0||e>=this.subProcessBreadCrumb.length){console.error("Invalid index");return}this.subProcessBreadCrumb.splice(e+1)},updateBpmn(e){this.bpmn=e,this.defCnt++},async openSubProcess(e){var t,r;let s=this;if((r=(t=e.extensionElements)==null?void 0:t.values[0])!=null&&r.definition){const l=ne.createBackend(),n=e.extensionElements.values[0].definition,c=await l.getRawDefinition(n,null);if(c){let g={processName:e.extensionElements.values[0].definition,xml:c.bpmn};s.subProcessBreadCrumb.push(g),s.selectedSubProcess=e.extensionElements.values[0].definition,s.updateBpmn(c.bpmn)}}},async init(e){var s=this;s.$try({action:async()=>{const t=ne.createBackend();s.onLoad=!1,e.name||(e.name=e.id);let r;if(s.value&&s.value.mega_proc_list&&s.value.mega_proc_list.length>0?r=s.value:r=await t.getProcessDefinitionMap(),r.mega_proc_list.forEach(l=>{l.major_proc_list.forEach(n=>{n.sub_proc_list.forEach(c=>{c.id==e.id&&(e=c,this.selectedProc.mega=l,this.selectedProc.major=n)})})}),e.id){let l=e.id.replace(/_/g,"/");s.bpmn=await t.getRawDefinition(l,{type:"bpmn"})}else s.bpmn=null;s.processDefinition=e,s.onLoad=!0}})},editProcessModel(){this.processDefinition&&this.processDefinition.id&&this.$router.push(`/definitions/chat?id=${this.processDefinition.id}&name=${this.processDefinition.name}`)},capture(){this.$emit("capture")},executeProcess(){this.executeDialog=!0},startProcess(){var e=this;e.$try({action:async()=>{const s=ne.createBackend(),t={process_instance_id:"new",process_definition_id:e.processDefinition.id},r=await s.start(t);if(r.instanceId){const l=window.$mode=="ProcessGPT"?btoa(r.instanceId):r.instanceId;e.$router.push(`/instancelist/${l}`)}e.EventBus.emit("instances-updated")},successMsg:this.$t("successMsg.processExecutionCompleted")})}}},At={class:"pa-0 pl-6 pt-4 pr-6 d-flex align-center"},Vt={class:"text-h6 font-weight-semibold"},Nt=$("mdi-chevron-right"),xt={class:"text-h6 font-weight-semibold"},Ut=$("mdi-chevron-right"),Lt={key:2,class:"d-flex align-center"},zt={class:"text-h6 font-weight-semibold"},Ot=["onClick"],Rt=$("mdi-chevron-right"),Ft={class:"text-h6 font-weight-semibold"},Ht={class:"ml-auto d-flex"},Gt={key:0},Xt=$(" 실행 "),Jt=$("mdi-pencil"),Zt={key:1,style:{height:"90%","text-align":"center"}},qt=d("h6",{class:"text-h6"},"정의된 프로세스 모델이 없습니다.",-1),Kt=$(" 프로세스 편집 "),Wt={key:2},Qt={key:1};function Yt(e,s,t,r,l,n){const c=M("Icons"),g=M("ProcessDefinition"),v=M("process-gpt-execute"),N=M("dry-run-process");return a(),h(x,{elevation:"10",style:_e(e.$globalState.state.isZoomed?"height: 100vh":"height:calc(100vh - 155px);")},{default:i(()=>[d("div",At,[e.selectedProc.mega?(a(),m("div",{key:0,class:"d-flex align-center cursor-pointer",onClick:s[0]||(s[0]=k=>e.goProcess())},[d("h6",Vt,B(e.selectedProc.mega.name),1),o(re,null,{default:i(()=>[Nt]),_:1})])):b("",!0),e.selectedProc.major?(a(),m("div",{key:1,class:"d-flex align-center cursor-pointer",onClick:s[1]||(s[1]=k=>e.goProcess(e.selectedProc.mega.name,"mega"))},[d("h6",xt,B(e.selectedProc.major.name),1),d("div",null,[o(re,{class:"cursor-pointer"},{default:i(()=>[Ut]),_:1}),o(Oe,{activator:"parent"},{default:i(()=>[e.selectedProc.major.sub_proc_list?(a(),h(Ue,{key:0,density:"compact",class:"cursor-pointer"},{default:i(()=>[(a(!0),m(X,null,J(e.selectedProc.major.sub_proc_list,k=>(a(),h(Le,{key:k.id,onClick:I=>e.goProcess(k.id,"sub")},{default:i(()=>[o(ze,null,{default:i(()=>[$(B(k.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):b("",!0)]),_:1})])])):b("",!0),e.processDefinition?(a(),m("div",Lt,[d("h6",zt,B(e.processDefinition?e.processDefinition.name:""),1)])):b("",!0),(a(!0),m(X,null,J(e.subProcessBreadCrumb,(k,I)=>(a(),m("div",{key:I},[d("div",{class:"d-flex align-center",onClick:fe=>n.goHistory(I)},[o(re,null,{default:i(()=>[Rt]),_:1}),d("h6",Ft,B(k.processName),1)],8,Ot)]))),128)),d("div",Ht,[e.onLoad&&e.bpmn?(a(),m("div",Gt,[n.JMS?b("",!0):(a(),h(A,{key:0,color:"primary",rounded:"",density:"comfortable",class:"ml-3",onClick:n.executeProcess},{default:i(()=>[Xt]),_:1},8,["onClick"])),o(L,{text:e.$t("processDefinition.edit")},{activator:i(({props:k})=>[o(A,z({size:30,icon:"",variant:"text",class:"ml-2"},k,{onClick:s[2]||(s[2]=I=>n.jumpToProcessDefintionChat())}),{default:i(()=>[o(re,null,{default:i(()=>[Jt]),_:1})]),_:2},1040)]),_:1},8,["text"]),o(L,{text:e.$t("processDefinition.capture")},{activator:i(({props:k})=>[o(A,z({icon:"",variant:"text",class:"ml-3",size:24,onClick:n.capture},k),{default:i(()=>[o(c,{icon:"image-download"})]),_:2},1040,["onClick"])]),_:1},8,["text"]),o(L,{text:e.$t("processDefinition.zoom")},{activator:i(({props:k})=>[o(A,z({size:30,icon:"",variant:"text",class:"ml-2"},k,{onClick:s[3]||(s[3]=I=>e.$globalState.methods.toggleZoom())}),{default:i(()=>[o(c,{icon:e.$globalState.state.isZoomed?"zoom-in":"zoom-out"},null,8,["icon"])]),_:2},1040)]),_:1},8,["text"])])):b("",!0)])]),o(be,{style:{width:"100%",height:"95%",padding:"10px"}},{default:i(()=>[e.onLoad&&e.bpmn?(a(),h(g,{style:{width:"100%",height:"100%"},bpmn:e.bpmn,key:e.defCnt,processDefinition:e.processDefinition.definition,isViewMode:e.isViewMode,onOpenSubProcess:s[4]||(s[4]=k=>n.openSubProcess(k))},null,8,["bpmn","processDefinition","isViewMode"])):e.onLoad&&!e.bpmn?(a(),m("div",Zt,[qt,t.enableEdit?(a(),h(A,{key:0,color:"primary",variant:"flat",class:"mt-4",onClick:n.editProcessModel},{default:i(()=>[Kt]),_:1},8,["onClick"])):b("",!0)])):(a(),m("div",Wt))]),_:1}),o(he,{modelValue:e.executeDialog,"onUpdate:modelValue":s[7]||(s[7]=k=>e.executeDialog=k)},{default:i(()=>[n.mode==="ProcessGPT"?(a(),h(v,{key:0,definitionId:e.processDefinition.id,onClose:s[5]||(s[5]=k=>e.executeDialog=!1)},null,8,["definitionId"])):(a(),m("div",Qt,[o(N,{definitionId:e.processDefinition.id,onClose:s[6]||(s[6]=k=>e.executeDialog=!1)},null,8,["definitionId"])]))]),_:1},8,["modelValue"])]),_:1},8,["style"])}const es=Q($t,[["render",Yt]]);const ts={components:{ProcessMenu:pe},props:{value:Object,enableEdit:Boolean},data(){return{processPath:null,filteredProcess:{id:"",name:"",major_proc_list:[]},onLoad:!1}},created(){this.init(this.$route.params)},watch:{value(e){if(e&&e.mega_proc_list&&e.mega_proc_list.length>0){const s=e.mega_proc_list.find(t=>t.name===this.processPath);s&&(this.filteredProcess=s)}}},methods:{init(e){var s=this;s.$try({action:async()=>{s.onLoad=!1,s.processPath=e.id;let t;s.value&&s.value.mega_proc_list&&s.value.mega_proc_list.length>0?t=s.value:t=await ne.createBackend().getProcessDefinitionMap();const r=t.mega_proc_list.find(l=>l.name===s.processPath);r&&(s.filteredProcess=r),s.onLoad=!0}})},addProcess(e,s,t){if(s==="mega")this.filteredProcess.major_proc_list||(this.filteredProcess.major_proc_list=[]),this.filteredProcess.major_proc_list.push({id:e.id,name:e.name,sub_proc_list:[]});else if(s==="major"){const r=this.filteredProcess.major_proc_list.find(l=>l.name===t);r?(r.sub_proc_list||(r.sub_proc_list=[]),r.sub_proc_list.push({id:e.id,label:e.name})):console.error("Major process not found for the given selectedProcessId")}},editProcess(e,s,t){if(s==="mega"){let r=this.value.mega_proc_list.find(l=>l.id===t);r&&(r.id=e.id,r.name=e.name,this.processPath=e.name)}else s==="major"?this.value.mega_proc_list.forEach(r=>{let l=r.major_proc_list.find(n=>n.id===t);l&&(l.id=e.id,l.name=e.name)}):s==="sub"&&this.value.mega_proc_list.forEach(r=>{r.major_proc_list.forEach(l=>{let n=l.sub_proc_list.find(c=>c.id===t);n&&(n.id=e.id,n.name=e.name)})})},deleteProcess(e,s){e==="mega"?this.value.mega_proc_list=this.value.mega_proc_list.filter(t=>t.id!==s):e==="major"?this.value.mega_proc_list.forEach(t=>{t.major_proc_list=t.major_proc_list.filter(r=>r.id!==s)}):e==="sub"&&this.value.mega_proc_list.forEach(t=>{t.major_proc_list.forEach(r=>{r.sub_proc_list=r.sub_proc_list.filter(l=>l.id!==s)})})},viewProcess(e){this.$router.push(`/definition-map/sub/${e.id}`)}}},ss={key:0},os={class:"d-flex align-items-center"},is=d("div",{class:"d-flex flex-column justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[$(" Mega"),d("br"),$("Process ")])],-1),ns=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),as={class:"text-h6 font-weight-semibold text-center"},rs={key:0,class:"d-flex align-items-center"},ls=d("div",{class:"d-flex flex-column justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[$(" Major"),d("br"),$("Process ")])],-1),cs=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),ds={class:"d-flex flex-column justify-content-center align-items-center"},us={class:"text-h6 font-weight-semibold text-center"},ps={key:1,class:"d-flex align-items-center"},ms=d("div",{class:"justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[$(" Sub"),d("br"),$("Process ")])],-1),fs=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),hs={class:"d-flex flex-column justify-content-center align-items-center"},gs={class:"text-h6 font-weight-semibold text-center"};function vs(e,s,t,r,l,n){return l.onLoad?(a(),m("div",ss,[d("div",os,[o(x,{class:"d-flex justify-center align-center pa-3 mb-3 details-title-card",elevation:"10",style:{"background-color":"rgb(var(--v-theme-primary), 0.2)"}},{default:i(()=>[is]),_:1}),ns,o(x,{class:"d-flex align-center pa-3 mb-3",elevation:"10",style:{"background-color":"rgb(var(--v-theme-primary), 0.2)"}},{default:i(()=>[d("h6",as,B(l.filteredProcess.name),1)]),_:1})]),l.filteredProcess&&l.filteredProcess.major_proc_list&&l.filteredProcess.major_proc_list.length>0?(a(),m("div",rs,[o(x,{class:"d-flex justify-center align-center pa-2 mb-3 details-title-card",elevation:"10",style:{"border-radius":"20px !important","margin-bottom":"5px",border:"5px solid rgba(var(--v-theme-primary), 0.2)"}},{default:i(()=>[ls]),_:1}),cs,(a(!0),m(X,null,J(l.filteredProcess.major_proc_list,(c,g)=>(a(),h(x,{key:g,class:"d-flex align-center pa-2 mb-3 last-no-margin",elevation:"10",style:{"border-radius":"20px !important","margin-bottom":"5px",border:"5px solid rgba(var(--v-theme-primary), 0.2)"}},{default:i(()=>[d("div",ds,[d("h6",us,B(c.name),1)])]),_:2},1024))),128))])):b("",!0),l.filteredProcess&&l.filteredProcess.major_proc_list&&l.filteredProcess.major_proc_list.some(c=>c.sub_proc_list&&c.sub_proc_list.length>0)?(a(),m("div",ps,[o(x,{class:"d-flex justify-center align-center pa-3 mb-3 bg-white details-title-card",elevation:"10"},{default:i(()=>[ms]),_:1}),fs,(a(!0),m(X,null,J(l.filteredProcess.major_proc_list,(c,g)=>(a(),h(H,{key:g,class:"ma-0 pa-0 last-no-margin"},{default:i(()=>[(a(!0),m(X,null,J(c.sub_proc_list,(v,N)=>(a(),h(x,{key:`sub-${g}-${N}`,class:"d-flex align-center pa-3 mb-3 bg-white",elevation:"10",style:{"border-radius":"10px !important",cursor:"pointer"},onClick:k=>n.viewProcess(v)},{default:i(()=>[d("div",hs,[d("h6",gs,B(v.name),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))])):b("",!0)])):b("",!0)}const ys=Q(ts,[["render",vs]]);const ie=ne.createBackend(),_s={components:{ProcessMenu:pe,ViewProcessDetails:ys,SubProcessDetail:es,DefinitionMapList:It,ProcessDefinitionChat:Je},props:{componentName:{type:String,required:!0},isViewMode:{type:Boolean,default:!1}},data:()=>({value:{mega_proc_list:[]},type:"map",enableEdit:!1,userName:null,lock:null,editUser:null,alertType:"",alertDialog:!1,alertMessage:"",isAdmin:!1,versionHistory:[],openConsultingDialog:!1,ProcessPreviewMode:!1}),computed:{useLock(){return window.$mode=="ProcessGPT"?!0:this.isViewMode},actionButtons(){return[{show:this.alertType==="checkout",text:this.$t("processDefinitionMap.confirm"),color:"primary",class:"cp-check-out",action:this.checkOut},{show:this.alertType==="checkin"&&this.userName&&this.userName===this.editUser,text:this.$t("processDefinitionMap.saveCheckIn"),color:"success",class:"cp-check-in",action:()=>{this.checkIn(),this.saveProcess()}},{show:this.alertType==="checkin"&&this.userName&&this.userName===this.editUser,text:this.$t("processDefinitionMap.cancelCheckIn"),color:"primary",class:"cp-check-in",action:async()=>{this.checkIn(),await this.getProcessMap()}},{show:this.alertType==="checkin"&&this.userName&&this.userName!==this.editUser,text:this.$t("processDefinitionMap.confirm"),color:"primary",class:"cp-check-in",action:async()=>{await this.getProcessMap(),this.checkOut()}},{show:this.alertType==="download",text:this.$t("processDefinitionMap.download"),color:"primary",action:this.download}]}},async created(){var e=this;e.$try({action:async()=>{e.userName=localStorage.getItem("userName"),localStorage.getItem("isAdmin")=="true"&&(e.isAdmin=!0),await e.getProcessMap(),e.useLock?await e.checkedLock():(e.editUser=e.userName,e.enableEdit=!0)}})},beforeRouteLeave(e,s,t){this.lock&&this.enableEdit?this.openAlertDialog().then(r=>{r?t():t(!1)}):t()},methods:{openProcessPreview(){this.ProcessPreviewMode=!0},createdBPMN(e){const s=()=>{function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},t=async n=>{n.sub_proc_list.push({id:e.processDefinitionId,name:e.processDefinitionName,new:!0}),await this.saveProcess()};if(e.megaProcessId===""){let n=this.value.mega_proc_list.find(c=>c.name===this.$t("processDefinitionMap.uncategorized"));n||(n={id:s(),name:this.$t("processDefinitionMap.uncategorized"),major_proc_list:[{id:"0",name:this.$t("processDefinitionMap.uncategorized"),sub_proc_list:[]}]},this.value.mega_proc_list.push(n)),t(n.major_proc_list[0]);return}let r=this.value.mega_proc_list.find(n=>n.id===e.megaProcessId);r||(r={id:e.megaProcessId,name:this.$t("processDefinitionMap.uncategorized"),major_proc_list:[]},this.value.mega_proc_list.push(r));let l=r.major_proc_list.find(n=>n.id===e.majorProcessId);l||(l={id:e.majorProcessId,name:this.$t("processDefinitionMap.uncategorized"),sub_proc_list:[]},r.major_proc_list.push(l)),t(l)},closeConsultingDialog(){let e;this.ProcessPreviewMode?e=window.confirm(this.$t("processDefinitionMap.closeConsultingInPreview")):e=window.confirm(this.$t("processDefinitionMap.closeConsulting")),e&&(this.ProcessPreviewMode=!1,this.openConsultingDialog=!1)},async checkedLock(){if(this.isAdmin){this.enableEdit=!1;const e=await ie.getLock("process-map");e&&e.id&&e.user_id?(this.lock=!0,this.editUser=e.user_id,this.userName==this.editUser&&(this.enableEdit=!0)):this.lock=!1}},capturePng(){var e=document.getElementById("processMap");qe.toPng(e).then(function(s){const t=document.createElement("a");t.href=s,t.download="process_definition_map.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}).catch(function(s){console.error("oops, something went wrong!",s)})},goProcessMap(){this.$router.push("/definition-map")},async getProcessMap(){let e=await ie.getProcessDefinitionMap();e.mega_proc_list?(e.mega_proc_list.forEach(s=>{s.major_proc_list&&s.major_proc_list.forEach(t=>{t.sub_proc_list&&t.sub_proc_list.forEach(r=>{r.new&&(r.new=!1)})})}),this.value=e):this.value={mega_proc_list:[]}},addProcess(e){this.value.mega_proc_list.push({id:e.id,name:e.name,major_proc_list:[]})},async saveProcess(){await ie.putProcessDefinitionMap(this.value),await this.getProcessMap(),this.closeAlertDialog()},async checkIn(){await ie.checkDBConnection()?(this.lock=!1,this.enableEdit=!1,this.useLock&&await ie.deleteLock("process-map"),this.closeAlertDialog()):(this.alertDialog=!0,this.alertMessage=this.$t("processDefinitionMap.checkInDBError"),this.alertType="download")},async checkOut(){if(!await ie.checkDBConnection())alert(this.$t("processDefinitionMap.checkOutDBError"));else if(this.lock=!0,this.enableEdit=!0,this.useLock&&this.userName&&this.userName!=null){this.editUser=this.userName;let s={id:"process-map",user_id:this.editUser};await ie.setLock(s)}this.closeAlertDialog()},download(){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.value)),s=document.createElement("a");s.setAttribute("href",e),s.setAttribute("download","process-map.json"),document.body.appendChild(s),s.click(),s.remove(),this.closeAlertDialog()},async openAlertDialog(){var e=this;e.$try({context:e,action:async()=>{if(this.isAdmin)if(e.useLock){const s=await ie.getLock("process-map");s&&s.id&&s.user_id?(e.lock=!0,e.editUser=s.user_id,e.editUser==e.userName?(e.alertDialog=!0,e.alertMessage=this.$t("processDefinitionMap.checkInMessage")):(e.alertDialog=!0,e.alertMessage=this.$t("processDefinitionMap.forcedCheckOutMessage",{name:e.editUser}),e.enableEdit=!1),e.alertType="checkin",e.$nextTick(()=>{const t=document.getElementById("confirmButton"),r=document.getElementById("cancelButton");t.onclick=()=>resolve(!0),r.onclick=()=>resolve(!1)})):(e.lock=!1,e.enableEdit=!1,e.alertDialog=!0,e.alertMessage=this.$t("processDefinitionMap.checkOutMessage"),e.alertType="checkout",e.$nextTick(()=>{const t=document.getElementById("confirmButton"),r=document.getElementById("cancelButton");t.onclick=()=>resolve(!0),r.onclick=()=>resolve(!1)}))}else e.lock=!1}})},closeAlertDialog(){this.alertDialog=!1,this.alertType="",this.alertMessage=""},clickProcess(e){this.$emit("clickProcess",e)}}},bs={key:0,class:"pa-0 pl-6 pt-4 pr-6 d-flex align-center",style:{position:"sticky",top:"0","z-index":"2","background-color":"white"}},Ps={class:"text-h5 font-weight-semibold"},ks={class:"ml-auto d-flex"},Ds={key:4,class:"ml-1"},ws={id:"processMap"},Es={key:0},Cs={key:1},Ms={key:2},Ss=$("mdi-auto-fix"),Ts=$("mdi-close");function js(e,s,t,r,l,n){const c=M("Icons"),g=M("LockIcon"),v=M("LockOpenIcon"),N=M("ViewProcessDetails"),k=M("SubProcessDetail"),I=M("DefinitionMapList"),fe=M("ProcessDefinitionChat");return a(),m("div",null,[o(x,{elevation:"10",style:_e([e.$globalState.state.isZoomed?"height:100vh;":"height:calc(100vh - 155px)",{overflow:"auto"}])},{default:i(()=>[t.componentName!="SubProcessDetail"?(a(),m("div",bs,[d("h5",Ps,B(e.$t("processDefinitionMap.title")),1),e.$route.path!=="/definition-map"?(a(),h(A,{key:0,style:{"margin-left":"3px","margin-top":"1px"},icon:"",variant:"text",size:"24",onClick:n.goProcessMap},{default:i(()=>[o(c,{icon:"arrow-go-back"})]),_:1},8,["onClick"])):b("",!0),d("div",ks,[n.useLock&&!e.lock&&e.isAdmin&&!t.isViewMode?(a(),h(L,{key:0,location:"bottom"},{activator:i(({props:T})=>[o(A,z(T,{icon:"",variant:"text",size:"24",class:"ml-3 cp-unlock",onClick:n.openAlertDialog}),{default:i(()=>[o(g,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:i(()=>[d("span",null,B(e.$t("processDefinitionMap.unlock")),1)]),_:1})):b("",!0),n.useLock&&e.lock&&e.isAdmin&&e.userName==e.editUser?(a(),h(L,{key:1,location:"bottom"},{activator:i(({props:T})=>[o(A,z(T,{icon:"",variant:"text",size:"24",class:"cp-lock",onClick:n.openAlertDialog}),{default:i(()=>[o(v,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:i(()=>[d("span",null,B(e.$t("processDefinitionMap.lock")),1)]),_:1})):b("",!0),n.useLock&&e.lock&&e.isAdmin&&e.userName!=e.editUser?(a(),h(L,{key:2,location:"bottom"},{activator:i(({props:T})=>[o(A,z(T,{icon:"",variant:"text",size:"24",onClick:n.openAlertDialog}),{default:i(()=>[o(g,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:i(()=>[d("span",null,B(e.$t("processDefinitionMap.unlock")),1)]),_:1})):b("",!0),n.useLock?b("",!0):(a(),h(L,{key:3,location:"bottom"},{activator:i(({props:T})=>[o(A,z(T,{icon:"",variant:"text",size:"24",onClick:s[0]||(s[0]=Y=>n.saveProcess())}),{default:i(()=>[o(c,{icon:"save"})]),_:2},1040)]),default:i(()=>[d("span",null,B(e.$t("processDefinitionMap.save")),1)]),_:1})),n.useLock&&e.lock&&e.userName&&e.userName!=e.editUser?(a(),m("span",Ds,B(e.$t("processDefinitionMap.editingUser",{name:e.editUser})),1)):b("",!0),o(L,{text:e.$t("processDefinitionMap.downloadImage")},{activator:i(({props:T})=>[o(A,z(T,{icon:"",variant:"text",size:24,class:"ml-3",onClick:n.capturePng}),{default:i(()=>[o(c,{icon:"image-download"})]),_:2},1040,["onClick"])]),_:1},8,["text"]),t.componentName!="SubProcessDetail"?(a(),h(L,{key:5,text:e.$t("processDefinition.zoom")},{activator:i(({props:T})=>[o(A,z(T,{class:"ml-3",onClick:s[1]||(s[1]=Y=>e.$globalState.methods.toggleZoom()),icon:"",variant:"text",size:24}),{default:i(()=>[o(c,{icon:e.$globalState.state.isZoomed?"zoom-in":"zoom-out"},null,8,["icon"])]),_:2},1040)]),_:1},8,["text"])):b("",!0)])])):b("",!0),d("div",ws,[t.componentName=="ViewProcessDetails"?(a(),m("div",Es,[o(N,{class:"pa-5",value:e.value,enableEdit:e.enableEdit},null,8,["value","enableEdit"])])):t.componentName=="SubProcessDetail"?(a(),m("div",Cs,[o(k,{value:e.value,onCapture:n.capturePng,enableEdit:e.enableEdit},null,8,["value","onCapture","enableEdit"])])):(a(),m("div",Ms,[o(I,{value:e.value,enableEdit:e.enableEdit,onClickProcess:n.clickProcess},null,8,["value","enableEdit","onClickProcess"])]))]),t.componentName=="DefinitionMapList"?(a(),h(A,{key:1,onClick:s[2]||(s[2]=T=>(e.openConsultingDialog=!0,e.ProcessPreviewMode=!1)),style:{"margin-left":"20px"},color:"primary",rounded:""},{default:i(()=>[o(c,{icon:"magic",size:18,style:{"margin-right":"10px"}}),$(" "+B(e.$t("processDefinitionMap.consultingButton")),1)]),_:1})):b("",!0)]),_:1},8,["style"]),o(he,{style:_e(e.ProcessPreviewMode?"":"max-width: 1000px;"),modelValue:e.openConsultingDialog,"onUpdate:modelValue":s[4]||(s[4]=T=>e.openConsultingDialog=T),persistent:""},{default:i(()=>[o(x,null,{default:i(()=>[o(F,{class:"ma-0 pa-3",style:{"background-color":"rgb(var(--v-theme-primary), 0.2)",height:"50px"}},{default:i(()=>[o(re,{small:"",style:{"margin-right":"10px"}},{default:i(()=>[Ss]),_:1}),d("div",null,B(e.$t("processDefinitionMap.consultingAI")),1),o(de),o(re,{onClick:s[3]||(s[3]=T=>n.closeConsultingDialog()),small:"",style:{"margin-right":"5px",float:"right"}},{default:i(()=>[Ts]),_:1})]),_:1}),o(fe,{chatMode:"consulting",onCreatedBPMN:n.createdBPMN,onOpenProcessPreview:n.openProcessPreview},null,8,["onCreatedBPMN","onOpenProcessPreview"])]),_:1})]),_:1},8,["style","modelValue"]),o(he,{modelValue:e.alertDialog,"onUpdate:modelValue":s[6]||(s[6]=T=>e.alertDialog=T),"max-width":"500",persistent:""},{default:i(()=>[o(x,null,{default:i(()=>[o(be,{class:"mt-2 alert-message"},{default:i(()=>[$(B(e.alertMessage),1)]),_:1}),o(we,null,{default:i(()=>[o(de),(a(!0),m(X,null,J(n.actionButtons,(T,Y)=>(a(),m("div",{key:Y},[T.show?(a(),h(A,{key:0,color:T.color,class:Re(T.class+(Y>0?" ml-2":"")),variant:"flat",onClick:T.action,rounded:""},{default:i(()=>[$(B(T.text),1)]),_:2},1032,["color","class","onClick"])):b("",!0)]))),128)),o(A,{color:"error",rounded:"",variant:"flat",onClick:s[5]||(s[5]=T=>e.alertDialog=!1),class:"ml-2"},{default:i(()=>[$(B(e.userName&&e.userName===e.editUser?e.$t("processDefinitionMap.close"):e.$t("processDefinitionMap.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const to=Q(_s,[["render",js],["__scopeId","data-v-20708ea0"]]);export{to as default};
