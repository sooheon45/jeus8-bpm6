import{_ as A,bi as B,r as v,o as l,c,a as n,b as d,w as p,F as b,i as k,Q as L,P as w,t as f,A as C,h as y,d as T,e as S,bj as R,k as O,V as x,bk as N,bl as E,a_ as D,f as U}from"./index-7b37f28a.js";import{P as F,_ as $}from"./chat-icon-2658168f.js";import{V}from"./VSheet-beabeb52.js";import{_ as J}from"./AppBaseCard.vue_vue_type_style_index_0_lang-764d25b8.js";import{_ as Q,a as G}from"./ChatProfile-ae681fa1.js";import"./VBadge-0c68c2c9.js";const K={components:{Icon:B},mixins:[F],data(){return{inputRegex:/Agent: ([^\n|]+)[|\n]Tool: ([^\n|]+)[|\n]Input: ([\s\S]+)/,outputRegex:/Agent: ([^\n]+)\nTool Output: ([\s\S]+)/,newMessage:"",ws:null,isConnection:!1,isRunning:!1,result:null}},watch:{},mounted(){this.animateBorder(),this.receiveAgent()},methods:{isFileLink(e){return!!(e.includes("/FileDown")||e.includes("/readDownloadFile")||e.includes(".pdf"))},generatePreviewImage(e){const t=new URL(e),o=t.hostname;return o.includes("youtube.com")?`https://img.youtube.com/vi/${t.searchParams.get("v")}/0.jpg`:o.includes("github.com")?"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png":null},receiveAgent(){var e=this;e.ws=new WebSocket(`ws://${window.location.host}/autonomous`),e.ws.onopen=()=>{e.isConnection=!0},e.ws.onmessage=t=>{e.isRunning=!0,e.animateBorder(),this.result||(this.result={}),this.result.chats||(this.result.chats=[]);let o=null;if(!t.data.startsWith("Chain started with inputs: "))if(t.data.includes("{'text': ")||t.data.includes("You are a tool for")||t.data.includes("{'topic'"))t.data.includes("{'topic'")&&(e.result.topic=this.parseJsonString(t.data));else if(t.data.includes("Prompt after formatting:")){var a=t.data.indexOf("Current summary:");a!==-1&&t.data.substring(a).replace(/\n/g,"<br>")}else if(t.data.includes('"agents":'))try{let i=JSON.parse(t.data);e.result.agents=i.agents.map((u,m)=>({...u,profile:`/src/assets/images/profile/user-${m+1}.jpg`})),e.result.tools={"Search the internet":"인터넷 검색","Search Internal Documents":"외부 문서 검색","Search news on the internet":"인터넷 뉴스 검색"},o=e.convertAgentsContent(t.data,e.result.agents)}catch(i){console.error("Error parsing JSON:",i)}else t.data.match(e.inputRegex)?o=e.convertInputContent(t.data,e.result.agents,e.result.tools):t.data.match(e.outputRegex)?o=e.convertSearchOutputContent(t.data,e.result.agents):o=e.convertSystemContent(t.data);o&&(e.result.chats.push(o),e.isRunning=!1)},e.ws.onclose=()=>{e.isConnection=!1}},convertSystemContent(e){if(!e)return null;const t=/(출처:\s*https?:\/\/[^\s]+)/g;var o=e.replace(/\n/g,"<br>");return o.replace(t,a=>`<a href="${a.replace("출처:","").trim()}" target="_blank">${a}</a>`),{action:"system",name:"System",role:"system",email:"system@uengine.org",content:o,profile:"@/assets/images/chat/chat-icon.png",timeStamp:1708491834047}},convertAgentsContent(e,t){return e?(t||(t=[]),typeof e=="string"&&(e=JSON.parse(e)),{action:"agents",name:"System",role:"system",email:"agent@uengine.org",content:t.map((a,i)=>({...a,explanation:`${a.name}은 ${a.backstory}을 바탕으로 ${a.goal}을 목표를 가진다.<br/><br/>${e.tasks.filter(u=>u.agent===a.name).map(u=>`* 업무내용 <br/> - ${u.description}`).join(`
`)||""}`})),profile:"@/assets/images/chat/chat-icon.png",timeStamp:1708491834047}):null},convertInputContent(e,t,o){if(!e)return null;t||(t=[]),o||(o={});const a=e.match(this.inputRegex),i=a[1],u=a[2],m=a[3],g=o&&o[u]?o[u]:u,h=t.find(r=>r.role==i||r.name==i),s=h?h.profile:"/src/assets/images/profile/user-9.jpg";let _={};if(m.includes("|")&&(g.toLowerCase().includes("delegate")||g.toLowerCase().includes("co-worker"))){let r=m.split("|"),M=r[0],j=r[1],z=r[2],P=t.find(I=>I.role==M||I.name==M),H=`
                    <h3>${j}</h3>
                    <p>${z}</p>
                `;_={action:"delegate",name:i,role:i,delegate:M,delegateProfile:P?P.profile:"/src/assets/images/profile/user-9.jpg",email:"agent@uengine.org",content:H,profile:s,timeStamp:1708491834047}}else{let r=`"${m}"을(를) ${g}...`;_={action:"search",name:i,role:i,email:"agent@uengine.org",content:r,profile:s,timeStamp:1708491834047}}return _},convertSearchOutputContent(e,t){if(!e)return null;t||(t=[]);const o=e.match(this.outputRegex),a=o?o[1]:"Unknown",i=t.find(g=>g.role==a||g.name==a),u=i?i.profile:"/src/assets/images/profile/user-9.jpg";let m=null;return o[2].includes("-----------------")?(m||(m=[]),o[2].split(`-----------------
`).filter(h=>h.trim()!=="").forEach(h=>{const s=h.match(/Title: (.+)/),_=h.match(/Link: (.+)/),r=h.match(/Snippet: (.+)/);s&&_&&r&&m.push({title:s[1],link:_[1],snippet:r[1]})})):m=o[2].replace(/\n/g,"<br>"),{action:"searchOutput",name:a,role:a,email:"agent@uengine.org",content:m,data:e,profile:u,timeStamp:1708491834047}},transformLinks(e){const t=/(출처:\s*https?:\/\/[^\s]+)/g;return e.replace(t,o=>`<a href="${o.replace("출처:","").trim()}" target="_blank">${o}</a>`)},parseJsonString(e){try{const t=e.replace(/'/g,'"').replace(/\\n/g,"\\n");return JSON.parse(t)}catch{return e}},sendMessage(){this.isRunning=!0,this.ws.send(this.newMessage)}}},W={class:"customHeight",style:{"background-color":"rgba( 255, 255, 255, 1 )"}},Y={class:"d-flex",style:{"padding-bottom":"20px"}},q={class:"w-100",style:{height:"calc(100vh - 320px)"}},X={key:0,src:$,alt:"pro",width:"50"},Z=["src"],ee={style:{"font-weight":"bold","align-self":"self-end","margin-left":"5px"}},te={key:0},se={style:{margin:"15px"}},ne=["src"],oe={class:"ml-3"},ie={style:{"font-weight":"bold"}},re=["innerHTML"],le={key:1},ae=["innerHTML"],ce={key:2},de={key:0},ue=["innerHTML"],pe={key:1},me={key:0,style:{"marin-top":"20px"}},ge={key:0,style:{"align-items":"center"}},he={style:{"font-weight":"bold"}},fe=["href"],_e={key:1,style:{display:"flex","align-items":"center","justify-content":"space-between"}},ye={style:{"margin-top":"20px"}},ve={style:{"font-weight":"bold"}},be={style:{"margin-top":"auto","font-size":"x-small"}},ke=["href"],we=["href"],Ce=["src"],Se={key:3},Me={key:0,class:"d-flex align-items-center justify-content-center"},xe={class:"text-center"},Pe=["src"],Ie={style:{"font-size":"small"}},Le=n("div",{style:{"font-size":"large",margin:"0 10px","align-self":"center"}},">>",-1),Re={class:"text-center"},Ve=["src"],Ae={style:{"font-size":"small"}},Te=["innerHTML"],$e={key:4},je=["innerHTML"],ze={key:1,style:{margin:"5%"}},He=n("img",{src:$,alt:"pro",width:"50"},null,-1),Be=T(" system "),Oe={class:"d-flex align-center pa-0"},Ne=n("div",{id:"imagePreview",style:{"max-width":"300px"}},null,-1);function Ee(e,t,o,a,i,u){const m=v("Icons"),g=v("perfect-scrollbar"),h=v("PhotoIcon");return l(),c("div",W,[n("div",null,[d(g,{class:"rightpartHeight h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:p(()=>[n("div",Y,[n("div",q,[i.result?(l(!0),c(b,{key:0},k(i.result.chats,(s,_)=>(l(),c("div",{key:s.id,style:{margin:"5%"}},[d(L,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:p(()=>[d(w,{size:"40"},{default:p(()=>[s.role=="system"?(l(),c("img",X)):(l(),c("img",{key:1,src:s.profile,alt:"pro",width:"50"},null,8,Z))]),_:2},1024),n("div",ee,f(s.role),1)]),_:2},1024),n("div",{class:C(["progress-border",{animate:e.borderCompletedAnimated}])},[i.result.chats.length-1==_?(l(),c(b,{key:0},k(5,r=>n("div",{class:C(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:r},null,2)),64)):y("",!0),d(V,{class:"bg-lightsecondary rounded-md px-3 py-2"},{default:p(()=>[s.action=="agents"?(l(),c("div",te,[n("div",se,'요청 주신 "'+f(i.newMessage)+'"작업을 위해서 팀 구성을 아래와 같이 하였습니다.',1),(l(!0),c(b,null,k(s.content,r=>(l(),c("div",{key:r.name,class:"d-flex align-items-start mb-3",style:{"margin-left":"5%"}},[d(w,{size:"40"},{default:p(()=>[n("img",{src:r.profile,alt:"profile",width:"50"},null,8,ne)]),_:2},1024),n("div",oe,[n("div",ie,f(r.role),1),n("div",{innerHTML:r.explanation},null,8,re)])]))),128))])):s.action=="search"?(l(),c("div",le,[n("div",{innerHTML:s.content},null,8,ae)])):s.action=="searchOutput"?(l(),c("div",ce,[typeof s.content=="string"?(l(),c("div",de,[n("div",{innerHTML:s.content,class:"mt-2"},null,8,ue)])):(l(),c("div",pe,[(l(!0),c(b,null,k(s.content,r=>(l(),c("div",null,[r.link?(l(),c("div",me,[u.isFileLink(r.link)?(l(),c("div",ge,[n("div",he,[T(f(r.title)+" ",1),n("a",{href:s.content.link,target:"_blank",style:{"margin-right":"10px"}},[d(m,{icon:"file-type-pdf2",size:35})],8,fe)]),n("div",null,f(r.snippet),1)])):(l(),c("div",_e,[n("div",ye,[n("div",ve,f(r.title),1),n("div",null,f(r.snippet),1),n("div",be,[n("a",{href:r.link,target:"_blank",style:{color:"#0000EE","text-decoration":"underline"}},f(r.link),9,ke)])]),n("a",{href:r.link,target:"_blank",style:{"margin-right":"10px"}},[u.generatePreviewImage(r.link)?(l(),c("img",{key:0,src:u.generatePreviewImage(r.link),alt:"preview",style:{width:"100px",height:"100px"}},null,8,Ce)):y("",!0)],8,we)]))])):y("",!0)]))),256))]))])):s.action=="delegate"?(l(),c("div",Se,[s.role!=s.delegate?(l(),c("div",Me,[n("div",xe,[d(w,{size:"40"},{default:p(()=>[n("img",{src:s.profile,alt:"profile",width:"50"},null,8,Pe)]),_:2},1024),n("div",Ie,f(s.role),1)]),Le,n("div",Re,[d(w,{size:"40"},{default:p(()=>[n("img",{src:s.delegateProfile,alt:"profile",width:"50"},null,8,Ve)]),_:2},1024),n("div",Ae,f(s.delegate),1)])])):y("",!0),n("div",{innerHTML:s.content,class:"mt-2"},null,8,Te)])):s.action=="system"?(l(),c("div",$e,[n("div",{innerHTML:s.content},null,8,je)])):y("",!0)]),_:2},1024),i.result.chats.length-1==_&&i.isConnection?(l(),S(R,{key:1,indeterminate:"",class:"my-progress-linear"})):y("",!0)],2)]))),128)):y("",!0),i.result&&i.result.chats.length==0&&i.isRunning?(l(),c("div",ze,[d(L,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important","align-items":"center"}},{default:p(()=>[d(w,{size:"40",style:{"margin-right":"5px"}},{default:p(()=>[He]),_:1}),Be]),_:1}),n("div",{class:C(["progress-border",{animate:e.borderCompletedAnimated}])},[n("template",null,[(l(),c(b,null,k(5,s=>n("div",{class:C(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:s},null,2)),64))]),d(V,{class:"bg-lightsecondary rounded-md px-3 py-2",style:{height:"100px"}}),d(R,{indeterminate:"",class:"my-progress-linear"})],2)])):y("",!0)])])]),_:1},8,["onScroll"])]),d(O),n("form",Oe,[n("input",{type:"file",accept:"image/*",ref:"uploader",class:"d-none",onChange:t[0]||(t[0]=(...s)=>e.changeImage&&e.changeImage(...s))},null,544),Ne,d(D,{variant:"solo","hide-details":"",modelValue:i.newMessage,"onUpdate:modelValue":t[2]||(t[2]=s=>i.newMessage=s),color:"primary",class:"shadow-none",density:"compact",placeholder:e.$t("chat.inputMessage"),"auto-grow":"",rows:"1",onKeydown:t[3]||(t[3]=E(s=>!s.shiftKey&&u.sendMessage(),["enter"])),disabled:e.disableChat},{"prepend-inner":p(()=>[d(x,{icon:"",variant:"text",class:"text-medium-emphasis",onClick:e.uploadImage},{default:p(()=>[d(h,{size:"20"})]),_:1},8,["onClick"])]),"append-inner":p(()=>[i.isRunning?(l(),S(x,{key:1,icon:"",variant:"text",class:"text-medium-emphasis"},{default:p(()=>[d(N,{style:{top:"50%"},indeterminate:"",color:"primary"})]),_:1})):(l(),S(x,{key:0,icon:"",variant:"text",type:"submit",onClick:t[1]||(t[1]=s=>u.sendMessage()),class:"text-medium-emphasis",disabled:!i.newMessage},{default:p(()=>[d(m,{icon:"document-sparkle"})]),_:1},8,["disabled"]))]),_:1},8,["modelValue","placeholder","disabled"])])])}const De=A(K,[["render",Ee]]),Ue={mixins:[],name:"Proposals",components:{Proposal:De,AppBaseCard:J,ChatListing:Q,ChatProfile:G},data:()=>({prompt:null,definitions:[],processDefinition:null,path:"chats",organizationChart:[],tableData:null,documentQueryStr:null,agentWS:null,isConnection:!1,log:""}),async created(){},mounted(){},methods:{}},Fe={class:"no-scrollbar"};function Je(e,t,o,a,i,u){const m=v("ChatProfile"),g=v("ChatListing"),h=v("Proposal"),s=v("AppBaseCard");return l(),S(U,{elevation:"10"},{default:p(()=>[d(s,null,{leftpart:p(()=>[n("div",Fe,[d(m),d(g)])]),rightpart:p(()=>[d(h,{messages:e.messages,userInfo:e.userInfo,type:e.path,documentQueryStr:e.documentQueryStr,onBeforeReply:e.beforeReply,onSendMessage:e.beforeSendMessage,onSendEditedMessage:e.sendEditedMessage,onStopMessage:e.stopMessage,onGetMoreChat:e.getMoreChat},null,8,["messages","userInfo","type","documentQueryStr","onBeforeReply","onSendMessage","onSendEditedMessage","onStopMessage","onGetMoreChat"])]),mobileLeftContent:p(()=>[d(m),d(g)]),_:1})]),_:1})}const Xe=A(Ue,[["render",Je]]);export{Xe as default};
