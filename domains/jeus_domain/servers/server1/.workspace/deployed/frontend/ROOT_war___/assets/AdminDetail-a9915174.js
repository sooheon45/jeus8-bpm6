import{_ as R,B as _,ba as T,r as $,o as p,c as g,b as l,w as s,Q as D,E as h,V as y,D as V,aS as B,a as w,t as u,U as I,d as v,F as N,i as O,ao as E,e as b,j as U,n as A,l as L,p as x,W as C,f as P,R as M,m as j,X as z}from"./index-7b37f28a.js";import{B as J,c as F}from"./index-5e2cd834.js";const k=_.createBackend(),W={name:"admin-detail",components:{BpmnUengineViewer:J,VDataTable:T},data:()=>({instanceId:null,instanceDetail:null,tab:null,processDefinition:null,processVariables:[],properties:[],executionScopeActivities:{},loaded:!1,eventList:[],options:{propertiesPanel:{invalidationList:{}},additionalModules:[F]},roles:[],currentActivities:[],activityVariables:{},selectedExecutionScope:null,taskStatus:{},rollbackDialog:!1,rollbackElement:null}),async created(){await this.init()},mounted(){this.headers=[{title:this.$t("adminDetail.key"),align:"start",key:"key",sortable:!1},{title:this.$t("adminDetail.value"),align:"start",key:"value"},{title:this.$t("adminDetail.tools"),align:"start",key:"save"}]},computed:{rollbackElementName(){return this.rollbackElement?this.rollbackElement.businessObject?this.rollbackElement.businessObject.name:"":null}},watch:{processDefinition(){},async $route(e,a){await this.init()},selectedExecutionScope(e){console.log(e),this.init()}},methods:{formatJsonValue(e){try{const a=JSON.parse(e);return JSON.stringify(a,null,4)}catch(a){return alert("AdminDetail formatJsonValue methods error"+a.message),e}},async init(){let e=this,a=performance.now();this.loaded=!1,this.instanceId=this.$route.params.id,this.eventList=await k.getEventList(this.instanceId),await this.getInstanceDetail(),await this.getProcessDefinition(),e.$try({action:async()=>{e.taskStatus=await k.getActivitiesStatus(this.instanceId)}}),await this.getProcessVariables();let i=performance.now();console.log(`Result Time :  ${i-a} ms`)},viewDetail(e){console.log(e)},async getInstanceDetail(){let e=performance.now(),a=this;await k.getInstance(this.instanceId).then(i=>{a.instanceDetail=i;let m=performance.now();console.log(`getInstanceDetail Result Time :  ${m-e} ms`)})},openSubProcess(e){this.$router.push({name:"Admin Detail",params:{id:this.activityVariables[e.id].instanceIdOfSubProcess}})},fireMessage(e){k.fireMessage(this.instanceId,e)},async getProcessDefinition(){let e=performance.now(),a=this,i=this.instanceDetail.defId,m=decodeURIComponent(i),n={type:"bpmn",version:this.instanceDetail.defVer};await k.getRawDefinition(m,n).then(c=>{a.processDefinition=c;let r=performance.now();console.log(`getProcessDefinition Result Time :  ${r-e} ms`)})},async getProcessVariables(){let e=performance.now(),a=this;await k.getProcessVariables(this.instanceDetail.instanceId).then(i=>{a.setVariableList(i);let m=performance.now();console.log(`getProcessVariables Result Time :  ${m-e} ms`)})},showRollbackDialog(e,a){this.rollbackDialog=e,this.rollbackElement=a},async rollback(e){let a=this;console.log(e);let i=null;e.businessObject.$parent.$type=="bpmn:SubProcess"?i=e.id+":"+this.selectedExecutionScope.executionScope:i=e.id,console.log(i),await k.backToHere(this.instanceId,i).then(m=>{a.init(),a.showRollbackDialog(!1,null)}).catch(m=>{alert(m)})},setVariableList(e){let a=performance.now(),i=this;i.processVariables=[],i.roles=[],i.activityVariables={},i.currentActivities=[];for(let n of Object.keys(e)){let c=(n.match(new RegExp(":","g"))||[]).length;if(n.includes("_executionScopes")){const r=e[n];let d={};for(let o of r){d[o.rootActivityTracingTag]||(d[o.rootActivityTracingTag]={});let t={parent:o.parent?o.parent.executionScope:null};d[o.rootActivityTracingTag][o.executionScope]=t}i.executionScopeActivities=d}if(n.includes(":_roleMapping_of_")){let r={name:n.replace(":_roleMapping_of_",""),endpoint:e[n].endpoint,resourceName:e[n].resourceName};i.roles.push(r)}else if(n.startsWith(":")){if(n.includes("_executionScopes"))continue;let d=n.slice(1).split(":")[0];if(isNaN(d)){let o={key:n.split(":").slice(1).join(":"),value:JSON.stringify(e[n])};n.includes(":prop")?i.properties.push(o):i.processVariables.push(o)}else{if(i.selectedExecutionScope&&d!=i.selectedExecutionScope.executionScope)continue;let o={key:n.split(":").slice(1).join(":"),value:JSON.stringify(e[n])};n.includes(":prop")?i.properties.push(o):i.processVariables.push(o)}}else if(n.includes("_status")){if(e[n]=="Completed"||e[n]=="Running")if(c==3){let r=n.split(":")[1];i.selectedExecutionScope&&i.selectedExecutionScope.executionScope==r&&i.currentActivities.push(n.split(":")[0])}else c==2&&i.currentActivities.push(n.split(":")[0])}else if(n.includes(":")){if(n.includes("ExecutionScope"))continue;if(c==2){let r=n.split(":")[0],d=n.split(":")[1],o=e[n];i.activityVariables[r]||(i.activityVariables[r]={}),i.activityVariables[r][d]=o}else if(c==3){let r=n.split(":")[0];n.split(":")[1];let d=n.split(":")[2],o=e[n];i.activityVariables[r]||(i.activityVariables[r]={}),i.activityVariables[r][d]=o}}}i.loaded=!0;let m=performance.now();console.log(`setVariableList Result Time :  ${m-a} ms`)},async updateItem(e){let a=this,i=e.key,m=JSON.parse(e.value);e.editMode=!1,await k.setVariable(a.instanceId,i,m)}}},K=v("mdi-arrow-left"),H={key:1,class:"pa-6"},Q={key:1,style:{"white-space":"pre-wrap"}},X={key:1,style:{"white-space":"pre-wrap"}};function q(e,a,i,m,n,c){const r=$("BpmnUengineViewer"),d=$("Icons"),o=$("PencilIcon");return p(),g("div",null,[l(P,{elevation:"10"},{default:s(()=>[l(D,{class:"ma-0 pa-4"},{default:s(()=>[l(h,{location:"bottom"},{activator:s(({props:t})=>[l(y,V(t,{onClick:a[0]||(a[0]=f=>e.$router.push("/admin")),icon:"",variant:"text",type:"file",class:"text-medium-emphasis mr-3",density:"comfortable",size:"28"}),{default:s(()=>[l(B,{left:""},{default:s(()=>[K]),_:1})]),_:2},1040)]),default:s(()=>[w("span",null,u(e.$t("adminDetail.goBack")),1)]),_:1}),l(I,{class:"ma-0 pa-0"},{default:s(()=>[v("Instance - "+u(e.instanceId),1)]),_:1}),(p(!0),g(N,null,O(e.eventList,t=>(p(),g("div",{key:t},[l(y,{onClick:f=>e.$try({context:this,action:()=>c.fireMessage(t.tracingTag),successMsg:`${t.name} ${this.$t("adminDetail.success")}`}),color:"primary",rounded:"",style:{"font-size":"12px"},density:"comfortable",class:"ml-3"},{default:s(()=>[v(u(t.name?t.name:t.tracingTag)+" "+u(e.$t("adminDetail.send")),1)]),_:2},1032,["onClick"])]))),128))]),_:1}),l(D,{class:"ma-0 pa-0 pb-2"},{default:s(()=>[l(E,{class:"ma-0 pa-0",cols:"12",lg:"6",md:"12",sm:"12",style:{height:"69vh",overflow:"auto","border-right":"solid 1px #ADADAD"}},{default:s(()=>[e.loaded?(p(),b(r,{key:0,ref:"bpmnVue",bpmn:e.processDefinition,options:e.options,adminMode:!0,currentActivities:e.currentActivities,executionScopeActivities:e.executionScopeActivities,selectedExecutionScope:e.selectedExecutionScope,"task-status":e.taskStatus,onSelectedExecutionScope:a[1]||(a[1]=t=>e.selectedExecutionScope=t),onOpenDefinition:a[2]||(a[2]=t=>c.openSubProcess(t)),onOpenPanel:a[3]||(a[3]=t=>e.openPanel(t)),onRollback:a[4]||(a[4]=t=>c.showRollbackDialog(!0,t)),style:{height:"100%"}},null,8,["bpmn","options","currentActivities","executionScopeActivities","selectedExecutionScope","task-status"])):(p(),g("div",H,u(e.$t("adminDetail.noProcessDefinition")),1))]),_:1}),l(E,{class:"ma-0 pa-4 pt-0",cols:"12",lg:"6",md:"12",sm:"12",style:{height:"69vh",overflow:"auto"}},{default:s(()=>[l(U,{modelValue:e.tab,"onUpdate:modelValue":a[5]||(a[5]=t=>e.tab=t),color:"primary"},{default:s(()=>[l(A,null,{default:s(()=>[v(u(e.$t("adminDetail.processVariables")),1)]),_:1}),l(A,null,{default:s(()=>[v(u(e.$t("adminDetail.properties")),1)]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:e.tab,"onUpdate:modelValue":a[6]||(a[6]=t=>e.tab=t)},{default:s(()=>[l(x,null,{default:s(()=>[l(T,{items:e.processVariables,headers:e.headers,"item-value":"key",class:"elevation-1 custom-table"},{"item.key":s(({item:t})=>[w("span",null,u(t.key),1)]),"item.value":s(({item:t})=>[t.editMode?(p(),b(C,{key:0,modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,outlined:"",dense:"","hide-details":"true"},null,8,["modelValue","onUpdate:modelValue"])):(p(),g("span",Q,u(c.formatJsonValue(t.value)),1))]),"item.save":s(({item:t})=>[t.editMode?(p(),b(h,{key:0,text:e.$t("adminDetail.save")},{activator:s(({props:f})=>[l(y,V({onClick:S=>c.updateItem(t)},f,{icon:"",variant:"text",density:"comfortable"}),{default:s(()=>[l(d,{icon:"save",size:18,class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])):(p(),b(h,{key:1,text:e.$t("adminDetail.edit")},{activator:s(({props:f})=>[l(y,V({onClick:S=>t.editMode=!0},f,{density:"comfortable",icon:"",flat:""}),{default:s(()=>[l(o,{"stroke-width":"1.5",size:"18",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]))]),_:2},1032,["items","headers"])]),_:1}),l(x,null,{default:s(()=>[l(T,{items:e.properties,headers:e.headers,"item-value":"key","items-per-page":10,class:"elevation-1 custom-table"},{"item.key":s(({item:t})=>[w("span",null,u(t.key),1)]),"item.value":s(({item:t})=>[t.editMode?(p(),b(C,{key:0,modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,outlined:"",dense:"","hide-details":"true"},null,8,["modelValue","onUpdate:modelValue"])):(p(),g("span",X,u(t.value),1))]),"item.save":s(({item:t})=>[t.editMode?(p(),b(h,{key:0,text:e.$t("adminDetail.save")},{activator:s(({props:f})=>[l(y,V({onClick:S=>c.updateItem(t)},f,{icon:"",variant:"text",density:"comfortable"}),{default:s(()=>[l(d,{icon:"save",size:18,class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])):(p(),b(h,{key:1,text:e.$t("adminDetail.edit")},{activator:s(({props:f})=>[l(y,V({onClick:S=>t.editMode=!0},f,{density:"comfortable",icon:"",flat:""}),{default:s(()=>[l(o,{"stroke-width":"1.5",size:"18",class:"text-primary"})]),_:2},1040,["onClick"])]),_:2},1032,["text"]))]),_:2},1032,["items","headers"])]),_:1})]),_:1},8,["modelValue"]),(p(),b(z,{modelValue:e.rollbackDialog,"onUpdate:modelValue":a[9]||(a[9]=t=>e.rollbackDialog=t),width:"500",style:{"z-index":"9999"},key:e.rollbackElement},{default:s(()=>[l(P,{class:"pa-4"},{default:s(()=>[l(D,{class:"ma-0 pa-0"},{default:s(()=>[l(I,{class:"ma-0 pa-0"},{default:s(()=>[v(u(e.$t("adminDetail.rollback")),1)]),_:1}),l(M),l(y,{onClick:a[7]||(a[7]=t=>c.showRollbackDialog(!1,null)),icon:"",variant:"text",density:"comfortable",style:{"margin-top":"-8px"}},{default:s(()=>[l(d,{icon:"close",size:16})]),_:1})]),_:1}),l(j,{class:"pa-0 pt-4 pb-4"},{default:s(()=>[w("div",null,'"'+u(c.rollbackElementName)+'"'+u(e.$t("adminDetail.rollbackMessage")),1)]),_:1}),l(D,{class:"pa-0 ma-0"},{default:s(()=>[l(M),l(y,{color:"primary",rounded:"",onClick:a[8]||(a[8]=t=>c.rollback(e.rollbackElement))},{default:s(()=>[v(u(e.$t("adminDetail.start")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))]),_:1})]),_:1})]),_:1})])}const Z=R(W,[["render",q]]);export{Z as default};
