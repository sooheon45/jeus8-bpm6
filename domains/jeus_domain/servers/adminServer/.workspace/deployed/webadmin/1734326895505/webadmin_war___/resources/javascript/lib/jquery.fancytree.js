/*!
 * jquery.fancytree.js
 * Dynamic tree view control, with support for lazy loading of branches.
 * https://github.com/mar10/fancytree/
 *
 * Copyright (c) 2006-2014, Martin Wendt (http://wwWendt.de)
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.4.1
 * @date 2014-09-23T19:33
 */

(function(e,t,n,r){function i(t){t=t||"",e.error("Not implemented: "+t)}function s(t,n){t||(n=n?": "+n:"",e.error("Fancytree assertion failed"+n))}function o(e,n){var r,i,s=t.console?t.console[e]:null;if(s)if(s.apply)s.apply(t.console,n);else{i="";for(r=0;r<n.length;r++)i+=n[r];s(i)}}function u(e){return!!e.tree&&e.statusNodeType!==r}function a(t,n,r,i){var s,o,u,a=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),f=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(s=0;s<f.length;s++){o=a[s]||0,u=f[s]||0;if(o!==u)return o>u}return!0}function f(e,t,n,r,i){var s=function(){var n=t[e],s=r[e],o=t.ext[i],u=function(){return n.apply(t,arguments)};return function(){var e=t._local,n=t._super;try{return t._local=o,t._super=u,s.apply(t,arguments)}finally{t._local=e,t._super=n}}}();return s}function l(t,n,r,i){for(var s in r)typeof r[s]=="function"?typeof t[s]=="function"?t[s]=f(s,t,n,r,i):s.charAt(0)==="_"?t.ext[i][s]=f(s,t,n,r,i):e.error("Could not override tree."+s+". Use prefix '_' to create tree."+i+"._"+s):s!=="options"&&(t.ext[i][s]=r[s])}function c(t,n){return t===r?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function h(t,n){return t===r?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function p(e,t){return function(){e.resolveWith(t)}}function d(t){var n=e.extend({},t.data()),r=n.json;return delete n.fancytree,r&&(delete n.json,n=e.extend(n,r)),n}function v(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function T(t,n){var r,i,o,u;this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={};for(r=0,i=E.length;r<i;r++)o=E[r],this[o]=n[o];n.data&&e.extend(this.data,n.data);for(o in n)!S[o]&&!e.isFunction(n[o])&&!x[o]&&(this.data[o]=n[o]);this.key==null?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),s(this.key,"defaultKey() must return a unique key")):this.key="_"+g._nextNodeKey++:this.key=""+this.key,n.active&&(s(this.tree.activeNode===null,"only one active node allowed"),this.tree.activeNode=this),n.selected&&(this.tree.lastSelectedNode=this),this.children=null,u=n.children,u&&u.length&&this._setChildren(u),this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function N(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&e.isFunction(this.options.lazyload)&&(e.isFunction(this.options.lazyLoad)||(this.options.lazyLoad=function(){g.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),t.options.lazyload.apply(this,arguments)})),this.options&&e.isFunction(this.options.loaderror)&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.ext={},this.data=d(this.$div),this._id=this.options.id==null?e.ui.fancytree._nextId++:this.options.id,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this.lastSelectedNode=null,this.systemFocusElement=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n={tree:this},r;this.rootNode=new T(n,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,r=e("<ul>",{"class":"ui-fancytree fancytree-container"}).appendTo(this.$div),this.$container=r,this.rootNode.ul=r[0],this.options.debugLevel==null&&(this.options.debugLevel=g.debugLevel),this.$container.attr("tabindex",this.options.tabbable?"0":"-1"),this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}if(e.ui.fancytree&&e.ui.fancytree.version){e.ui.fancytree.warn("Fancytree: ignored duplicate include");return}var m,g=null,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},b="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),w={},E="expanded extraClasses folder hideCheckbox key lazy refKey selected title tooltip unselectable".split(" "),S={},x={active:!0,children:!0,data:!0,focus:!0};for(m=0;m<b.length;m++)w[b[m]]=!0;for(m=0;m<E.length;m++)S[E[m]]=!0;T.prototype={_findDirectChild:function(e){var t,n,r=this.children;if(r)if(typeof e=="string"){for(t=0,n=r.length;t<n;t++)if(r[t].key===e)return r[t]}else{if(typeof e=="number")return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){s(e&&(!this.children||this.children.length===0),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new T(this,e[t]))},addChildren:function(t,n){var r,i,o,u=null,a=[];e.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]);for(r=0,i=t.length;r<i;r++)a.push(new T(this,t[r]));return u=a[0],n==null?this.children=this.children.concat(a):(n=this._findDirectChild(n),o=e.inArray(n,this.children),s(o>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[o,0].concat(a))),(!this.parent||this.parent.ul||this.tr)&&this.render(),this.tree.options.selectMode===3&&this.fixSelection3FromEndNodes(),u},addNode:function(e,t){if(t===r||t==="over")t="child";switch(t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"child":case"over":return this.addChildren(e)}s(!1,"Invalid mode: "+t)},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(t){if(t===null)return this.remove(),c(this);var n,r,i,s={children:!0,expanded:!0,parent:!0};for(n in t)i=t[n],!s[n]&&!e.isFunction(i)&&(S[n]?this[n]=i:this.data[n]=i);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?r=this.setExpanded(t.expanded):r=c(this),r},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t=this.children,n,r,i;if(!t)return 0;i=t.length;if(e!==!1)for(n=0,r=i;n<r;n++)i+=t[n].countChildren();return i},debug:function(e){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("debug",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},findAll:function(t){t=e.isFunction(t)?t:v(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:v(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},_changeSelectStatusAttrs:function(e){var t=!1;switch(e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case r:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:s(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var e=this.isSelected();this.visit(function(t){t._changeSelectStatusAttrs(e)}),this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){function e(t){var n,i,s,o,u,a,f,l=t.children;if(l&&l.length){a=!0,f=!1;for(n=0,i=l.length;n<i;n++)s=l[n],o=e(s),o!==!1&&(f=!0),o!==!0&&(a=!1);u=a?!0:f?r:!1}else u=!!t.selected;return t._changeSelectStatusAttrs(u),u}s(this.tree.options.selectMode===3,"expected selectMode 3"),e(this),this.visitParents(function(e){var t,n,i,s,o=e.children,u=!0,a=!1;for(t=0,n=o.length;t<n;t++){i=o[t];if(i.selected||i.partsel)a=!0;!i.unselectable&&!i.selected&&(u=!1)}s=u?!0:a?r:!1,e._changeSelectStatusAttrs(s)})},fromDict:function(t){for(var n in t)S[n]?this[n]=t[n]:n==="data"?e.extend(this.data,t.data):!e.isFunction(t[n])&&!x[n]&&(this.data[n]=t[n]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){return this.hasChildren()===r?r:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t){t=t||".";var n=[];return e.each(this.getParentList(!1,!0),function(e,t){n.push(t.getIndex()+1)}),n.join(t)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){var e=0,t=this.parent;while(t)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){var n=[],r=t?this:this.parent;while(r)(e||r.parent)&&n.unshift(r),r=r.parent;return n},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},hasChildren:function(){if(this.lazy)return this.children==null?r:this.children.length===0?!1:this.children.length===1&&this.children[0].isStatusNode()?r:!0;return!!this.children&&!!this.children.length},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;var t=this.parent;while(t){if(t===e)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==r},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===r},isVisible:function(){var e,t,n=this.getParentList(!1,!1);for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t,n,r=this;return!e&&!this.isUndefined()?c(this):(this.isLoaded()&&this.resetLazy(),n=this.tree._triggerNodeEvent("lazyLoad",this),n===!1?c(this):(s(typeof n!="boolean","lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,n),this.expanded&&t.always(function(){r.render()}),t))},makeVisible:function(t){var n,r=this,i=[],s=new e.Deferred,o=this.getParentList(!1,!1),u=o.length,a=!t||t.noAnimation!==!0,f=!t||t.scrollIntoView!==!1;for(n=u-1;n>=0;n--)i.push(o[n].setExpanded(!0,t));return e.when.apply(e,i).done(function(){f?r.scrollIntoView(a).done(function(){s.resolve()}):s.resolve()}),s.promise()},moveTo:function(t,n,i){if(n===r||n==="over")n="child";var o,u=this.parent,a=n==="child"?t:t.parent;if(this===t)return;if(!this.parent)throw"Cannot move system root";if(a.isDescendantOf(this))throw"Cannot move a node to its own descendant";if(this.parent.children.length===1){if(this.parent===a)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else o=e.inArray(this,this.parent.children),s(o>=0),this.parent.children.splice(o,1);this.parent=a;if(a.hasChildren())switch(n){case"child":a.children.push(this);break;case"before":o=e.inArray(t,a.children),s(o>=0),a.children.splice(o,0,this);break;case"after":o=e.inArray(t,a.children),s(o>=0),a.children.splice(o+1,0,this);break;default:throw"Invalid mode "+n}else a.children=[this];i&&t.visit(i,!0),this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(e){e.tree=t.tree},!0)),u.isDescendantOf(a)||u.render(),!a.isDescendantOf(u)&&a!==u&&a.render()},navigate:function(t,n){function a(r){if(r){try{r.makeVisible()}catch(i){}if(!e(r.span).is(":visible")){r.debug("Navigate: skipping hidden node"),r.navigate(t,n);return}return n===!1?r.setFocus():r.setActive()}}var r,i,s=!0,o=e.ui.keyCode,u=null;switch(t){case o.BACKSPACE:this.parent&&this.parent.parent&&a(this.parent);break;case o.LEFT:this.expanded?(this.setExpanded(!1),a(this)):this.parent&&this.parent.parent&&a(this.parent);break;case o.RIGHT:!this.expanded&&(this.children||this.lazy)?(this.setExpanded(),a(this)):this.children&&this.children.length&&a(this.children[0]);break;case o.UP:u=this.getPrevSibling();while(u&&u.expanded&&u.children&&u.children.length)u=u.children[u.children.length-1];!u&&this.parent&&this.parent.parent&&(u=this.parent),a(u);break;case o.DOWN:if(this.expanded&&this.children&&this.children.length)u=this.children[0];else{i=this.getParentList(!1,!0);for(r=i.length-1;r>=0;r--){u=i[r].getNextSibling();if(u)break}}a(u);break;default:s=!1}},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=r,this.renderStatus()},scheduleAction:function(e,t){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:throw"Invalid mode "+e}},scrollIntoView:function(i,o){o!==r&&u(o)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),o={topNode:o});var a,f,l,c,h=e.extend({effects:i===!0?{duration:200,queue:!1}:i,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},o),p=new e.Deferred,d=this,v=e(this.span).height(),m=e(h.scrollParent),g=h.scrollOfs.top||0,y=h.scrollOfs.bottom||0,b=m.height(),w=m.scrollTop(),E=m,S=m[0]===t,x=h.topNode||null,T=null;return s(e(this.span).is(":visible"),"scrollIntoView node is invisible"),S?(f=e(this.span).offset().top,a=x&&x.span?e(x.span).offset().top:0,E=e("html,body")):(s(m[0]!==n&&m[0]!==n.body,"scrollParent should be an simple element or `window`, not document or body."),c=m.offset().top,f=e(this.span).offset().top-c+w,a=x?e(x.span).offset().top-c+w:0,l=Math.max(0,m.innerHeight()-m[0].clientHeight),b-=l),f<w+g?T=f-g:f+v>w+b-y&&(T=f+v-b+y,x&&(s(x.isRoot()||e(x.span).is(":visible"),"topNode must be visible"),a<T&&(T=a-g))),T!==null?h.effects?(h.effects.complete=function(){p.resolveWith(d)},E.stop(!0).animate({scrollTop:T},h.effects)):(E[0].scrollTop=T,p.resolveWith(this)):p.resolveWith(this),p.promise()},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e){return this.tree._callHook("nodeSetSelected",this,e)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle()},sortChildren:function(e,t){var n,r,i=this.children;if(!i)return;e=e||function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();return n===r?0:n>r?1:-1},i.sort(e);if(t)for(n=0,r=i.length;n<r;n++)i[n].children&&i[n].sortChildren(e,"$norender$");t!=="$norender$"&&this.render()},toDict:function(t,n){var r,i,s,o={},u=this;e.each(E,function(e,t){if(u[t]||u[t]===!1)o[t]=u[t]}),e.isEmptyObject(this.data)||(o.data=e.extend({},this.data),e.isEmptyObject(o.data)&&delete o.data),n&&n(o);if(t&&this.hasChildren()){o.children=[];for(r=0,i=this.children.length;r<i;r++)s=this.children[r],s.isStatusNode()||o.children.push(s.toDict(!0,n))}return o},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(e,t){var n,r,i=!0,s=this.children;if(t===!0){i=e(this);if(i===!1||i==="skip")return i}if(s)for(n=0,r=s.length;n<r;n++){i=s[n].visit(e,!0);if(i===!1)break}return i},visitAndLoad:function(t,n,r){var i,s,o,u=this;if(t&&n===!0){s=t(u);if(s===!1||s==="skip")return r?s:c()}return!u.children&&!u.lazy?c():(i=new e.Deferred,o=[],u.load().done(function(){for(var n=0,r=u.children.length;n<r;n++){s=u.children[n].visitAndLoad(t,!0,!0);if(s===!1){i.reject();break}s!=="skip"&&o.push(s)}e.when.apply(this,o).then(function(){i.resolve()})}),i.promise())},visitParents:function(e,t){if(t&&e(this)===!1)return!1;var n=this.parent;while(n){if(e(n)===!1)return!1;n=n.parent}return!0},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},N.prototype={_makeHookContext:function(t,n,i){var s,o;return t.node!==r?(n&&t.originalEvent!==n&&e.error("invalid args"),s=t):t.tree?(o=t.tree,s={node:t,tree:o,widget:o.widget,options:o.widget.options,originalEvent:n}):t.widget?s={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:n}:e.error("invalid args"),i&&e.extend(s,i),s},_callHook:function(t,n,r){var i=this._makeHookContext(n),s=this[t],o=Array.prototype.slice.call(arguments,2);return e.isFunction(s)||e.error("_callHook('"+t+"') is not a function"),o.unshift(i),s.apply(this,o)},_requireExtension:function(t,n,r,i){r=!!r;var o=this._local.name,u=this.options.extensions,a=e.inArray(t,u)<e.inArray(o,u),f=n&&this.ext[t]==null,l=!f&&r!=null&&r!==a;return s(o&&o!==t),f||l?(i||(f||n?(i="'"+o+"' extension requires '"+t+"'",l&&(i+=" to be registered "+(r?"before":"after")+" itself")):i="If used together, `"+t+"` must be registered "+(r?"before":"after")+" `"+o+"`"),e.error(i),!1):!0},activateKey:function(e){var t=this.getNodeByKey(e);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},applyPatch:function(t){var n,r,i,o,u,a,f=t.length,l=[];for(r=0;r<f;r++)i=t[r],s(i.length===2,"patchList must be an array of length-2-arrays"),o=i[0],u=i[1],a=o===null?this.rootNode:this.getNodeByKey(o),a?(n=new e.Deferred,l.push(n),a.applyPatch(u).always(p(n,a))):this.warn("could not find node with key '"+o+"'");return e.when.apply(e,l).promise()},count:function(){return this.rootNode.countChildren()},debug:function(e){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),o("debug",arguments))},generateFormElements:function(t,n,r){var i,s=t!==!1?"ft_"+this._id+"[]":t,o=n!==!1?"ft_"+this._id+"_active":n,u="fancytree_result_"+this._id,a=e("#"+u);r=typeof r=="boolean"?r:this.options.selectMode===3,a.length?a.empty():a=e("<div>",{id:u}).hide().insertAfter(this.$container),s&&(i=this.getSelectedNodes(r),e.each(i,function(t,n){a.append(e("<input>",{type:"checkbox",name:s,value:n.key,checked:!0}))})),o&&this.activeNode&&a.append(e("<input>",{type:"radio",name:o,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(e){return this.focusNode},getNodeByKey:function(e,t){var r,i;if(!t){r=n.getElementById(this.options.idPrefix+e);if(r)return r.ftnode?r.ftnode:null}return t=t||this.rootNode,i=null,t.visit(function(t){if(t.key===e)return i=t,!1},!0),i},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){var t=[];return this.rootNode.visit(function(n){if(n.selected){t.push(n);if(e===!0)return"skip"}}),t},hasFocus:function(){return!!this._hasFocus},info:function(e){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),o("info",arguments))},loadKeyPath:function(t,n,i){function g(e,t,r){n.call(m,t,"loading"),t.load().done(function(){m.loadKeyPath.call(m,l[e],n,t).always(p(r,m))}).fail(function(i){m.warn("loadKeyPath: error loading: "+e+" (parent: "+h+")"),n.call(m,t,"error"),r.reject()})}var s,o,u,a,f,l,c,h,d,v=this.options.keyPathSeparator,m=this;e.isArray(t)||(t=[t]),l={};for(u=0;u<t.length;u++){h=i||this.rootNode,a=t[u],a.charAt(0)===v&&(a=a.substr(1)),d=a.split(v);while(d.length){f=d.shift(),c=h._findDirectChild(f);if(!c){this.warn("loadKeyPath: key not found: "+f+" (parent: "+h+")"),n.call(this,f,"error");break}if(d.length===0){n.call(this,c,"ok");break}if(!!c.lazy&&c.hasChildren()===r){n.call(this,c,"loaded"),l[f]?l[f].push(d.join(v)):l[f]=[d.join(v)];break}n.call(this,c,"loaded"),h=c}}s=[];for(f in l)c=h._findDirectChild(f),o=new e.Deferred,s.push(o),g(f,c,o);return e.when.apply(e,s).promise()},reactivate:function(e){var t=this.activeNode;t&&(this.activeNode=null,t.setActive(),e&&t.setFocus())},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(e,t,n,i){var s=this._makeHookContext(t,n,i),o=this.widget._trigger(e,n,s);return o!==!1&&s.result!==r?s.result:o},_triggerTreeEvent:function(e,t){var n=this._makeHookContext(this,t),i=this.widget._trigger(e,t,n);return i!==!1&&n.result!==r?n.result:i},visit:function(e){return this.rootNode.visit(e,!1)},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),o("warn",arguments)}},e.extend(N.prototype,{nodeClick:function(e){var t,n,r=e.originalEvent,i=e.targetType,s=e.node;if(i==="expander")this._callHook("nodeToggleExpanded",e);else if(i==="checkbox")this._callHook("nodeToggleSelected",e),this._callHook("nodeSetFocus",e,!0);else{n=!1,t=!0;if(s.folder)switch(e.options.clickFolderMode){case 2:n=!0,t=!1;break;case 3:t=!0,n=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&(!t,this._callHook("nodeToggleExpanded",e))}r.target.localName==="a"&&r.target.className==="fancytree-title"&&r.preventDefault()},nodeCollapseSiblings:function(e,t){var n,r,i,s=e.node;if(s.parent){n=s.parent.children;for(r=0,i=n.length;r<i;r++)n[r]!==s&&n[r].expanded&&this._callHook("nodeSetExpanded",n[r],!1,t)}},nodeDblclick:function(e){e.targetType==="title"&&e.options.clickFolderMode===4&&this._callHook("nodeToggleExpanded",e),e.targetType==="title"&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var n,r=t.originalEvent,i=t.node,s=t.tree,o=t.options,u=!0,a=!r.ctrlKey&&!!o.autoActivate,f=e.ui.keyCode;i||(this.rootNode.getFirstChild().setFocus(),i=t.node=this.focusNode,i.debug("Keydown force focus on first node"));switch(r.which){case f.NUMPAD_ADD:case 187:s.nodeSetExpanded(t,!0);break;case f.NUMPAD_SUBTRACT:case 189:s.nodeSetExpanded(t,!1);break;case f.SPACE:o.checkbox?s.nodeToggleSelected(t):s.nodeSetActive(t,!0);break;case f.ENTER:s.nodeSetActive(t,!0);break;case f.BACKSPACE:case f.LEFT:case f.RIGHT:case f.UP:case f.DOWN:n=i.navigate(r.which,a);break;default:u=!1}u&&r.preventDefault()},nodeLoadChildren:function(t,n){var r,i,o,u=t.tree,a=t.node;return e.isFunction(n)&&(n=n()),n.url&&(r=e.extend({},t.options.ajax,n),r.debugDelay?(i=r.debugDelay,e.isArray(i)&&(i=i[0]+Math.random()*(i[1]-i[0])),a.debug("nodeLoadChildren waiting debug delay "+Math.round(i)+"ms"),r.debugDelay=!1,o=e.Deferred(function(t){setTimeout(function(){e.ajax(r).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},i)})):o=e.ajax(r),n=new e.Deferred,o.done(function(r,i,s){var o,f;typeof r=="string"&&e.error("Ajax request returned a string (did you get the JSON dataType wrong?).");if(t.options.postProcess){f=u._triggerNodeEvent("postProcess",t,t.originalEvent,{response:r,error:null,dataType:this.dataType});if(f.error){o=e.isPlainObject(f.error)?f.error:{message:f.error},o=u._makeHookContext(a,null,o),n.rejectWith(this,[o]);return}r=e.isArray(f)?f:r}else r&&r.hasOwnProperty("d")&&t.options.enableAspx&&(r=typeof r.d=="string"?e.parseJSON(r.d):r.d);n.resolveWith(this,[r])}).fail(function(e,t,r){var i=u._makeHookContext(a,null,{error:e,args:Array.prototype.slice.call(arguments),message:r,details:e.status+": "+r});n.rejectWith(this,[i])})),e.isFunction(n.promise)&&(s(!a.isLoading()),u.nodeSetStatus(t,"loading"),n.done(function(e){u.nodeSetStatus(t,"ok")}).fail(function(e){var n;e.node&&e.error&&e.message?n=e:n=u._makeHookContext(a,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""}),u._triggerNodeEvent("loadError",n,null)!==!1&&u.nodeSetStatus(t,"error",n.message,n.details)})),e.when(n).done(function(t){var n;e.isPlainObject(t)&&(s(e.isArray(t.children),"source must contain (or be) an array of children"),s(a.isRoot(),"source may only be an object for root nodes"),n=t,t=t.children,delete n.children,e.extend(u.data,n)),s(e.isArray(t),"expected array of children"),a._setChildren(t),u._triggerNodeEvent("loadChildren",a)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(t,n){var r,i=t.node,o=t.options,u=e.extend({},t,{node:n}),a=i.children;if(a.length===1)return s(n===a[0]),this.nodeRemoveChildren(t);this.activeNode&&(n===this.activeNode||this.activeNode.isDescendantOf(n))&&this.activeNode.setActive(!1),this.focusNode&&(n===this.focusNode||this.focusNode.isDescendantOf(n))&&(this.focusNode=null),this.nodeRemoveMarkup(u),this.nodeRemoveChildren(u),r=e.inArray(n,a),s(r>=0),n.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,n),o.removeNode&&o.removeNode.call(t.tree,{type:"removeNode"},u),a.splice(r,1)},nodeRemoveChildMarkup:function(t){var n=t.node;n.ul&&(n.isRoot()?e(n.ul).empty():(e(n.ul).remove(),n.ul=null),n.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(t){var n,r=t.tree,i=t.node,s=i.children,o=t.options;if(!s)return;this.activeNode&&this.activeNode.isDescendantOf(i)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(i)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),n=e.extend({},t),i.visit(function(e){e.parent=null,r._callHook("treeRegisterNode",r,!1,e),o.removeNode&&(n.node=e,o.removeNode.call(t.tree,{type:"removeNode"},n))}),i.lazy?i.children=[]:i.children=null,this.nodeRenderStatus(t)},nodeRemoveMarkup:function(t){var n=t.node;n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,r,i,o,u){var a,f,l,c,h,p,d,v=t.node,m=t.tree,g=t.options,y=g.aria,b=!1,w=v.parent,E=!w,S=v.children;if(!E&&!w.ul)return;s(E||w.ul,"parent UL must exist"),E||(v.li&&(r||v.li.parentNode!==v.parent.ul)&&(v.li.parentNode!==v.parent.ul&&this.warn("unlink "+v+" (must be child of "+v.parent+")"),this.nodeRemoveMarkup(t)),v.li?this.nodeRenderStatus(t):(b=!0,v.li=n.createElement("li"),v.li.ftnode=v,y,v.key&&g.generateIds&&(v.li.id=g.idPrefix+v.key),v.span=n.createElement("span"),v.span.className="fancytree-node",y&&e(v.span).attr("aria-labelledby","ftal_"+v.key),v.li.appendChild(v.span),this.nodeRenderTitle(t),g.createNode&&g.createNode.call(m,{type:"createNode"},t)),g.renderNode&&g.renderNode.call(m,{type:"renderNode"},t));if(S){if(E||v.expanded||i===!0){if(!v.ul){v.ul=n.createElement("ul");if(o===!0&&!u||!v.expanded)v.ul.style.display="none";y&&e(v.ul).attr("role","group"),v.li?v.li.appendChild(v.ul):v.tree.$div.append(v.ul)}for(c=0,h=S.length;c<h;c++)d=e.extend({},t,{node:S[c]}),this.nodeRender(d,r,i,!1,!0);a=v.ul.firstChild;while(a)l=a.ftnode,l&&l.parent!==v?(v.debug("_fixParent: remove missing "+l,a),p=a.nextSibling,a.parentNode.removeChild(a),a=p):a=a.nextSibling;a=v.ul.firstChild;for(c=0,h=S.length-1;c<h;c++)f=S[c],l=a.ftnode,f!==l?v.ul.insertBefore(f.li,l.li):a=a.nextSibling}}else v.ul&&(this.warn("remove child markup for "+v),this.nodeRemoveChildMarkup(t));E||b&&w.ul.appendChild(v.li)},nodeRenderTitle:function(e,t){var n,i,s,o,u,a,f=e.node,l=e.tree,c=e.options,h=c.aria,p=f.getLevel(),d=[],v=f.data.icon;t!==r&&(f.title=t);if(!f.span)return;p<c.minExpandLevel?p>1&&(f.lazy||(f.expanded=!0),h?d.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>"):d.push("<span class='fancytree-expander fancytree-expander-fixed''></span>")):h?d.push("<span role='button' class='fancytree-expander'></span>"):d.push("<span class='fancytree-expander'></span>"),c.checkbox&&f.hideCheckbox!==!0&&!f.isStatusNode()&&(h?d.push("<span role='checkbox' class='fancytree-checkbox'></span>"):d.push("<span class='fancytree-checkbox'></span>")),o=h?" role='img'":"";if(v===!0||v!==!1&&c.icons!==!1)v&&typeof v=="string"?(v=v.charAt(0)==="/"?v:(c.imagePath||"")+v,d.push("<img src='"+v+"' class='fancytree-icon' alt='' />")):(i=c.iconClass&&c.iconClass.call(l,f,e)||f.data.iconclass||null,i?d.push("<span "+o+" class='fancytree-custom-icon "+i+"'></span>"):d.push("<span "+o+" class='fancytree-icon'></span>"));s="",c.renderTitle&&(s=c.renderTitle.call(l,{type:"renderTitle"},e)||""),s||(a=f.tooltip?" title='"+f.tooltip.replace("'","&apos;")+"'":"",n=h?" id='ftal_"+f.key+"'":"",o=h?" role='treeitem'":"",u=c.titlesTabbable?" tabindex='0'":"",s="<span "+o+" class='fancytree-title'"+n+a+u+">"+f.title+"</span>"),d.push(s),f.span.innerHTML=d.join(""),this.nodeRenderStatus(e)},nodeRenderStatus:function(t){var n=t.node,r=t.tree,i=t.options,s=n.hasChildren(),o=n.isLastSibling(),u=i.aria,a=e(n.span).find(".fancytree-title"),f=i._classNames,l=[],c=n[r.statusClassPropName];if(!c)return;l.push(f.node),r.activeNode===n&&l.push(f.active),r.focusNode===n?(l.push(f.focused),u&&a.attr("aria-activedescendant",!0)):u&&a.removeAttr("aria-activedescendant"),n.expanded?(l.push(f.expanded),u&&a.attr("aria-expanded",!0)):u&&a.removeAttr("aria-expanded"),n.folder&&l.push(f.folder),s!==!1&&l.push(f.hasChildren),o&&l.push(f.lastsib),n.lazy&&n.children==null&&l.push(f.lazy),n.partsel&&l.push(f.partsel),n._isLoading&&l.push(f.loading),n._error&&l.push(f.error),n.selected?(l.push(f.selected),u&&a.attr("aria-selected",!0)):u&&a.attr("aria-selected",!1),n.extraClasses&&l.push(n.extraClasses),s===!1?l.push(f.combinedExpanderPrefix+"n"+(o?"l":"")):l.push(f.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&n.children==null?"d":"")+(o?"l":"")),l.push(f.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),c.className=l.join(" "),n.li&&(n.li.className=o?f.lastsib:"")},nodeSetActive:function(t,n,r){r=r||{};var i,o=t.node,u=t.tree,a=t.options,f=r.noEvents===!0,l=o===u.activeNode;n=n!==!1;if(l===n)return c(o);if(n&&!f&&this._triggerNodeEvent("beforeActivate",o,t.originalEvent)===!1)return h(o,["rejected"]);n?(u.activeNode&&(s(u.activeNode!==o,"node was active (inconsistency)"),i=e.extend({},t,{node:u.activeNode}),u.nodeSetActive(i,!1),s(u.activeNode===null,"deactivate was out of sync?")),a.activeVisible&&o.makeVisible({scrollIntoView:!1}),u.activeNode=o,u.nodeRenderStatus(t),u.nodeSetFocus(t),f||u._triggerNodeEvent("activate",o,t.originalEvent)):(s(u.activeNode===o,"node was not active (inconsistency)"),u.activeNode=null,this.nodeRenderStatus(t),f||t.tree._triggerNodeEvent("deactivate",o,t.originalEvent))},nodeSetExpanded:function(t,n,i){i=i||{};var s,o,u,a,f,l,p=t.node,d=t.tree,v=t.options,m=i.noAnimation===!0,g=i.noEvents===!0;n=n!==!1;if(p.expanded&&n||!p.expanded&&!n)return c(p);if(n&&!p.lazy&&!p.hasChildren())return c(p);if(!n&&p.getLevel()<v.minExpandLevel)return h(p,["locked"]);if(!g&&this._triggerNodeEvent("beforeExpand",p,t.originalEvent)===!1)return h(p,["rejected"]);!m&&!p.isVisible()&&(m=i.noAnimation=!0),o=new e.Deferred;if(n&&!p.expanded&&v.autoCollapse){f=p.getParentList(!1,!0),l=v.autoCollapse;try{v.autoCollapse=!1;for(u=0,a=f.length;u<a;u++)this._callHook("nodeCollapseSiblings",f[u],i)}finally{v.autoCollapse=l}}return o.done(function(){n&&v.autoScroll&&!m?p.getLastChild().scrollIntoView(!0,{topNode:p}).always(function(){g||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}):g||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}),s=function(r){var i,s,o,u;p.expanded=n,d._callHook("nodeRender",t,!1,!1,!0);if(p.ul){o=p.ul.style.display!=="none",u=!!p.expanded;if(o===u)p.warn("nodeSetExpanded: UL.style.display already set");else{if(!!v.fx&&!m){i=v.fx.duration||200,s=v.fx.easing,e(p.ul).animate(v.fx,i,s,function(){r()});return}p.ul.style.display=p.expanded||!parent?"":"none"}}r()},n&&p.lazy&&p.hasChildren()===r?p.load().done(function(){o.notifyWith&&o.notifyWith(p,["loaded"]),s(function(){o.resolveWith(p)})}).fail(function(e){s(function(){o.rejectWith(p,["load failed ("+e+")"])})}):s(function(){o.resolveWith(p)}),o.promise()},nodeSetFocus:function(t,n){var r,i=t.tree,s=t.node;n=n!==!1;if(i.focusNode){if(i.focusNode===s&&n)return;r=e.extend({},t,{node:i.focusNode}),i.focusNode=null,this._triggerNodeEvent("blur",r),this._callHook("nodeRenderStatus",r)}n&&(this.hasFocus()||(s.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,!0)),s.makeVisible({scrollIntoView:!1}),i.focusNode=s,this._triggerNodeEvent("focus",t),t.options.autoScroll&&s.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(e,t){var n=e.node,r=e.tree,i=e.options;t=t!==!1,n.debug("nodeSetSelected("+t+")",e);if(n.unselectable)return;if(n.selected&&t||!n.selected&&!t)return!!n.selected;if(this._triggerNodeEvent("beforeSelect",n,e.originalEvent)===!1)return!!n.selected;t&&i.selectMode===1?r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1):i.selectMode===3&&(n.selected=t,n.fixSelection3AfterClick()),n.selected=t,this.nodeRenderStatus(e),r.lastSelectedNode=t?n:null,r._triggerNodeEvent("select",e)},nodeSetStatus:function(t,n,r,i){function u(){var e=s.children?s.children[0]:null;if(e&&e.isStatusNode()){try{s.ul&&(s.ul.removeChild(e.li),e.li=null)}catch(t){}s.children.length===1?s.children=[]:s.children.shift()}}function a(t,n){var r=s.children?s.children[0]:null;return r&&r.isStatusNode()?(e.extend(r,t),r.statusNodeType=n,o._callHook("nodeRender",r),o._callHook("nodeRenderTitle",r)):(t.key="_statusNode",s._setChildren([t]),s.children[0].statusNodeType=n,o.render()),s.children[0]}var s=t.node,o=t.tree;switch(n){case"ok":u(),s._isLoading=!1,s._error=null,s.renderStatus();break;case"loading":s.parent||a({title:o.options.strings.loading+(r?" ("+r+") ":""),tooltip:i,extraClasses:"fancytree-statusnode-wait"},n),s._isLoading=!0,s._error=null,s.renderStatus();break;case"error":a({title:o.options.strings.loadError+(r?" ("+r+") ":""),tooltip:i,extraClasses:"fancytree-statusnode-error"},n),s._isLoading=!1,s._error={message:r,details:i},s.renderStatus();break;default:e.error("invalid node status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){return this.nodeSetSelected(e,!e.node.selected)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(e){},treeDestroy:function(e){},treeInit:function(e){this.treeLoad(e)},treeLoad:function(t,n){var r,s,o=t.tree,u=t.widget.element,a,f=e.extend({},t,{node:this.rootNode});o.rootNode.children&&this.treeClear(t),n=n||this.options.source;if(!n){r=u.data("type")||"html";switch(r){case"html":s=u.find(">ul:first"),s.addClass("ui-fancytree-source ui-helper-hidden"),n=e.ui.fancytree.parseHtml(s),this.data=e.extend(this.data,d(s));break;case"json":n=e.parseJSON(u.text()),n.children&&(n.title&&(o.title=n.title),n=n.children);break;default:e.error("Invalid data-type: "+r)}}else typeof n=="string"&&i();return a=this.nodeLoadChildren(f,n).done(function(){o.render(),t.options.selectMode===3&&o.rootNode.fixSelection3FromEndNodes(),o._triggerTreeEvent("init",!0)}).fail(function(){o.render(),o._triggerTreeEvent("init",!1)}),a},treeRegisterNode:function(e,t,n){},treeSetFocus:function(e,t,n){t=t!==!1,t!==this.hasFocus()&&(this._hasFocus=t,this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"))}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,extensions:[],fx:{height:"toggle",duration:200},generateIds:!1,icons:!0,id:null,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!"},tabbable:!0,titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partsel:"fancytree-partsel",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new N(this),this.$source=this.source||this.element.data("type")==="json"?this.element:this.element.find(">ul:first");var t,n,i,o=this.options.extensions,u=this.tree;for(i=0;i<o.length;i++)n=o[i],t=e.ui.fancytree._extensions[n],t||e.error("Could not apply extension '"+n+"' (it is not registered, did you forget to include it?)"),this.tree.options[n]=e.extend(!0,{},t.options,this.tree.options[n]),s(this.tree.ext[n]===r,"Extension name must not exist as Fancytree.ext attribute: '"+n+"'"),this.tree.ext[n]={},l(this.tree,u,t,n),u=t;this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(t,n){var r=!0,i=!1;switch(t){case"aria":case"checkbox":case"icons":case"minExpandLevel":case"tabbable":this.tree._callHook("treeCreate",this.tree),i=!0;break;case"source":r=!1,this.tree._callHook("treeLoad",this.tree,n)}this.tree.debug("set option "+t+"="+n+" <"+typeof n+">"),r&&e.Widget.prototype._setOption.apply(this,arguments),i&&this.tree.render(!0,!1)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),this.tree.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden"),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.unbind(t),this.tree.$container.unbind(t),e(n).unbind(t)},_bind:function(){var e=this,t=this.options,n=this.tree,r=n._ns;this._unbind(),n.$container.on("focusin"+r+" focusout"+r,function(e){var t=g.getNode(e),r=e.type==="focusin";t?n._callHook("nodeSetFocus",t,r):n._callHook("treeSetFocus",n,r)}).on("selectstart"+r,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+r,function(e){if(t.disabled||t.keyboard===!1)return!0;var r,i=n.focusNode,s=n._makeHookContext(i||n,e),o=n.phase;try{return n.phase="userEvent",i?r=n._triggerNodeEvent("keydown",i,e):r=n._triggerTreeEvent("keydown",e),r==="preventNav"?r=!0:r!==!1&&(r=n._callHook("nodeKeydown",s)),r}finally{n.phase=o}}).on("click"+r+" dblclick"+r,function(n){if(t.disabled)return!0;var r,i=g.getEventTarget(n),s=i.node,o=e.tree,u=o.phase;if(!s)return!0;r=o._makeHookContext(s,n);try{o.phase="userEvent";switch(n.type){case"click":return r.targetType=i.type,o._triggerNodeEvent("click",r,n)===!1?!1:o._callHook("nodeClick",r);case"dblclick":return r.targetType=i.type,o._triggerNodeEvent("dblclick",r,n)===!1?!1:o._callHook("nodeDblclick",r)}}finally{o.phase=u}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(""+e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),g=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.4.1",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:N,_FancytreeNodeClass:T,jquerySupports:{positionMyOfs:a(e.ui.version,1,9)},assert:function(e,t){return s(e,t)},debounce:function(e,t,n,r){var i;return arguments.length===3&&typeof n!="boolean"&&(r=n,n=!1),function(){var s=arguments;r=r||this,n&&!i&&t.apply(r,s),clearTimeout(i),i=setTimeout(function(){n||t.apply(r,s),i=null},e)}},debug:function(t){e.ui.fancytree.debugLevel>=2&&o("log",arguments)},error:function(e){o("error",arguments)},escapeHtml:function(e){return(""+e).replace(/[&<>"'\/]/g,function(e){return y[e]})},unescapeHtml:function(e){var t=n.createElement("div");return t.innerHTML=e,t.childNodes.length===0?"":t.childNodes[0].nodeValue},getEventTargetType:function(e){return this.getEventTarget(e).type},getEventTarget:function(t){var n=t&&t.target?t.target.className:"",i={node:this.getNode(t.target),type:r};return/\bfancytree-title\b/.test(n)?i.type="title":/\bfancytree-expander\b/.test(n)?i.type=i.node.hasChildren()===!1?"prefix":"expander":/\bfancytree-checkbox\b/.test(n)||/\bfancytree-radio\b/.test(n)?i.type="checkbox":/\bfancytree-icon\b/.test(n)?i.type="icon":/\bfancytree-node\b/.test(n)?i.type="title":t&&t.target&&e(t.target).closest(".fancytree-title").length&&(i.type="title"),i},getNode:function(e){if(e instanceof T)return e;e.selector!==r?e=e[0]:e.originalEvent!==r&&(e=e.target);while(e){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},info:function(t){e.ui.fancytree.debugLevel>=1&&o("info",arguments)},parseHtml:function(t){var n,i,s,o,u,a,f,l,c=t.find(">li"),h=[];return c.each(function(){var c,p=e(this),v=p.find(">span:first",this),m=v.length?null:p.find(">a:first"),g={tooltip:null,data:{}};v.length?g.title=v.html():m&&m.length?(g.title=m.html(),g.data.href=m.attr("href"),g.data.target=m.attr("target"),g.tooltip=m.attr("title")):(g.title=p.html(),o=g.title.search(/<ul/i),o>=0&&(g.title=g.title.substring(0,o))),g.title=e.trim(g.title);for(i=0,s=b.length;i<s;i++)g[b[i]]=r;f=this.className.split(" "),n=[];for(i=0,s=f.length;i<s;i++)l=f[i],w[l]?g[l]=!0:n.push(l);g.extraClasses=n.join(" "),u=p.attr("title"),u&&(g.tooltip=u),u=p.attr("id"),u&&(g.key=u),c=d(p);if(c&&!e.isEmptyObject(c)){for(i=0,s=E.length;i<s;i++)u=E[i],a=c[u],a!=null&&(delete c[u],g[u]=a);e.extend(g.data,c)}t=p.find(">ul:first"),t.length?g.children=e.ui.fancytree.parseHtml(t):g.children=g.lazy?r:null,h.push(g)}),h},registerExtension:function(t){s(t.name!=null,"extensions must have a `name` property."),s(t.version!=null,"extensions must have a `version` property."),e.ui.fancytree._extensions[t.name]=t},warn:function(e){o("warn",arguments)}})})(jQuery,window,document);